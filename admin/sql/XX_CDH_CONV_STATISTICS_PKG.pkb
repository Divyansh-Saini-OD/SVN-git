SET VERIFY OFF
WHENEVER SQLERROR CONTINUE;
WHENEVER OSERROR EXIT FAILURE ROLLBACK;

CREATE OR REPLACE PACKAGE BODY XX_CDH_CONV_STATISTICS_PKG
-- +===================================================================+
-- |                  Office Depot - Project Simplify                  |
-- |                Oracle NAIO Consulting Organization                |
-- +===================================================================+
-- | Name        :  XX_CDH_CONV_STATISTICS_PKG.pkb                     |
-- | Description :  CDH Customer Conversion Master Package Body        |
-- |                                                                   |
-- |Change Record:                                                     |
-- |===============                                                    |
-- |Version   Date        Author             Remarks                   |
-- |========  =========== ================== ==========================|
-- |DRAFT 1a  05-Aug-2007 Ambarish Mukherjee Initial draft version     |
-- |2.0       18-NOV-2015  Manikant Kasu     Removed schema alias as   | 
-- |                                         part of GSCC R12.2.2      |
-- |                                         Retrofit                  |
-- +===================================================================+
AS
gt_request_id                 fnd_concurrent_requests.request_id%TYPE
                              := fnd_global.conc_request_id();
                              
-- +===================================================================+
-- | Name        :  conv_stat_main                                     |
-- | Description :  This procedure is invoked from the CDH Conversion  |
-- |                Master Concurrent Request.This would submit Child  |
-- |                programs based on batch_ids generated by ETL       |
-- |                                                                   |
-- |                                                                   |
-- | Parameters  :                                                     |
-- |                                                                   |
-- | Returns     :                                                     |
-- |                                                                   |
-- +===================================================================+
PROCEDURE conv_stat_main
   (  x_errbuf                OUT VARCHAR2,
      x_retcode               OUT VARCHAR2,
      p_aops_batch_id         IN  NUMBER,
      p_batch_id              IN  NUMBER,
      p_outfile_dir           IN  VARCHAR2
   ) 
IS
   d1                         NUMBER := 0;
   d2                         NUMBER := 0;
   d3                         NUMBER := 0;
   d4                         NUMBER := 0;
   d5                         NUMBER := 0;
   d6                         NUMBER := 0;
   d7                         NUMBER := 0;
   d8                         NUMBER := 0;
   d9                         NUMBER := 0;
   d10                        NUMBER := 0;
   d11                        NUMBER := 0;
   d12                        NUMBER := 0;
   d13                        NUMBER := 0;
   d14                        NUMBER := 0;
   d15                        NUMBER := 0;
   d16                        NUMBER := 0;
   d17                        NUMBER := 0;
   d18                        NUMBER := 0;
   d19                        NUMBER := 0;
   d20                        NUMBER := 0;
   d21                        NUMBER := 0;
   d22                        NUMBER := 0;
   d23                        NUMBER := 0;
   d24                        NUMBER := 0;
   d25                        NUMBER := 0;
   d26                        NUMBER := 0;
   d27                        NUMBER := 0;
   d28                        NUMBER := 0;
   d29                        NUMBER := 0;
   d30                        NUMBER := 0;
   d31                        NUMBER := 0;
   d32                        NUMBER := 0;
   d33                        NUMBER := 0;
   d34                        NUMBER := 0;
   d35                        NUMBER := 0;
   d36                        NUMBER := 0;
   f4                         NUMBER := 0;
   f5                         NUMBER := 0;
   f6                         NUMBER := 0;
   f7                         NUMBER := 0;
   f8                         NUMBER := 0;
   f10                        NUMBER := 0;
   f11                        NUMBER := 0;
   f9                         NUMBER := 0;
   f12                        NUMBER := 0;
   f13                        NUMBER := 0;
   f14                        NUMBER := 0;
   f15                        NUMBER := 0;
   f16                        NUMBER := 0;
   f17                        NUMBER := 0;
   f18                        NUMBER := 0;
   f19                        NUMBER := 0;
   f20                        NUMBER := 0;
   f21                        NUMBER := 0;
   f22                        NUMBER := 0;
   g4                         NUMBER := 0;
   g5                         NUMBER := 0;
   g6                         NUMBER := 0;
   g7                         NUMBER := 0;
   g8                         NUMBER := 0;
   g10                        NUMBER := 0;
   g11                        NUMBER := 0;
   g9                         NUMBER := 0;
   g12                        NUMBER := 0;
   g13                        NUMBER := 0;
   g14                        NUMBER := 0;
   g15                        NUMBER := 0;
   g16                        NUMBER := 0;
   g17                        NUMBER := 0;
   g18                        NUMBER := 0;
   g19                        NUMBER := 0;
   g20                        NUMBER := 0;
   g21                        NUMBER := 0;
   g22                        NUMBER := 0;
   e4                         NUMBER := 0;
   e5                         NUMBER := 0;
   e6                         NUMBER := 0;
   e7                         NUMBER := 0;
   e8                         NUMBER := 0;
   e9                         NUMBER := 0;
   e10                        NUMBER := 0;
   e11                        NUMBER := 0;
   e12                        NUMBER := 0;
   e13                        NUMBER := 0;
   e14                        NUMBER := 0;
   e15                        NUMBER := 0;
   e16                        NUMBER := 0;
   e17                        NUMBER := 0;
   e18                        NUMBER := 0;
   e19                        NUMBER := 0;
   e20                        NUMBER := 0;
   e21                        NUMBER := 0;
   e22                        NUMBER := 0;
   e21_1                      NUMBER := 0;
   e21_2                      NUMBER := 0;
   e21_3                      NUMBER := 0;
   e21_4                      NUMBER := 0;
   e21_5                      NUMBER := 0;
   e21_6                      NUMBER := 0;
   e21_7                      NUMBER := 0;
   v_out_dir_name             VARCHAR2(2000);
   v_hdr_file_name            VARCHAR2(250);
   v_dtl_file_name            VARCHAR2(250);
   v_out_file_ptr             UTL_FILE.FILE_TYPE;
   v_dtl_record               VARCHAR2(4000);
   lv_cmd                     VARCHAR2(4000); 
   le_skip_process            EXCEPTION;
   ln_ebs_batch_id            NUMBER;
   
   CURSOR lc_time_cur ( p_ebs_batch_id   NUMBER,
                        p_aops_batch_id  NUMBER
                      )
   IS
   SELECT b.user_concurrent_program_name,
          a.request_id, 
          TO_CHAR(a.actual_start_date,'hh24:mi:ss')                         start_time, 
          TO_CHAR(a.actual_completion_date,'hh24:mi:ss')                    end_time, 
          ROUND(((a.actual_completion_date - a.actual_start_date)*24*60),2) time_min 
   FROM   fnd_concurrent_requests a, 
          fnd_concurrent_programs_vl b 
   WHERE  (  a.argument_text LIKE '%'||p_ebs_batch_id||'%' OR 
             a.argument_text LIKE '%'||p_aops_batch_id||'%'
          )
   AND    a.concurrent_program_id = b.concurrent_program_id 
   ORDER  BY a.request_id;
   

BEGIN

   IF p_aops_batch_id IS NULL AND 
      p_batch_id      IS NULL THEN
   
      fnd_file.put_line(fnd_file.log,'AOPS Batch ID or EBS Batch ID should be provided !!');
      RAISE le_skip_process;
   END IF;
   
   IF p_aops_batch_id IS NOT NULL THEN
      
      BEGIN
         SELECT ebs_batch_id
         INTO   ln_ebs_batch_id
         FROM   xx_owb_crmbatch_status
         WHERE  aops_batch_id = p_aops_batch_id;   
      EXCEPTION
         WHEN OTHERS THEN
            fnd_file.put_line (fnd_file.log, 'EBS Batch Id not Found for AOPS Batch Id - '||p_aops_batch_id);
            fnd_file.put_line (fnd_file.log, 'Aborting..');
            RAISE le_skip_process;
      END;
   ELSE
      ln_ebs_batch_id := p_batch_id;
   END IF;   
   
   ------------------------
   -- Staging Table Counts
   ------------------------

   SELECT /*+ parallel */ COUNT(*) INTO d1  FROM HZ_IMP_PARTIES_INT             WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d2  FROM HZ_IMP_ADDRESSES_INT           WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d3  FROM HZ_IMP_ADDRESSUSES_INT         WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d4  FROM HZ_IMP_CONTACTS_INT            WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d5  FROM HZ_IMP_CONTACTPTS_INT          WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d6  FROM XXOD_HZ_IMP_CONTACTPTS_STG     WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d7  FROM HZ_IMP_CONTACTROLES_INT        WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d8  FROM HZ_IMP_RELSHIPS_INT            WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d9  FROM XXOD_HZ_IMP_ACCOUNTS_STG       WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d10 FROM XXOD_HZ_IMP_ACCT_SITES_STG     WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d11 FROM XXOD_HZ_IMP_ACCT_SITE_USES_STG WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d12 FROM XXOD_HZ_IMP_ACCOUNT_PROF_STG   WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d13 FROM XXOD_HZ_IMP_ACCOUNT_PROF_STG   WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d14 FROM XXOD_HZ_IMP_ACCT_CONTACT_STG   WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d15 FROM XXOD_HZ_IMP_ACCT_CNTTROLES_STG WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d16 FROM XXOD_HZ_IMP_CUSTOMER_BANKS_STG WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d17 FROM XXOD_HZ_IMP_ACCT_PAYMETH_STG   WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d18 FROM XXOD_HZ_IMP_EXT_ATTRIBS_STG    WHERE batch_id = ln_ebs_batch_id;
   SELECT /*+ parallel */ COUNT(*) INTO d13 FROM XXOD_HZ_IMP_RELSHIPS_STG       WHERE batch_id = ln_ebs_batch_id;
   
   ----------------------------
   -- Common View Table Counts
   ----------------------------
   
   --SELECT /*+ parallel */ COUNT(*) INTO d19 FROM XXOD_HZ_IMP_PARTIES_INT        WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d20 FROM XXOD_HZ_IMP_ADDRESSES_INT      WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d21 FROM XXOD_HZ_IMP_ADDRESSUSES_INT    WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d22 FROM XXOD_HZ_IMP_CONTACTS_INT       WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d23 FROM XXOD_HZ_IMP_CONTACTPTS_INT     WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d24 FROM XXOD_HZ_IMP_CONTACTPTS_INT     WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d25 FROM XXOD_HZ_IMP_CONTACTROLES_INT   WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d26 FROM XXOD_HZ_IMP_RELSHIPS_INT       WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d27 FROM XXOD_HZ_IMP_ACCOUNTS_INT       WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d28 FROM XXOD_HZ_IMP_ACCOUNT_SITES_INT  WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d29 FROM XXOD_HZ_IMP_ACCT_SITEUSES_INT  WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d30 FROM XXOD_HZ_IMP_ACCT_PROFILES_INT  WHERE batch_id = ln_ebs_batch_id;
   ----SELECT /*+ parallel */ COUNT(*) INTO d31 FROM XXOD_HZ_IMP_ACCT_PROFILES_INT  WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d32 FROM XXOD_HZ_IMP_ACCT_CONTACTS_INT  WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d33 FROM XXOD_HZ_IMP_ACCT_CNTROLES_INT  WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d34 FROM XXOD_HZ_CUSTOMER_BANKS_INT     WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d35 FROM XXOD_HZ_IMP_ACCT_PAYMTHD_INT   WHERE batch_id = ln_ebs_batch_id;
   --SELECT /*+ parallel */ COUNT(*) INTO d36 FROM XXOD_HZ_IMP_EXT_ATTRIBS_INT    WHERE batch_id = ln_ebs_batch_id;
   --
   --------------------------
   -- Program Error Counts
   ------------------------
   
   SELECT parties_in_batch       - parties_imported,
          addresses_in_batch     - addresses_imported,
          addressuses_in_batch   - addressuses_imported,
          contacts_in_batch      - contacts_imported,
          contactpoints_in_batch - contactpoints_imported,
          contactroles_in_batch  - contactroles_imported,
          relationships_in_batch - relationships_imported,
          parties_imported,
          addresses_imported,
          addressuses_imported,
          contacts_imported,
          contactpoints_imported,
          contactroles_imported,
          relationships_imported
   INTO   f4,f5,f6,f7,f8,f10,f11,g4,g5,g6,g7,g8,g10,g11
   FROM   hz_imp_batch_summary 
   WHERE  batch_id = ln_ebs_batch_id;
   
   SELECT /*+ parallel */ COUNT(*) INTO f9  FROM XXOD_HZ_IMP_CONTACTPTS_STG     WHERE batch_id = ln_ebs_batch_id AND interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f12 FROM XXOD_HZ_IMP_ACCOUNTS_STG       WHERE batch_id = ln_ebs_batch_id AND interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f13 FROM XXOD_HZ_IMP_ACCT_SITES_STG     WHERE batch_id = ln_ebs_batch_id AND interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f14 FROM XXOD_HZ_IMP_ACCT_SITE_USES_STG WHERE batch_id = ln_ebs_batch_id AND interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f15 FROM XXOD_HZ_IMP_ACCOUNT_PROF_STG   WHERE batch_id = ln_ebs_batch_id AND interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f16 FROM XXOD_HZ_IMP_ACCOUNT_PROF_STG   WHERE batch_id = ln_ebs_batch_id AND profile_amt_interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f17 FROM XXOD_HZ_IMP_ACCT_CONTACT_STG   WHERE batch_id = ln_ebs_batch_id AND role_interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f18 FROM XXOD_HZ_IMP_ACCT_CNTTROLES_STG WHERE batch_id = ln_ebs_batch_id AND interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f19 FROM XXOD_HZ_IMP_CUSTOMER_BANKS_STG WHERE batch_id = ln_ebs_batch_id AND interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f20 FROM XXOD_HZ_IMP_ACCT_PAYMETH_STG   WHERE batch_id = ln_ebs_batch_id AND interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f21 FROM XXOD_HZ_IMP_EXT_ATTRIBS_STG    WHERE batch_id = ln_ebs_batch_id AND interface_status = 6;
   SELECT /*+ parallel */ COUNT(*) INTO f22 FROM XXOD_HZ_IMP_RELSHIPS_STG       WHERE batch_id = ln_ebs_batch_id AND interface_status = 6;

   -------------------------
   -- Program Sucess Counts
   -------------------------
      
   SELECT /*+ parallel */ COUNT(*) INTO g9  FROM XXOD_HZ_IMP_CONTACTPTS_STG     WHERE batch_id = ln_ebs_batch_id AND interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g12 FROM XXOD_HZ_IMP_ACCOUNTS_STG       WHERE batch_id = ln_ebs_batch_id AND interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g13 FROM XXOD_HZ_IMP_ACCT_SITES_STG     WHERE batch_id = ln_ebs_batch_id AND interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g14 FROM XXOD_HZ_IMP_ACCT_SITE_USES_STG WHERE batch_id = ln_ebs_batch_id AND interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g15 FROM XXOD_HZ_IMP_ACCOUNT_PROF_STG   WHERE batch_id = ln_ebs_batch_id AND interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g16 FROM XXOD_HZ_IMP_ACCOUNT_PROF_STG   WHERE batch_id = ln_ebs_batch_id AND profile_amt_interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g17 FROM XXOD_HZ_IMP_ACCT_CONTACT_STG   WHERE batch_id = ln_ebs_batch_id AND role_interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g18 FROM XXOD_HZ_IMP_ACCT_CNTTROLES_STG WHERE batch_id = ln_ebs_batch_id AND interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g19 FROM XXOD_HZ_IMP_CUSTOMER_BANKS_STG WHERE batch_id = ln_ebs_batch_id AND interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g20 FROM XXOD_HZ_IMP_ACCT_PAYMETH_STG   WHERE batch_id = ln_ebs_batch_id AND interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g21 FROM XXOD_HZ_IMP_EXT_ATTRIBS_STG    WHERE batch_id = ln_ebs_batch_id AND interface_status = 7;
   SELECT /*+ parallel */ COUNT(*) INTO g22 FROM XXOD_HZ_IMP_RELSHIPS_STG       WHERE batch_id = ln_ebs_batch_id AND interface_status = 7;
   
   SELECT /*+ FULL(A) PARALLEL(a,8) */ count(*)
   INTO   e4
   FROM   hz_parties a
   WHERE  EXISTS ( SELECT 1
                   FROM   hz_imp_parties_int b
                   WHERE  b.batch_id = ln_ebs_batch_id
                   AND    b.party_orig_system_reference = a.orig_system_reference);

   SELECT /*+ FULL(A) PARALLEL(a,8) */ count(*)
   INTO   e5
   FROM   hz_party_sites a
   WHERE  attribute11 = ln_ebs_batch_id;

   SELECT /*+ FULL(A) PARALLEL(a,8) */ count(*)
   INTO   e6
   FROM   hz_party_site_uses a
   WHERE  EXISTS ( SELECT 1
                   FROM   hz_party_sites c
                   WHERE  c.party_site_id = a.party_site_id
                   AND    EXISTS ( SELECT 1
                                   FROM   hz_imp_addressuses_int b
                                   WHERE  b.batch_id = ln_ebs_batch_id
                                   AND    b.site_orig_system_reference = c.orig_system_reference
                                 )
                 );

   SELECT /*+ FULL(A) PARALLEL(a,8) */ count(*)
   INTO   e7
   FROM   hz_org_contacts a
   WHERE  EXISTS ( SELECT 1
                   FROM   HZ_IMP_CONTACTS_INT b
                   WHERE  b.batch_id = ln_ebs_batch_id
                   AND    b.contact_orig_system_reference = a.orig_system_reference);

   SELECT /*+ FULL(A) PARALLEL(a,8) */ count(*)
   INTO   e10
   FROM   hz_org_contact_roles a
   WHERE  EXISTS ( SELECT 1
                   FROM   hz_org_contacts c
                   WHERE  c.org_contact_id = a.org_contact_id
                   AND    EXISTS ( SELECT 1
                                   FROM   hz_imp_contactroles_int b
                                   WHERE  b.batch_id = ln_ebs_batch_id
                                   AND    b.contact_orig_system_reference = c.orig_system_reference
                                 )
                 );                

   SELECT COUNT(*)
   INTO   e12
   FROM   hz_orig_sys_references a,
          xxod_hz_imp_acct_contact_stg b
   WHERE  a.orig_system_reference = b.account_orig_system_reference
   AND    a.orig_system           = b.account_orig_system
   AND    a.owner_table_name      = 'HZ_CUST_ACCOUNTS'
   AND    a.status                = 'A'
   AND    b.batch_id              = ln_ebs_batch_id;
   
   SELECT COUNT(*)
   INTO   e13
   FROM   hz_orig_sys_references a,
          xxod_hz_imp_acct_sites_stg b
   WHERE  a.orig_system_reference = b.acct_site_orig_sys_reference
   AND    a.orig_system           = b.acct_site_orig_system
   AND    a.owner_table_name      = 'HZ_CUST_ACCT_SITES_ALL'
   AND    a.status                = 'A'
   AND    b.batch_id              = ln_ebs_batch_id;
   

   SELECT COUNT(*)
   INTO   e14
   FROM   hz_orig_sys_references a,
          xxod_hz_imp_acct_site_uses_stg b
   WHERE  a.orig_system_reference = b.acct_site_orig_sys_reference||'-'||b.site_use_code
   AND    a.orig_system           = b.acct_site_orig_system
   AND    a.owner_table_name      = 'HZ_CUST_SITE_USES_ALL'
   AND    a.status                = 'A'
   AND    b.batch_id              = ln_ebs_batch_id;

   SELECT /*+ FULL(A) PARALLEL(a,8) */ count(*)
   INTO   e15
   FROM   hz_customer_profiles a
   WHERE  EXISTS ( SELECT 1
                   FROM   hz_cust_accounts c
                   WHERE  c.cust_account_id = a.cust_account_id
                   AND    EXISTS ( SELECT 1
                                   FROM   xxod_hz_imp_account_prof_stg b
                                   WHERE  b.batch_id = ln_ebs_batch_id
                                   AND    b.account_orig_system_reference = c.orig_system_reference
                                 )
                 );


   SELECT /*+ FULL(A) PARALLEL(a,8) */ count(*)
   INTO   e16
   FROM   hz_cust_profile_amts  a
   WHERE  EXISTS ( SELECT 1
                   FROM   hz_cust_accounts c
                   WHERE  c.cust_account_id = a.cust_account_id
                   AND    EXISTS ( SELECT 1
                                   FROM   xxod_hz_imp_account_prof_stg b
                                   WHERE  b.batch_id = ln_ebs_batch_id
                                   AND    b.account_orig_system_reference = c.orig_system_reference
                                 )
                 );     

   SELECT COUNT(*)
   INTO   e17
   FROM   hz_orig_sys_references a,
          xxod_hz_imp_acct_contact_stg b
   WHERE  a.orig_system_reference = b.contact_orig_system_reference
   AND    a.orig_system           = b.contact_orig_system
   AND    a.owner_table_name      = 'HZ_CUST_ACCOUNT_ROLES'
   AND    a.status                = 'A'
   AND    b.batch_id              = ln_ebs_batch_id;

   SELECT /*+ FULL(a) PARALLEL(a,8) */COUNT(*)
   INTO   e18
   FROM   hz_role_responsibility a
   WHERE  EXISTS ( SELECT 1
                   FROM   xxod_hz_imp_acct_cnttroles_stg b
                   WHERE  b.batch_id = ln_ebs_batch_id
                   AND    b.contact_orig_system_reference = a.orig_system_reference);

   SELECT COUNT(*)
   INTO   e9
   FROM   hz_orig_sys_references a,
          xxod_hz_imp_contactpts_stg b
   WHERE  a.orig_system_reference = b.cp_orig_system_reference
   AND    a.orig_system           = b.cp_orig_system
   AND    a.owner_table_name      = 'HZ_CONTACT_POINTS'
   AND    a.status                = 'A'
   AND    b.batch_id              = ln_ebs_batch_id;   
                   
   SELECT COUNT(*)
   INTO   e19
   FROM   ap_bank_accounts a,
          xxod_hz_imp_customer_banks_stg b 
   WHERE  a.bank_account_name = b.bank_account_name
   AND    a.bank_account_num  = b.bank_account_num
   AND    b.batch_id          = ln_ebs_batch_id;
   
   SELECT COUNT(*) 
   INTO   e20
   FROM   xxod_hz_imp_acct_paymeth_stg a,
          hz_cust_accounts b,
          ra_cust_receipt_methods c,
          ar_receipt_methods d
   WHERE  a.batch_id                      = ln_ebs_batch_id
   AND    a.account_orig_system_reference = b.orig_system_reference
   AND    c.customer_id                   = b.cust_account_id
   AND    c.receipt_method_id             = d.receipt_method_id
   AND    d.name                          = a.payment_method_name;
   
   SELECT COUNT(*) INTO e21_1 FROM hz_org_profiles_ext_b  WHERE n_ext_attr20 = ln_ebs_batch_id;
   
   SELECT COUNT(*) INTO e21_2 FROM hz_per_profiles_ext_b  WHERE n_ext_attr20 = ln_ebs_batch_id;
   
   SELECT COUNT(*) INTO e21_3 FROM hz_locations_ext_b     WHERE n_ext_attr20 = ln_ebs_batch_id;
   
   SELECT COUNT(*) INTO e21_4 FROM hz_party_sites_ext_b   WHERE n_ext_attr20 = ln_ebs_batch_id;
   
   SELECT COUNT(*) INTO e21_5 FROM xx_cdh_cust_acct_ext_b WHERE n_ext_attr20 = ln_ebs_batch_id;
   
   SELECT COUNT(*) INTO e21_6 FROM xx_cdh_acct_site_ext_b WHERE n_ext_attr20 = ln_ebs_batch_id;
   
   SELECT COUNT(*) INTO e21_7 FROM xx_cdh_site_uses_ext_b WHERE n_ext_attr20 = ln_ebs_batch_id;
   
   e21 := e21_1 + e21_2 + e21_3 + e21_4 + e21_5 + e21_6 + e21_7;

   FND_FILE.PUT_LINE(FND_FILE.LOG,'Generating Output File');
   
   IF p_outfile_dir IS NOT NULL THEN
      v_hdr_file_name := 'XX_CDH_CONV_'||ln_ebs_batch_id||'.csv';
      v_out_dir_name  := p_outfile_dir;
      --v_out_dir_name  := fnd_profile.value ('XX_CDH_UTL_FILE_DIR');
      
   
      FND_FILE.PUT_LINE(FND_FILE.LOG,'Path - '||v_out_dir_name);
      FND_FILE.PUT_LINE(FND_FILE.LOG,'File Name - '||v_hdr_file_name);

      --'/app/ebs/ctgsidev02/utl_file_out';
      v_out_file_ptr := UTL_FILE.FOPEN (v_out_dir_name, v_hdr_file_name, 'W');

      v_dtl_record := 'Oracle Table (Bulk/Staging)'||','||
                      'Entity'||','||'STG Count'||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||'Oracle Base Table Count'||','||
                      'Total Errors'||','||'Total Processed'||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record);

      v_dtl_record := 'HZ_IMP_PARTIES_INT'||','||
                      'Parties'||','||d1||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e4||','||
                      f4||','||g4||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'HZ_IMP_ADDRESSES_INT'||','||
                      'Party Sites'||','||d2||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e5||','||
                      f5||','||g5||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'HZ_IMP_ADDRESSUSES_INT'||','||
                      'Party Site Uses'||','||d3||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e6||','||
                      f6||','||g6||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'HZ_IMP_CONTACTS_INT'||','||
                      'Party Contacts'||','||d4||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e7||','||
                      f7||','||g7||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'HZ_IMP_CONTACTPTS_INT'||','||
                      'Party Contact Points'||','||d5||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e8||','||
                      f8||','||g8||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_CONTACTPTS_STG'||','||
                      'Account Contact Points'||','||d6||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e9||','||
                      f9||','||g9||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'HZ_IMP_CONTACTROLES_INT'||','||
                      'Party Roles'||','||d7||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e10||','||
                      f10||','||g10||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'HZ_IMP_RELSHIPS_INT'||','||
                      'Party Relationships'||','||d8||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e11||','||
                      f11||','||g11||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_ACCOUNTS_STG'||','||
                      'Customer Accounts'||','||d9||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e12||','||
                      f12||','||g12||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_ACCT_SITES_STG'||','||
                      'Cust Account Sites'||','||d10||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e13||','||
                      f13||','||g13||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_ACCT_SITE_USES_STG'||','||
                      'Customer Site Uses'||','||d11||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e14||','||
                      f14||','||g14||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_ACCOUNT_PROF_STG'||','||
                      'Customer Profiles'||','||d12||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e15||','||
                      f15||','||g15||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_ACCOUNT_PROF_STG'||','||
                      'Customer Profile Amounts'||','||d12||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e16||','||
                      f16||','||g16||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_ACCT_CONTACT_STG'||','||
                      'Customer Contact Roles'||','||d14||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e17||','||
                      f17||','||g17||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_ACCT_CNTTROLES_STG'||','||
                      'Customer Role Responsiblities'||','||d15||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e18||','||
                      f18||','||g18||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_CUSTOMER_BANKS_STG'||','||
                      'Customer Banks'||','||d16||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e19||','||
                      f19||','||g19||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_ACCT_PAYMETH_STG'||','||
                      'Customer Payment Methods'||','||d17||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e20||','||
                      f20||','||g20||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_EXT_ATTRIBS_STG'||','||
                      'Extensible Attributes'||','||d18||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e21||','||
                      f21||','||g21||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := 'XXOD_HZ_IMP_RELSHIPS_STG'||','||
                      'Hierarchical Party Relationships'||','||d13||','||'TPH'||','||'Expected Duration'||','||
                      'Start Time'||','||'End Time'||','||e22||','||
                      f22||','||g22||','||'Difference';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      v_dtl_record := NULL;

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 
      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 
      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 
      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record);

      v_dtl_record := 'Program/Step Name'||','||'Request Id'||','||'Start Time'||','||
                      'End Time'||','||'Total Time (Mins)';

      UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record); 

      FOR lc_time_rec IN lc_time_cur (ln_ebs_batch_id,p_aops_batch_id)
      LOOP
         v_dtl_record := lc_time_rec.user_concurrent_program_name||','||lc_time_rec.request_id||','||
                         lc_time_rec.start_time||','||lc_time_rec.end_time||','||
                         lc_time_rec.time_min;
         UTL_FILE.PUT_LINE (v_out_file_ptr, v_dtl_record);                 
      END LOOP;

      UTL_FILE.FCLOSE (v_out_file_ptr);
   --lv_cmd := 'nail -s ''CDH Conversion Batch'' -a /app/ebs/ctgsidev02/utl_file_out/XX_CDH_CONV_21001.csv ambarish.mukherjee@officedepot.com';

   --host(lv_cmd);
   END IF;
      
   fnd_file.put_line(fnd_file.output,'                                   -----------------------------------');
   fnd_file.put_line(fnd_file.output,'                                   |    AOPS Batch Id - '||RPAD(p_aops_batch_id,5,' ')||'        |');
   fnd_file.put_line(fnd_file.output,'                                   |    EBS Batch Id  - '||RPAD(ln_ebs_batch_id,5,' ')||'        |');
   fnd_file.put_line(fnd_file.output,'                                   -----------------------------------');
   fnd_file.put_line(fnd_file.output,' ');
   fnd_file.put_line(fnd_file.output,' ');
   fnd_file.put_line(fnd_file.output,' ');
   fnd_file.put_line(fnd_file.output,' ');
   
   v_dtl_record := '------------------------------'||'----------------------------------'||'------------'||'-------------'||'-------------'||'---------------';
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'Oracle Table (Bulk/Staging)   '||' Entity                           '||'STG Count   '||'Oracle Count '||'Total Errors '||'Total Processed';
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := '------------------------------'||'----------------------------------'||'------------'||'-------------'||'-------------'||'---------------';
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'HZ_IMP_PARTIES_INT            '||' Parties                          '||LPAD(d1 ,10,' ')||'  '||LPAD(e4  ,10,' ')||' '||LPAD(f4  ,10,' ')||' '||LPAD(g4  ,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'HZ_IMP_ADDRESSES_INT          '||' Party Sites                      '||LPAD(d2 ,10,' ')||'  '||LPAD(e5  ,10,' ')||' '||LPAD(f5  ,10,' ')||' '||LPAD(g5  ,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'HZ_IMP_ADDRESSUSES_INT        '||' Party Sie Uses                   '||LPAD(d3 ,10,' ')||'  '||LPAD(e6  ,10,' ')||' '||LPAD(f6  ,10,' ')||' '||LPAD(g6  ,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'HZ_IMP_CONTACTS_INT           '||' Party Contacts                   '||LPAD(d4 ,10,' ')||'  '||LPAD(e7  ,10,' ')||' '||LPAD(f7  ,10,' ')||' '||LPAD(g7  ,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record); 
   v_dtl_record := 'HZ_IMP_CONTACTPTS_INT         '||' Party Contact Points             '||LPAD(d5 ,10,' ')||'  '||LPAD(e8  ,10,' ')||' '||LPAD(f8  ,10,' ')||' '||LPAD(g8  ,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_CONTACTPTS_STG    '||' Account Contact Points           '||LPAD(d6 ,10,' ')||'  '||LPAD(e9  ,10,' ')||' '||LPAD(f9  ,10,' ')||' '||LPAD(g9  ,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'HZ_IMP_CONTACTROLES_INT       '||' Party Contact Roles              '||LPAD(d7 ,10,' ')||'  '||LPAD(e10 ,10,' ')||' '||LPAD(f10 ,10,' ')||' '||LPAD(g10 ,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'HZ_IMP_RELSHIPS_INT           '||' Party Relationships              '||LPAD(d8 ,10,' ')||'  '||LPAD(e11 ,10,' ')||' '||LPAD(f11 ,10,' ')||' '||LPAD(g11 ,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_ACCOUNTS_STG      '||' Accounts                         '||LPAD(d9 ,10,' ')||'  '||LPAD(e12 ,10,' ')||' '||LPAD(f12 ,10,' ')||' '||LPAD(g12 ,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record); 
   v_dtl_record := 'XXOD_HZ_IMP_ACCT_SITES_STG    '||' Account Sites                    '||LPAD(d10,10,' ')||'  '||LPAD(e13,10,' ')||' '||LPAD(f13,10,' ')||' '||LPAD(g13,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_ACCT_SITE_USES_STG'||' Account Site Uses                '||LPAD(d11,10,' ')||'  '||LPAD(e14,10,' ')||' '||LPAD(f14,10,' ')||' '||LPAD(g14,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_ACCOUNT_PROF_STG  '||' Account Profiles                 '||LPAD(d12,10,' ')||'  '||LPAD(e15,10,' ')||' '||LPAD(f15,10,' ')||' '||LPAD(g15,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_ACCOUNT_PROF_STG  '||' Account Profile Amounts          '||LPAD(d12,10,' ')||'  '||LPAD(e16,10,' ')||' '||LPAD(f16,10,' ')||' '||LPAD(g16,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_ACCT_CONTACT_STG  '||' Account Contact Roles            '||LPAD(d14,10,' ')||'  '||LPAD(e17,10,' ')||' '||LPAD(f17,10,' ')||' '||LPAD(g17,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_ACCT_CNTTROLES_STG'||' Acct Cont Role Responsibilities  '||LPAD(d15,10,' ')||'  '||LPAD(e18,10,' ')||' '||LPAD(f18,10,' ')||' '||LPAD(g18,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_CUSTOMER_BANKS_STG'||' Banks                            '||LPAD(d16,10,' ')||'  '||LPAD(e19,10,' ')||' '||LPAD(f19,10,' ')||' '||LPAD(g19,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_ACCT_PAYMETH_STG  '||' Payment Methods                  '||LPAD(d17,10,' ')||'  '||LPAD(e20,10,' ')||' '||LPAD(f20,10,' ')||' '||LPAD(g20,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_EXT_ATTRIBS_STG   '||' Extensible Attributes            '||LPAD(d18,10,' ')||'  '||LPAD(e21,10,' ')||' '||LPAD(f21,10,' ')||' '||LPAD(g21,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   v_dtl_record := 'XXOD_HZ_IMP_RELSHIPS_STG      '||' Hierarchical Relationships       '||LPAD(d13,10,' ')||'  '||LPAD(e22,10,' ')||' '||LPAD(f22,10,' ')||' '||LPAD(g22,10,' ');
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   
   
   
   v_dtl_record := NULL;
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   fnd_file.put_line(fnd_file.output,v_dtl_record);
   
   fnd_file.put_line(fnd_file.output,'                                   -------------------------------------');
   fnd_file.put_line(fnd_file.output,'                                   |    Conversion Load Timings'||'        |');
   fnd_file.put_line(fnd_file.output,'                                   -------------------------------------');
   fnd_file.put_line(fnd_file.output,' ');
   fnd_file.put_line(fnd_file.output,' ');
   fnd_file.put_line(fnd_file.output,' ');
   fnd_file.put_line(fnd_file.output,' ');
   
   fnd_file.put_line(fnd_file.output,'-------------------------------------------------------------------------------------------------------------------');
   fnd_file.put_line(fnd_file.output,RPAD('Concurrent Program Name',65,' ')||'  '||
                                          'Request Id'||'   '||
                                          'Start Time'||'   '||
                                          'End Time'||'   '||
                                          'Time Taken');
   
   fnd_file.put_line(fnd_file.output,'-------------------------------------------------------------------------------------------------------------------');
   
   FOR lc_time_rec IN lc_time_cur (ln_ebs_batch_id,p_aops_batch_id)
   LOOP
      v_dtl_record := RPAD(lc_time_rec.user_concurrent_program_name,65,' ')||'  '||
                      lc_time_rec.request_id||'      '||
                      lc_time_rec.start_time||'     '||
                      lc_time_rec.end_time||'   '||
                      lc_time_rec.time_min;
      FND_FILE.PUT_LINE(FND_FILE.OUTPUT,v_dtl_record);
   END LOOP;   
   
   
EXCEPTION
   WHEN le_skip_process THEN
      x_retcode := 0;
   WHEN UTL_FILE.INTERNAL_ERROR THEN
      FND_FILE.PUT_LINE(FND_FILE.LOG, 'Internal error occured in the UTL_FILE package.');
      x_retcode := 2;
   WHEN UTL_FILE.INVALID_FILEHANDLE THEN
      FND_FILE.PUT_LINE(FND_FILE.LOG, 'UTL_FILE Error. File is not open.');
      x_retcode := 2;
   WHEN UTL_FILE.INVALID_MODE THEN
      FND_FILE.PUT_LINE(FND_FILE.LOG, 'FOPEN mode is invalid. Valid modes are: A,R,W.');
      x_retcode := 2;
   WHEN UTL_FILE.INVALID_OPERATION THEN
      FND_FILE.PUT_LINE(FND_FILE.LOG, 'FOPEN could not open the file or invalid operation for' || ' GET_LINE,FFLUSH,NEW_LINE,PUT,PUTF, or PUT_LINE.');
      x_retcode := 2;
   WHEN UTL_FILE.INVALID_PATH THEN
      FND_FILE.PUT_LINE(FND_FILE.LOG, 'Path name supplied in call to FOPEN is not valid.');
      x_retcode := 2;
   WHEN UTL_FILE.READ_ERROR THEN
      FND_FILE.PUT_LINE(FND_FILE.LOG, 'Operating system error occurred when trying to read file.');
      x_retcode := 2;
   WHEN UTL_FILE.WRITE_ERROR THEN
      FND_FILE.PUT_LINE(FND_FILE.LOG, 'Operation system error occurred when trying to write file.');
      x_retcode := 2;
   WHEN OTHERS THEN
      FND_FILE.PUT_LINE (FND_FILE.LOG, 'Error -'||SQLERRM);
      x_retcode := 2;
END conv_stat_main;

PROCEDURE host( cmd IN VARCHAR2 )
AS
    status NUMBER;
BEGIN

    FND_FILE.PUT_LINE(FND_FILE.LOG,'Unix Command -'||cmd);
    
    dbms_pipe.pack_message( cmd );
    status := dbms_pipe.send_message( 'HOST_PIPE' );
    FND_FILE.PUT_LINE(FND_FILE.LOG,'Unix Command Status -'||status);
    IF ( status <> 0 ) THEN FND_FILE.PUT_LINE(FND_FILE.LOG, 'Pipe error' );
    END IF;
END;


END XX_CDH_CONV_STATISTICS_PKG;
/
SHOW ERRORS;
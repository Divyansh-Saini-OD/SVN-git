<?xml version="1.0" encoding="UTF-8" ?>
<!-- XML Data template for <<< Iexpenses Open Notification >>> -->
<dataTemplate name="XXIEXPNOTIFDDF.xml" description="OD: iExpenses Open Notifications Data Definition" Version="1.0"> 
<properties>
<property name="xml_tag_case"  value="upper" />
<property name="debug_mode"    value="on" />
</properties>
<parameters>
</parameters>
<dataQuery>
<sqlStatement name="Q_MAIN">
 <![CDATA[SELECT NTF.NOTIFICATION_ID,
       NTF.STATUS NOTIFICATION_STATUS,
        NA.NAME,
        NA.TEXT_VALUE,
       PER.EMPLOYEE_NUMBER||','||PER.FULL_NAME EMPLOYEE_NAME,
       NTF.RECIPIENT_ROLE,
       to_char(ntf.begin_date,'MM/DD/YY HH:MI:SS AM') BEGIN_DATE,
       to_char(NTF.END_DATE,'MM/DD/YY HH:MI:SS AM') END_DATE,
       NTF.RESPONDER,
       NTF.ORIGINAL_RECIPIENT ,
       NTF.TO_USER,
       to_char(NTF.SENT_DATE,'MM/DD/YY HH:MI:SS AM') SENT_DATE ,
       XX_IEXP_OPEN_NOTIF_FUNC(per.person_id) unused_amount
  from per_all_people_f per,
       wf_notification_attributes na,                                                                                                                                     
       wf_item_attribute_values watr,
       wf_notifications ntf                                                                                                                                     
 where 1=1
   and ntf.message_type='APCCARD'                                                       
   and ntf.status='OPEN'
   and ntf.message_name='OIE_MSG_MGR_INACTIVE_EMPL_EX_1'  
   and na.notification_id=ntf.notification_id                                                                                                                                        
   and na.name='RESULT'             
   and watr.item_type=ntf.message_type
   and watr.item_key=ntf.item_key
   and watr.name='INACT_EMPLOYEE_ID'                                                                                             
   and per.person_id=watr.number_value
   AND PER.PERSON_TYPE_ID=9
   AND EXISTS (SELECT 'x'
                 FROM ap_credit_card_trxns_all txn,
                      ap_cards_all crd
                WHERE crd.employee_id=watr.number_value
                  AND txn.validate_code = 'Y'
                  AND txn.payment_flag <> 'Y'
                  AND TXN.BILLED_AMOUNT IS NOT NULL
                  AND txn.card_id = crd.card_id
                  AND txn.card_program_id = crd.card_program_id
                  AND txn.card_id = crd.card_id
                  AND (NVL (txn.CATEGORY, 'BUSINESS') NOT IN ('DISPUTED', 'CREDIT', 'MATCHED', 'DEACTIVATED'))
                  AND TRUNC (NVL (TXN.TRX_AVAILABLE_DATE,TO_DATE ('01-01-1952 00:00:00','DD-MM-YYYY HH24:MI:SS'))) <= TRUNC (SYSDATE)
                  AND REPORT_HEADER_ID IS NULL 
              )
  Order by 1
]]> 
  </sqlStatement>
</dataQuery>
-<dataStructure>
-<group name="G_MAIN" source="Q_MAIN">
<element name="NOTIFICATION_ID" value="NOTIFICATION_ID"/>
<element name="NOTIFICATION_STATUS" value="NOTIFICATION_STATUS"/>
<element name="NAME" value="NAME"/>
<element name="TEXT_VALUE" value="TEXT_VALUE"/>
<element name="EMPLOYEE_NAME" value="EMPLOYEE_NAME"/>
<element name="RECIPIENT_ROLE" value="RECIPIENT_ROLE"/>
<element name="BEGIN_DATE" value="BEGIN_DATE"/>
<element name="END_DATE" value="END_DATE"/>
<element name="RESPONDER" value="RESPONDER"/>
<element name="ORIGINAL_RECIPIENT" value="ORIGINAL_RECIPIENT"/>
<element name="TO_USER" value="TO_USER"/>
<element name="SENT_DATE" value="SENT_DATE"/>
<element name="UNUSED_AMOUNT" value="UNUSED_AMOUNT"/>
</group>
</dataStructure>
</dataTemplate>  
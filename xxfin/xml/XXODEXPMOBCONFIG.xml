<?xml version = '1.0' encoding = 'UTF-8'?>
<!--
*************************************************************************************************
* PROGRAM NAME
*  XXODEXPMOBCONFIG.xml
*
* DESCRIPTION
*  Data Template for Mobile Expense Configurations
*
* USAGE
*  Data Template to retrieve data from database
*  
* HISTORY
* =======
*
* VERSION DATE        AUTHOR(S)         DESCRIPTION
* ******* *********   **************** *************************************
* 1.0     24-Nov-2016 Praveen Vanga      Initial Version
**************************************************************************************************
-->
<dataTemplate name="XXODEXPMOBCONFIG" description="OD : Expense Mobile Configurations" version="1.0">
   <properties>
      <property name="xml_tag_case" value="upper"/>
      <property name="include_parameters" value="true" />
   </properties>
   <parameters>
    <!--<parameter name="p_date_from"  dataType="varchar2"></parameter>
    <parameter name="p_date_to"    dataType="varchar2"></parameter>
    <parameter name="p_employee"   dataType="number"></parameter> -->
   </parameters>
      <lexicals>
     </lexicals>
<dataQuery>
   <sqlStatement name="Q_EXPRPT">
    <![CDATA[SELECT a.REPORT_TYPE,a.INACTIVE_DATE ,h.NAME ,a.MOBILE_ENABLED_FLAG  ,a.WEB_ENABLED_FLAG
               from AP_EXPENSE_REPORTS_ALL a,
                    hr_all_organization_units h
              where a.MOBILE_ENABLED_FLAG = 'Y'
                AND h.organization_id=a.org_id 
     ]]>
   </sqlStatement>
    
	<sqlStatement name="Q_EXPUSR">
    <![CDATA[select /*+ NO_CPU_COSTING */
       distinct U.USER_NAME,per.full_name,per.email_address,FR.RESPONSIBILITY_NAME,fa.application_name Resp_application_name
  from  FND_FORM_FUNCTIONS F
       ,FND_MENU_ENTRIES M   
       ,FND_RESPONSIBILITY_VL FR
       ,FND_APPLICATION_VL FA
       ,FND_USER_RESP_GROUPS FU
       ,PER_ALL_PEOPLE_F PER
       ,fnd_user u 
 where 1 = 1
   and F.FUNCTION_NAME='OIE_MOBILE_EXPENSES'     
    and M.FUNCTION_ID=F.FUNCTION_ID
    and FR.MENU_ID=M.MENU_ID  
    and fa.application_id=fr.application_id
   and FU.RESPONSIBILITY_ID=FR.RESPONSIBILITY_ID
   and u.user_id=fu.user_id
   and (TO_CHAR(U.END_DATE) is null  or U.END_DATE > sysdate)
   and PER.EMPLOYEE_NUMBER=U.USER_NAME
   and TRUNC(sysdate) between TRUNC(PER.EFFECTIVE_START_DATE) and TRUNC(PER.EFFECTIVE_END_DATE)
   order by 1,4
   ]]>
   </sqlStatement> 
   
   
   <sqlStatement name="Q_EXPPRO">
    <![CDATA[SELECT SUBSTR(e.profile_option_name,1,35) Profile,e.user_profile_option_name
              ,DECODE(a.level_id,10001,'Site'
                                ,10002,'Application'
                                ,10003,'Resp'
                                ,10004,'User') Profile_Level
              ,b.responsibility_name
           FROM fnd_profile_option_values a
               ,fnd_responsibility_tl b
               ,fnd_profile_options_vl e
          WHERE e.profile_option_name = 'AP_WEB_MOBILE_RESPONSIBILITY'
            AND e.profile_option_id   = a.profile_option_id
            and a.PROFILE_OPTION_VALUE         = B.RESPONSIBILITY_ID(+)
            order by 1
	]]>
   </sqlStatement>
   
   
 </dataQuery>
   <dataStructure>
      <group name="G_EXPRPT" dataType="varchar2" source="Q_EXPRPT">
	     <element name="REPORT_TYPE" dataType="varchar2" value="REPORT_TYPE"/>
		 <element name="INACTIVE_DATE" dataType="varchar2" value="INACTIVE_DATE"/>
		 <element name="NAME" dataType="varchar2" value="NAME"/>
		 <element name="MOBILE_ENABLED_FLAG" dataType="varchar2" value="MOBILE_ENABLED_FLAG"/>
         <element name="WEB_ENABLED_FLAG" dataType="varchar2" value="WEB_ENABLED_FLAG"/>
      </group>
	  
	  <group name="G_EXPUSR" dataType="varchar2" source="Q_EXPUSR">
	     <element name="USER_NAME" dataType="varchar2" value="USER_NAME"/>
         <element name="FULL_NAME" dataType="varchar2" value="FULL_NAME"/>
		 <element name="EMAIL_ADDRESS" dataType="varchar2" value="EMAIL_ADDRESS"/>
		 <element name="RESPONSIBILITY_NAME" dataType="varchar2" value="RESPONSIBILITY_NAME"/>
		 <element name="RESP_APPLICATION_NAME" dataType="varchar2" value="RESP_APPLICATION_NAME"/>
      </group>
	  
	  <group name="G_EXPPRO" dataType="varchar2" source="Q_EXPPRO">
	     <element name="PROFILE" dataType="varchar2" value="PROFILE"/>
         <element name="USER_PROFILE_OPTION_NAME" dataType="varchar2" value="USER_PROFILE_OPTION_NAME"/>
		 <element name="PROFILE_LEVEL" dataType="varchar2" value="PROFILE_LEVEL"/>
		 <element name="RESPONSIBILITY_NAME" dataType="varchar2" value="RESPONSIBILITY_NAME"/>
      </group>
	  
	 	  
	</dataStructure>
</dataTemplate>


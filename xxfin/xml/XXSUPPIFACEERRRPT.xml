<?xml version = '1.0' encoding = 'UTF-8'?>
<!--
*************************************************************************************************
* PROGRAM NAME
*  XXSUPPIFACEERRRPT.xml
*
* DESCRIPTION
*  Data Template for Supplier Interface Error Reprot
*
* USAGE
*  Data Template to retrieve data from database
*  
* HISTORY
* =======
*
* VERSION DATE        AUTHOR(S)         DESCRIPTION
* ******* *********   **************** *************************************
* 1.0     21-Jan-2015 Amar Modium      Initial Version
**************************************************************************************************
-->
<dataTemplate name="XXSUPPIFACEERRRPT" version="1.0">
   <properties>
      <property name="xml_tag_case" value="upper"/>
   </properties>
   <parameters>
   <parameter name="p_request_id" dataType="number"></parameter>
   <parameter name="P_STATUS" dataType="varchar2"></parameter>
   </parameters>
      <lexicals>
     </lexicals>
<dataQuery>
<sqlStatement name="Q_RPT">
<![CDATA[SELECT ROWNUM,SRC,LVL,SUPPLIER_NAME,ERR_MSG,VENDOR_ID,STATUS,ORD
FROM(
SELECT SRC,LVL,SUPPLIER_NAME,ERR_MSG,VENDOR_NUM VENDOR_ID,STATUS,decode(LVL,'HDR',1,'SITE',2,'CNT',3) ORD
FROM(
SELECT 'MANUAL' SRC,'HDR' lvl,SUPPLIER_NAME, SUPP_ERROR_MSG err_msg,(select segment1 from ap_suppliers where vendor_id = a.vendor_id) VENDOR_NUM,DECODE(SUPP_ERROR_FLAG,'E','FAIL','SUCCESS') status
FROM XX_AP_SUPPLIER_STG a
WHERE request_id = :p_request_id
UNION
SELECT 'MANUAL' SRC,'SITE' lvl,SUPPLIER_NAME, SUPP_SITE_ERROR_MSG ERR_MSG,(select segment1 from ap_suppliers where vendor_id = b.vendor_id) VENDOR_NUM,DECODE(SUPP_SITE_ERROR_FLAG,'E','FAIL','SUCCESS') STATUS
FROM XX_AP_SUPP_SITE_CONTACT_STG b
WHERE request_id = :p_request_id
UNION
SELECT 'MANUAL' SRC,'CNT' LVL,SUPPLIER_NAME, CONT_ERROR_MSG ERR_MSG,(select segment1 from ap_suppliers where vendor_id = c.vendor_id) VENDOR_NUM,DECODE(CONT_ERROR_FLAG,'E','FAIL','SUCCESS') STATUS
FROM XX_AP_SUPP_SITE_CONTACT_STG c
WHERE request_id = :p_request_id)
order by supplier_name,ORD)
]]>
</sqlStatement>
   </dataQuery>
   <dataStructure>
      <group name="G_RPT" dataType="varchar2" source="Q_RPT">
	     <element name="ROWNUM" dataType="number" value="ROWNUM"/>
         <element name="SRC" dataType="varchar2" value="SRC"/>
         <element name="LVL" dataType="varchar2" value="LVL"/>
         <element name="SUPPLIER_NAME" dataType="varchar2" value="SUPPLIER_NAME"/>
         <element name="ERR_MSG" dataType="varchar2" value="ERR_MSG"/>
         <element name="VENDOR_ID" dataType="number" value="VENDOR_ID"/>
         <element name="STATUS" dataType="varchar2" value="STATUS"/>
      </group>
     </dataStructure>
</dataTemplate>


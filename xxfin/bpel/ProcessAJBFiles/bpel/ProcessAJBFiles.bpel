<?xml version = "1.0" encoding = "UTF-8" ?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Tue May 06 12:23:41 IST 2008
  Author:  rajesh
  Purpose: Asynchronous BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->
<process name="ProcessAJBFiles"
         targetNamespace="http://xmlns.oracle.com/ProcessAJBFiles"
         xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
         xmlns:ns4="http://xmlns.oracle.com/pcbpel/adapter/file/"
         xmlns:ns24="http://xmlns.oracle.com/ias/pcbpel/NotificationService"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema"
         xmlns:ns16="http://xmlns.oracle.com/pcbpel/adapter/db/ServiceTableFileInsert/"
         xmlns:ns27="http://xmlns.oracle.com/pcbpel/adapter/db/serviceCallCCProgram/"
         xmlns:ns5="http://xmlns.oracle.com/pcbpel/adapter/db/AJB998TableInsert/"
         xmlns:ora="http://schemas.oracle.com/xpath/extension"
         xmlns:ns9="http://TargetNamespace.com/InboundService_AJB996"
         xmlns:ns17="http://xmlns.oracle.com/pcbpel/adapter/db/APPS/XX_CE_AJB_CC_RECON_PKG/BPEL_DELETE_RECS/"
         xmlns:ns1="http://xmlns.oracle.com/PostJournalEntry"
         xmlns:ns25="http://xmlns.oracle.com/pcbpel/adapter/db/Service_BPEL_Record_File_Load/"
         xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/file/ServiceFileAJB998Read/"
         xmlns:ns26="http://xmlns.oracle.com/pcbpel/adapter/db/APPS/XX_CE_AJB_CC_RECON_PKG/BPEL_RECORD_FILE_LOAD/"
         xmlns:orcl="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
         xmlns:ns15="ODError"
         xmlns:ns10="http://xmlns.oracle.com/pcbpel/adapter/db/AJB996TableInsert/"
         xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:ns20="http://xmlns.oracle.com/pcbpel/adapter/db/Service_Duplicate_File_Check/"
         xmlns:ns13="http://xmlns.oracle.com/pcbpel/adapter/db/AJB999TableInsert/"
         xmlns:ns7="http://schemas.oracle.com/service/bpel/common"
         xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
         xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap"
         xmlns:ns12="http://xmlns.oracle.com/pcbpel/adapter/db/top/AJB996TableInsert"
         xmlns:ns18="http://xmlns.oracle.com/pcbpel/adapter/file/FileDelete/"
         xmlns:client="http://xmlns.oracle.com/ProcessAJBFiles"
         xmlns:ns23="http://xmlns.oracle.com/TransactionData"
         xmlns:ns6="http://xmlns.oracle.com/pcbpel/adapter/db/top/AJB998TableInsert"
         xmlns:ns28="http://xmlns.oracle.com/pcbpel/adapter/db/APPS/XX_BPEL_INTEGRATION_PKG/SUBMIT_CONCURRENT_PROGRAM/"
         xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions"
         xmlns:ns11="http://xmlns.oracle.com/pcbpel/adapter/file/ServiceFileAJB999Read/"
         xmlns:ns22="http://xmlns.oracle.com/ODTransactionLogger"
         xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
         xmlns:ns19="http://xmlns.oracle.com/pcbpel/adapter/opaque/"
         xmlns:ehdr="http://www.oracle.com/XSL/Transform/java/oracle.tip.esb.server.headers.ESBHeaderFunctions"
         xmlns:ns3="http://TargetNamespace.com/InboundService"
         xmlns:ns14="http://xmlns.oracle.com/ODErrorLogger"
         xmlns:bpelx="http://schemas.oracle.com/bpel/extension"
         xmlns:ns21="http://xmlns.oracle.com/pcbpel/adapter/db/APPS/XX_CE_AJB_CC_RECON_PKG/BPEL_CHECK_DUP_FILE/"
         xmlns:ns8="http://xmlns.oracle.com/pcbpel/adapter/file/ServiceFileAJB996Read/">
        <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        PARTNERLINKS                                                      
        List of services participating in this BPEL process               
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
        <partnerLinks>
                <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
                <partnerLink name="client"
                             partnerLinkType="client:ProcessAJBFiles"
                             myRole="ProcessAJBFilesProvider"
                             partnerRole="ProcessAJBFilesRequester"/>
                <partnerLink name="ServiceFileAJB998Read"
                             partnerRole="SynchChunkedRead_role"
                             partnerLinkType="ns2:SynchChunkedRead_plt"
                             myRole="SynchChunkedRead_role"/>
                <partnerLink name="ServiceFileAJB996Read"
                             partnerRole="SynchChunkedRead_role"
                             partnerLinkType="ns8:SynchChunkedRead_plt"/>
                <partnerLink name="ServiceFileAJB999Read"
                             partnerRole="SynchChunkedRead_role"
                             partnerLinkType="ns11:SynchChunkedRead_plt"/>
                <partnerLink myRole="ODErrorLoggerRequester"
                             name="ODErrorLogger"
                             partnerRole="ODErrorLoggerProvider"
                             partnerLinkType="ns14:ODErrorLogger"/>
                <partnerLink name="ServiceXX_CE_AJB_RECON_PKG"
                             partnerRole="ServiceTableFileInsert_role"
                             partnerLinkType="ns16:ServiceTableFileInsert_plt"/>
                <partnerLink name="FileDelete" partnerRole="Write_role"
                             partnerLinkType="ns18:Write_plt"/>
                <partnerLink name="AJB999TableInsert"
                             partnerRole="AJB999TableInsert_role"
                             partnerLinkType="ns13:AJB999TableInsert_plt"/>
                <partnerLink name="AJB996TableInsert"
                             partnerRole="AJB996TableInsert_role"
                             partnerLinkType="ns10:AJB996TableInsert_plt"/>
                <partnerLink name="AJB998TableInsert"
                             partnerRole="AJB998TableInsert_role"
                             partnerLinkType="ns5:AJB998TableInsert_plt"/>
                <partnerLink name="Service_Duplicate_File_Check"
                             partnerRole="Service_Duplicate_File_Check_role"
                             partnerLinkType="ns20:Service_Duplicate_File_Check_plt"/>
                <partnerLink myRole="ODTransactionLoggerRequester"
                             name="ODTransactionLogger"
                             partnerRole="ODTransactionLoggerProvider"
                             partnerLinkType="ns22:ODTransactionLogger"/>
                <partnerLink name="NotificationService"
                             partnerRole="NotificationServiceProvider"
                             partnerLinkType="ns24:NotificationServiceLink"/>
                <partnerLink name="Service_BPEL_Record_File_Load"
                             partnerRole="Service_BPEL_Record_File_Load_role"
                             partnerLinkType="ns25:Service_BPEL_Record_File_Load_plt"/>
                <partnerLink name="serviceCallCCProgram"
                             partnerRole="serviceCallCCProgram_role"
                             partnerLinkType="ns27:serviceCallCCProgram_plt"
                             myRole="serviceCallCCProgram_role"/>
        </partnerLinks>
        <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        VARIABLES                                                        
        List of messages and XML documents used within this BPEL process 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
        <variables>
                <!-- Reference to the message passed as input during initiation -->
                <variable name="InputFileHeader"
                          messageType="client:ProcessAJBFilesRequestMessage"/>
                <!-- Reference to the message that will be sent back to the requester during callback -->
                <variable name="outputVariable"
                          messageType="client:ProcessAJBFilesResponseMessage"/>
                <variable name="Invoke_998_Chunk_Read"
                          messageType="ns2:Empty_msg"/>
                <variable name="Invoke_output_998_Chunk_Read"
                          messageType="ns2:Root-Element_msg"/>
                <variable name="SyncChunkReadInboundHeader"
                          messageType="ns4:OutboundHeader_msg"/>
                <variable name="SyncChunkReadOutboundHeader"
                          messageType="ns4:OutboundHeader_msg"/>
                <variable name="FileName" type="xsd:string"/>
                <variable name="XSLT_PARAM" element="ns7:parameters"/>
                <variable name="Substr_File_name" type="xsd:string"/>
                <variable name="InvokeAJB996ReadData"
                          messageType="ns8:Empty_msg"/>
                <variable name="InvokeAJB996ReadData_Output"
                          messageType="ns8:Root-Element_AJB996_msg"/>
                <variable name="InvokeAJB999ReadData"
                          messageType="ns11:Empty_msg"/>
                <variable name="InvokeAJB999ReadData_Output"
                          messageType="ns11:Root-Element_AJB999_msg"/>
                <variable name="invkCatchAll_initiate"
                          messageType="ns14:ODErrorLoggerRequestMessage"/>
                <variable name="ErrorMessageText" type="xsd:string"/>
                <variable name="TableName" type="xsd:string"/>
                <variable name="Exception"
                          messageType="bpelx:RuntimeFaultMessage"/>
                <variable name="Invoke_XX_CE_AJB_RECON_PKG_ServiceTableFileInsert_In"
                          messageType="ns16:args_in_msg"/>
                <variable name="Invoke_XX_CE_AJB_RECON_PKG_ServiceTableFileInsert_Out"
                          messageType="ns16:args_out_msg"/>
                <variable name="Outbound_Var"
                          element="ns4:OutboundFileHeaderType"/>
                <variable name="Invoke_1_Write_InputVariable"
                          messageType="ns18:Write_msg"/>
                <variable name="ProcessHeader" type="xsd:string"/>
                <variable name="InvokeAJB999TableInsert"
                          messageType="ns13:XxCeAjb999Collection_msg"/>
                <variable name="InvokeAJB996TableInsert"
                          messageType="ns10:XxCeAjb996Collection_msg"/>
                <variable name="InvokeAJB998TableInsert"
                          messageType="ns5:XxCeAjb998Collection_msg"/>
                <variable name="Invoke_Service_Duplicate_File_Out"
                          messageType="ns20:args_out_msg"/>
                <variable name="Invoke_Service_Duplicate_File_In"
                          messageType="ns20:args_in_msg"/>
                <variable name="AJBPrefixFileName" type="xsd:string"/>
                <variable name="counter" type="xsd:int"/>
                <variable name="Status" type="xsd:string"/>
                <variable name="logTransactionInput"
                          messageType="ns22:ODTransactionLoggerRequestMessage"/>
                <variable name="EmailAddress" type="xsd:string"/>
                <variable name="InvokeServiceRecordFileLoad_In"
                          messageType="ns25:args_in_msg"/>
                <variable name="InvokeServiceRecordFileLoad_Out"
                          messageType="ns25:args_out_msg"/>
                <variable name="xmlFragment" type="xsd:string"/>
                <variable name="numberofrecords" type="xsd:int"/>
                <variable name="invkCallCCProgram_In"
                          messageType="ns27:args_in_msg"/>
                <variable name="invkCallCCProgram_Out"
                          messageType="ns27:args_out_msg"/>
        </variables>
        <faultHandlers>
                <catchAll>
                        <sequence name="Sequence_4">
                                <assign name="asnCatchAll">
                                        <copy>
                                                <from expression="concat(&quot;Error encountered in ProcessFTPAJBFiles, while copying file &quot;,bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'))"/>
                                                <to variable="ErrorMessageText"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getProcessId()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ProcessInfo/ns15:BusinessProcessName"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getInstanceId()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ProcessInfo/ns15:BusinessProcessId"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getDomainId()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ProcessInfo/ns15:BusinessProcessDomain"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getProcessURL()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ProcessInfo/ns15:SystemName"/>
                                        </copy>
                                        <copy>
                                                <from expression="xp20:current-dateTime()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorDateTime"/>
                                        </copy>
                                        <copy>
                                                <from expression="'Catch All on the Main Sequence'"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ProcessInfo/ns15:BusinessProcessStep"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getFaultName()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorCode"/>
                                        </copy>
                                        <copy>
                                                <from expression="concat(bpws:getVariableData('ErrorMessageText'), '. Status: ', bpws:getVariableData('Status'))"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorDescription"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getFaultAsString()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorText"/>
                                        </copy>
                                        <copy>
                                                <from expression="'system'"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorType"/>
                                        </copy>
                                        <copy>
                                                <from expression="'fatal'"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorSeverity"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/FaultNotification/SendNotification')"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns15:ErrorData/ns15:Notification/ns15:sendNotification"/>
                                        </copy>
                                        <copy>
                                                <from variable="InputFileHeader"
                                                      part="payload"
                                                      query="/ns1:fileHeader/ns1:fileName"/>
                                                <to variable="Invoke_XX_CE_AJB_RECON_PKG_ServiceTableFileInsert_In"
                                                    part="InputParameters"
                                                    query="/ns17:InputParameters/P_FILE_NAME"/>
                                        </copy>
                                        <copy>
                                                <from variable="Invoke_Service_Duplicate_File_In"
                                                      part="InputParameters"
                                                      query="/ns21:InputParameters/ns21:P_TABLE_NAME"/>
                                                <to variable="Invoke_XX_CE_AJB_RECON_PKG_ServiceTableFileInsert_In"
                                                    part="InputParameters"
                                                    query="/ns17:InputParameters/P_TABLE_NAME"/>
                                        </copy>
                                </assign>
                                <assign name="copyTransactionData">
                                        <copy>
                                                <from expression="'Error'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:ProcessStatus"/>
                                        </copy>
                                </assign>
                                <invoke name="logTransaction"
                                        partnerLink="ODTransactionLogger"
                                        portType="ns22:ODTransactionLogger"
                                        operation="initiate"
                                        inputVariable="logTransactionInput"/>
                                <scope name="XX_CE_AJB_RECON_PKG">
                                        <faultHandlers>
                                                <catchAll>
                                                        <sequence name="Sequence_28">
                                                                <invoke name="invkCatchAll"
                                                                        partnerLink="ODErrorLogger"
                                                                        portType="ns14:ODErrorLogger"
                                                                        operation="initiate"
                                                                        inputVariable="invkCatchAll_initiate"/>
                                                                <terminate name="Terminate"/>
                                                        </sequence>
                                                </catchAll>
                                        </faultHandlers>
                                        <invoke name="Invoke_XX_CE_AJB_RECON_PKG"
                                                partnerLink="ServiceXX_CE_AJB_RECON_PKG"
                                                portType="ns16:ServiceTableFileInsert_ptt"
                                                operation="ServiceTableFileInsert"
                                                inputVariable="Invoke_XX_CE_AJB_RECON_PKG_ServiceTableFileInsert_In"
                                                outputVariable="Invoke_XX_CE_AJB_RECON_PKG_ServiceTableFileInsert_Out"/>
                                </scope>
                                <invoke name="invkCatchAll"
                                        partnerLink="ODErrorLogger"
                                        portType="ns14:ODErrorLogger"
                                        operation="initiate"
                                        inputVariable="invkCatchAll_initiate"/>
                                <terminate name="Terminate"/>
                        </sequence>
                </catchAll>
        </faultHandlers>
        <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
       ORCHESTRATION LOGIC                                               
       Set of activities coordinating the flow of messages across the    
       services integrated within this business process                  
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
        <sequence name="main">
                <!-- Receive input from requestor. (Note: This maps to operation defined in ProcessAJBFiles.wsdl) -->
                <receive name="receiveInput" partnerLink="client"
                         portType="client:ProcessAJBFiles" operation="initiate"
                         variable="InputFileHeader" createInstance="yes"/>
                <!-- 
          Asynchronous callback to the requester. (Note: the callback location and correlation id is transparently handled using WS-addressing.)
        -->
                <scope name="logTransactionStart">
                        <sequence name="Sequence_19">
                                <assign name="copyTransactionData">
                                        <copy>
                                                <from expression="ora:getDomainId()"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:Domain"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getProcessId()"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:ProcessName"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getInstanceId()"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:InstanceId"/>
                                        </copy>
                                        <copy>
                                                <from expression="'Start'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:ProcessStatus"/>
                                        </copy>
                                        <copy>
                                                <from expression="'Insert data into staging table'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:MessageDetails/ns23:MessageOperation"/>
                                        </copy>
                                        <copy>
                                                <from expression="'AJB Files'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:MessageDetails/ns23:MessageSourceSystem"/>
                                        </copy>
                                        <copy>
                                                <from expression="'Payload'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:MessageDetails/ns23:MessageType"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getCurrentDateTime()"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:MessageDetails/ns23:MessageDateTime"/>
                                        </copy>
                                        <copy>
                                                <from>
                                                        <EntiltyList xmlns="http://xmlns.oracle.com/TransactionData">
                                                                <EntityID EntityType="SourceFileName"/>
                                                        </EntiltyList>
                                                </from>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:EntiltyList"/>
                                        </copy>
                                        <copy>
                                                <from expression="concat('&lt;EntityID EntityType=&quot;SourceFileName&quot;>', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'), '&lt;/EntityID>')"/>
                                                <to variable="xmlFragment"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:parseEscapedXML(bpws:getVariableData('xmlFragment'))"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:EntiltyList/ns23:EntityID[1]"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getCurrentDateTime()"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:transactionStartTime"/>
                                        </copy>
                                        <copy>
                                                <from expression="'I0032_Bank and AJB CM Inbound Interface'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:SystemName"/>
                                        </copy>
                                        <copy>
                                                <from expression="'AJB'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:TradingPartnerDetails/ns23:TPFrom"/>
                                        </copy>
                                        <copy>
                                                <from expression="'EBS'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:TradingPartnerDetails/ns23:TPTo"/>
                                        </copy>
                                </assign>
                                <invoke name="logTransaction"
                                        partnerLink="ODTransactionLogger"
                                        portType="ns22:ODTransactionLogger"
                                        operation="initiate"
                                        inputVariable="logTransactionInput"/>
                        </sequence>
                </scope>
                <scope name="SetProcessHeader">
                        <sequence name="Sequence_27">
                                <assign name="initializeInstanceTitle">
                                        <copy>
                                                <from expression="substring(concat('Processing ', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName')),1,50)"/>
                                                <to variable="ProcessHeader"/>
                                        </copy>
                                </assign>
                                <bpelx:exec name="SetTitle" language="java"
                                            version="1.5">
                                        <![CDATA[try {              
  String title = (String)getVariableData("ProcessHeader");              
  setTitle(title);              
  addAuditTrailEntry(title) ;              
} catch (Exception ex) {              
  addAuditTrailEntry(ex.toString());              
  ex.printStackTrace();              
}]]>
                                </bpelx:exec>
                        </sequence>
                </scope>
                <assign name="InitializeDuplicateFileRequest">
                        <copy>
                                <from expression="substring(bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'),1,6)"/>
                                <to variable="AJBPrefixFileName"/>
                        </copy>
                        <copy>
                                <from variable="InputFileHeader" part="payload"
                                      query="/ns1:fileHeader/ns1:fileName"/>
                                <to variable="Invoke_Service_Duplicate_File_In"
                                    part="InputParameters"
                                    query="/ns21:InputParameters/ns21:P_FILE_NAME"/>
                        </copy>
                        <copy>
                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/FTPAJBFiles/Interface[@name=bpws:getVariableData(&amp;quot;AJBPrefixFileName&amp;quot;)]/TableName')"/>
                                <to variable="Invoke_Service_Duplicate_File_In"
                                    part="InputParameters"
                                    query="/ns21:InputParameters/ns21:P_TABLE_NAME"/>
                        </copy>
                </assign>
                <invoke name="Invoke_Service_Duplicate_File_Check"
                        partnerLink="Service_Duplicate_File_Check"
                        portType="ns20:Service_Duplicate_File_Check_ptt"
                        operation="Service_Duplicate_File_Check"
                        inputVariable="Invoke_Service_Duplicate_File_In"
                        outputVariable="Invoke_Service_Duplicate_File_Out"/>
                <switch name="DuplicateFileNameCheck">
                        <case condition="bpws:getVariableData('Invoke_Service_Duplicate_File_Out','OutputParameters','/ns21:OutputParameters/ns21:BPEL_CHECK_DUP_FILE') ='F'">
                                <bpelx:annotation>
                                        <bpelx:pattern>File Not Found In AJB* Table</bpelx:pattern>
                                </bpelx:annotation>
                                <sequence name="Sequence_14">
                                        <assign name="initializeChunkReadHeaders">
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              query="/ns1:fileHeader/ns1:fileName"
                                                              part="payload"/>
                                                        <to variable="FileName"/>
                                                </copy>
                                                <copy>
                                                        <from expression="''"/>
                                                        <to variable="SyncChunkReadInboundHeader"
                                                            part="outboundHeader"
                                                            query="/ns4:OutboundFileHeaderType/ns4:lineNumber"/>
                                                </copy>
                                                <copy>
                                                        <from expression="''"/>
                                                        <to variable="SyncChunkReadInboundHeader"
                                                            part="outboundHeader"
                                                            query="/ns4:OutboundFileHeaderType/ns4:columnNumber"/>
                                                </copy>
                                                <copy>
                                                        <from expression="''"/>
                                                        <to variable="SyncChunkReadInboundHeader"
                                                            part="outboundHeader"
                                                            query="/ns4:OutboundFileHeaderType/ns4:recordNumber"/>
                                                </copy>
                                                <copy>
                                                        <from expression="'false'"/>
                                                        <to variable="SyncChunkReadOutboundHeader"
                                                            part="outboundHeader"
                                                            query="/ns4:OutboundFileHeaderType/ns4:isEOF"/>
                                                </copy>
                                                <copy>
                                                        <from expression="0"/>
                                                        <to variable="counter"/>
                                                </copy>
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:directory"/>
                                                        <to variable="SyncChunkReadInboundHeader"
                                                            part="outboundHeader"
                                                            query="/ns4:OutboundFileHeaderType/ns4:directory"/>
                                                </copy>
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:fileName"/>
                                                        <to variable="SyncChunkReadInboundHeader"
                                                            part="outboundHeader"
                                                            query="/ns4:OutboundFileHeaderType/ns4:fileName"/>
                                                </copy>
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:directory"/>
                                                        <to variable="SyncChunkReadInboundHeader"
                                                            part="outboundHeader"
                                                            query="/ns4:OutboundFileHeaderType/ns4:directory"/>
                                                </copy>
                                                <copy>
                                                        <from expression="'AJB_File_Name'"/>
                                                        <to variable="XSLT_PARAM"
                                                            query="/ns7:parameters/ns7:item/ns7:name"/>
                                                </copy>
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:fileName"/>
                                                        <to variable="XSLT_PARAM"
                                                            query="/ns7:parameters/ns7:item/ns7:value"/>
                                                </copy>
                                                <copy>
                                                        <from expression="substring(bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'),1,6)"/>
                                                        <to variable="Substr_File_name"/>
                                                </copy>
                                        </assign>
                                        <switch name="Switch_1">
                                                <case condition="bpws:getVariableData('Substr_File_name') ='AJB999'">
                                                        <bpelx:annotation>
                                                                <bpelx:pattern>AJB999</bpelx:pattern>
                                                        </bpelx:annotation>
                                                        <while name="While_3"
                                                               condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isEOF') != 'true'">
                                                                <sequence name="Sequence_4">
                                                                        <invoke name="InvokeAJB999ReadData"
                                                                                partnerLink="ServiceFileAJB999Read"
                                                                                portType="ns11:SynchChunkedRead_ptt"
                                                                                operation="SynchChunkedRead"
                                                                                inputVariable="InvokeAJB999ReadData"
                                                                                outputVariable="InvokeAJB999ReadData_Output"
                                                                                bpelx:outputHeaderVariable="SyncChunkReadOutboundHeader"
                                                                                bpelx:inputHeaderVariable="SyncChunkReadInboundHeader"/>
                                                                        <assign name="AssignChunkHeaderAJB999">
                                                                                <copy>
                                                                                        <from variable="SyncChunkReadOutboundHeader"/>
                                                                                        <to variable="SyncChunkReadInboundHeader"/>
                                                                                </copy>
                                                                                <copy>
                                                                                        <from expression="bpws:getVariableData('counter') + 1"/>
                                                                                        <to variable="counter"/>
                                                                                </copy>
                                                                                <copy>
                                                                                        <from expression="concat('Processing Chunk number: ', bpws:getVariableData('counter'), ' from file: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:fileName'), ' located in: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:directory'), '. Line number: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:lineNumber'), ', Column Number: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:columnNumber'), ', Record Number: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:recordNumber'), '. Is message rejected: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isMessageRejected'), ', Rejection reason: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:rejectionReason'), '. No data found: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:NoDataFound'), ', is EOF: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isEOF'))"/>
                                                                                        <to variable="Status"/>
                                                                                </copy>
                                                                        </assign>
                                                                        <switch name="Switch_2">
                                                                                <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isMessageRejected')!='true'">
                                                                                        <bpelx:annotation>
                                                                                                <bpelx:pattern>Valid Message</bpelx:pattern>
                                                                                        </bpelx:annotation>
                                                                                        <switch name="Switch_3">
                                                                                                <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:NoDataFound')!='true'">
                                                                                                        <bpelx:annotation>
                                                                                                                <bpelx:pattern>Data Found</bpelx:pattern>
                                                                                                        </bpelx:annotation>
                                                                                                        <sequence name="Sequence_5">
                                                                                                                <assign name="Transform_3">
                                                                                                                        <bpelx:annotation>
                                                                                                                                <bpelx:pattern>transformation</bpelx:pattern>
                                                                                                                        </bpelx:annotation>
                                                                                                                        <copy>
                                                                                                                                <from expression="ora:processXSLT('Transformation999.xsl',bpws:getVariableData('InvokeAJB999ReadData_Output','Root-Element_AJB999'),bpws:getVariableData('XSLT_PARAM'))"/>
                                                                                                                                <to variable="InvokeAJB999TableInsert"
                                                                                                                                    part="XxCeAjb999Collection"/>
                                                                                                                        </copy>
                                                                                                                </assign>
                                                                                                                <invoke name="InvokeAJB999TableInsert"
                                                                                                                        partnerLink="AJB999TableInsert"
                                                                                                                        portType="ns13:AJB999TableInsert_ptt"
                                                                                                                        operation="insert"
                                                                                                                        inputVariable="InvokeAJB999TableInsert"/>
                                                                                                        </sequence>
                                                                                                </case>
                                                                                                <otherwise>
                                                                                                        <sequence name="Sequence_6">
                                                                                                                <assign name="NoData_Found">
                                                                                                                        <copy>
                                                                                                                                <from expression="string('No Data Found')"/>
                                                                                                                                <to variable="Exception"
                                                                                                                                    part="summary"/>
                                                                                                                        </copy>
                                                                                                                        <copy>
                                                                                                                                <from expression="string('Empty file or File layout issue. The data from the file does not match the file layout definition. The data parsing failed. Please review the file for errors. The status is: ', bpws:getVariableData('Status'))"/>
                                                                                                                                <to variable="Exception"
                                                                                                                                    part="detail"/>
                                                                                                                        </copy>
                                                                                                                        <copy>
                                                                                                                                <from expression="string('ReadChunkFile.NoDataFound')"/>
                                                                                                                                <to variable="Exception"
                                                                                                                                    part="code"/>
                                                                                                                        </copy>
                                                                                                                </assign>
                                                                                                                <throw name="Throw_NoData_Found"
                                                                                                                       faultName="bpelx:bindingFault"
                                                                                                                       faultVariable="Exception"/>
                                                                                                        </sequence>
                                                                                                </otherwise>
                                                                                        </switch>
                                                                                </case>
                                                                                <otherwise>
                                                                                        <sequence name="Sequence_7">
                                                                                                <switch name="Switch_9">
                                                                                                        <case condition="(bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:NoDataFound') = 'true') and (bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isEOF') = 'true') and (bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:lineNumber') = 1)">
                                                                                                                <bpelx:annotation>
                                                                                                                        <bpelx:pattern>Empty File</bpelx:pattern>
                                                                                                                </bpelx:annotation>
                                                                                                                <sequence name="Sequence_21">
                                                                                                                        <assign name="EmptyFile">
                                                                                                                                <copy>
                                                                                                                                        <from expression="'0 byte file. send notification if required.'"/>
                                                                                                                                        <to variable="ErrorMessageText"/>
                                                                                                                                </copy>
                                                                                                                                <copy>
                                                                                                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/ProcessAJBFiles/EmailAddress')"/>
                                                                                                                                        <to variable="EmailAddress"/>
                                                                                                                                </copy>
                                                                                                                        </assign>
                                                                                                                        <scope name="Scope_1">
                                                                                                                                <scope name="Email_1">
                                                                                                                                        <bpelx:annotation>
                                                                                                                                                <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                                                                                                        </bpelx:annotation>
                                                                                                                                        <variables>
                                                                                                                                                <variable name="varNotificationReq"
                                                                                                                                                          messageType="ns24:EmailNotificationRequest"/>
                                                                                                                                                <variable name="varNotificationResponse"
                                                                                                                                                          messageType="ns24:ArrayOfResponse"/>
                                                                                                                                                <variable name="NotificationServiceFaultVariable"
                                                                                                                                                          messageType="ns24:NotificationServiceErrorMessage"/>
                                                                                                                                        </variables>
                                                                                                                                        <sequence name="Sequence_22">
                                                                                                                                                <assign name="EmailParamsAssign">
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('SOAEmailNotify')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:FromAccountName"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Bcc"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Cc"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:ReplyToAddress"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="concat('File  ',bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'),' received on ', xp20:current-dateTime(),'  has 0 records')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Subject"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:To"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="concat('File  ',bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'),' received on ', xp20:current-dateTime(),'  has 0 records')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Content/ns24:ContentBody"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Content/ns24:MimeType"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('SOAEmailNotify')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:FromAccountName"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Bcc"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Cc"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:ReplyToAddress"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="concat('File  ',bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'),' received on ', xp20:current-dateTime(),'  has 0 records')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Subject"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:To"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="concat('File  ',bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'),' received on ', xp20:current-dateTime(),'  has 0 records')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Content/ns24:ContentBody"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Content/ns24:MimeType"/>
                                                                                                                                                        </copy>
                                                                                                                                                </assign>
                                                                                                                                                <invoke name="InvokeNotificationService"
                                                                                                                                                        partnerLink="NotificationService"
                                                                                                                                                        portType="ns24:NotificationService"
                                                                                                                                                        operation="sendEmailNotification"
                                                                                                                                                        inputVariable="varNotificationReq"
                                                                                                                                                        outputVariable="varNotificationResponse"/>
                                                                                                                                        </sequence>
                                                                                                                                </scope>
                                                                                                                        </scope>
                                                                                                                </sequence>
                                                                                                        </case>
                                                                                                        <otherwise>
                                                                                                                <sequence name="Sequence_17">
                                                                                                                        <assign name="Assign_Invalid_Message">
                                                                                                                                <copy>
                                                                                                                                        <from expression="string('Invalid Message for AJB999')"/>
                                                                                                                                        <to variable="Exception"
                                                                                                                                            part="summary"/>
                                                                                                                                </copy>
                                                                                                                                <copy>
                                                                                                                                        <from expression="string('ReadChunkFile.InvalidMessage')"/>
                                                                                                                                        <to variable="Exception"
                                                                                                                                            part="code"/>
                                                                                                                                </copy>
                                                                                                                                <copy>
                                                                                                                                        <from variable="Status"/>
                                                                                                                                        <to variable="Exception"
                                                                                                                                            part="detail"/>
                                                                                                                                </copy>
                                                                                                                        </assign>
                                                                                                                        <throw name="Throw_invalid_Message"
                                                                                                                               faultName="bpelx:bindingFault"
                                                                                                                               faultVariable="Exception"/>
                                                                                                                </sequence>
                                                                                                        </otherwise>
                                                                                                </switch>
                                                                                        </sequence>
                                                                                </otherwise>
                                                                        </switch>
                                                                </sequence>
                                                        </while>
                                                </case>
                                                <case condition="bpws:getVariableData('Substr_File_name') ='AJB996'">
                                                        <bpelx:annotation>
                                                                <bpelx:pattern>AJB996</bpelx:pattern>
                                                        </bpelx:annotation>
                                                        <sequence name="Sequence_2">
                                                                <while name="While_2"
                                                                       condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isEOF') != 'true'">
                                                                        <sequence name="Sequence_3">
                                                                                <invoke name="InvokeAJB996ReadData"
                                                                                        partnerLink="ServiceFileAJB996Read"
                                                                                        portType="ns8:SynchChunkedRead_ptt"
                                                                                        operation="SynchChunkedRead"
                                                                                        inputVariable="InvokeAJB996ReadData"
                                                                                        outputVariable="InvokeAJB996ReadData_Output"
                                                                                        bpelx:outputHeaderVariable="SyncChunkReadOutboundHeader"
                                                                                        bpelx:inputHeaderVariable="SyncChunkReadInboundHeader"/>
                                                                                <assign name="AssignChunkHeaderAJB996">
                                                                                        <copy>
                                                                                                <from variable="SyncChunkReadOutboundHeader"/>
                                                                                                <to variable="SyncChunkReadInboundHeader"/>
                                                                                        </copy>
                                                                                        <copy>
                                                                                                <from expression="bpws:getVariableData('counter') + 1"/>
                                                                                                <to variable="counter"/>
                                                                                        </copy>
                                                                                        <copy>
                                                                                                <from expression="concat('Processing Chunk number: ', bpws:getVariableData('counter'), ' from file: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:fileName'), ' located in: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:directory'), '. Line number: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:lineNumber'), ', Column Number: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:columnNumber'), ', Record Number: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:recordNumber'), '. Is message rejected: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isMessageRejected'), ', Rejection reason: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:rejectionReason'), '. No data found: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:NoDataFound'), ', is EOF: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isEOF'))"/>
                                                                                                <to variable="Status"/>
                                                                                        </copy>
                                                                                </assign>
                                                                                <switch name="Switch_4">
                                                                                        <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isMessageRejected')!='true'">
                                                                                                <bpelx:annotation>
                                                                                                        <bpelx:pattern>Valid Message</bpelx:pattern>
                                                                                                </bpelx:annotation>
                                                                                                <switch name="Switch_5">
                                                                                                        <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:NoDataFound')!='true'">
                                                                                                                <bpelx:annotation>
                                                                                                                        <bpelx:pattern>Data Found</bpelx:pattern>
                                                                                                                </bpelx:annotation>
                                                                                                                <sequence name="Sequence_8">
                                                                                                                        <assign name="Transform_2">
                                                                                                                                <bpelx:annotation>
                                                                                                                                        <bpelx:pattern>transformation</bpelx:pattern>
                                                                                                                                </bpelx:annotation>
                                                                                                                                <copy>
                                                                                                                                        <from expression="ora:processXSLT('TransformationAJB996.xsl',bpws:getVariableData('InvokeAJB996ReadData_Output','Root-Element_AJB996'),bpws:getVariableData('XSLT_PARAM'))"/>
                                                                                                                                        <to variable="InvokeAJB996TableInsert"
                                                                                                                                            part="XxCeAjb996Collection"/>
                                                                                                                                </copy>
                                                                                                                        </assign>
                                                                                                                        <invoke name="InvokeAJB996TableInsert"
                                                                                                                                partnerLink="AJB996TableInsert"
                                                                                                                                portType="ns10:AJB996TableInsert_ptt"
                                                                                                                                operation="insert"
                                                                                                                                inputVariable="InvokeAJB996TableInsert"/>
                                                                                                                </sequence>
                                                                                                        </case>
                                                                                                        <otherwise>
                                                                                                                <sequence name="Sequence_9">
                                                                                                                        <assign name="Assign_NoData_Found">
                                                                                                                                <copy>
                                                                                                                                        <from expression="string('ReadChunkFile.NoDataFound')"/>
                                                                                                                                        <to variable="Exception"
                                                                                                                                            part="code"/>
                                                                                                                                </copy>
                                                                                                                                <copy>
                                                                                                                                        <from expression="string('No Data Found')"/>
                                                                                                                                        <to variable="Exception"
                                                                                                                                            part="summary"/>
                                                                                                                                </copy>
                                                                                                                                <copy>
                                                                                                                                        <from expression="string('Empty file or File layout issue. The data from the file does not match the file layout definition. The data parsing failed. Please review the file for errors. The status is: ', bpws:getVariableData('Status'))"/>
                                                                                                                                        <to variable="Exception"
                                                                                                                                            part="detail"/>
                                                                                                                                </copy>
                                                                                                                        </assign>
                                                                                                                        <throw name="Throw_NoData_Found"
                                                                                                                               faultName="bpelx:bindingFault"
                                                                                                                               faultVariable="Exception"/>
                                                                                                                </sequence>
                                                                                                        </otherwise>
                                                                                                </switch>
                                                                                        </case>
                                                                                        <otherwise>
                                                                                                <sequence name="Sequence_10">
                                                                                                        <switch name="Switch_8">
                                                                                                                <case condition="(bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:NoDataFound') = 'true') and (bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isEOF') = 'true') and (bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:lineNumber') = 1)">
                                                                                                                        <bpelx:annotation>
                                                                                                                                <bpelx:pattern>Empty File</bpelx:pattern>
                                                                                                                        </bpelx:annotation>
                                                                                                                        <sequence name="Sequence_23">
                                                                                                                                <assign name="EmptyFile">
                                                                                                                                        <copy>
                                                                                                                                                <from expression="'0 byte file. send notification if required.'"/>
                                                                                                                                                <to variable="ErrorMessageText"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/ProcessAJBFiles/EmailAddress')"/>
                                                                                                                                                <to variable="EmailAddress"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <scope name="Scope_2">
                                                                                                                                        <scope name="Email_2">
                                                                                                                                                <bpelx:annotation>
                                                                                                                                                        <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                                                                                                                </bpelx:annotation>
                                                                                                                                                <variables>
                                                                                                                                                        <variable name="varNotificationReq"
                                                                                                                                                                  messageType="ns24:EmailNotificationRequest"/>
                                                                                                                                                        <variable name="varNotificationResponse"
                                                                                                                                                                  messageType="ns24:ArrayOfResponse"/>
                                                                                                                                                        <variable name="NotificationServiceFaultVariable"
                                                                                                                                                                  messageType="ns24:NotificationServiceErrorMessage"/>
                                                                                                                                                </variables>
                                                                                                                                                <sequence name="Sequence_24">
                                                                                                                                                        <assign name="EmailParamsAssign">
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('SOAEmailNotify')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:FromAccountName"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:Bcc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:Cc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:ReplyToAddress"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File  ', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'), ' received on ', xp20:current-dateTime(), '  has 0 records', string(' '))"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:Subject"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:To"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File  ', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'), ' received on ', xp20:current-dateTime(), '  has 0 records', string('
'))"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:Content/ns24:ContentBody"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:Content/ns24:MimeType"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('SOAEmailNotify')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:FromAccountName"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:Bcc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:Cc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:ReplyToAddress"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File  ', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'), ' received on ', xp20:current-dateTime(), '  has 0 records', string(' '))"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:Subject"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:To"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File  ', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'), ' received on ', xp20:current-dateTime(), '  has 0 records', string('
'))"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:Content/ns24:ContentBody"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns24:Content/ns24:MimeType"/>
                                                                                                                                                                </copy>
                                                                                                                                                        </assign>
                                                                                                                                                        <invoke name="InvokeNotificationService"
                                                                                                                                                                partnerLink="NotificationService"
                                                                                                                                                                portType="ns24:NotificationService"
                                                                                                                                                                operation="sendEmailNotification"
                                                                                                                                                                inputVariable="varNotificationReq"
                                                                                                                                                                outputVariable="varNotificationResponse"/>
                                                                                                                                                </sequence>
                                                                                                                                        </scope>
                                                                                                                                </scope>
                                                                                                                        </sequence>
                                                                                                                </case>
                                                                                                                <otherwise>
                                                                                                                        <sequence name="Sequence_16">
                                                                                                                                <assign name="Assign_Invalid_Message">
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('ReadChunkFile.InvalidMessage for AJB996')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="code"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('Invalid Message')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="summary"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from variable="Status"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="detail"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <throw name="Throw_Invalid_Message"
                                                                                                                                       faultName="bpelx:bindingFault"
                                                                                                                                       faultVariable="Exception"/>
                                                                                                                        </sequence>
                                                                                                                </otherwise>
                                                                                                        </switch>
                                                                                                </sequence>
                                                                                        </otherwise>
                                                                                </switch>
                                                                        </sequence>
                                                                </while>
                                                        </sequence>
                                                </case>
                                                <case condition="bpws:getVariableData('Substr_File_name') ='AJB998'">
                                                        <bpelx:annotation>
                                                                <bpelx:pattern>AJB998</bpelx:pattern>
                                                        </bpelx:annotation>
                                                        <while name="While_1"
                                                               condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isEOF') != 'true'">
                                                                <sequence name="Sequence_1">
                                                                        <invoke name="InvokeAJB998ReadData"
                                                                                partnerLink="ServiceFileAJB998Read"
                                                                                portType="ns2:SynchChunkedRead_ptt"
                                                                                operation="SynchChunkedRead"
                                                                                inputVariable="Invoke_998_Chunk_Read"
                                                                                outputVariable="Invoke_output_998_Chunk_Read"
                                                                                bpelx:outputHeaderVariable="SyncChunkReadOutboundHeader"
                                                                                bpelx:inputHeaderVariable="SyncChunkReadInboundHeader"/>
                                                                        <assign name="AssignChunkHeaderAJB998">
                                                                                <copy>
                                                                                        <from variable="SyncChunkReadOutboundHeader"/>
                                                                                        <to variable="SyncChunkReadInboundHeader"/>
                                                                                </copy>
                                                                                <copy>
                                                                                        <from expression="bpws:getVariableData('counter') + 1"/>
                                                                                        <to variable="counter"/>
                                                                                </copy>
                                                                                <copy>
                                                                                        <from expression="concat('Processing Chunk number: ', bpws:getVariableData('counter'), ' from file: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:fileName'), ' located in: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:directory'), '. Line number: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:lineNumber'), ', Column Number: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:columnNumber'), ', Record Number: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:recordNumber'), '. Is message rejected: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isMessageRejected'), ', Rejection reason: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:rejectionReason'), '. No data found: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:NoDataFound'), ', is EOF: ', bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isEOF'))"/>
                                                                                        <to variable="Status"/>
                                                                                </copy>
                                                                        </assign>
                                                                        <switch name="Switch_6">
                                                                                <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isMessageRejected')!='true'">
                                                                                        <bpelx:annotation>
                                                                                                <bpelx:pattern>Valid Message</bpelx:pattern>
                                                                                        </bpelx:annotation>
                                                                                        <switch name="Switch_7">
                                                                                                <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:NoDataFound')!='true'">
                                                                                                        <bpelx:annotation>
                                                                                                                <bpelx:pattern>Data Found</bpelx:pattern>
                                                                                                        </bpelx:annotation>
                                                                                                        <sequence name="Sequence_11">
                                                                                                                <assign name="Transform_1">
                                                                                                                        <bpelx:annotation>
                                                                                                                                <bpelx:pattern>transformation</bpelx:pattern>
                                                                                                                        </bpelx:annotation>
                                                                                                                        <copy>
                                                                                                                                <from expression="ora:processXSLT('TransformationAJB998.xsl',bpws:getVariableData('Invoke_output_998_Chunk_Read','Root-Element'),bpws:getVariableData('XSLT_PARAM'))"/>
                                                                                                                                <to variable="InvokeAJB998TableInsert"
                                                                                                                                    part="XxCeAjb998Collection"/>
                                                                                                                        </copy>
                                                                                                                </assign>
                                                                                                                <invoke name="InvokeAJB998TableInsert"
                                                                                                                        partnerLink="AJB998TableInsert"
                                                                                                                        portType="ns5:AJB998TableInsert_ptt"
                                                                                                                        operation="insert"
                                                                                                                        inputVariable="InvokeAJB998TableInsert"/>
                                                                                                        </sequence>
                                                                                                </case>
                                                                                                <otherwise>
                                                                                                        <sequence name="Sequence_12">
                                                                                                                <assign name="Assign_NoData_Found">
                                                                                                                        <copy>
                                                                                                                                <from expression="string('ReadChunkFile.NoDataFound')"/>
                                                                                                                                <to variable="Exception"
                                                                                                                                    part="code"/>
                                                                                                                        </copy>
                                                                                                                        <copy>
                                                                                                                                <from expression="string('No Data Found')"/>
                                                                                                                                <to variable="Exception"
                                                                                                                                    part="summary"/>
                                                                                                                        </copy>
                                                                                                                        <copy>
                                                                                                                                <from expression="string('Empty file or File layout issue. The data from the file does not match the file layout definition. The data parsing failed. Please review the file for errors. The status is: ', bpws:getVariableData('Status'))"/>
                                                                                                                                <to variable="Exception"
                                                                                                                                    part="detail"/>
                                                                                                                        </copy>
                                                                                                                </assign>
                                                                                                                <throw name="Throw_NoData_Found"
                                                                                                                       faultName="bpelx:bindingFault"
                                                                                                                       faultVariable="Exception"/>
                                                                                                        </sequence>
                                                                                                </otherwise>
                                                                                        </switch>
                                                                                </case>
                                                                                <otherwise>
                                                                                        <sequence name="Sequence_13">
                                                                                                <switch name="Switch_10">
                                                                                                        <case condition="(bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:NoDataFound') = 'true') and (bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:isEOF') = 'true') and (bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:lineNumber') = 1)">
                                                                                                                <bpelx:annotation>
                                                                                                                        <bpelx:pattern>Empty file</bpelx:pattern>
                                                                                                                </bpelx:annotation>
                                                                                                                <sequence name="Sequence_25">
                                                                                                                        <assign name="EmptyFile">
                                                                                                                                <copy>
                                                                                                                                        <from expression="'0 byte file. send notification if required.'"/>
                                                                                                                                        <to variable="ErrorMessageText"/>
                                                                                                                                </copy>
                                                                                                                                <copy>
                                                                                                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/ProcessAJBFiles/EmailAddress')"/>
                                                                                                                                        <to variable="EmailAddress"/>
                                                                                                                                </copy>
                                                                                                                        </assign>
                                                                                                                        <scope name="Scope_3">
                                                                                                                                <scope name="Email_3">
                                                                                                                                        <bpelx:annotation>
                                                                                                                                                <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                                                                                                        </bpelx:annotation>
                                                                                                                                        <variables>
                                                                                                                                                <variable name="varNotificationReq"
                                                                                                                                                          messageType="ns24:EmailNotificationRequest"/>
                                                                                                                                                <variable name="varNotificationResponse"
                                                                                                                                                          messageType="ns24:ArrayOfResponse"/>
                                                                                                                                                <variable name="NotificationServiceFaultVariable"
                                                                                                                                                          messageType="ns24:NotificationServiceErrorMessage"/>
                                                                                                                                        </variables>
                                                                                                                                        <sequence name="Sequence_26">
                                                                                                                                                <assign name="EmailParamsAssign">
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string(' SOAEmailNotify')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:FromAccountName"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Bcc"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Cc"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:ReplyToAddress"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="concat('File  ', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'), ' received on ', xp20:current-dateTime(), '  has 0 records')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Subject"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:To"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="concat('File  ', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'), ' received on ', xp20:current-dateTime(), '  has 0 records')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Content/ns24:ContentBody"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Content/ns24:MimeType"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string(' SOAEmailNotify')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:FromAccountName"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Bcc"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Cc"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:ReplyToAddress"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="concat('File  ', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'), ' received on ', xp20:current-dateTime(), '  has 0 records')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Subject"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:To"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="concat('File  ', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'), ' received on ', xp20:current-dateTime(), '  has 0 records')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Content/ns24:ContentBody"/>
                                                                                                                                                        </copy>
                                                                                                                                                        <copy>
                                                                                                                                                                <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                                    part="EmailPayload"
                                                                                                                                                                    query="/EmailPayload/ns24:Content/ns24:MimeType"/>
                                                                                                                                                        </copy>
                                                                                                                                                </assign>
                                                                                                                                                <invoke name="InvokeNotificationService"
                                                                                                                                                        partnerLink="NotificationService"
                                                                                                                                                        portType="ns24:NotificationService"
                                                                                                                                                        operation="sendEmailNotification"
                                                                                                                                                        inputVariable="varNotificationReq"
                                                                                                                                                        outputVariable="varNotificationResponse"/>
                                                                                                                                        </sequence>
                                                                                                                                </scope>
                                                                                                                        </scope>
                                                                                                                </sequence>
                                                                                                        </case>
                                                                                                        <otherwise>
                                                                                                                <sequence name="Sequence_18">
                                                                                                                        <assign name="Assign_Invalid_Message">
                                                                                                                                <copy>
                                                                                                                                        <from expression="string('ReadChunkFile.InvalidMessage for AJB999')"/>
                                                                                                                                        <to variable="Exception"
                                                                                                                                            part="code"/>
                                                                                                                                </copy>
                                                                                                                                <copy>
                                                                                                                                        <from expression="string('Invalid Message')"/>
                                                                                                                                        <to variable="Exception"
                                                                                                                                            part="summary"/>
                                                                                                                                </copy>
                                                                                                                                <copy>
                                                                                                                                        <from variable="Status"/>
                                                                                                                                        <to variable="Exception"
                                                                                                                                            part="detail"/>
                                                                                                                                </copy>
                                                                                                                        </assign>
                                                                                                                        <throw name="Throw_Invalid_Message"
                                                                                                                               faultName="bpelx:bindingFault"
                                                                                                                               faultVariable="Exception"/>
                                                                                                                </sequence>
                                                                                                        </otherwise>
                                                                                                </switch>
                                                                                        </sequence>
                                                                                </otherwise>
                                                                        </switch>
                                                                </sequence>
                                                        </while>
                                                </case>
                                        </switch>
                                        <assign name="AssignOutDetails">
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:directory"/>
                                                        <to variable="Outbound_Var"
                                                            query="/ns4:OutboundFileHeaderType/ns4:sourceDirectory"/>
                                                </copy>
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:fileName"/>
                                                        <to variable="Outbound_Var"
                                                            query="/ns4:OutboundFileHeaderType/ns4:sourceFileName"/>
                                                </copy>
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:directory"/>
                                                        <to variable="Outbound_Var"
                                                            query="/ns4:OutboundFileHeaderType/ns4:targetDirectory"/>
                                                </copy>
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:fileName"/>
                                                        <to variable="Outbound_Var"
                                                            query="/ns4:OutboundFileHeaderType/ns4:targetFileName"/>
                                                </copy>
                                        </assign>
                                        <invoke name="InvokeFileDelete"
                                                partnerLink="FileDelete"
                                                portType="ns18:Write_ptt"
                                                operation="Write"
                                                inputVariable="Invoke_1_Write_InputVariable"
                                                bpelx:inputHeaderVariable="Outbound_Var"/>
                                </sequence>
                        </case>
                        <otherwise>
                                <bpelx:annotation>
                                        <bpelx:pattern>Duplicate File</bpelx:pattern>
                                </bpelx:annotation>
                                <sequence name="Sequence_15">
                                        <assign name="InitializeDuplicateFileException">
                                                <copy>
                                                        <from expression="string('Duplicate File Exception')"/>
                                                        <to variable="Exception"
                                                            part="summary"/>
                                                </copy>
                                                <copy>
                                                        <from expression="concat(&quot;The file &quot;, bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'),&quot; has already been processed.&quot;) "/>
                                                        <to variable="Exception"
                                                            part="detail"/>
                                                </copy>
                                                <copy>
                                                        <from expression="string('XX_CE_AJB_CC_RECON_PKG_FILENAME_CHECK.DuplicateFileName')"/>
                                                        <to variable="Exception"
                                                            part="code"/>
                                                </copy>
                                        </assign>
                                        <assign name="AssignDuplicateFileExceptionDetails">
                                                <copy>
                                                        <from expression="concat(&quot;Error encountered in ProcessFTPAJBFiles, while copying file &quot;,bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'))"/>
                                                        <to variable="ErrorMessageText"/>
                                                </copy>
                                                <copy>
                                                        <from expression="ora:getProcessId()"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ProcessInfo/ns15:BusinessProcessName"/>
                                                </copy>
                                                <copy>
                                                        <from expression="ora:getInstanceId()"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ProcessInfo/ns15:BusinessProcessId"/>
                                                </copy>
                                                <copy>
                                                        <from expression="ora:getDomainId()"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ProcessInfo/ns15:BusinessProcessDomain"/>
                                                </copy>
                                                <copy>
                                                        <from expression="ora:getProcessURL()"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ProcessInfo/ns15:SystemName"/>
                                                </copy>
                                                <copy>
                                                        <from expression="xp20:current-dateTime()"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorDateTime"/>
                                                </copy>
                                                <copy>
                                                        <from expression="'Catch All on the Main Sequence'"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ProcessInfo/ns15:BusinessProcessStep"/>
                                                </copy>
                                                <copy>
                                                        <from variable="Exception"
                                                              part="code"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorCode"/>
                                                </copy>
                                                <copy>
                                                        <from variable="ErrorMessageText"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorDescription"/>
                                                </copy>
                                                <copy>
                                                        <from variable="Exception"
                                                              part="detail"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorText"/>
                                                </copy>
                                                <copy>
                                                        <from expression="'system'"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorType"/>
                                                </copy>
                                                <copy>
                                                        <from expression="'fatal'"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:ErrorDetails/ns15:ErrorSeverity"/>
                                                </copy>
                                                <copy>
                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/FaultNotification/SendNotification')"/>
                                                        <to variable="invkCatchAll_initiate"
                                                            part="payload"
                                                            query="/ns15:ErrorData/ns15:Notification/ns15:sendNotification"/>
                                                </copy>
                                        </assign>
                                        <invoke name="InvokeODErrorloggerDuplicateFile"
                                                partnerLink="ODErrorLogger"
                                                portType="ns14:ODErrorLogger"
                                                operation="initiate"
                                                inputVariable="invkCatchAll_initiate"/>
                                        <assign name="AssignOutDetails_FileDuplicate">
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:directory"/>
                                                        <to variable="Outbound_Var"
                                                            query="/ns4:OutboundFileHeaderType/ns4:sourceDirectory"/>
                                                </copy>
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:fileName"/>
                                                        <to variable="Outbound_Var"
                                                            query="/ns4:OutboundFileHeaderType/ns4:sourceFileName"/>
                                                </copy>
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:directory"/>
                                                        <to variable="Outbound_Var"
                                                            query="/ns4:OutboundFileHeaderType/ns4:targetDirectory"/>
                                                </copy>
                                                <copy>
                                                        <from variable="InputFileHeader"
                                                              part="payload"
                                                              query="/ns1:fileHeader/ns1:fileName"/>
                                                        <to variable="Outbound_Var"
                                                            query="/ns4:OutboundFileHeaderType/ns4:targetFileName"/>
                                                </copy>
                                        </assign>
                                        <invoke name="InvokeFileDelete_DuplicateFile"
                                                partnerLink="FileDelete"
                                                portType="ns18:Write_ptt"
                                                operation="Write"
                                                inputVariable="Invoke_1_Write_InputVariable"
                                                bpelx:inputHeaderVariable="Outbound_Var"/>
                                        <terminate name="TerminateDuplicateFile"/>
                                </sequence>
                        </otherwise>
                </switch>
                <assign name="AssignBpelFileLoad">
                        <copy>
                                <from variable="InputFileHeader" part="payload"
                                      query="/ns1:fileHeader/ns1:fileName"/>
                                <to variable="InvokeServiceRecordFileLoad_In"
                                    part="InputParameters"
                                    query="/ns26:InputParameters/P_FILE_NAME"/>
                        </copy>
                        <copy>
                                <from expression="ora:getInstanceId()"/>
                                <to variable="InvokeServiceRecordFileLoad_In"
                                    part="InputParameters"
                                    query="/ns26:InputParameters/P_BPEL_INSTANCE_ID"/>
                        </copy>
                        <copy>
                                <from expression="substring(bpws:getVariableData('AJBPrefixFileName'),4)"/>
                                <to variable="InvokeServiceRecordFileLoad_In"
                                    part="InputParameters"
                                    query="/ns26:InputParameters/P_FILE_TYPE"/>
                        </copy>
                </assign>
                <invoke name="InvokeServiceRecordFileLoad"
                        partnerLink="Service_BPEL_Record_File_Load"
                        portType="ns25:Service_BPEL_Record_File_Load_ptt"
                        operation="Service_BPEL_Record_File_Load"
                        inputVariable="InvokeServiceRecordFileLoad_In"
                        outputVariable="InvokeServiceRecordFileLoad_Out"/>
                <assign name="asnCCPrgmValues">
                        <copy>
                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/ProcessAJBFiles/UserName')"/>
                                <to variable="invkCallCCProgram_In"
                                    part="InputParameters"
                                    query="/ns28:InputParameters/P_USER_NAME"/>
                        </copy>
                        <copy>
                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/ProcessAJBFiles/ResponsibilityName')"/>
                                <to variable="invkCallCCProgram_In"
                                    part="InputParameters"
                                    query="/ns28:InputParameters/P_RESP_NAME"/>
                        </copy>
                        <copy>
                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/ProcessAJBFiles/CCName')"/>
                                <to variable="invkCallCCProgram_In"
                                    part="InputParameters"
                                    query="/ns28:InputParameters/P_CONC_SHORT_NAME"/>
                        </copy>
                        <copy>
                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/ProcessAJBFiles/ApplicationShortName')"/>
                                <to variable="invkCallCCProgram_In"
                                    part="InputParameters"
                                    query="/ns28:InputParameters/P_APPL_SHORT_NAME"/>
                        </copy>
                        <copy>
                                <from expression="substring(bpws:getVariableData('Substr_File_name'),4,6)"/>
                                <to variable="invkCallCCProgram_In"
                                    part="InputParameters"
                                    query="/ns28:InputParameters/P_ARGUMENT1"/>
                        </copy>
                        <copy>
                                <from variable="InputFileHeader" part="payload"
                                      query="/ns1:fileHeader/ns1:fileName"/>
                                <to variable="invkCallCCProgram_In"
                                    part="InputParameters"
                                    query="/ns28:InputParameters/P_ARGUMENT2"/>
                        </copy>
                        <copy>
                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/ProcessAJBFiles/BatchSize')"/>
                                <to variable="invkCallCCProgram_In"
                                    part="InputParameters"
                                    query="/ns28:InputParameters/P_ARGUMENT3"/>
                        </copy>
                </assign>
                <invoke name="invkCCProgram" partnerLink="serviceCallCCProgram"
                        portType="ns27:serviceCallCCProgram_ptt"
                        operation="serviceCallCCProgram"
                        inputVariable="invkCallCCProgram_In"
                        outputVariable="invkCallCCProgram_Out"/>
                <scope name="logTransactionEnd">
                        <sequence name="Sequence_20">
                                <assign name="logTransactionInput">
                                        <copy>
                                                <from expression="'Success'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:ProcessStatus"/>
                                        </copy>
                                        <copy>
                                                <from expression="number(bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns4:OutboundFileHeaderType/ns4:lineNumber')) - 1"/>
                                                <to variable="numberofrecords"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getCurrentDateTime()"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:ProcessInfo/ns23:transactionEndTime"/>
                                        </copy>
                                        <copy>
                                                <from>
                                                        <EntiltyList xmlns="http://xmlns.oracle.com/TransactionData">
                                                                <EntityID EntityType="SourceFileName"/>
                                                                <EntityID EntityType="TargetTableName"/>
                                                                <EntityID EntityType="NumberOfRecords"/>
                                                                <EntityID EntityType="ReleaseESPJob"/>
                                                                <EntityID EntityType="NumberOfChunksProcessed"/>
                                                                <EntityID EntityType="ChunkSize"/>
                                                        </EntiltyList>
                                                </from>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:EntiltyList"/>
                                        </copy>
                                        <copy>
                                                <from expression="concat('&lt;EntityID EntityType=&quot;SourceFileName&quot;>', bpws:getVariableData('InputFileHeader','payload','/ns1:fileHeader/ns1:fileName'), '&lt;/EntityID>')"/>
                                                <to variable="xmlFragment"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:parseEscapedXML(bpws:getVariableData('xmlFragment'))"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:EntiltyList/ns23:EntityID[1]"/>
                                        </copy>
                                        <copy>
                                                <from expression="concat('&lt;EntityID EntityType=&quot;TargetTableName&quot;>', bpws:getVariableData('Invoke_Service_Duplicate_File_In','InputParameters', '/ns21:InputParameters/ns21:P_TABLE_NAME'), '&lt;/EntityID>')"/>
                                                <to variable="xmlFragment"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:parseEscapedXML(bpws:getVariableData('xmlFragment'))"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:EntiltyList/ns23:EntityID[2]"/>
                                        </copy>
                                        <copy>
                                                <from expression="concat('&lt;EntityID EntityType=&quot;NumberOfRecords&quot;>', bpws:getVariableData('numberofrecords'), '&lt;/EntityID>')"/>
                                                <to variable="xmlFragment"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:parseEscapedXML(bpws:getVariableData('xmlFragment'))"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:EntiltyList/ns23:EntityID[3]"/>
                                        </copy>
                                        <copy>
                                                <from expression="concat('&lt;EntityID EntityType=&quot;ReleaseESPJob&quot;>', 'No', '&lt;/EntityID>')"/>
                                                <to variable="xmlFragment"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:parseEscapedXML(bpws:getVariableData('xmlFragment'))"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:EntiltyList/ns23:EntityID[4]"/>
                                        </copy>
                                        <copy>
                                                <from expression="concat('&lt;EntityID EntityType=&quot;NumberOfChunksProcessed&quot;>', bpws:getVariableData('counter'), '&lt;/EntityID>')"/>
                                                <to variable="xmlFragment"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:parseEscapedXML(bpws:getVariableData('xmlFragment'))"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:EntiltyList/ns23:EntityID[5]"/>
                                        </copy>
                                        <copy>
                                                <from expression="concat('&lt;EntityID EntityType=&quot;ChunkSize&quot;>', '2000', '&lt;/EntityID>')"/>
                                                <to variable="xmlFragment"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:parseEscapedXML(bpws:getVariableData('xmlFragment'))"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:EntiltyList/ns23:EntityID[6]"/>
                                        </copy>
                                        <copy>
                                                <from variable="Status"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns23:TransactionData/ns23:MessageDetails/ns23:MessageData"/>
                                        </copy>
                                </assign>
                                <invoke name="logTransaction"
                                        partnerLink="ODTransactionLogger"
                                        portType="ns22:ODTransactionLogger"
                                        operation="initiate"
                                        inputVariable="logTransactionInput"/>
                        </sequence>
                </scope>
        </sequence>
</process>
<?xml version = "1.0" encoding = "UTF-8" ?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Mon Jan 21 16:37:00 EST 2008
  Author:  Cecilia-Macean
  Purpose: Empty BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->
<process name="PostJournalEntry"
         targetNamespace="http://xmlns.oracle.com/PostJournalEntry"
         xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
         xmlns:ns4="http://schemas.oracle.com/service/bpel/common"
         xmlns:ns24="http://xmlns.oracle.com/ODTransactionLogger"
         xmlns:ns30="http://xmlns.oracle.com/pcbpel/adapter/file/ChunkReadTMSJournal/"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns16="ODError"
         xmlns:ns27="http://xmlns.oracle.com/ias/pcbpel/NotificationService"
         xmlns:ns5="http://TargetNamespace.com/FTPGLJournalInvoice"
         xmlns:ora="http://schemas.oracle.com/xpath/extension"
         xmlns:ns31="http://xmlns.oracle.com/pcbpel/adapter/file/TestServiceName/"
         xmlns:ns32="http://TargetNamespace.com/TMSGLFTPRead"
         xmlns:ns9="http://xmlns.oracle.com/pcbpel/adapter/db/GLStagingTableInsert/"
         xmlns:ns17="http://TargetNamespace.com/FileRead"
         xmlns:ns1="http://xmlns.oracle.com/pcbpel/adapter/ftp/InvokeTriggerFilePut/"
         xmlns:ns25="http://xmlns.oracle.com/TransactionData"
         xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/file/"
         xmlns:ns26="http://xmlns.oracle.com/BPELInvokeESP"
         xmlns:ns15="http://xmlns.oracle.com/ODErrorLogger"
         xmlns:orcl="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
         xmlns:ns10="http://xmlns.oracle.com/PostGLSIStgTableInsert"
         xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:ns20="http://xmlns.oracle.com/pcbpel/adapter/db/APPS/XX_BPEL_INTEGRATION_PKG/SUBMIT_CONCURRENT_PROGRAM/"
         xmlns:ns13="http://TargetNamespace.com/PSGLFTPRead"
         xmlns:ns7="http://www.openapplications.org/oagis/9"
         xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
         xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap"
         xmlns:ns12="http://xmlns.oracle.com/pcbpel/adapter/file/ChunkReadPeopleSoftJournal/"
         xmlns:ns29="http://xmlns.oracle.com/GetFileInfo"
         xmlns:ns18="http://xmlns.oracle.com/pcbpel/adapter/ftp/"
         xmlns:client="http://xmlns.oracle.com/PostJournalEntry"
         xmlns:ns23="http://xmlns.oracle.com/pcbpel/adapter/file/FileDelete/"
         xmlns:ns6="http://xmlns.oracle.com/pcbpel/adapter/ftp/Dummy_OAGIS/"
         xmlns:ns28="http://xmlns.oracle.com/pcbpel/adapter/file/ChunkReadGDWJournal/"
         xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions"
         xmlns:xdk="http://schemas.oracle.com/bpel/extension/xpath/function/xdk"
         xmlns:ns11="http://xmlns.oracle.com/ODErrorLogger"
         xmlns:ns22="http://xmlns.oracle.com/PostJournalEntryGLSI"
         xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
         xmlns:ns19="http://xmlns.oracle.com/pcbpel/adapter/db/SubmitConcurrentProgram/"
         xmlns:ehdr="http://www.oracle.com/XSL/Transform/java/oracle.tip.esb.server.headers.ESBHeaderFunctions"
         xmlns:ns14="http://xmlns.oracle.com/pcbpel/adapter/file/ChunkReadGSSJournal/"
         xmlns:ns3="http://xmlns.oracle.com/pcbpel/adapter/file/ChunkReadGLSIJournal/"
         xmlns:bpelx="http://schemas.oracle.com/bpel/extension"
         xmlns:ns21="http://xmlns.oracle.com/pcbpel/adapter/db/InvokeConcurrentProgram/"
         xmlns:ns8="http://www.openapplications.org/oagis/9/officedepot/1">
        <bpelx:exec import="org.w3c.dom.Element"/>
        <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      PARTNERLINKS                                                      
      List of services participating in this BPEL process               
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
        <partnerLinks>
                <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
                <partnerLink name="client"
                             partnerLinkType="client:PostJournalEntry"
                             myRole="PostJournalEntryProvider"/>
                <!--                         partnerRole="PostJournalEntryRequester"/>  -->
                <partnerLink name="ChunkReadGLSIJournal"
                             partnerRole="SynchChunkedRead_role"
                             partnerLinkType="ns3:SynchChunkedRead_plt"/>
                <partnerLink myRole="Get_role" name="Dummy_OAGIS"
                             partnerLinkType="ns6:Get_plt"/>
                <partnerLink myRole="ODErrorLoggerRequester"
                             name="ODErrorLogger"
                             partnerRole="ODErrorLoggerProvider"
                             partnerLinkType="ns15:ODErrorLogger"/>
                <partnerLink name="PostGLSIStgTableInsert"
                             partnerRole="PostGLSIStgTableInsertProvider"
                             partnerLinkType="ns10:PostGLSIStgTableInsert"
                             myRole="PostGLSIStgTableInsertRequester"/>
                <partnerLink name="ChunkReadPeopleSoftJournal"
                             partnerRole="SynchChunkedRead_role"
                             partnerLinkType="ns12:SynchChunkedRead_plt"/>
                <partnerLink name="ChunkReadGSSJournal"
                             partnerRole="SynchChunkedRead_role"
                             partnerLinkType="ns14:SynchChunkedRead_plt"/>
                <partnerLink name="InvokeConcurrentProgram"
                             partnerRole="InvokeConcurrentProgram_role"
                             partnerLinkType="ns21:InvokeConcurrentProgram_plt"/>
                <partnerLink name="FileDelete" partnerRole="Write_role"
                             partnerLinkType="ns23:Write_plt"/>
                <partnerLink myRole="ODTransactionLoggerRequester"
                             name="ODTransactionLogger"
                             partnerRole="ODTransactionLoggerProvider"
                             partnerLinkType="ns24:ODTransactionLogger"/>
                <partnerLink myRole="BPELInvokeESPRequester"
                             name="BPELInvokeESP"
                             partnerRole="BPELInvokeESPProvider"
                             partnerLinkType="ns26:BPELInvokeESP"/>
                <partnerLink name="NotificationService"
                             partnerRole="NotificationServiceProvider"
                             partnerLinkType="ns27:NotificationServiceLink"/>
                <partnerLink name="ChunkReadGDWJournal"
                             partnerRole="SynchChunkedRead_role"
                             partnerLinkType="ns28:SynchChunkedRead_plt"/>
                <partnerLink name="GetFileInfo"
                             partnerRole="GetFileInfoProvider"
                             partnerLinkType="ns29:GetFileInfo"/>
                <partnerLink name="ChunkReadTMSJournal"
                             partnerRole="SynchChunkedRead_role"
                             partnerLinkType="ns30:SynchChunkedRead_plt"/>
        </partnerLinks>
        <variables>
                <!-- Reference to the message passed as input during initiation -->
                <variable name="InputFileHeader"
                          messageType="client:PostJournalEntryRequestMessage"/>
                <!-- Reference to the message that will be sent back to the requester during callback -->
                <variable name="ReadGLSIJournalDataInput"
                          messageType="ns3:Empty_msg"/>
                <variable name="SyncChunkReadInboundHeader"
                          messageType="ns2:OutboundHeader_msg"/>
                <variable name="SyncChunkReadOutboundHeader"
                          messageType="ns2:OutboundHeader_msg"/>
                <variable name="OutputFileHeader"
                          messageType="ns2:OutboundHeader_msg"/>
                <variable name="XSLT_Param" element="ns4:parameters"/>
                <variable name="lastHeaderFound" element="ns5:Header"/>
                <variable name="Oagis" messageType="ns6:PostJournalEntry_msg"/>
                <variable name="ReadGLSIJournalDataOutput"
                          messageType="ns3:GLJournalInvoice_msg"/>
                <variable name="StgTableInsertRequest"
                          messageType="ns10:PostGLSIStgTableInsertRequestMessage"/>
                <variable name="Exception"
                          messageType="bpelx:RuntimeFaultMessage"/>
                <variable name="invkCatchAll_initiate"
                          messageType="ns15:ODErrorLoggerRequestMessage"/>
                <variable name="Invoke_2_SynchChunkedRead_PS"
                          messageType="ns12:Empty_msg"/>
                <variable name="Invoke_2_SynchChunkedRead_Output_PS"
                          messageType="ns12:PSJournalEntry_msg"/>
                <variable name="ReadGSSJournalsInput"
                          messageType="ns14:Empty_msg"/>
                <variable name="ReadGSSJournalsOutput"
                          messageType="ns14:Root-Element_msg"/>
                <variable name="FileName" type="xsd:string"/>
                <variable name="FileNameLength" type="xsd:int"/>
                <variable name="FileNameWithoutTimeStamp" type="xsd:string"/>
                <variable name="StgTableInsertResponse"
                          messageType="ns10:PostGLSIStgTableInsertResponseMessage"/>
                <variable name="ConcurrentProgram_In"
                          messageType="ns21:args_in_msg"/>
                <variable name="ConcurrentProgram_Out"
                          messageType="ns21:args_out_msg"/>
                <variable name="ErrorMessageText" type="xsd:string"/>
                <variable name="TestVariable" type="xsd:string"/>
                <variable name="InvokeFiledelete" messageType="ns23:Write_msg"/>
                <variable name="OutPut_Var"
                          element="ns2:OutboundFileHeaderType"/>
                <variable name="ProcessHeader" type="xsd:string"/>
                <variable name="logTransactionInput"
                          messageType="ns24:ODTransactionLoggerRequestMessage"/>
                <variable name="XSLT_Param1" element="ns4:parameters"/>
                <variable name="InvokeServiceESPIn"
                          messageType="ns26:BPELInvokeESPRequestMessage"/>
                <variable name="ESP_File_Name" type="xsd:string"/>
                <variable name="TMP_File_Name" type="xsd:string"/>
                <variable name="EmailAddress" type="xsd:string"/>
                <variable name="TestVarSeq" type="xsd:integer"/>
                <variable name="BatchIdVar" type="xsd:integer"/>
                <variable name="xmlFragment" type="xsd:string"/>
                <variable name="SourceSystem" type="xsd:string"/>
                <variable name="temp" type="xsd:string"/>
                <variable name="PS_File_Name" type="xsd:string"/>
                <variable name="PS_Subgroup" type="xsd:string"/>
                <variable name="GLSI_Subgroup" type="xsd:string"/>
                <variable name="ReadGDWJournals_SynchRead_In"
                          messageType="ns28:Empty_msg"/>
                <variable name="ReadGDWJournals_SynchRead_Out"
                          messageType="ns28:GDWJournalEntry_msg"/>
                <variable name="RejectionReason" type="xsd:string"/>
                <variable name="isNoDataFound" type="xsd:string"/>
                <variable name="InvokeGetFileInfoIn"
                          messageType="ns29:GetFileInfoRequestMessage"/>
                <variable name="InvokeGetFileInfoOut"
                          messageType="ns29:GetFileInfoResponseMessage"/>
                <variable name="ReceiveGLSIResponseOut"
                          messageType="ns10:PostGLSIStgTableInsertResponseMessage"/>
                <variable name="ReadTMSJournals_SynchChunkedRead_InputVariable"
                          messageType="ns30:Empty_msg"/>
                <variable name="ReadTMSJournals_SynchChunkedRead_OutputVariable"
                          messageType="ns30:TMSJournalEntry_msg"/>
        </variables>
        <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      VARIABLES                                                        
      List of messages and XML documents used within this BPEL process 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
        <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
     ORCHESTRATION LOGIC                                               
     Set of activities coordinating the flow of messages across the    
     services integrated within this business process                  
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
        <faultHandlers>
                <catchAll>
                        <sequence name="Sequence_4">
                                <bpelx:exec name="InitializeErrorMessageText"
                                            language="java" version="1.5">
                                        <![CDATA[try{       
     
    StringBuffer sb = new StringBuffer();       
    sb.append("Exception caught while processing batch file");  
    String fileName = ((Element)getVariableData("InputFileHeader", "payload","/client:fileHeader/client:fileName")).getFirstChild().getNodeValue();  
    if (fileName != null){  
        sb.append(" name: ");  
        sb.append(fileName);  
        }  
    String directoryName = ((Element)getVariableData("InputFileHeader", "payload","/client:fileHeader/client:directory")).getFirstChild().getNodeValue();  
    if (directoryName != null){  
        sb.append( " from directory: ");  
        sb.append(directoryName);  
        }  
    String lineNumber = ((Element)getVariableData("SyncChunkReadInboundHeader", "outboundHeader","/ns2:OutboundFileHeaderType/ns2:lineNumber")).getFirstChild().getNodeValue();  
    if (lineNumber != null){  
        sb.append( ". The error occurred while processing the data chunk starting at line: ");  
        sb.append(lineNumber);  
        }          
    String columnNumber = ((Element)getVariableData("SyncChunkReadInboundHeader", "outboundHeader","/ns2:OutboundFileHeaderType/ns2:columnNumber")).getFirstChild().getNodeValue();  
    if (columnNumber != null){  
        sb.append( ", column number: ");  
        sb.append(columnNumber);  
        }       
    String recordNumber = ((Element)getVariableData("SyncChunkReadInboundHeader", "outboundHeader","/ns2:OutboundFileHeaderType/ns2:recordNumber")).getFirstChild().getNodeValue();  
    if (recordNumber != null){  
        sb.append( ", record number: ");  
        sb.append(recordNumber);  
        }   
    String isMessageRejected = ((Element)getVariableData("SyncChunkReadInboundHeader", "outboundHeader","/ns2:OutboundFileHeaderType/ns2:isMessageRejected")).getFirstChild().getNodeValue();  
    if (isMessageRejected != null){  
        sb.append( ". Is the message rejected: ");  
        sb.append(isMessageRejected);  
        }         
    String rejectionReason = ((Element)getVariableData("SyncChunkReadInboundHeader", "outboundHeader","/ns2:OutboundFileHeaderType/ns2:rejectionReason")).getFirstChild().getNodeValue();  
    if (rejectionReason != null){  
        sb.append( ". The rejection reason is: ");  
        sb.append(rejectionReason);  
        }     
    String noDataFound = ((Element)getVariableData("SyncChunkReadInboundHeader", "outboundHeader","/ns2:OutboundFileHeaderType/ns2:NoDataFound")).getFirstChild().getNodeValue();  
    if (noDataFound != null){  
        sb.append( ". Data found: ");  
        sb.append(noDataFound);  
        }      
    String isEOF = ((Element)getVariableData("SyncChunkReadInboundHeader", "outboundHeader","/ns2:OutboundFileHeaderType/ns2:isEOF")).getFirstChild().getNodeValue();  
    if (isEOF != null){  
        sb.append( ". Is EOF: ");  
        sb.append(isEOF);  
        }     
    sb.append(".");         
    addAuditTrailEntry(sb.toString());       
    setVariableData("ErrorMessageText", sb.toString());       
    } catch( Exception ne )       
{       
    addAuditTrailEntry(ne);       
}]]>
                                </bpelx:exec>
                                <switch name="SwitchCleanStagingTable">
                                        <case condition="bpws:getVariableData('Oagis','PostJournalEntry','/ns7:PostJournalEntry') != string('')">
                                                <bpelx:annotation>
                                                        <bpelx:pattern>OAGIS_NOT_EMPTY</bpelx:pattern>
                                                </bpelx:annotation>
                                                <sequence name="Sequence_9">
                                                        <assign name="OAGIS_NOT_EMPTY">
                                                                <copy>
                                                                        <from expression="concat(bpws:getVariableData('ErrorMessageText'), ' The GroupID/BatchID used to insert into XXFIN.XX_GL_INTERFACE_NA_STG is : ' , bpws:getVariableData('Oagis','PostJournalEntry','/ns7:PostJournalEntry/ns7:DataArea/ns7:JournalEntry/ns7:JournalEntryHeader/ns7:GLEntityID'))"/>
                                                                        <to variable="ErrorMessageText"/>
                                                                </copy>
                                                                <copy>
                                                                        <from expression="'Not Empty Oagis'"/>
                                                                        <to variable="TestVariable"/>
                                                                </copy>
                                                        </assign>
                                                        <assign name="AssignConProgramParam">
                                                                <copy>
                                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/GLConcurrentPrograms/GL_Journals_CleanStagingTable/UserName')"/>
                                                                        <to variable="ConcurrentProgram_In"
                                                                            part="InputParameters"
                                                                            query="/ns20:InputParameters/ns20:P_USER_NAME"/>
                                                                </copy>
                                                                <copy>
                                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/GLConcurrentPrograms/GL_Journals_CleanStagingTable/Responsibility')"/>
                                                                        <to variable="ConcurrentProgram_In"
                                                                            part="InputParameters"
                                                                            query="/ns20:InputParameters/ns20:P_RESP_NAME"/>
                                                                </copy>
                                                                <copy>
                                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/GLConcurrentPrograms/GL_Journals_CleanStagingTable/ApplicationName')"/>
                                                                        <to variable="ConcurrentProgram_In"
                                                                            part="InputParameters"
                                                                            query="/ns20:InputParameters/ns20:P_APPL_SHORT_NAME"/>
                                                                </copy>
                                                                <copy>
                                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/GLConcurrentPrograms/GL_Journals_CleanStagingTable/ShortName')"/>
                                                                        <to variable="ConcurrentProgram_In"
                                                                            part="InputParameters"
                                                                            query="/ns20:InputParameters/ns20:P_CONC_SHORT_NAME"/>
                                                                </copy>
                                                                <copy>
                                                                        <from expression="concat('', bpws:getVariableData('Oagis','PostJournalEntry','/ns7:PostJournalEntry/ns7:DataArea/ns7:JournalEntry/ns7:JournalEntryHeader/ns7:GLEntityID'))"/>
                                                                        <to variable="ConcurrentProgram_In"
                                                                            part="InputParameters"
                                                                            query="/ns20:InputParameters/ns20:P_ARGUMENT1"/>
                                                                </copy>
                                                                <copy>
                                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/GLConcurrentPrograms/GL_Journals_CleanStagingTable/Parameter2')"/>
                                                                        <to variable="ConcurrentProgram_In"
                                                                            part="InputParameters"
                                                                            query="/ns20:InputParameters/ns20:P_ARGUMENT2"/>
                                                                </copy>
                                                                <copy>
                                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/GLConcurrentPrograms/GL_Journals_CleanStagingTable/Parameter3')"/>
                                                                        <to variable="ConcurrentProgram_In"
                                                                            part="InputParameters"
                                                                            query="/ns20:InputParameters/ns20:P_ARGUMENT3"/>
                                                                </copy>
                                                                <copy>
                                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/GLConcurrentPrograms/GL_Journals_CleanStagingTable/Parameter4')"/>
                                                                        <to variable="ConcurrentProgram_In"
                                                                            part="InputParameters"
                                                                            query="/ns20:InputParameters/ns20:P_ARGUMENT4"/>
                                                                </copy>
                                                        </assign>
                                                        <scope name="Scope_1">
                                                                <faultHandlers>
                                                                        <catchAll>
                                                                                <sequence name="Sequence_40">
                                                                                        <assign name="InitializeConcurrentProgramError">
                                                                                                <copy>
                                                                                                        <from expression="concat(bpws:getVariableData('ErrorMessageText'), ' Error caught while invoking the Concurrent Program. ', ora:getFaultAsString())"/>
                                                                                                        <to variable="ErrorMessageText"/>
                                                                                                </copy>
                                                                                        </assign>
                                                                                </sequence>
                                                                        </catchAll>
                                                                </faultHandlers>
                                                                <invoke name="InvokeConcurrentProgram"
                                                                        partnerLink="InvokeConcurrentProgram"
                                                                        portType="ns21:InvokeConcurrentProgram_ptt"
                                                                        operation="InvokeConcurrentProgram"
                                                                        inputVariable="ConcurrentProgram_In"
                                                                        outputVariable="ConcurrentProgram_Out"/>
                                                        </scope>
                                                </sequence>
                                        </case>
                                        <otherwise>
                                                <bpelx:annotation>
                                                        <bpelx:pattern>OAGIS_EMPTY</bpelx:pattern>
                                                </bpelx:annotation>
                                                <assign name="EMPTY_OAGIS">
                                                        <copy>
                                                                <from expression="'OAGIS empty'"/>
                                                                <to variable="TestVariable"/>
                                                        </copy>
                                                </assign>
                                        </otherwise>
                                </switch>
                                <bpelx:exec name="ThreadInfo" language="java"
                                            version="1.5">
                                        <![CDATA[Thread t = Thread.currentThread();   
    StringBuffer sb = new StringBuffer();   
    sb.append(getVariableData("ErrorMessageText"));  
    sb.append(". Thread Group Name: " + t.getThreadGroup().getName() + " Thread Name: " + t.getName() + ".");  
    addAuditTrailEntry(sb.toString());        
    setVariableData("ErrorMessageText", sb.toString());]]>
                                </bpelx:exec>
                                <assign name="asnCatchAll">
                                        <copy>
                                                <from expression="ora:getProcessId()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ProcessInfo/ns16:BusinessProcessName"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getInstanceId()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ProcessInfo/ns16:BusinessProcessId"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getDomainId()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ProcessInfo/ns16:BusinessProcessDomain"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getProcessURL()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ProcessInfo/ns16:SystemName"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getCurrentDateTime()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ErrorDetails/ns16:ErrorDateTime"/>
                                        </copy>
                                        <copy>
                                                <from expression="'Catch All on the Main Sequence'"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ProcessInfo/ns16:BusinessProcessStep"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getFaultName()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ErrorDetails/ns16:ErrorCode"/>
                                        </copy>
                                        <copy>
                                                <from variable="ErrorMessageText"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ErrorDetails/ns16:ErrorDescription"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getFaultAsString()"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ErrorDetails/ns16:ErrorText"/>
                                        </copy>
                                        <copy>
                                                <from expression="'system'"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ErrorDetails/ns16:ErrorType"/>
                                        </copy>
                                        <copy>
                                                <from expression="'fatal'"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:ErrorDetails/ns16:ErrorSeverity"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/FaultNotification/SendNotification')"/>
                                                <to variable="invkCatchAll_initiate"
                                                    part="payload"
                                                    query="/ns16:ErrorData/ns16:Notification/ns16:sendNotification"/>
                                        </copy>
                                </assign>
                                <invoke name="invkCatchAll"
                                        partnerLink="ODErrorLogger"
                                        portType="ns15:ODErrorLogger"
                                        operation="initiate"
                                        inputVariable="invkCatchAll_initiate"/>
                                <scope name="LogTransactionError">
                                        <sequence name="SeqTransLog">
                                                <assign name="copyTransactionData">
                                                        <copy>
                                                                <from expression="'Error'"/>
                                                                <to variable="logTransactionInput"
                                                                    part="payload"
                                                                    query="/ns25:TransactionData/ns25:ProcessInfo/ns25:ProcessStatus"/>
                                                        </copy>
                                                </assign>
                                                <invoke name="logTransaction"
                                                        partnerLink="ODTransactionLogger"
                                                        portType="ns24:ODTransactionLogger"
                                                        operation="initiate"
                                                        inputVariable="logTransactionInput"/>
                                        </sequence>
                                </scope>
                                <terminate name="TerminateProcess"/>
                        </sequence>
                </catchAll>
        </faultHandlers>
        <sequence name="main">
                <!-- Receive input from requestor. (Note: This maps to operation defined in PostJournalEntry.wsdl) -->
                <receive name="receiveInput" partnerLink="client"
                         portType="client:PostJournalEntry" operation="initiate"
                         variable="InputFileHeader" createInstance="yes"/>
                <scope name="ProcessTitle">
                        <sequence name="SeqProcessTitle">
                                <assign name="InitializeInstanceTitle">
                                        <copy>
                                                <from expression="substring(concat('PostJournalEntry - ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName')),1,50)"/>
                                                <to variable="ProcessHeader"/>
                                        </copy>
                                </assign>
                                <bpelx:exec name="SetProcessTitle"
                                            language="java" version="1.5">
                                        <![CDATA[try {                
  String title = (String)getVariableData("ProcessHeader");                
  setTitle(title);                
  addAuditTrailEntry(title) ;                
} catch (Exception ex) {                
  addAuditTrailEntry(ex.toString());                
  ex.printStackTrace();                
}]]>
                                </bpelx:exec>
                        </sequence>
                </scope>
                <assign name="initializeChunkReadHeaders">
                        <copy>
                                <from variable="InputFileHeader"
                                      query="/client:fileHeader/client:fileName"
                                      part="payload"/>
                                <to variable="FileName"/>
                        </copy>
                        <copy>
                                <from variable="FileName"/>
                                <to variable="SyncChunkReadInboundHeader"
                                    part="outboundHeader"
                                    query="/ns2:OutboundFileHeaderType/ns2:fileName"/>
                        </copy>
                        <copy>
                                <from expression="''"/>
                                <to variable="SyncChunkReadInboundHeader"
                                    part="outboundHeader"
                                    query="/ns2:OutboundFileHeaderType/ns2:lineNumber"/>
                        </copy>
                        <copy>
                                <from expression="''"/>
                                <to variable="SyncChunkReadInboundHeader"
                                    part="outboundHeader"
                                    query="/ns2:OutboundFileHeaderType/ns2:columnNumber"/>
                        </copy>
                        <copy>
                                <from expression="''"/>
                                <to variable="SyncChunkReadInboundHeader"
                                    part="outboundHeader"
                                    query="/ns2:OutboundFileHeaderType/ns2:recordNumber"/>
                        </copy>
                        <copy>
                                <from variable="FileName"/>
                                <to variable="OutputFileHeader"
                                    part="outboundHeader"
                                    query="/ns2:OutboundFileHeaderType/ns2:fileName"/>
                        </copy>
                        <copy>
                                <from expression="'GLFileName'"/>
                                <to variable="XSLT_Param"
                                    query="/ns4:parameters/ns4:item/ns4:name"/>
                        </copy>
                        <copy>
                                <from variable="FileName"/>
                                <to variable="XSLT_Param"
                                    query="/ns4:parameters/ns4:item/ns4:value"/>
                        </copy>
                        <copy>
                                <from expression="'false'"/>
                                <to variable="SyncChunkReadOutboundHeader"
                                    part="outboundHeader"
                                    query="/ns2:OutboundFileHeaderType/ns2:isEOF"/>
                        </copy>
                        <copy>
                                <from variable="InputFileHeader" part="payload"
                                      query="/client:fileHeader/client:directory"/>
                                <to variable="SyncChunkReadInboundHeader"
                                    part="outboundHeader"
                                    query="/ns2:OutboundFileHeaderType/ns2:directory"/>
                        </copy>
                        <copy>
                                <from variable="FileName"/>
                                <to variable="TMP_File_Name"/>
                        </copy>
                </assign>
                <scope name="GetFileInfo">
                        <sequence name="SeqFileInfo">
                                <assign name="AssignFileName">
                                        <copy>
                                                <from expression="concat(bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:directory'),'/',bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'))"/>
                                                <to variable="InvokeGetFileInfoIn"
                                                    part="payload"
                                                    query="/ns29:GetFileInfoProcessRequest/ns29:fileName"/>
                                        </copy>
                                </assign>
                                <invoke name="InvokeGetFileInfo"
                                        partnerLink="GetFileInfo"
                                        portType="ns29:GetFileInfo"
                                        operation="process"
                                        inputVariable="InvokeGetFileInfoIn"
                                        outputVariable="InvokeGetFileInfoOut"/>
                                <switch name="CheckNoData">
                                        <case condition="bpws:getVariableData('InvokeGetFileInfoOut','payload','/ns29:GetFileInfoProcessResponse/ns29:longestLineLength') = 0">
                                                <assign name="AssignNoDataFound">
                                                        <copy>
                                                                <from expression="'true'"/>
                                                                <to variable="isNoDataFound"/>
                                                        </copy>
                                                </assign>
                                        </case>
                                        <otherwise>
                                                <assign name="AssignDataFound">
                                                        <copy>
                                                                <from expression="'false'"/>
                                                                <to variable="isNoDataFound"/>
                                                        </copy>
                                                </assign>
                                        </otherwise>
                                </switch>
                        </sequence>
                </scope>
                <assign name="AssignGLFileName">
                        <copy>
                                <from expression="'GLFileName'"/>
                                <to variable="XSLT_Param"
                                    query="/ns4:parameters/ns4:item/ns4:name"/>
                        </copy>
                        <copy>
                                <from variable="FileName"/>
                                <to variable="XSLT_Param"
                                    query="/ns4:parameters/ns4:item/ns4:value"/>
                        </copy>
                </assign>
                <assign name="TransformParameters">
                        <bpelx:annotation>
                                <bpelx:pattern>transformation</bpelx:pattern>
                        </bpelx:annotation>
                        <copy>
                                <from expression="ora:processXSLT('TransformationParameters.xsl',bpws:getVariableData('XSLT_Param'),bpws:getVariableData('XSLT_Param'))"/>
                                <to variable="XSLT_Param"/>
                        </copy>
                </assign>
                <assign name="AssignBatchId">
                        <copy>
                                <from expression="bpws:getVariableData('XSLT_Param','/ns4:parameters/ns4:item[2]/ns4:value')"/>
                                <to variable="BatchIdVar"/>
                        </copy>
                </assign>
                <bpelx:exec name="SwitchFileName" language="java" version="1.5">
                        <![CDATA[String fileName = (String)getVariableData("TMP_File_Name");           
String espName = (String)getVariableData("ESP_File_Name");        
String PSFileName = (String)getVariableData("PS_File_Name");      
      
if (fileName.startsWith("GL_Journals_NA_PS_PAY_US")){                                       
    espName = "GL_Journals_NA_PS_PAY_US";      
    PSFileName = "PeopleSoft";           
}if (fileName.startsWith("GL_Journals_NA_PS_PAY_CA")){                                       
     espName = "GL_Journals_NA_PS_PAY_CA";    
     PSFileName = "PeopleSoft";      
}if (fileName.startsWith("GL_Journals_NA_PS_VAC_US")){                                       
     espName = "GL_Journals_NA_PS_VAC_US";     
     PSFileName = "PeopleSoft";           
}if (fileName.startsWith("GL_Journals_NA_PS_VAC_CA")){                                       
     espName = "GL_Journals_NA_PS_VAC_CA";      
     PSFileName = "PeopleSoft";           
}if (fileName.startsWith("GL_Journals_NA_PS_Headcount_US")){                                       
     espName = "GL_Journals_NA_PS_Headcount_US";      
     PSFileName = "PeopleSoft";           
}if (fileName.startsWith("GL_Journals_NA_PS_Headcount_CA")){                                       
     espName = "GL_Journals_NA_PS_Headcount_CA";      
     PSFileName = "PeopleSoft";           
}if (fileName.startsWith("GL_Journals_NA_GSS")){                                       
     espName = "GL_Journals_NA_GSS";           
}if (fileName.startsWith("GL_Journals_NA_GLSI_Receiver")){                                       
     espName = "GL_Journals_NA_GLSI_Receiver";           
}if (fileName.startsWith("GL_Journals_NA_GLSI_INV")){                                       
     espName = "GL_Journals_NA_GLSI_INV";           
}if (fileName.startsWith("GL_Journals_NA_GDW_SA_US")){                                       
     espName = "GL_Journals_NA_GDW_SA_US";      
     PSFileName = "GDW";           
}if (fileName.startsWith("GL_Journals_NA_GDW_SA_CA")){                                       
     espName = "GL_Journals_NA_GDW_SA_CA";      
     PSFileName = "GDW"; 
}if (fileName.startsWith("GL_Journals_NA_TMS")){                                       
     espName = "GL_Journals_NA_TMS";      
     PSFileName = "TMS";       
}              
setVariableData("TMP_File_Name", fileName);           
setVariableData("ESP_File_Name", espName);      
setVariableData("PS_File_Name", PSFileName);]]>
                </bpelx:exec>
                <scope name="LogTransactionStart">
                        <sequence name="SeqTransLog">
                                <assign name="copyTransactionData">
                                        <copy>
                                                <from expression="ora:getDomainId()"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:ProcessInfo/ns25:Domain"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getProcessId()"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:ProcessInfo/ns25:ProcessName"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getInstanceId()"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:ProcessInfo/ns25:InstanceId"/>
                                        </copy>
                                        <copy>
                                                <from expression="'Start'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:ProcessInfo/ns25:ProcessStatus"/>
                                        </copy>
                                        <copy>
                                                <from expression="'GL File Read'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:MessageDetails/ns25:MessageOperation"/>
                                        </copy>
                                        <copy>
                                                <from expression="'Legacy GL Files'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:MessageDetails/ns25:MessageSourceSystem"/>
                                        </copy>
                                        <copy>
                                                <from expression="'Payload'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:MessageDetails/ns25:MessageType"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getCurrentDateTime()"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:MessageDetails/ns25:MessageDateTime"/>
                                        </copy>
                                        <copy>
                                                <from variable="InputFileHeader"
                                                      part="payload"
                                                      query="/client:fileHeader/client:fileName"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:EntiltyList/ns25:EntityID"/>
                                        </copy>
                                        <copy>
                                                <from expression="concat('&lt;EntityList xmlns=&quot;http://xmlns.oracle.com/TransactionData&quot;>&lt;EntityID EntityType=&quot;SourceFileName&quot;>',bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'),'&lt;/EntityID>&lt;EntityID EntityType=&quot;BatchID&quot;>',bpws:getVariableData('BatchIdVar'),'&lt;/EntityID>&lt;/EntityList>')"/>
                                                <to variable="xmlFragment"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:parseEscapedXML(bpws:getVariableData('xmlFragment'))"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:EntiltyList"/>
                                        </copy>
                                        <copy>
                                                <from expression="'Legacy Systems GL'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:ProcessInfo/ns25:TradingPartnerDetails/ns25:TPFrom"/>
                                        </copy>
                                        <copy>
                                                <from expression="'EBS'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:ProcessInfo/ns25:TradingPartnerDetails/ns25:TPTo"/>
                                        </copy>
                                        <copy>
                                                <from expression="'I0985_EBS_GL_Journal_Import'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:ProcessInfo/ns25:SystemName"/>
                                        </copy>
                                </assign>
                                <invoke name="logTransaction"
                                        partnerLink="ODTransactionLogger"
                                        portType="ns24:ODTransactionLogger"
                                        operation="initiate"
                                        inputVariable="logTransactionInput"/>
                        </sequence>
                </scope>
                <while name="While_1"
                       condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:isEOF') != 'true'">
                        <sequence name="Sequence_1">
                                <switch name="Switch_4">
                                        <case condition="bpws:getVariableData('PS_File_Name') ='TMS'">
                                                <bpelx:annotation>
                                                        <bpelx:pattern>TMS</bpelx:pattern>
                                                </bpelx:annotation>
                                                <sequence name="Sequence_58">
                                                        <assign name="AssignSourceSystem">
                                                                <copy>
                                                                        <from expression="'TMS'"/>
                                                                        <to variable="SourceSystem"/>
                                                                </copy>
                                                        </assign>
                                                        <invoke name="ReadTMSJournals"
                                                                partnerLink="ChunkReadTMSJournal"
                                                                portType="ns30:SynchChunkedRead_ptt"
                                                                operation="SynchChunkedRead"
                                                                inputVariable="ReadTMSJournals_SynchChunkedRead_InputVariable"
                                                                outputVariable="ReadTMSJournals_SynchChunkedRead_OutputVariable"
                                                                bpelx:outputHeaderVariable="SyncChunkReadOutboundHeader"
                                                                bpelx:inputHeaderVariable="SyncChunkReadInboundHeader"/>
                                                        <assign name="AssignChunkHeaderTMS">
                                                                <copy>
                                                                        <from variable="SyncChunkReadOutboundHeader"/>
                                                                        <to variable="SyncChunkReadInboundHeader"/>
                                                                </copy>
                                                        </assign>
                                                        <switch name="IsMessageRejected">
                                                                <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:isMessageRejected')!='true'">
                                                                        <bpelx:annotation>
                                                                                <bpelx:pattern>ValidMessage</bpelx:pattern>
                                                                        </bpelx:annotation>
                                                                        <sequence name="Sequence_60">
                                                                                <assign name="TransformTMSOAGIS">
                                                                                        <bpelx:annotation>
                                                                                                <bpelx:pattern>transformation</bpelx:pattern>
                                                                                        </bpelx:annotation>
                                                                                        <copy>
                                                                                                <from expression="ora:processXSLT('TransformationTMSFileOAGIS.xsl',bpws:getVariableData('ReadTMSJournals_SynchChunkedRead_OutputVariable','TMSJournalEntry'),bpws:getVariableData('XSLT_Param'))"/>                                                                                                
                                                                                                <to variable="Oagis"
                                                                                                    part="PostJournalEntry"/>
                                                                                        </copy>
                                                                                </assign>
                                                                                <assign name="AssignOAGISToDBSchema">
                                                                                        <copy>
                                                                                                <from variable="Oagis"
                                                                                                      part="PostJournalEntry"/>
                                                                                                <to variable="StgTableInsertRequest"
                                                                                                    part="payload"
                                                                                                    query="/ns7:PostJournalEntry"/>
                                                                                        </copy>
                                                                                </assign>
                                                                                <invoke name="InvokeTMSStgTableInsert"
                                                                                        partnerLink="PostGLSIStgTableInsert"
                                                                                        inputVariable="StgTableInsertRequest"
                                                                                        portType="ns10:PostGLSIStgTableInsert"
                                                                                        operation="initiate"/>
                                                                                <receive name="ReceiveGLSIResponse"
                                                                                         partnerLink="PostGLSIStgTableInsert"
                                                                                         variable="ReceiveGLSIResponseOut"
                                                                                         createInstance="no"
                                                                                         portType="ns10:PostGLSIStgTableInsertCallback"
                                                                                         operation="onResult"/>
                                                                                <switch name="CheckResponse">
                                                                                        <case condition="bpws:getVariableData('ReceiveGLSIResponseOut','payload','/ns10:PostGLSIStgTableInsertProcessResponse/ns10:result') = 'E'">
                                                                                                <bpelx:annotation>
                                                                                                        <bpelx:pattern>GLSIFailure</bpelx:pattern>
                                                                                                </bpelx:annotation>
                                                                                                <sequence name="GLSITMSFailure">
                                                                                                        <assign name="AssignGLSIFailure">
                                                                                                                <copy>
                                                                                                                        <from expression="'GLSI Insert Error'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="code"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="'There was an error in PostGLSIStgTableInsert process.'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="summary"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="'There was an error in PostGLSIStgTableInsert process.'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="detail"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                        <throw name="ThrowGLSIFailure"
                                                                                                               faultName="bpws:selectionFailure"
                                                                                                               faultVariable="Exception"/>
                                                                                                </sequence>
                                                                                        </case>
                                                                                        <otherwise>
                                                                                                <empty name="GLSISuccess"/>
                                                                                        </otherwise>
                                                                                </switch>
                                                                        </sequence>
                                                                </case>
                                                                <otherwise>
                                                                        <sequence name="Sequence_59">
                                                                                <switch name="Switch_11">
                                                                                        <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:NoDataFound')='true'">
                                                                                                <bpelx:annotation>
                                                                                                        <bpelx:pattern>TMSNoDataFound</bpelx:pattern>
                                                                                                </bpelx:annotation>
                                                                                                <sequence name="NoDataFoundTMS">
                                                                                                        <assign name="AssignGetEmailAddressTMS">
                                                                                                                <copy>
                                                                                                                        <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/PostJournalEntry/Interface[@name=&quot;GL_Journals_NA_TMS&quot;]/EmailAddress')"/>
                                                                                                                        <to variable="EmailAddress"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                        <scope name="ScopeEMailTMS">
                                                                                                                <scope name="Email_3">
                                                                                                                        <bpelx:annotation>
                                                                                                                                <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                                                                                        </bpelx:annotation>
                                                                                                                        <variables>
                                                                                                                                <variable name="varNotificationReq"
                                                                                                                                          messageType="ns27:EmailNotificationRequest"/>
                                                                                                                                <variable name="varNotificationResponse"
                                                                                                                                          messageType="ns27:ArrayOfResponse"/>
                                                                                                                                <variable name="NotificationServiceFaultVariable"
                                                                                                                                          messageType="ns27:NotificationServiceErrorMessage"/>
                                                                                                                        </variables>
                                                                                                                        <sequence name="Sequence_49">
                                                                                                                                <assign name="EmailParamsAssign">
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('SOAEmailNotify')"/>
                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                    part="EmailPayload"
                                                                                                                                                    query="/EmailPayload/ns27:FromAccountName"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                    part="EmailPayload"
                                                                                                                                                    query="/EmailPayload/ns27:Bcc"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                    part="EmailPayload"
                                                                                                                                                    query="/EmailPayload/ns27:Cc"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('')"/>
                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                    part="EmailPayload"
                                                                                                                                                    query="/EmailPayload/ns27:ReplyToAddress"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="concat('File ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'), ' received on ', xp20:current-dateTime(), ' has 0 Records')"/>
                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                    part="EmailPayload"
                                                                                                                                                    query="/EmailPayload/ns27:Subject"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                    part="EmailPayload"
                                                                                                                                                    query="/EmailPayload/ns27:To"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from>
                                                                                                                                                        <Content xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">multipart/mixed</MimeType>
                                                                                                                                                                <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                        <MultiPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                <BodyPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                        <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                        <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                        <BodyPartName xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                </BodyPart>
                                                                                                                                                                        </MultiPart>
                                                                                                                                                                </ContentBody>
                                                                                                                                                        </Content>
                                                                                                                                                </from>
                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                    part="EmailPayload"
                                                                                                                                                    query="/EmailPayload/ns27:Content"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                    part="EmailPayload"
                                                                                                                                                    query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:MimeType"/>
                                                                                                                                        </copy>
                                                                                                                                        <!--<copy>
                                                                                                                                                                        <from expression="string('NotificationAttachment1.html')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:BodyPartName"/>
                                                                                                                                                                </copy>-->
                                                                                                                                        <copy>
                                                                                                                                                <from expression="concat('File ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'), ' received on ', xp20:current-dateTime(), ' has 0 Records')"/>
                                                                                                                                                <to variable="varNotificationReq"
                                                                                                                                                    part="EmailPayload"
                                                                                                                                                    query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:ContentBody"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <invoke name="InvokeNotificationService"
                                                                                                                                        partnerLink="NotificationService"
                                                                                                                                        portType="ns27:NotificationService"
                                                                                                                                        operation="sendEmailNotification"
                                                                                                                                        inputVariable="varNotificationReq"
                                                                                                                                        outputVariable="varNotificationResponse"/>
                                                                                                                        </sequence>
                                                                                                                </scope>
                                                                                                        </scope>
                                                                                                </sequence>
                                                                                        </case>
                                                                                        <otherwise>
                                                                                                <sequence name="SequenceInvalidMessage_TMS">
                                                                                                        <assign name="InvalidMessageTMS">
                                                                                                                <copy>
                                                                                                                        <from expression="string('Invalid Message')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="summary"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="string('ReadChunkFile.InvalidMessage')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="code"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="string('Invalid Message. Please review the file for errors.')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="detail"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                        <throw name="ThrowInvalidMessageTMS"
                                                                                                               faultName="bpelx:bindingFault"
                                                                                                               faultVariable="Exception"/>
                                                                                                </sequence>
                                                                                        </otherwise>
                                                                                </switch>
                                                                        </sequence>
                                                                </otherwise>
                                                        </switch>
                                                </sequence>
                                        </case>
                                        <case condition="substring(bpws:getVariableData('FileName'),1,18) ='GL_Journals_NA_GSS'">
                                                <bpelx:annotation>
                                                        <bpelx:pattern>GSS</bpelx:pattern>
                                                </bpelx:annotation>
                                                <sequence name="Sequence_8">
                                                        <assign name="AssignSourceSystem">
                                                                <copy>
                                                                        <from expression="'GSS'"/>
                                                                        <to variable="SourceSystem"/>
                                                                </copy>
                                                        </assign>
                                                        <invoke name="ReadGSSJournals"
                                                                partnerLink="ChunkReadGSSJournal"
                                                                portType="ns14:SynchChunkedRead_ptt"
                                                                operation="SynchChunkedRead"
                                                                inputVariable="ReadGSSJournalsInput"
                                                                outputVariable="ReadGSSJournalsOutput"
                                                                bpelx:outputHeaderVariable="SyncChunkReadOutboundHeader"
                                                                bpelx:inputHeaderVariable="SyncChunkReadInboundHeader"/>
                                                        <assign name="AssignChunkHeaderGSS">
                                                                <copy>
                                                                        <from variable="SyncChunkReadOutboundHeader"/>
                                                                        <to variable="SyncChunkReadInboundHeader"/>
                                                                </copy>
                                                        </assign>
                                                        <switch name="IsMessageRejected">
                                                                <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:isMessageRejected')!='true'">
                                                                        <bpelx:annotation>
                                                                                <bpelx:pattern>ValidMessage</bpelx:pattern>
                                                                        </bpelx:annotation>
                                                                        <sequence name="Sequence_45">
                                                                                <assign name="TransformGSSOagis">
                                                                                        <bpelx:annotation>
                                                                                                <bpelx:pattern>transformation</bpelx:pattern>
                                                                                        </bpelx:annotation>
                                                                                        <copy>
                                                                                                <from expression="ora:processXSLT('TransformationGSSOagis.xsl',bpws:getVariableData('ReadGSSJournalsOutput','Root-Element'),bpws:getVariableData('XSLT_Param'))"/>
                                                                                                <to variable="Oagis"
                                                                                                    part="PostJournalEntry"/>
                                                                                        </copy>
                                                                                </assign>
                                                                                <assign name="AssignOAGISToDBSchema">
                                                                                        <copy>
                                                                                                <from variable="Oagis"
                                                                                                      part="PostJournalEntry"/>
                                                                                                <to variable="StgTableInsertRequest"
                                                                                                    part="payload"
                                                                                                    query="/ns7:PostJournalEntry"/>
                                                                                        </copy>
                                                                                </assign>
                                                                                <invoke name="InvokeGSSStgtableInsert"
                                                                                        partnerLink="PostGLSIStgTableInsert"
                                                                                        portType="ns10:PostGLSIStgTableInsert"
                                                                                        operation="initiate"
                                                                                        inputVariable="StgTableInsertRequest"/>
                                                                                <receive name="ReceiveGLSIResponse"
                                                                                         partnerLink="PostGLSIStgTableInsert"
                                                                                         portType="ns10:PostGLSIStgTableInsertCallback"
                                                                                         operation="onResult"
                                                                                         variable="ReceiveGLSIResponseOut"
                                                                                         createInstance="no"/>
                                                                                <switch name="CheckResponse">
                                                                                        <case condition="bpws:getVariableData('ReceiveGLSIResponseOut','payload','/ns10:PostGLSIStgTableInsertProcessResponse/ns10:result') = 'E'">
                                                                                                <sequence name="GLSIFailure">
                                                                                                        <assign name="AssignGLSIFailure">
                                                                                                                <copy>
                                                                                                                        <from expression="'GLSI Insert Error'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="code"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="'There was an error in PostGLSIStgTableInsert process.'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="summary"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="'There was an error in PostGLSIStgTableInsert process.'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="detail"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                        <throw name="ThrowGLSIFailure"
                                                                                                               faultName="bpws:selectionFailure"
                                                                                                               faultVariable="Exception"/>
                                                                                                </sequence>
                                                                                        </case>
                                                                                        <otherwise>
                                                                                                <empty name="GLSISuccess"/>
                                                                                        </otherwise>
                                                                                </switch>
                                                                        </sequence>
                                                                </case>
                                                                <otherwise>
                                                                        <bpelx:annotation>
                                                                                <bpelx:pattern>Invalid Message</bpelx:pattern>
                                                                        </bpelx:annotation>
                                                                        <sequence name="Sequence_10">
                                                                                <switch name="Switch_8_1">
                                                                                        <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:NoDataFound')='true'">
                                                                                                <sequence name="Sequence_50">
                                                                                                        <switch name="Switch_10">
                                                                                                                <case condition="bpws:getVariableData('isNoDataFound') = 'true'">
                                                                                                                        <sequence name="NoDataFoundGSS">
                                                                                                                                <assign name="AssignGetEmailAddressPS">
                                                                                                                                        <copy>
                                                                                                                                                <!--<from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/PostJournalEntry/Interface[@name=&quot;GL_Journals_NA_GLSI_Receiver&quot;]/EmailAddress')"/>-->
                                                                                                                                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/PostJournalEntry/Interface[@name=&quot;GL_Journals_NA_GSS&quot;]/EmailAddress')"/>
                                                                                                                                                <to variable="EmailAddress"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <scope name="ScopeEMailGSS">
                                                                                                                                        <scope name="Email_3">
                                                                                                                                                <bpelx:annotation>
                                                                                                                                                        <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                                                                                                                </bpelx:annotation>
                                                                                                                                                <variables>
                                                                                                                                                        <variable name="varNotificationReq"
                                                                                                                                                                  messageType="ns27:EmailNotificationRequest"/>
                                                                                                                                                        <variable name="varNotificationResponse"
                                                                                                                                                                  messageType="ns27:ArrayOfResponse"/>
                                                                                                                                                        <variable name="NotificationServiceFaultVariable"
                                                                                                                                                                  messageType="ns27:NotificationServiceErrorMessage"/>
                                                                                                                                                </variables>
                                                                                                                                                <sequence name="Sequence_49">
                                                                                                                                                        <assign name="EmailParamsAssign">
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('SOAEmailNotify')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:FromAccountName"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Bcc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Cc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:ReplyToAddress"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'), ' received on ', xp20:current-dateTime(), ' has 0 Records')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Subject"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:To"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from>
                                                                                                                                                                                <Content xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                        <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">multipart/mixed</MimeType>
                                                                                                                                                                                        <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                <MultiPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                        <BodyPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                                <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                                <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                                <BodyPartName xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                        </BodyPart>
                                                                                                                                                                                                </MultiPart>
                                                                                                                                                                                        </ContentBody>
                                                                                                                                                                                </Content>
                                                                                                                                                                        </from>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:MimeType"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <!--<copy>
                                                                                                                                                                        <from expression="string('NotificationAttachment1.html')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:BodyPartName"/>
                                                                                                                                                                </copy>-->
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'), ' received on ', xp20:current-dateTime(), ' has 0 Records')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:ContentBody"/>
                                                                                                                                                                </copy>
                                                                                                                                                        </assign>
                                                                                                                                                        <invoke name="InvokeNotificationService"
                                                                                                                                                                partnerLink="NotificationService"
                                                                                                                                                                portType="ns27:NotificationService"
                                                                                                                                                                operation="sendEmailNotification"
                                                                                                                                                                inputVariable="varNotificationReq"
                                                                                                                                                                outputVariable="varNotificationResponse"/>
                                                                                                                                                </sequence>
                                                                                                                                        </scope>
                                                                                                                                </scope>
                                                                                                                        </sequence>
                                                                                                                </case>
                                                                                                                <otherwise>
                                                                                                                        <sequence name="SeqInvalidMessage_1">
                                                                                                                                <assign name="InvalidMessage">
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('Invalid Message')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="summary"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('ReadChunkFile.InvalidMessage')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="code"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('Invalid Message. Please review the file for errors.')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="detail"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <throw name="ThrowInvalidMessage"
                                                                                                                                       faultName="bpelx:bindingFault"
                                                                                                                                       faultVariable="Exception"/>
                                                                                                                        </sequence>
                                                                                                                </otherwise>
                                                                                                        </switch>
                                                                                                </sequence>
                                                                                        </case>
                                                                                        <otherwise>
                                                                                                <sequence name="Sequence_48">
                                                                                                        <assign name="InvalidMessage">
                                                                                                                <copy>
                                                                                                                        <from expression="string('Invalid Message')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="summary"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="string('ReadChunkFile.InvalidMessage')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="code"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="string('Invalid Message. Please review the file for errors.')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="detail"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                        <throw name="ThrowInvalidMessage"
                                                                                                               faultName="bpelx:bindingFault"
                                                                                                               faultVariable="Exception"/>
                                                                                                </sequence>
                                                                                        </otherwise>
                                                                                </switch>
                                                                        </sequence>
                                                                </otherwise>
                                                        </switch>
                                                </sequence>
                                        </case>
                                        <case condition="bpws:getVariableData('PS_File_Name') ='PeopleSoft'">
                                                <bpelx:annotation>
                                                        <bpelx:pattern>PeopleSoft</bpelx:pattern>
                                                </bpelx:annotation>
                                                <sequence name="Sequence_7">
                                                        <assign name="AssignSourceSystem">
                                                                <copy>
                                                                        <from expression="'PeopleSoft'"/>
                                                                        <to variable="SourceSystem"/>
                                                                </copy>
                                                        </assign>
                                                        <invoke name="ReadPeopleSoftJournals"
                                                                partnerLink="ChunkReadPeopleSoftJournal"
                                                                portType="ns12:SynchChunkedRead_ptt"
                                                                operation="SynchChunkedRead"
                                                                inputVariable="Invoke_2_SynchChunkedRead_PS"
                                                                outputVariable="Invoke_2_SynchChunkedRead_Output_PS"
                                                                bpelx:outputHeaderVariable="SyncChunkReadOutboundHeader"
                                                                bpelx:inputHeaderVariable="SyncChunkReadInboundHeader"/>
                                                        <assign name="AssignChunkHeaderPS">
                                                                <copy>
                                                                        <from variable="SyncChunkReadOutboundHeader"/>
                                                                        <to variable="SyncChunkReadInboundHeader"/>
                                                                </copy>
                                                        </assign>
                                                        <switch name="IsMessageRejected">
                                                                <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:isMessageRejected')!='true'">
                                                                        <bpelx:annotation>
                                                                                <bpelx:pattern>ValidMessage</bpelx:pattern>
                                                                        </bpelx:annotation>
                                                                        <sequence name="Sequence_47">
                                                                                <assign name="TransformPSOAGIS">
                                                                                        <bpelx:annotation>
                                                                                                <bpelx:pattern>transformation</bpelx:pattern>
                                                                                        </bpelx:annotation>
                                                                                        <copy>
                                                                                                <from expression="ora:processXSLT('TransformationPSFileOAGIS.xsl',bpws:getVariableData('Invoke_2_SynchChunkedRead_Output_PS','PSJournalEntry'),bpws:getVariableData('XSLT_Param'))"/>
                                                                                                <to variable="Oagis"
                                                                                                    part="PostJournalEntry"/>
                                                                                        </copy>
                                                                                </assign>
                                                                                <assign name="AssignOAGISToDBSchema">
                                                                                        <copy>
                                                                                                <from variable="Oagis"
                                                                                                      part="PostJournalEntry"/>
                                                                                                <to variable="StgTableInsertRequest"
                                                                                                    part="payload"
                                                                                                    query="/ns7:PostJournalEntry"/>
                                                                                        </copy>
                                                                                </assign>
                                                                                <invoke name="InvokePSSTgTableInsert"
                                                                                        partnerLink="PostGLSIStgTableInsert"
                                                                                        portType="ns10:PostGLSIStgTableInsert"
                                                                                        operation="initiate"
                                                                                        inputVariable="StgTableInsertRequest"/>
                                                                                <receive name="ReceiveGLSIResponse"
                                                                                         partnerLink="PostGLSIStgTableInsert"
                                                                                         portType="ns10:PostGLSIStgTableInsertCallback"
                                                                                         operation="onResult"
                                                                                         variable="ReceiveGLSIResponseOut"
                                                                                         createInstance="no"/>
                                                                                <switch name="CheckResponse">
                                                                                        <case condition="bpws:getVariableData('ReceiveGLSIResponseOut','payload','/ns10:PostGLSIStgTableInsertProcessResponse/ns10:result') = 'E'">
                                                                                                <sequence name="GLSIFailure">
                                                                                                        <assign name="AssignGLSIFailure">
                                                                                                                <copy>
                                                                                                                        <from expression="'GLSI Insert Error'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="code"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="'There was an error in PostGLSIStgTableInsert process.'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="summary"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="'There was an error in PostGLSIStgTableInsert process.'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="detail"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                        <throw name="ThrowGLSIFailure"
                                                                                                               faultName="bpws:selectionFailure"
                                                                                                               faultVariable="Exception"/>
                                                                                                </sequence>
                                                                                        </case>
                                                                                        <otherwise>
                                                                                                <empty name="GLSISuccess"/>
                                                                                        </otherwise>
                                                                                </switch>
                                                                        </sequence>
                                                                </case>
                                                                <otherwise>
                                                                        <bpelx:annotation>
                                                                                <bpelx:pattern>Invalid Message</bpelx:pattern>
                                                                        </bpelx:annotation>
                                                                        <sequence name="Sequence_10">
                                                                                <switch name="Switch_8_2">
                                                                                        <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:NoDataFound')='true'">
                                                                                                <sequence name="Sequence_50">
                                                                                                        <switch name="Switch_10">
                                                                                                                <case condition="bpws:getVariableData('isNoDataFound') = 'true'">
                                                                                                                        <sequence name="NoDataFoundPS">
                                                                                                                                <bpelx:exec name="AssignPSSubgroup"
                                                                                                                                            language="java"
                                                                                                                                            version="1.5">
                                                                                                                                        <![CDATA[String fileName = (String)getVariableData("TMP_File_Name"); 
String subGroup = null; 
 
if (fileName.startsWith("GL_Journals_NA_PS_PAY")){                                       
    subGroup = "GL_Journals_NA_PS_PAY"; 
} 
if (fileName.startsWith("GL_Journals_NA_PS_VAC")){                                       
    subGroup = "GL_Journals_NA_PS_VAC"; 
} 
if (fileName.startsWith("GL_Journals_NA_PS_Headcount")){                                       
    subGroup = "GL_Journals_NA_PS_Headcount"; 
} 
setVariableData("PS_Subgroup", subGroup);]]>
                                                                                                                                </bpelx:exec>
                                                                                                                                <assign name="AssignGetEmailAddressPS">
                                                                                                                                        <copy>
                                                                                                                                                <!--<from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/PostJournalEntry/Interface[@name=&quot;GL_Journals_NA_GLSI_Receiver&quot;]/EmailAddress')"/>-->
                                                                                                                                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml',concat('/GlobalParameters/PostJournalEntry/Interface[@name=&quot;',bpws:getVariableData('PS_Subgroup'),'&quot;]/EmailAddress'))"/>
                                                                                                                                                <to variable="EmailAddress"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <scope name="ScopeEMailPS">
                                                                                                                                        <scope name="Email_3">
                                                                                                                                                <bpelx:annotation>
                                                                                                                                                        <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                                                                                                                </bpelx:annotation>
                                                                                                                                                <variables>
                                                                                                                                                        <variable name="varNotificationReq"
                                                                                                                                                                  messageType="ns27:EmailNotificationRequest"/>
                                                                                                                                                        <variable name="varNotificationResponse"
                                                                                                                                                                  messageType="ns27:ArrayOfResponse"/>
                                                                                                                                                        <variable name="NotificationServiceFaultVariable"
                                                                                                                                                                  messageType="ns27:NotificationServiceErrorMessage"/>
                                                                                                                                                </variables>
                                                                                                                                                <sequence name="Sequence_49">
                                                                                                                                                        <assign name="EmailParamsAssign">
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('SOAEmailNotify')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:FromAccountName"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Bcc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Cc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:ReplyToAddress"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'), ' received on ', xp20:current-dateTime(), ' has 0 Records')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Subject"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:To"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from>
                                                                                                                                                                                <Content xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                        <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">multipart/mixed</MimeType>
                                                                                                                                                                                        <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                <MultiPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                        <BodyPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                                <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                                <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                                <BodyPartName xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                        </BodyPart>
                                                                                                                                                                                                </MultiPart>
                                                                                                                                                                                        </ContentBody>
                                                                                                                                                                                </Content>
                                                                                                                                                                        </from>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:MimeType"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <!--<copy>
                                                                                                                                                                        <from expression="string('NotificationAttachment1.html')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:BodyPartName"/>
                                                                                                                                                                </copy>-->
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'), ' received on ', xp20:current-dateTime(), ' has 0 Records')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:ContentBody"/>
                                                                                                                                                                </copy>
                                                                                                                                                        </assign>
                                                                                                                                                        <invoke name="InvokeNotificationService"
                                                                                                                                                                partnerLink="NotificationService"
                                                                                                                                                                portType="ns27:NotificationService"
                                                                                                                                                                operation="sendEmailNotification"
                                                                                                                                                                inputVariable="varNotificationReq"
                                                                                                                                                                outputVariable="varNotificationResponse"/>
                                                                                                                                                </sequence>
                                                                                                                                        </scope>
                                                                                                                                </scope>
                                                                                                                        </sequence>
                                                                                                                </case>
                                                                                                                <otherwise>
                                                                                                                        <sequence name="SeqInvalidMessage_1">
                                                                                                                                <assign name="InvalidMessage">
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('Invalid Message')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="summary"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('ReadChunkFile.InvalidMessage')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="code"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('Invalid Message. Please review the file for errors.')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="detail"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <throw name="ThrowInvalidMessage"
                                                                                                                                       faultName="bpelx:bindingFault"
                                                                                                                                       faultVariable="Exception"/>
                                                                                                                        </sequence>
                                                                                                                </otherwise>
                                                                                                        </switch>
                                                                                                </sequence>
                                                                                        </case>
                                                                                        <otherwise>
                                                                                                <sequence name="Sequence_48">
                                                                                                        <assign name="InvalidMessage">
                                                                                                                <copy>
                                                                                                                        <from expression="string('Invalid Message')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="summary"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="string('ReadChunkFile.InvalidMessage')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="code"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="string('Invalid Message. Please review the file for errors.')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="detail"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                        <throw name="ThrowInvalidMessage"
                                                                                                               faultName="bpelx:bindingFault"
                                                                                                               faultVariable="Exception"/>
                                                                                                </sequence>
                                                                                        </otherwise>
                                                                                </switch>
                                                                        </sequence>
                                                                </otherwise>
                                                        </switch>
                                                </sequence>
                                        </case>
                                        <case condition="bpws:getVariableData('PS_File_Name') ='GDW'">
                                                <bpelx:annotation>
                                                        <bpelx:pattern>GDW</bpelx:pattern>
                                                </bpelx:annotation>
                                                <sequence name="Sequence_52">
                                                        <assign name="AssignSourceSystem">
                                                                <copy>
                                                                        <from expression="'GDW'"/>
                                                                        <to variable="SourceSystem"/>
                                                                </copy>
                                                        </assign>
                                                        <invoke name="ReadGDWJournals"
                                                                partnerLink="ChunkReadGDWJournal"
                                                                portType="ns28:SynchChunkedRead_ptt"
                                                                operation="SynchChunkedRead"
                                                                inputVariable="ReadGDWJournals_SynchRead_In"
                                                                outputVariable="ReadGDWJournals_SynchRead_Out"
                                                                bpelx:outputHeaderVariable="SyncChunkReadOutboundHeader"
                                                                bpelx:inputHeaderVariable="SyncChunkReadInboundHeader"/>
                                                        <assign name="AssignChunkHeaderGDW">
                                                                <copy>
                                                                        <from variable="SyncChunkReadOutboundHeader"/>
                                                                        <to variable="SyncChunkReadInboundHeader"/>
                                                                </copy>
                                                        </assign>
                                                        <switch name="IsMessageRejected">
                                                                <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:isMessageRejected')!='true'">
                                                                        <bpelx:annotation>
                                                                                <bpelx:pattern>ValidMessage</bpelx:pattern>
                                                                        </bpelx:annotation>
                                                                        <sequence name="Sequence_57">
                                                                                <assign name="TransformGDWOAGIS">
                                                                                        <bpelx:annotation>
                                                                                                <bpelx:pattern>transformation</bpelx:pattern>
                                                                                        </bpelx:annotation>
                                                                                        <copy>
                                                                                                <from expression="ora:processXSLT('Transformation_2.xsl',bpws:getVariableData('ReadGDWJournals_SynchRead_Out','GDWJournalEntry'),bpws:getVariableData('XSLT_Param'))"/>
                                                                                                <to variable="Oagis"
                                                                                                    part="PostJournalEntry"/>
                                                                                        </copy>
                                                                                </assign>
                                                                                <assign name="AssignOAGISToDBSchema">
                                                                                        <copy>
                                                                                                <from variable="Oagis"
                                                                                                      part="PostJournalEntry"/>
                                                                                                <to variable="StgTableInsertRequest"
                                                                                                    part="payload"
                                                                                                    query="/ns7:PostJournalEntry"/>
                                                                                        </copy>
                                                                                </assign>
                                                                                <invoke name="InvokeGDWStgTableInsert"
                                                                                        partnerLink="PostGLSIStgTableInsert"
                                                                                        portType="ns10:PostGLSIStgTableInsert"
                                                                                        operation="initiate"
                                                                                        inputVariable="StgTableInsertRequest"/>
                                                                                <receive name="ReceiveGLSIResponse"
                                                                                         partnerLink="PostGLSIStgTableInsert"
                                                                                         portType="ns10:PostGLSIStgTableInsertCallback"
                                                                                         operation="onResult"
                                                                                         variable="ReceiveGLSIResponseOut"
                                                                                         createInstance="no"/>
                                                                                <switch name="CheckResponse">
                                                                                        <case condition="bpws:getVariableData('ReceiveGLSIResponseOut','payload','/ns10:PostGLSIStgTableInsertProcessResponse/ns10:result') = 'E'">
                                                                                                <sequence name="GLSIFailure">
                                                                                                        <assign name="AssignGLSIFailure">
                                                                                                                <copy>
                                                                                                                        <from expression="'GLSI Insert Error'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="code"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="'There was an error in PostGLSIStgTableInsert process.'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="summary"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="'There was an error in PostGLSIStgTableInsert process.'"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="detail"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                        <throw name="ThrowGLSIFailure"
                                                                                                               faultName="bpws:selectionFailure"
                                                                                                               faultVariable="Exception"/>
                                                                                                </sequence>
                                                                                        </case>
                                                                                        <otherwise>
                                                                                                <empty name="GLSISuccess"/>
                                                                                        </otherwise>
                                                                                </switch>
                                                                        </sequence>
                                                                </case>
                                                                <otherwise>
                                                                        <bpelx:annotation>
                                                                                <bpelx:pattern>Invalid Message</bpelx:pattern>
                                                                        </bpelx:annotation>
                                                                        <sequence name="Sequence_53">
                                                                                <switch name="Switch_8_3">
                                                                                        <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:NoDataFound')='true'">
                                                                                                <sequence name="Sequence_50">
                                                                                                        <switch name="Switch_10">
                                                                                                                <case condition="bpws:getVariableData('isNoDataFound') = 'true'">
                                                                                                                        <sequence name="NoDataFoundGDW">
                                                                                                                                <assign name="AssignGetEmailAddressPS">
                                                                                                                                        <copy>
                                                                                                                                                <!--<from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/PostJournalEntry/Interface[@name=&quot;GL_Journals_NA_GLSI_Receiver&quot;]/EmailAddress')"/>-->
                                                                                                                                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml','/GlobalParameters/PostJournalEntry/Interface[@name=&quot;GL_Journals_NA_GDW_SA&quot;]/EmailAddress')"/>
                                                                                                                                                <to variable="EmailAddress"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <scope name="ScopeEMailGDW">
                                                                                                                                        <scope name="Email_3">
                                                                                                                                                <bpelx:annotation>
                                                                                                                                                        <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                                                                                                                </bpelx:annotation>
                                                                                                                                                <variables>
                                                                                                                                                        <variable name="varNotificationReq"
                                                                                                                                                                  messageType="ns27:EmailNotificationRequest"/>
                                                                                                                                                        <variable name="varNotificationResponse"
                                                                                                                                                                  messageType="ns27:ArrayOfResponse"/>
                                                                                                                                                        <variable name="NotificationServiceFaultVariable"
                                                                                                                                                                  messageType="ns27:NotificationServiceErrorMessage"/>
                                                                                                                                                </variables>
                                                                                                                                                <sequence name="Sequence_49">
                                                                                                                                                        <assign name="EmailParamsAssign">
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('SOAEmailNotify')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:FromAccountName"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Bcc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Cc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:ReplyToAddress"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'), ' received on ', xp20:current-dateTime(), ' has 0 Records')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Subject"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:To"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from>
                                                                                                                                                                                <Content xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                        <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">multipart/mixed</MimeType>
                                                                                                                                                                                        <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                <MultiPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                        <BodyPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                                <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                                <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                                <BodyPartName xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                        </BodyPart>
                                                                                                                                                                                                </MultiPart>
                                                                                                                                                                                        </ContentBody>
                                                                                                                                                                                </Content>
                                                                                                                                                                        </from>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:MimeType"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <!--<copy>
                                                                                                                                                                        <from expression="string('NotificationAttachment1.html')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:BodyPartName"/>
                                                                                                                                                                </copy>-->
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'), ' received on ', xp20:current-dateTime(), ' has 0 Records')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:ContentBody"/>
                                                                                                                                                                </copy>
                                                                                                                                                        </assign>
                                                                                                                                                        <invoke name="InvokeNotificationService"
                                                                                                                                                                partnerLink="NotificationService"
                                                                                                                                                                portType="ns27:NotificationService"
                                                                                                                                                                operation="sendEmailNotification"
                                                                                                                                                                inputVariable="varNotificationReq"
                                                                                                                                                                outputVariable="varNotificationResponse"/>
                                                                                                                                                </sequence>
                                                                                                                                        </scope>
                                                                                                                                </scope>
                                                                                                                        </sequence>
                                                                                                                </case>
                                                                                                                <otherwise>
                                                                                                                        <sequence name="SeqInvalidMessage_1">
                                                                                                                                <assign name="InvalidMessage">
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('Invalid Message')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="summary"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('ReadChunkFile.InvalidMessage')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="code"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('Invalid Message. Please review the file for errors.')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="detail"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <throw name="ThrowInvalidMessage"
                                                                                                                                       faultName="bpelx:bindingFault"
                                                                                                                                       faultVariable="Exception"/>
                                                                                                                        </sequence>
                                                                                                                </otherwise>
                                                                                                        </switch>
                                                                                                </sequence>
                                                                                        </case>
                                                                                        <otherwise>
                                                                                                <sequence name="Sequence_48">
                                                                                                        <assign name="InvalidMessage">
                                                                                                                <copy>
                                                                                                                        <from expression="string('Invalid Message')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="summary"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="string('ReadChunkFile.InvalidMessage')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="code"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="string('Invalid Message. Please review the file for errors.')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="detail"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                        <throw name="ThrowInvalidMessage"
                                                                                                               faultName="bpelx:bindingFault"
                                                                                                               faultVariable="Exception"/>
                                                                                                </sequence>
                                                                                        </otherwise>
                                                                                </switch>
                                                                        </sequence>
                                                                </otherwise>
                                                        </switch>
                                                </sequence>
                                        </case>
                                        <case condition="substring(bpws:getVariableData('FileName'),1,19) = 'GL_Journals_NA_GLSI'">
                                                <bpelx:annotation>
                                                        <bpelx:pattern>GLSI</bpelx:pattern>
                                                </bpelx:annotation>
                                                <sequence name="Sequence_6">
                                                        <assign name="AssignSourceSystem">
                                                                <copy>
                                                                        <from expression="'GLSI'"/>
                                                                        <to variable="SourceSystem"/>
                                                                </copy>
                                                        </assign>
                                                        <invoke name="ReadGLSIJournal"
                                                                partnerLink="ChunkReadGLSIJournal"
                                                                portType="ns3:SynchChunkedRead_ptt"
                                                                operation="SynchChunkedRead"
                                                                inputVariable="ReadGLSIJournalDataInput"
                                                                outputVariable="ReadGLSIJournalDataOutput"
                                                                bpelx:outputHeaderVariable="SyncChunkReadOutboundHeader"
                                                                bpelx:inputHeaderVariable="SyncChunkReadInboundHeader"/>
                                                        <assign name="AssignChunkHeaderGLSI">
                                                                <copy>
                                                                        <from variable="SyncChunkReadOutboundHeader"/>
                                                                        <to variable="SyncChunkReadInboundHeader"/>
                                                                </copy>
                                                        </assign>
                                                        <switch name="IsMessageRejected">
                                                                <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:isMessageRejected')!='true'">
                                                                        <bpelx:annotation>
                                                                                <bpelx:pattern>ValidMessage</bpelx:pattern>
                                                                        </bpelx:annotation>
                                                                        <sequence name="Sequence_4">
                                                                                <sequence name="Sequence_2">
                                                                                        <switch name="Switch_1">
                                                                                                <case condition="starts-with(local-name(ora:getNodes( 'ReadGLSIJournalDataOutput' ,'GLJournalInvoice',' /ns5:GLJournalInvoice/child::*[position()=1]')),'Detail')">
                                                                                                        <bpelx:annotation>
                                                                                                                <bpelx:pattern>is First Element Detail</bpelx:pattern>
                                                                                                        </bpelx:annotation>
                                                                                                        <sequence name="Sequence_3">
                                                                                                                <switch name="Switch_2">
                                                                                                                        <case condition="ora:countNodes('lastHeaderFound','/ns5:Header','/ns5:JournalID') > 0">
                                                                                                                                <bpelx:annotation>
                                                                                                                                        <bpelx:pattern>hasLastHeader</bpelx:pattern>
                                                                                                                                </bpelx:annotation>
                                                                                                                                <assign name="AppendBeforeHeaderToChunk">
                                                                                                                                        <bpelx:insertBefore>
                                                                                                                                                <bpelx:from variable="lastHeaderFound"
                                                                                                                                                            query="/ns5:Header"/>
                                                                                                                                                <bpelx:to variable="ReadGLSIJournalDataOutput"
                                                                                                                                                          part="GLJournalInvoice"
                                                                                                                                                          query="/ns5:GLJournalInvoice/ns5:Detail[1]"/>
                                                                                                                                        </bpelx:insertBefore>
                                                                                                                                </assign>
                                                                                                                        </case>
                                                                                                                        <otherwise>
                                                                                                                                <empty name="NoLastHeaderFound"/>
                                                                                                                        </otherwise>
                                                                                                                </switch>
                                                                                                        </sequence>
                                                                                                </case>
                                                                                                <otherwise>
                                                                                                        <bpelx:annotation>
                                                                                                                <bpelx:pattern>First Element Is Header</bpelx:pattern>
                                                                                                        </bpelx:annotation>
                                                                                                        <empty name="FirstElementIsHeader"/>
                                                                                                </otherwise>
                                                                                        </switch>
                                                                                        <switch name="Switch_3">
                                                                                                <case condition="ora:countNodes('ReadGLSIJournalDataOutput','GLJournalInvoice','/ns5:GLJournalInvoice/ns5:Header') > 0">
                                                                                                        <bpelx:annotation>
                                                                                                                <bpelx:pattern>hasHeadersInChunk</bpelx:pattern>
                                                                                                        </bpelx:annotation>
                                                                                                        <assign name="InitializeLastHeader">
                                                                                                                <copy>
                                                                                                                        <from expression="bpws:getVariableData('ReadGLSIJournalDataOutput','GLJournalInvoice','/ns5:GLJournalInvoice/ns5:Header[last()]') "/>
                                                                                                                        <to variable="lastHeaderFound"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                </case>
                                                                                                <otherwise>
                                                                                                        <empty name="Empty_3"/>
                                                                                                </otherwise>
                                                                                        </switch>
                                                                                        <switch name="Switch_5">
                                                                                                <case condition="starts-with(local-name(ora:getNodes( 'ReadGLSIJournalDataOutput' ,'GLJournalInvoice',' /ns5:GLJournalInvoice/child::*[position()=last()]')),'Header')">
                                                                                                        <bpelx:annotation>
                                                                                                                <bpelx:pattern>isLastElementHeader</bpelx:pattern>
                                                                                                        </bpelx:annotation>
                                                                                                        <assign name="RemoveLastElement">
                                                                                                                <bpelx:remove>
                                                                                                                        <bpelx:target variable="ReadGLSIJournalDataOutput"
                                                                                                                                      part="GLJournalInvoice"
                                                                                                                                      query="/ns5:GLJournalInvoice/child::*[position()=last()]"/>
                                                                                                                </bpelx:remove>
                                                                                                        </assign>
                                                                                                </case>
                                                                                                <otherwise>
                                                                                                        <empty name="Empty_4"/>
                                                                                                </otherwise>
                                                                                        </switch>
                                                                                        <assign name="TransformFileOAGIS">
                                                                                                <bpelx:annotation>
                                                                                                        <bpelx:pattern>transformation</bpelx:pattern>
                                                                                                </bpelx:annotation>
                                                                                                <copy>
                                                                                                        <from expression="ora:processXSLT('TransformationFileOAGIS.xsl',bpws:getVariableData('ReadGLSIJournalDataOutput','GLJournalInvoice'),bpws:getVariableData('XSLT_Param'))"/>
                                                                                                        <to variable="Oagis"
                                                                                                            part="PostJournalEntry"/>
                                                                                                </copy>
                                                                                        </assign>
                                                                                        <assign name="AssignOagisToDBSchema">
                                                                                                <copy>
                                                                                                        <from variable="Oagis"
                                                                                                              part="PostJournalEntry"/>
                                                                                                        <to variable="StgTableInsertRequest"
                                                                                                            part="payload"
                                                                                                            query="/ns7:PostJournalEntry"/>
                                                                                                </copy>
                                                                                        </assign>
                                                                                        <invoke name="InvokeGLSISTgTableInsert"
                                                                                                partnerLink="PostGLSIStgTableInsert"
                                                                                                portType="ns10:PostGLSIStgTableInsert"
                                                                                                operation="initiate"
                                                                                                inputVariable="StgTableInsertRequest"/>
                                                                                        <receive name="ReceiveGLSIResponse"
                                                                                                 partnerLink="PostGLSIStgTableInsert"
                                                                                                 portType="ns10:PostGLSIStgTableInsertCallback"
                                                                                                 operation="onResult"
                                                                                                 variable="ReceiveGLSIResponseOut"
                                                                                                 createInstance="no"/>
                                                                                        <switch name="CheckResponse">
                                                                                                <case condition="bpws:getVariableData('ReceiveGLSIResponseOut','payload','/ns10:PostGLSIStgTableInsertProcessResponse/ns10:result') = 'E'">
                                                                                                        <sequence name="GLSIFailure">
                                                                                                                <assign name="AssignGLSIFailure">
                                                                                                                        <copy>
                                                                                                                                <from expression="'GLSI Insert Error'"/>
                                                                                                                                <to variable="Exception"
                                                                                                                                    part="code"/>
                                                                                                                        </copy>
                                                                                                                        <copy>
                                                                                                                                <from expression="'There was an error in PostGLSIStgTableInsert process.'"/>
                                                                                                                                <to variable="Exception"
                                                                                                                                    part="summary"/>
                                                                                                                        </copy>
                                                                                                                        <copy>
                                                                                                                                <from expression="'There was an error in PostGLSIStgTableInsert process.'"/>
                                                                                                                                <to variable="Exception"
                                                                                                                                    part="detail"/>
                                                                                                                        </copy>
                                                                                                                </assign>
                                                                                                                <throw name="ThrowGLSIFailure"
                                                                                                                       faultName="bpws:selectionFailure"
                                                                                                                       faultVariable="Exception"/>
                                                                                                        </sequence>
                                                                                                </case>
                                                                                                <otherwise>
                                                                                                        <empty name="GLSISuccess"/>
                                                                                                </otherwise>
                                                                                        </switch>
                                                                                </sequence>
                                                                        </sequence>
                                                                </case>
                                                                <otherwise>
                                                                        <bpelx:annotation>
                                                                                <bpelx:pattern>Invalid Message</bpelx:pattern>
                                                                        </bpelx:annotation>
                                                                        <sequence name="Sequence_10">
                                                                                <switch name="Switch_8_4">
                                                                                        <case condition="bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:NoDataFound')='true'">
                                                                                                <sequence name="Sequence_50">
                                                                                                        <switch name="Switch_10">
                                                                                                                <case condition="bpws:getVariableData('isNoDataFound') = 'true'">
                                                                                                                        <sequence name="NoDataFoundGLSI">
                                                                                                                                <bpelx:exec name="AssignGLSISubgroup"
                                                                                                                                            language="java"
                                                                                                                                            version="1.5">
                                                                                                                                        <![CDATA[String fileName = (String)getVariableData("TMP_File_Name"); 
String subGroup = null; 
 
if (fileName.startsWith("GL_Journals_NA_GLSI_Receiver")){                                       
    subGroup = "GL_Journals_NA_GLSI_Receiver"; 
} 
if (fileName.startsWith("GL_Journals_NA_GLSI_INV")){                                       
    subGroup = "GL_Journals_NA_GLSI_INV"; 
} 
setVariableData("GLSI_Subgroup", subGroup);]]>
                                                                                                                                </bpelx:exec>
                                                                                                                                <assign name="AssignGetEmailAddressPS">
                                                                                                                                        <copy>
                                                                                                                                                <from expression="ora:doc('${server_url}/xmllib/fin/GlobalParameters.xml',concat('/GlobalParameters/PostJournalEntry/Interface[@name=&quot;',bpws:getVariableData('GLSI_Subgroup'),'&quot;]/EmailAddress'))"/>
                                                                                                                                                <to variable="EmailAddress"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <scope name="ScopeEMailGLSI">
                                                                                                                                        <scope name="Email_3">
                                                                                                                                                <bpelx:annotation>
                                                                                                                                                        <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                                                                                                                </bpelx:annotation>
                                                                                                                                                <variables>
                                                                                                                                                        <variable name="varNotificationReq"
                                                                                                                                                                  messageType="ns27:EmailNotificationRequest"/>
                                                                                                                                                        <variable name="varNotificationResponse"
                                                                                                                                                                  messageType="ns27:ArrayOfResponse"/>
                                                                                                                                                        <variable name="NotificationServiceFaultVariable"
                                                                                                                                                                  messageType="ns27:NotificationServiceErrorMessage"/>
                                                                                                                                                </variables>
                                                                                                                                                <sequence name="Sequence_49">
                                                                                                                                                        <assign name="EmailParamsAssign">
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('SOAEmailNotify')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:FromAccountName"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Bcc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Cc"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:ReplyToAddress"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'), ' received on ', xp20:current-dateTime(), ' has 0 Records')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Subject"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="bpws:getVariableData('EmailAddress')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:To"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from>
                                                                                                                                                                                <Content xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                        <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">multipart/mixed</MimeType>
                                                                                                                                                                                        <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                <MultiPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                        <BodyPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                                                                                                                                <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                                <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                                <BodyPartName xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                                                                                                                        </BodyPart>
                                                                                                                                                                                                </MultiPart>
                                                                                                                                                                                        </ContentBody>
                                                                                                                                                                                </Content>
                                                                                                                                                                        </from>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="string('text/html; charset=UTF-8')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:MimeType"/>
                                                                                                                                                                </copy>
                                                                                                                                                                <!--<copy>
                                                                                                                                                                        <from expression="string('NotificationAttachment1.html')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:BodyPartName"/>
                                                                                                                                                                </copy>-->
                                                                                                                                                                <copy>
                                                                                                                                                                        <from expression="concat('File ', bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'), ' received on ', xp20:current-dateTime(), ' has 0 Records')"/>
                                                                                                                                                                        <to variable="varNotificationReq"
                                                                                                                                                                            part="EmailPayload"
                                                                                                                                                                            query="/EmailPayload/ns27:Content/ns27:ContentBody/ns27:MultiPart/ns27:BodyPart[1]/ns27:ContentBody"/>
                                                                                                                                                                </copy>
                                                                                                                                                        </assign>
                                                                                                                                                        <invoke name="InvokeNotificationService"
                                                                                                                                                                partnerLink="NotificationService"
                                                                                                                                                                portType="ns27:NotificationService"
                                                                                                                                                                operation="sendEmailNotification"
                                                                                                                                                                inputVariable="varNotificationReq"
                                                                                                                                                                outputVariable="varNotificationResponse"/>
                                                                                                                                                </sequence>
                                                                                                                                        </scope>
                                                                                                                                </scope>
                                                                                                                        </sequence>
                                                                                                                </case>
                                                                                                                <otherwise>
                                                                                                                        <sequence name="SeqInvalidMessage_1">
                                                                                                                                <assign name="InvalidMessage">
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('Invalid Message')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="summary"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('ReadChunkFile.InvalidMessage')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="code"/>
                                                                                                                                        </copy>
                                                                                                                                        <copy>
                                                                                                                                                <from expression="string('Invalid Message. Please review the file for errors.')"/>
                                                                                                                                                <to variable="Exception"
                                                                                                                                                    part="detail"/>
                                                                                                                                        </copy>
                                                                                                                                </assign>
                                                                                                                                <throw name="ThrowInvalidMessage"
                                                                                                                                       faultName="bpelx:bindingFault"
                                                                                                                                       faultVariable="Exception"/>
                                                                                                                        </sequence>
                                                                                                                </otherwise>
                                                                                                        </switch>
                                                                                                </sequence>
                                                                                        </case>
                                                                                        <otherwise>
                                                                                                <sequence name="Sequence_48">
                                                                                                        <assign name="InvalidMessage">
                                                                                                                <copy>
                                                                                                                        <from expression="string('Invalid Message')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="summary"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="string('ReadChunkFile.InvalidMessage')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="code"/>
                                                                                                                </copy>
                                                                                                                <copy>
                                                                                                                        <from expression="string('Invalid Message. Please review the file for errors.')"/>
                                                                                                                        <to variable="Exception"
                                                                                                                            part="detail"/>
                                                                                                                </copy>
                                                                                                        </assign>
                                                                                                        <throw name="ThrowInvalidMessage"
                                                                                                               faultName="bpelx:bindingFault"
                                                                                                               faultVariable="Exception"/>
                                                                                                </sequence>
                                                                                        </otherwise>
                                                                                </switch>
                                                                        </sequence>
                                                                </otherwise>
                                                        </switch>
                                                </sequence>
                                        </case>
                                </switch>
                        </sequence>
                </while>
                <assign name="AssignGLFileName">
                        <copy>
                                <from expression="string-length(bpws:getVariableData('FileName'))"/>
                                <to variable="FileNameLength"/>
                        </copy>
                        <copy>
                                <from expression="substring(bpws:getVariableData('FileName'),1,bpws:getVariableData('FileNameLength')-20)"/>
                                <to variable="FileNameWithoutTimeStamp"/>
                        </copy>
                </assign>
                <assign name="AssignoutVar">
                        <copy>
                                <from variable="InputFileHeader" part="payload"
                                      query="/client:fileHeader/client:directory"/>
                                <to variable="OutPut_Var"
                                    query="/ns2:OutboundFileHeaderType/ns2:sourceDirectory"/>
                        </copy>
                        <copy>
                                <from variable="InputFileHeader" part="payload"
                                      query="/client:fileHeader/client:fileName"/>
                                <to variable="OutPut_Var"
                                    query="/ns2:OutboundFileHeaderType/ns2:sourceFileName"/>
                        </copy>
                        <copy>
                                <from variable="InputFileHeader" part="payload"
                                      query="/client:fileHeader/client:directory"/>
                                <to variable="OutPut_Var"
                                    query="/ns2:OutboundFileHeaderType/ns2:targetDirectory"/>
                        </copy>
                        <copy>
                                <from variable="InputFileHeader" part="payload"
                                      query="/client:fileHeader/client:fileName"/>
                                <to variable="OutPut_Var"
                                    query="/ns2:OutboundFileHeaderType/ns2:targetFileName"/>
                        </copy>
                </assign>
                <invoke name="InvokeFiledelete" partnerLink="FileDelete"
                        portType="ns23:Write_ptt" operation="Write"
                        inputVariable="InvokeFiledelete"
                        bpelx:inputHeaderVariable="OutPut_Var"/>
                <scope name="LogTransactionEnd">
                        <sequence name="SeqTransLog">
                                <assign name="copyTransactionData">
                                        <copy>
                                                <from expression="'Success'"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:ProcessInfo/ns25:ProcessStatus"/>
                                        </copy>
                                        <copy>
                                                <from expression="'FileSize'"/>
                                                <to variable="XSLT_Param1"
                                                    query="/ns4:parameters/ns4:item/ns4:name"/>
                                        </copy>
                                        <copy>
                                                <from variable="SyncChunkReadOutboundHeader"
                                                      part="outboundHeader"
                                                      query="/ns2:OutboundFileHeaderType/ns2:lineNumber"/>
                                                <to variable="XSLT_Param1"
                                                    query="/ns4:parameters/ns4:item/ns4:value"/>
                                        </copy>
                                        <copy>
                                                <from expression="concat('&lt;EntityList xmlns=&quot;http://xmlns.oracle.com/TransactionData&quot;>&lt;EntityID EntityType=&quot;SourceFileName&quot;>',bpws:getVariableData('InputFileHeader','payload','/client:fileHeader/client:fileName'),'&lt;/EntityID>&lt;EntityID EntityType=&quot;BatchID&quot;>',bpws:getVariableData('BatchIdVar'),'&lt;/EntityID>&lt;EntityID EntityType=&quot;NumberOfRecords&quot;>',(bpws:getVariableData('SyncChunkReadOutboundHeader','outboundHeader','/ns2:OutboundFileHeaderType/ns2:lineNumber') - 1),'&lt;/EntityID>&lt;EntityID EntityType=&quot;ReleaseESPJob&quot;>YES&lt;/EntityID>&lt;EntityID EntityType=&quot;SourceSystem&quot;>',bpws:getVariableData('SourceSystem'),'&lt;/EntityID>&lt;/EntityList>')"/>
                                                <to variable="xmlFragment"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:parseEscapedXML(bpws:getVariableData('xmlFragment'))"/>
                                                <to variable="logTransactionInput"
                                                    part="payload"
                                                    query="/ns25:TransactionData/ns25:EntiltyList"/>
                                        </copy>
                                </assign>
                                <invoke name="logTransaction"
                                        partnerLink="ODTransactionLogger"
                                        portType="ns24:ODTransactionLogger"
                                        operation="initiate"
                                        inputVariable="logTransactionInput"/>
                        </sequence>
                </scope>
                <scope name="InvokeESP">
                        <sequence name="SeqInvokeESP">
                                <assign name="AssignESPVariables">
                                        <copy>
                                                <from expression="ora:getDomainId()"/>
                                                <to variable="InvokeServiceESPIn"
                                                    part="payload"
                                                    query="/ns26:BPELInvokeESPProcessRequest/ns26:processDomain"/>
                                        </copy>
                                        <copy>
                                                <from expression="ora:getProcessId()"/>
                                                <to variable="InvokeServiceESPIn"
                                                    part="payload"
                                                    query="/ns26:BPELInvokeESPProcessRequest/ns26:processName"/>
                                        </copy>
                                        <copy>
                                                <from variable="ESP_File_Name"/>
                                                <to variable="InvokeServiceESPIn"
                                                    part="payload"
                                                    query="/ns26:BPELInvokeESPProcessRequest/ns26:filePattern"/>
                                        </copy>
                                </assign>
                                <invoke name="InvokeServiceESP"
                                        partnerLink="BPELInvokeESP"
                                        portType="ns26:BPELInvokeESP"
                                        operation="initiate"
                                        inputVariable="InvokeServiceESPIn"/>
                        </sequence>
                </scope>
        </sequence>
</process>
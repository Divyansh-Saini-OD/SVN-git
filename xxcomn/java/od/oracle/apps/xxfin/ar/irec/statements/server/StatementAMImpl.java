package od.oracle.apps.xxfin.ar.irec.statements.server;

/*===========================================================================+
 |      Copyright (c) 2001 Oracle Corporation, Redwood Shores, CA, USA       |
 |                         All rights reserved.                              |
 +===========================================================================+
 |  HISTORY                                                                  |
 | 1.1  17-FEB-2017   MBolli  Thread Leak 12.2.5 Upgrade - close all statements, resultsets |
 +===========================================================================*/
 
import java.sql.Blob;
import java.sql.CallableStatement;
import java.sql.ResultSet;

import od.oracle.apps.xxfin.ar.irec.statements.webui.StatementFile;

import oracle.apps.fnd.framework.server.OAApplicationModuleImpl;
import oracle.apps.fnd.framework.server.OADBTransaction;
import oracle.jdbc.OracleTypes;

//import java.sql.Types;

//  ---------------------------------------------------------------
//  ---    File generated by Oracle Business Components for Java.
//  ---------------------------------------------------------------

public class StatementAMImpl extends OAApplicationModuleImpl
{
  /**
   *
   * This is the default constructor (do not remove)
   */
  public StatementAMImpl()
  {
  }

  public StatementFile GetStatementFile(String sFileId)
  {
    OADBTransaction txn = getOADBTransaction();
    CallableStatement s = null;
    ResultSet rs = null;
    byte[] baFile = null;
    Blob aBlob = null;
    String sFileName = null;

    try
    {
      s = txn.createCallableStatement("BEGIN XX_AR_EBL_TRANSMISSION_PKG.GET_FILE_DATA_CURSOR(?,?); END;",1);

      s.setInt(1,Integer.parseInt(sFileId));
      s.registerOutParameter(2, OracleTypes.CURSOR); 
      s.execute();

      rs = (ResultSet) s.getObject(2);
      rs.next();

      try
      {
        // Get as a BLOB
        aBlob = rs.getBlob(2);
        baFile = aBlob.getBytes(1, (int) aBlob.length());
        sFileName = rs.getString(1);
      }
      catch(Exception ex)
      {
        // The driver could not handle this as a BLOB...
        // Fallback to default (and slower) byte[] handling
        baFile = rs.getBytes(2);
        sFileName = rs.getString(1);
      }
      rs.close();
      if (s != null) s.close();
    }
    catch(Exception ex)
    {
      try {
		  if (rs != null) rs.close();
		  if (s != null) s.close();			  
	  }
      catch(Exception ex2) {};
    }
    return (new StatementFile(sFileName, baFile));
  }

  /**
   *
   * Sample main for debugging Business Components code using the tester.
   */
  public static void main(String[] args)
  {
    launchTester("od.oracle.apps.xxfin.ar.irec.Files.server", "FileAMLocal");
  }
}
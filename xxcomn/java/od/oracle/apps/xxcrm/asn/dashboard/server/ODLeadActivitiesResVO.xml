<?xml version="1.0" encoding='windows-1252'?>
<!DOCTYPE ViewObject SYSTEM "jbo_03_01.dtd">

<ViewObject
   Name="ODLeadActivitiesResVO"
   Extends="oracle.apps.asn.dashboard.server.LeadActivitiesResVO"
   BindingStyle="Oracle"
   CustomQuery="true"
   RowClass="oracle.apps.asn.dashboard.server.LeadActivitiesResVORowImpl"
   ComponentClass="od.oracle.apps.xxcrm.asn.dashboard.server.ODLeadActivitiesResVOImpl"
   MsgBundleClass="oracle.jbo.common.JboResourceBundle"
   UseGlueCode="false" >
   <SQLQuery><![CDATA[
SELECT /*+ index(AS_SALES_LEADS_U1 asl */ aslrt.meaning as rank_name , 
      aslrt.rank_id,
      sum(case when asl.status_open_flag = 'Y'  AND ceil(sysdate-asl.creation_date)<= 2  THEN 1 else 0 END)  as day0_2,
      sum(case when asl.status_open_flag = 'Y'  AND  ceil((sysdate - asl.creation_date)) between 3 and 7 THEN 1 else 0 END) as day3_7,
      sum(case when asl.status_open_flag = 'Y'  AND  ceil((sysdate - asl.creation_date)) between 8 and 30 THEN 1 else 0 END) as day8_30,
      sum(case when asl.status_open_flag = 'Y'  AND  ceil((sysdate - asl.creation_date)) >= 31 THEN 1 else 0 END) as day_31,
      sum(case when nvl(asl.status_open_flag, 'N') = 'N' AND asl.status_code <> 'CONVERTED_TO_OPPORTUNITY' THEN 1 ELSE 0 END) as closed,
      sum(case when asl.status_code = 'CONVERTED_TO_OPPORTUNITY' THEN 1 ELSE 0 END) as converted,
      ROUND((sum(case when asl.status_code = 'CONVERTED_TO_OPPORTUNITY' THEN 1 ELSE 0 END)/count(asl.sales_lead_id)) * 100, 2)  as conversion,
      count(aslrt.rank_id) total_leads     
FROM  as_sales_leads asl,
      as_sales_lead_ranks_tl aslrt,
      as_sales_lead_ranks_b aslrb,
       (SELECT 
	   	 		/*+ no_merge */  DISTINCT    ENT.ENTITY_ID sales_lead_id,
				HZP.PARTY_ID customer_id
		FROM 
			   XX_TM_NAM_TERR_ENTITY_DTLS ENT,
			   XX_TM_NAM_TERR_RSC_DTLS TERR_RSC,
			   XX_TM_NAM_TERR_DEFN TERR,
			   HZ_PARTIES HZP,
			   AS_SALES_LEADS ASLA
		WHERE 
			   TERR.NAMED_ACCT_TERR_ID = ENT.NAMED_ACCT_TERR_ID AND
			   TERR.NAMED_ACCT_TERR_ID = TERR_RSC.NAMED_ACCT_TERR_ID AND
			   SYSDATE BETWEEN NVL(TERR.START_DATE_ACTIVE,SYSDATE-1) AND
			   NVL(TERR.END_DATE_ACTIVE,SYSDATE+1) AND
			   SYSDATE BETWEEN NVL(ENT.START_DATE_ACTIVE,SYSDATE-1) AND
			   NVL(ENT.END_DATE_ACTIVE,SYSDATE+1) AND
			   SYSDATE BETWEEN NVL(TERR_RSC.START_DATE_ACTIVE,SYSDATE-1) AND
			   NVL(TERR_RSC.END_DATE_ACTIVE,SYSDATE+1)    AND
			   ASLA.CUSTOMER_ID = HZP.PARTY_ID AND
			   ASLA.SALES_LEAD_ID = ENT.ENTITY_ID    AND
			   ENT.ENTITY_TYPE = 'LEAD'  		     AND
			   TERR_RSC.RESOURCE_ID = :1    AND
			   TERR_RSC.RESOURCE_ID+0 = :1    AND
			   CEIL(SYSDATE-ENT.creation_date) <= :3) secu       
WHERE  asl.lead_rank_id = aslrt.rank_id
AND     aslrb.rank_id = aslrt.rank_id
AND    aslrt.language = USERENV('LANG')
AND    secu.sales_lead_id = asl.sales_lead_id
AND    secu.customer_id = asl.customer_id
GROUP   BY  aslrt.rank_id, aslrt.meaning, aslrb.min_score
ORDER BY  aslrb.min_score DESC
   ]]></SQLQuery>
   <DesignTime>
      <Attr Name="_version" Value="9.0.3.13.93" />
      <Attr Name="_CodeGenFlagNew" Value="36" />
   </DesignTime>
   <ViewAttribute
      Name="RankName"
      IsUpdateable="false"
      IsQueriable="false"
      IsPersistent="false"
      IsNotNull="true"
      Precision="240"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="RANK_NAME"
      Expression="RANK_NAME"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="240" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="RankId"
      IsQueriable="false"
      IsPersistent="false"
      IsNotNull="true"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="RANK_ID"
      Expression="RANK_ID"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Day02"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="DAY0_2"
      Expression="DAY0_2"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Day37"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="DAY3_7"
      Expression="DAY3_7"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Day830"
      IsUpdateable="false"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="DAY8_30"
      Expression="DAY8_30"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Day31"
      IsUpdateable="false"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="DAY_31"
      Expression="DAY_31"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Closed"
      IsUpdateable="false"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="CLOSED"
      Expression="CLOSED"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Converted"
      IsUpdateable="false"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="CONVERTED"
      Expression="CONVERTED"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Conversion"
      IsUpdateable="false"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="CONVERSION"
      Expression="CONVERSION"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="TotalLeads"
      IsUpdateable="false"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="TOTAL_LEADS"
      Expression="TOTAL_LEADS"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Day02_Zero_Flag"
      IsUpdateable="false"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="DAY02_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Day37_Zero_flag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="DAY37_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Day830_Zero_Flag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="DAY830_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Day31_Zero_Flag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="DAY31_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Closed_Zero_Flag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="CLOSED_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Converted_Zero_Flag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="CONVERTED_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
</ViewObject>

/*===========================================================================+
 |                       Office Depot - Project Simplify                     |
 |            Oracle NAIO/WIPRO/Office Depot/Consulting Organization         |
 +===========================================================================+
 |  FILENAME                                                                 |
 |             ODCtctAddrCreateUpdateAMImpl.java                             |
 |                                                                           |
 |  DESCRIPTION                                                              |
 |    Application Module Implementation for the                              |
 |     Create Update Contact Address Page.                                   |
 |                                                                           |
 |  NOTES                                                                    |
 |         Used for the Customization on the                                 |
 |          Create Update Contact Address Page                               |
 |                                                                           |
 |  DEPENDENCIES                                                             |
 |    No dependencies.                                                       |
 |                                                                           |
 |  HISTORY                                                                  |
 |                                                                           |
 |    27-Sep-2007 Jasmine Sujithra   Created                                 |
 |                                                                           |
 +===========================================================================*/
package od.oracle.apps.xxcrm.asn.common.customer.server;
import oracle.apps.asn.common.customer.server.CtctAddrCreateUpdateAMImpl;

import oracle.apps.fnd.framework.server.OADBTransaction;
import oracle.apps.fnd.common.MessageToken;
import oracle.apps.fnd.framework.OAException;
import oracle.apps.fnd.framework.OAFwkConstants;
import oracle.apps.asn.common.server.PartyVOImpl;
import oracle.apps.asn.common.server.PartyVORowImpl;
import oracle.apps.fnd.framework.OAViewObject;
import oracle.jbo.Row;

//  ---------------------------------------------------------------
//  ---    File generated by Oracle Business Components for Java.
//  ---------------------------------------------------------------

public class ODCtctAddrCreateUpdateAMImpl extends CtctAddrCreateUpdateAMImpl 
{


public String  getPartySiteAddr( String partySiteId )
  {
      final String METHOD_NAME = "od.oracle.apps.xxcrm.asn.common.customer.server.ODAddSiteCtctAMImpl.getPartySiteFromId";
    OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
    boolean isProcLogEnabled = dbTrx.isLoggingEnabled(OAFwkConstants.PROCEDURE);
    if (isProcLogEnabled)  {
      dbTrx.writeDiagnostics(METHOD_NAME, "Begin", OAFwkConstants.PROCEDURE);
      StringBuffer buf = new StringBuffer();
      buf.append("Input Parameters: partySiteId = ");
      buf.append(partySiteId);
      dbTrx.writeDiagnostics(METHOD_NAME,buf.toString(), OAFwkConstants.PROCEDURE);
    }

    ODPartySiteVOImpl vo = this.getODPartySiteVO();
    if (vo == null)
    {
          MessageToken[] tokens = { new MessageToken("NAME", "PartyVO") };
          throw new OAException("ASN", "ASN_CMMN_OBJ_MISS_ERR", tokens);
    }
    vo.initQuery(partySiteId);

    String partySiteAddr = null;
    Object primaryAddress = null;

   if ( vo != null && vo.isExecuted() )
    {
         ODPartySiteVORowImpl cRow = (ODPartySiteVORowImpl)vo.first();
         primaryAddress = (Object)cRow.getAttribute("PrimaryAddress");
         if (primaryAddress != null)
            partySiteAddr = (primaryAddress).toString();
       
    }   
   
    if(partySiteAddr !=null)
      return partySiteAddr.trim();
    else
      return partySiteAddr;
  }







public void applyTransaction()
{
   OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
   dbTrx.commit();
}

 public void insertRecords(String partySiteId,String relationshipId)
  {
    final String METHOD_NAME = "od.oracle.apps.xxcrm.asn.common.customer.server.ODAddSiteCtctAMImpl.insertRecords";
    OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
    boolean isProcLogEnabled = dbTrx.isLoggingEnabled(OAFwkConstants.PROCEDURE);
    if (isProcLogEnabled)  {
      dbTrx.writeDiagnostics(METHOD_NAME, "Begin", OAFwkConstants.PROCEDURE);
      StringBuffer buf = new StringBuffer();
      buf.append("  ,Party Site ID = ");
      buf.append(partySiteId);      
      dbTrx.writeDiagnostics(METHOD_NAME,buf.toString(), OAFwkConstants.PROCEDURE);
    }

   
  
    String viewUsageName = "ODHzPartySitesExtVLVO";
    OAViewObject vo = getODHzPartySitesExtVLVO();
   
    if(vo == null)
    {
      MessageToken[] tokens = { new MessageToken("OBJECT_NAME", viewUsageName) };
      throw new OAException("ASN", "ASN_CMMN_OBJ_MISS_ERR", tokens);
    }
 
    if (!vo.isPreparedForExecution()) 
    { 
      vo.executeQuery(); 
    } 
    vo.reset();
    vo.setRowValidation(false);



    String attrSql = " select attr_group_id from ego_attr_groups_v egoag where  egoag.attr_group_type = 'HZ_PARTY_SITES_GROUP' AND egoag.attr_group_name = 'SITE_CONTACTS'";
    oracle.jbo.ViewObject attrgrpidvo = createViewObjectFromQueryStmt("AttrGrpIdVO", attrSql); 
    attrgrpidvo.executeQuery();
    attrgrpidvo.first();
    String attrGroupId = attrgrpidvo.getCurrentRow().getAttribute(0).toString(); 
    attrgrpidvo.remove();


        
    String relId = relationshipId;
 
    Row newrow = vo.createRow();

    newrow.setAttribute("AttrGroupId",attrGroupId);
    newrow.setAttribute("PartySiteId", partySiteId);              
    newrow.setAttribute("NExtAttr1", relId);

    vo.insertRow(newrow);
    newrow.setNewRowState(Row.STATUS_NEW);
       
    dbTrx.commit(); 

    if (isProcLogEnabled) {
      dbTrx.writeDiagnostics(METHOD_NAME, "End", OAFwkConstants.PROCEDURE);
    }
  }

 public String getPartyNameFromId(String partyId)
  {
    final String METHOD_NAME = "od.oracle.apps.xxcrm.asn.common.customer.server.ODHzPuiAddressAMImpl.getPartyNameFromId";
    OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
    boolean isProcLogEnabled = dbTrx.isLoggingEnabled(OAFwkConstants.PROCEDURE);
    if (isProcLogEnabled)  {
      dbTrx.writeDiagnostics(METHOD_NAME, "Begin", OAFwkConstants.PROCEDURE);
      StringBuffer buf = new StringBuffer();
      buf.append("Input Parameters: partyId = ");
      buf.append(partyId);
      dbTrx.writeDiagnostics(METHOD_NAME,buf.toString(), OAFwkConstants.PROCEDURE);
    }

    PartyVOImpl vo = this.getPartyVO();
    if (vo == null)
    {
          MessageToken[] tokens = { new MessageToken("NAME", "PartyVO") };
          throw new OAException("ASN", "ASN_CMMN_OBJ_MISS_ERR", tokens);
    }
    vo.initQuery(partyId);

    String partyName = null;

   if ( vo != null && vo.isExecuted() )
    {
         PartyVORowImpl cRow = (PartyVORowImpl)vo.first();
         partyName = ((Object)cRow.getAttribute("PartyName")).toString();
    }

    if (isProcLogEnabled) {
      StringBuffer buf = new StringBuffer();
      buf.append("Output Parameters: partyName = ");
      buf.append(partyName);
      dbTrx.writeDiagnostics(METHOD_NAME,buf.toString(), OAFwkConstants.PROCEDURE);
      dbTrx.writeDiagnostics(METHOD_NAME, "End", OAFwkConstants.PROCEDURE);
    }

    return partyName;
  }

 
  /**
   * 
   * This is the default constructor (do not remove)
   */
  public ODCtctAddrCreateUpdateAMImpl()
  {
  }

  /**
   * 
   * Container's getter for ODPartySiteListVO
   */
  public ODPartySiteListVOImpl getODPartySiteListVO()
  {
    return (ODPartySiteListVOImpl)findViewObject("ODPartySiteListVO");
  }

  /**
   * 
   * Sample main for debugging Business Components code using the tester.
   */
  public static void main(String[] args)
  {
    launchTester("od.oracle.apps.xxcrm.asn.common.customer.server", "ODCtctAddrCreateUpdateAMLocal");
  }

  /**
   * 
   * Container's getter for ODPartySiteVO
   */
  public ODPartySiteVOImpl getODPartySiteVO()
  {
    return (ODPartySiteVOImpl)findViewObject("ODPartySiteVO");
  }

  /**
   * 
   * Container's getter for ODHzPartySitesExtVLVO
   */
  public ODHzPartySitesExtVLVOImpl getODHzPartySitesExtVLVO()
  {
    return (ODHzPartySitesExtVLVOImpl)findViewObject("ODHzPartySitesExtVLVO");
  }

  /**
   * 
   * Container's getter for ODPartySiteExtRelationshipVO
   */
  public ODPartySiteExtRelationshipVOImpl getODPartySiteExtRelationshipVO()
  {
    return (ODPartySiteExtRelationshipVOImpl)findViewObject("ODPartySiteExtRelationshipVO");
  }

  /**
   * 
   * Container's getter for PartyVO
   */
  public PartyVOImpl getPartyVO()
  {
    return (PartyVOImpl)findViewObject("PartyVO");
  }
}
/*===========================================================================+
 |                       Office Depot - Project Simplify                     |
 |            Oracle NAIO/WIPRO/Office Depot/Consulting Organization         |
 +===========================================================================+
 |  FILENAME                                                                 |
 |             ODCtctCreateAMImpl.java                                       |
 |                                                                           |
 |  DESCRIPTION                                                              |
 |    Root Application Module Implementation for the Create Contact Page.    |
 |                                                                           |
 |  NOTES                                                                    |
 |         Used for the Customization on the Create Contact Page             |
 |         Inserts records into HZ_PARTY_SITES_EXT_B using                   |
 |         ODHzPartySitesExtVLVO                                             |
 |  DEPENDENCIES                                                             |
 |    No dependencies.                                                       |
 |                                                                           |
 |  HISTORY                                                                  |
 |                                                                           |
 |    27-Sep-2007 Jasmine Sujithra   Created                                 |
 |    04-Mar-2008 Jasmine Sujithra   Updated for Performance                 |
 +===========================================================================*/
package od.oracle.apps.xxcrm.asn.common.customer.server;
import oracle.apps.asn.common.customer.server.CtctCreateAMImpl;
import oracle.apps.fnd.framework.server.OADBTransaction;
import oracle.apps.fnd.framework.OAViewObject;
import oracle.apps.fnd.common.MessageToken;
import oracle.apps.fnd.framework.OAException;
import oracle.jbo.RowSetIterator;
import oracle.apps.fnd.framework.OAFwkConstants;
import oracle.apps.fnd.framework.server.OAViewRowImpl;
import com.sun.java.util.collections.HashMap;
import oracle.apps.ar.hz.components.address.server.HzPuiLocationVOImpl;
import oracle.jbo.Row;

//  ---------------------------------------------------------------
//  ---    File generated by Oracle Business Components for Java.
//  ---------------------------------------------------------------

public class ODCtctCreateAMImpl extends CtctCreateAMImpl 
{

 public HashMap  getPartySiteDet( String partySiteId )
  {
    final String METHOD_NAME = "od.oracle.apps.xxcrm.asn.common.customer.server.ODCtctCreateAMImpl.getPartySiteDet";
    OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
    boolean isProcLogEnabled = dbTrx.isLoggingEnabled(OAFwkConstants.PROCEDURE);
    boolean isStatLogEnabled = dbTrx.isLoggingEnabled(OAFwkConstants.STATEMENT);

    if (isProcLogEnabled)
    {
      dbTrx.writeDiagnostics(METHOD_NAME, "Begin", OAFwkConstants.PROCEDURE);
    }

    if (isStatLogEnabled)
    {
      StringBuffer buf = new StringBuffer(100);
      buf.append("  partySiteId : ");
      buf.append(partySiteId);
      dbTrx.writeDiagnostics(METHOD_NAME, buf.toString(), OAFwkConstants.STATEMENT);
    }
     HashMap partySiteInfo = null;
      // get view instance/object
    String viewUsageName = "ODPartySiteListVO";
    OAViewObject partysitelistvo = (OAViewObject)getODPartySiteListVO();
   
    if (partysitelistvo == null)
    {
      MessageToken[] tokens = { new MessageToken("NAME", viewUsageName) };
      throw new OAException("ASN", "ASN_CMMN_OBJ_MISS_ERR", tokens);
    }
    int index = 0;
      // determine the row index based on the requested lead
    if(partySiteId!=null && partySiteId.trim().length()>=0)
    {
      RowSetIterator partySiteItr = null;
      OAViewRowImpl row = null;
      if(partysitelistvo!=null) {
        partySiteItr = partysitelistvo.findRowSetIterator("PartySiteIterator");
        if(partySiteItr==null)
          partySiteItr = partysitelistvo.createRowSetIterator("PartySiteIterator");
        else
          partySiteItr.reset();
      }
      if(partySiteItr!=null)
      {
        partySiteItr.setRowValidation(false);
        String id = null;
        while(partySiteItr.hasNext())
        {
          row = (OAViewRowImpl)partySiteItr.next();
          if(row!=null)
            id = row.getAttribute("PartySiteId").toString();
          if(partySiteId.equals(id))
          {
            index = partySiteItr.getCurrentRowIndex();
            String ind = ""+index;//(String)new Object(index);
            partySiteInfo = new HashMap(12);           
            partySiteInfo.put("Index",ind);
            partySiteInfo.put("Address1",row.getAttribute("Address1"));
            
            OAViewRowImpl oaviewrowimpl = (OAViewRowImpl)partySiteItr.getCurrentRow();
            partysitelistvo.setCurrentRow(oaviewrowimpl);
            break;
          }
        }
        partySiteItr.closeRowSetIterator();
      }
    }
    if (isProcLogEnabled)
    {
      dbTrx.writeDiagnostics(METHOD_NAME,"End", OAFwkConstants.PROCEDURE);
    }

    return partySiteInfo;
  }

 public String  getPartySiteAddr( String partySiteId )
  {
    final String METHOD_NAME = "od.oracle.apps.xxcrm.asn.common.customer.server.ODCtctCreateAMImpl.getPartySiteAddr";
    OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
    boolean isProcLogEnabled = dbTrx.isLoggingEnabled(OAFwkConstants.PROCEDURE);
    if (isProcLogEnabled)  {
      dbTrx.writeDiagnostics(METHOD_NAME, "Begin", OAFwkConstants.PROCEDURE);
      StringBuffer buf = new StringBuffer();
      buf.append("Input Parameters: partySiteId = ");
      buf.append(partySiteId);
      dbTrx.writeDiagnostics(METHOD_NAME,buf.toString(), OAFwkConstants.PROCEDURE);
    }

    ODPartySiteVOImpl vo = this.getODPartySiteVO();
    if (vo == null)
    {
          MessageToken[] tokens = { new MessageToken("NAME", "PartyVO") };
          throw new OAException("ASN", "ASN_CMMN_OBJ_MISS_ERR", tokens);
    }
    vo.initQuery(partySiteId);

    String partySiteAddr = null;
    Object primaryAddress = null;

   if ( vo != null && vo.isExecuted() )
    {
         ODPartySiteVORowImpl cRow = (ODPartySiteVORowImpl)vo.first();
         primaryAddress = (Object)cRow.getAttribute("PrimaryAddress");
         if (primaryAddress != null)
         partySiteAddr = (primaryAddress).toString();       
    }   
   
    if (partySiteAddr != null)
        return partySiteAddr.trim();
    else
        return partySiteAddr;
  }


public void applyTransaction()
{
   OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
   dbTrx.commit();
   
}

public void cancelTransaction()
{
   OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
   dbTrx.rollback();
   
}

 public void insertRecords(String partySiteId,String relationshipId)
  {
    final String METHOD_NAME = "od.oracle.apps.xxcrm.asn.common.customer.server.ODCtctCreateAMImpl.insertRecords";
    OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
    boolean isProcLogEnabled = dbTrx.isLoggingEnabled(OAFwkConstants.PROCEDURE);
    if (isProcLogEnabled)  {
      dbTrx.writeDiagnostics(METHOD_NAME, "Begin", OAFwkConstants.PROCEDURE);
      StringBuffer buf = new StringBuffer();
      buf.append("  ,Party Site ID = ");
      buf.append(partySiteId);      
      dbTrx.writeDiagnostics(METHOD_NAME,buf.toString(), OAFwkConstants.PROCEDURE);
    }
 
    String viewUsageName = "ODHzPartySitesExtVLVO";
    OAViewObject vo = getODHzPartySitesExtVLVO();
   
    if(vo == null)
    {
      MessageToken[] tokens = { new MessageToken("OBJECT_NAME", viewUsageName) };
      throw new OAException("ASN", "ASN_CMMN_OBJ_MISS_ERR", tokens);
    }
 
    
    vo.reset();
    vo.setRowValidation(false);
    
    String attrSql = " select attr_group_id from ego_attr_groups_v egoag where  egoag.attr_group_type = 'HZ_PARTY_SITES_GROUP' AND egoag.attr_group_name = 'SITE_CONTACTS'";
    oracle.jbo.ViewObject attrgrpidvo = createViewObjectFromQueryStmt("AttrGrpIdVO", attrSql); 
    attrgrpidvo.executeQuery();
    attrgrpidvo.first();
    String attrGroupId = attrgrpidvo.getCurrentRow().getAttribute(0).toString(); 
    attrgrpidvo.remove();
        
    String relId = relationshipId;
 
    Row newrow = vo.createRow();

    newrow.setAttribute("AttrGroupId",attrGroupId);
    newrow.setAttribute("PartySiteId", partySiteId);              
    newrow.setAttribute("NExtAttr1", relId);

    vo.insertRow(newrow);
    newrow.setNewRowState(Row.STATUS_NEW);
       
    dbTrx.commit(); 

    if (isProcLogEnabled) {
      dbTrx.writeDiagnostics(METHOD_NAME, "End", OAFwkConstants.PROCEDURE);
    }
  }




  /**
   * 
   * This is the default constructor (do not remove)
   */
  public ODCtctCreateAMImpl()
  {
  }

  /**
   * 
   * Container's getter for ODPartySiteListVO
   */
  public ODPartySiteListVOImpl getODPartySiteListVO()
  {
    return (ODPartySiteListVOImpl)findViewObject("ODPartySiteListVO");
  }

    public HzPuiLocationVOImpl getHzPuiLocationVO()
    {
        return (HzPuiLocationVOImpl)findViewObject("HzPuiLocationVO");
    }


  /**
   * 
   * Sample main for debugging Business Components code using the tester.
   */
  public static void main(String[] args)
  {
    launchTester("od.oracle.apps.xxcrm.asn.common.customer.server", "ODCtctCreateAMLocal");
  }

  /**
   * 
   * Container's getter for ODHzPartySitesExtVLVO
   */
  public ODHzPartySitesExtVLVOImpl getODHzPartySitesExtVLVO()
  {
    return (ODHzPartySitesExtVLVOImpl)findViewObject("ODHzPartySitesExtVLVO");
  }

  /**
   * 
   * Container's getter for ODPartySiteVO
   */
  public ODPartySiteVOImpl getODPartySiteVO()
  {
    return (ODPartySiteVOImpl)findViewObject("ODPartySiteVO");
  }

  /**
   * 
   * Container's getter for ODPartySiteExtRelationshipVO
   */
  public ODPartySiteExtRelationshipVOImpl getODPartySiteExtRelationshipVO()
  {
    return (ODPartySiteExtRelationshipVOImpl)findViewObject("ODPartySiteExtRelationshipVO");
  }
}
<?xml version="1.0" encoding="WINDOWS-1252" ?>
<dataTemplate name="XXARCBIONE_SPEC" description="SPECIAL HANDLING CONSOLIDATED BILLING-ONE" Version="1.0">
<parameters>
 <parameter name="P_SUMM_BILL_NUM" dataType="character" />
 <parameter name="P_SUMM_BILL_NUM_TO" dataType="character" />
 <parameter name="P_CUST_ACCOUNT_ID" dataType="number" />
 <parameter name="P_MBS_DOCUMENT_ID" dataType="number" />
 <parameter name="P_MBS_EXTENSION_ID" dataType="number" /> 
 <parameter name="P_SPEC_HANDLING_FLAG" dataType="character" />
 <parameter name="P_SELECT_LIST" dataType="character" />
 <parameter name="P_ORDER_LIST" dataType="character" />
</parameters>
<dataQuery>
<sqlStatement name="Q_ONE">
<![CDATA[
SELECT *
FROM  APPS.XX_AR_CBI_REPRINT_V
WHERE BILLING_NO BETWEEN NVL(:P_SUMM_BILL_NUM, BILLING_NO) AND NVL(:P_SUMM_BILL_NUM_TO, BILLING_NO)
  AND CUSTOMER_ID =:P_CUST_ACCOUNT_ID
ORDER BY CUSTOMER_NUMBER
]]>
</sqlStatement>
<sqlStatement name="Q_SPL_HANDLING_COMMENTS">
<![CDATA[
select a.billdocs_comments1||' ,'||a.billdocs_comments2||' ,'||
       a.billdocs_comments3||' ,'||a.billdocs_comments4 COMMENTS
      ,b.account_number customer_no   
      ,c.doc_sort_order  doc_desc
from   xx_cdh_a_ext_billdocs_v a
      ,hz_cust_accounts b
      ,xx_cdh_mbs_document_master c
where  a.cust_account_id =:p_cust_account_id
  and  a.extension_id    =:p_mbs_extension_id
  and  a.cust_account_id =b.cust_account_id
  and  a.billdocs_doc_id =c.document_id  
]]>
</sqlStatement>
<sqlStatement name="Q_CONS_INV_TOTALS"> 
<![CDATA[ 
SELECT 
       SUM(DECODE(LINE_TYPE, 'LINE', NVL(AMOUNT, 0), 0)) LINE_AMOUNT
      ,SUM(DECODE(LINE_TYPE, 'TAX',  NVL(AMOUNT, 0), 0)) TAX_AMOUNT
      ,SUM(DECODE(LINE_TYPE, 'DISC', NVL(AMOUNT, 0), 0)) DISC_AMOUNT
      ,SUM(NVL(AMOUNT,0))                                TOTAL_AMOUNT 
      ,:CURRENCY                                         CIT_CURRENCY
FROM (
SELECT
       'DISC'                                           LINE_TYPE
      ,SUM(RACTL.EXTENDED_AMOUNT)                       AMOUNT
FROM   
       AR_CONS_INV_TRX       ARCIT 
      ,AR_CONS_INV_TRX_LINES CONSINV_LINES
      ,RA_CUSTOMER_TRX_LINES RACTL
      ,OE_PRICE_ADJUSTMENTS  OEPA
WHERE ARCIT.CONS_INV_ID                  = :CONS_INV_ID
  AND CONSINV_LINES.CONS_INV_ID          = ARCIT.CONS_INV_ID
  AND CONSINV_LINES.CONS_INV_LINE_NUMBER = ARCIT.CONS_INV_LINE_NUMBER
  AND CONSINV_LINES.CUSTOMER_TRX_LINE_ID = RACTL.CUSTOMER_TRX_LINE_ID
  AND CONSINV_LINES.CUSTOMER_TRX_ID      = RACTL.CUSTOMER_TRX_ID
  AND RACTL.INTERFACE_LINE_ATTRIBUTE11   = OEPA.PRICE_ADJUSTMENT_ID
  --AND OEPA.ATTRIBUTE8 IN ('TD', '21', '10')
  AND ARCIT.TRANSACTION_TYPE IN 
  (
   'INVOICE'
  ,'CREDIT_MEMO'
  )
UNION
SELECT
       RACTL.LINE_TYPE                                  LINE_TYPE
      ,SUM(RACTL.EXTENDED_AMOUNT)                       LINE_TOT_AMT
FROM   
       AR_CONS_INV_TRX       ARCIT 
      ,AR_CONS_INV_TRX_LINES CONSINV_LINES
      ,RA_CUSTOMER_TRX_LINES RACTL
WHERE ARCIT.CONS_INV_ID                  = :CONS_INV_ID
  AND CONSINV_LINES.CONS_INV_ID          = ARCIT.CONS_INV_ID
  AND CONSINV_LINES.CONS_INV_LINE_NUMBER = ARCIT.CONS_INV_LINE_NUMBER
  AND CONSINV_LINES.CUSTOMER_TRX_LINE_ID = RACTL.CUSTOMER_TRX_LINE_ID
  AND CONSINV_LINES.CUSTOMER_TRX_ID      = RACTL.CUSTOMER_TRX_ID
  AND RACTL.LINE_TYPE = 'LINE'
  AND ARCIT.TRANSACTION_TYPE IN 
  (
   'INVOICE'
  ,'CREDIT_MEMO'
  )
  AND (CONSINV_LINES.CUSTOMER_TRX_ID ,CONSINV_LINES.CUSTOMER_TRX_LINE_ID) NOT IN
  (
     SELECT ARCITLI.CUSTOMER_TRX_ID
           ,ARCITLI.CUSTOMER_TRX_LINE_ID
     FROM   RA_CUSTOMER_TRX_LINES  RACTL
           ,OE_PRICE_ADJUSTMENTS OEPA
           ,AR_CONS_INV_TRX_LINES ARCITLI
     WHERE  1 = 1
     AND RACTL.INTERFACE_LINE_ATTRIBUTE11 = OEPA.PRICE_ADJUSTMENT_ID
     --AND OEPA.ATTRIBUTE8 IN ('TD', '10', '21')
     AND ARCITLI.CUSTOMER_TRX_LINE_ID = RACTL.CUSTOMER_TRX_LINE_ID
     AND ARCITLI.CUSTOMER_TRX_ID = RACTL.CUSTOMER_TRX_ID
     AND ARCIT.CONS_INV_ID = ARCIT.CONS_INV_ID
  )  
GROUP BY RACTL.LINE_TYPE
UNION ALL
SELECT
       RACTL.LINE_TYPE                                  LINE_TYPE
      ,SUM(RACTL.EXTENDED_AMOUNT)                       LINE_TOT_AMT
FROM   
       AR_CONS_INV_TRX       ARCIT 
      ,AR_CONS_INV_TRX_LINES CONSINV_LINES
      ,RA_CUSTOMER_TRX_LINES RACTL
WHERE ARCIT.CONS_INV_ID                  = :CONS_INV_ID
  AND CONSINV_LINES.CONS_INV_ID          = ARCIT.CONS_INV_ID
  AND CONSINV_LINES.CONS_INV_LINE_NUMBER = ARCIT.CONS_INV_LINE_NUMBER
--  AND CONSINV_LINES.CUSTOMER_TRX_LINE_ID = RACTL.CUSTOMER_TRX_LINE_ID
  AND CONSINV_LINES.CUSTOMER_TRX_ID      = RACTL.CUSTOMER_TRX_ID
  AND RACTL.LINE_TYPE = 'TAX'
  AND ARCIT.TRANSACTION_TYPE IN 
  (
   'INVOICE'
  ,'CREDIT_MEMO'
  )
GROUP BY RACTL.LINE_TYPE
UNION ALL
SELECT
       'LINE'
      ,SUM(ARCIT.AMOUNT_ORIGINAL)
FROM   AR_CONS_INV_TRX       ARCIT 
WHERE ARCIT.CONS_INV_ID =:CONS_INV_ID
  AND ARCIT.TRANSACTION_TYPE ='ADJUSTMENT'
UNION ALL
SELECT
       'TAX'
      ,SUM(ARCIT.TAX_ORIGINAL)
FROM   AR_CONS_INV_TRX       ARCIT 
WHERE ARCIT.CONS_INV_ID =:CONS_INV_ID
  AND ARCIT.TRANSACTION_TYPE ='ADJUSTMENT'
)
]]> 
</sqlStatement>
</dataQuery>
<dataStructure>
<group name="G_SPL_CUSTOMERS" source="Q_SPL_HANDLING_COMMENTS">
<element name="CUSTOMER_ID" value="CUSTOMER_NO" />
<element name="COMMENT" value="COMMENTS" />
<element name="SORT_DESC" value="DOC_DESC" />
<group name="G_CUSTOMER_NUMBER" source="Q_ONE">
<element name="CONS_ID" value="CONS_INV_ID" />
<element name="ADDR1" value="ADDRESS1" />
<element name="ADDR2" value="ADDRESS2" />
<element name="CITYSTATEPOSTALCODE" value="CITY" />
<element name="TAX_ID_DESC" value="TAX_ID_DESC" />
<element name="TAX_ID" value="TAX_ID" />
<element name="ACCOUNT_CONTACT" value="ACCOUNT_CONTACT" />
<element name="ORDER_CONTACT" value="ORDER_CONTACT" />
<element name="BILLING_NO" value="BILLING_NO" />
<element name="BILLING_NO1" value="BILLING_NO" />
<element name="ISSUE_DATE" value="ISSUE_DATE" />
<element name="ISSUE_DATE1" value="ISSUE_DATE" />
<element name="CUT_OFF_DATE" value="CUT_OFF_DATE" />
<element name="DUE_DATE" value="DUE_DATE" />
<element name="CUSTOMER_NAME" value="CUSTOMER_NAME" />
<element name="CUSTOMER_NAME1" value="CUSTOMER_NAME" />
<element name="ACCOUNT_NUMBER" value="ACCOUNT_NUMBER" />
<element name="BILLING_ID" value="CUSTOMER_NUMBER" />
<element name="BILLING_ID1" value="CUSTOMER_NUMBER" />
<element name="ADDRESS1" value="ADDRESS1" />
<element name="ADDRESS2" value="ADDRESS2" />
<element name="CITY" value="CITY" />
<element name="COUNTRY" value="COUNTRY" />
<element name="PROVINCE" value="PROVINCE" />
<element name="CURRENCY" value="CURRENCY" />
<element name="RADDRESS1" value="RADDRESS1" />
<element name="RADDRESS2" value="RADDRESS2" />
<element name="RCITY" value="RCITY" />
<element name="RADDRESS1C" value="RADDRESS1C" />
<element name="RADDRESS2C" value="RADDRESS2C" />
<element name="RCITYC" value="RCITYC" />
<element name="RCOUNTRY" value="RCOUNTRY" />
<element name="CD_BEGINNING_BALANCE" value="CD_BEGINNING_BALANCE" />
<element name="CD_ENDING_BALANCE" value="CD_ENDING_BALANCE" />
<element name="CD_ENDING_BALANCE1" value="CD_ENDING_BALANCE" />
<element name="CD_ENDING_BALANCE2" value="CD_ENDING_BALANCE" />
<element name="CD_PERIOD_RECEIPTS" value="CD_PERIOD_RECEIPTS" />
<element name="CD_PERIOD_TAX" value="CD_PERIOD_TAX" />
<element name="CD_PERIOD_BILLED" value="CD_PERIOD_BILLED" />
<element name="RADDRESS1C" value="RADDRESS1" />
<element name="RADDRESS2C" value="RADDRESS2" />
<element name="RCITYC" value="RCITY" />
<element name="PRINT_INSTANCE" value="SPL_PRINT_INSTANCE" />
<element name="PAYSTUB_UPPER_TEXT" value="PAYSTUB_UPPER_TEXT" />
<element name="BILLING_POSTAL_CODE" value="BILLING_POSTAL_CODE" />
<element name="REMIT_POSTAL_CODE" value="REMIT_POSTAL_CODE" />
<element name="FLO_CODE" value="FLO_CODE" />
<group name="G_CONS_INV_TOTALS" source="Q_CONS_INV_TOTALS"> 
<element name="CIT_LINE_AMOUNT" value="LINE_AMOUNT" /> 
<element name="CIT_TAX_AMOUNT" value="TAX_AMOUNT" /> 
<element name="CIT_DISC_AMOUNT" value="DISC_AMOUNT" /> 
<element name="CIT_TOTAL_AMOUNT" value="TOTAL_AMOUNT" /> 
<element name="CIT_CURRENCY" value="CIT_CURRENCY" /> 
</group>
</group>
</group>
</dataStructure>
</dataTemplate>
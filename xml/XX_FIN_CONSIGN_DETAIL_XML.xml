<?xml version="1.0" encoding="UTF-8"?>
<dataTemplate name="XX_FIN_CONSIGN_DETAIL" defaultPackage="" dataSourceRef="">
	<properties>
		<property name="include_parameters" value="true"/>
		<property name="include_null_Element" value="true"/>
		<property name="db_fetch_size" value="300"/>
	</properties>
	<parameters>
		<parameter name="P_VENDOR_NUMBER" dataType="varchar2" defaultValue=""/>
		<parameter name="P_INVOICE_NUM" dataType="varchar2" defaultValue=""/>
		<parameter name="P_FROM_DATE" dataType="varchar2" /> 
        <parameter name="P_TO_DATE" dataType="varchar2" />
	</parameters>
<dataQuery>
<sqlStatement name="Q_DATA" dataSourceRef="">
<![CDATA[  
    SELECT HDR.INVOICE_ID                             INVOICE_ID,
           HDR.INVOICE_NUMBER                         INVOICE_NUMBER,
    	   AIA.INVOICE_DATE                           INVOICE_DATE,
    	   AIA.INVOICE_AMOUNT                         INVOICE_AMOUNT,
    	   'USTR'                                     AP_COMPANY,
    	   HDR.AP_VENDOR||' '||ASP.VENDOR_NAME        VENDOR_NUMBER,
    	   UPPER(PTY_REL.EMAIL_ADDRESS)               EMAIL_ADDRESS
      FROM AP_SUPPLIERS ASP ,
           AP_SUPPLIER_SITES_ALL ASSA ,
           AP_SUPPLIER_CONTACTS APSC ,
           HZ_PARTIES PERSON ,
           HZ_PARTIES PTY_REL,
           HR_OPERATING_UNITS HOU,
           XX_AP_TRADE_INV_HDR HDR,
           AP_INVOICES_ALL AIA
     WHERE ASSA.VENDOR_ID = ASP.VENDOR_ID
       AND APSC.PER_PARTY_ID = PERSON.PARTY_ID
       AND APSC.REL_PARTY_ID = PTY_REL.PARTY_ID
       AND ASSA.ORG_ID = HOU.ORGANIZATION_ID
       AND APSC.ORG_PARTY_SITE_ID = ASSa.PARTY_SITE_ID
       AND LTRIM(ASSA.VENDOR_SITE_CODE_ALT,'0') = LTRIM(HDR.AP_VENDOR,'0')
       AND HDR.INVOICE_NUMBER = AIA.INVOICE_NUM
	   AND ASP.VENDOR_ID = AIA.VENDOR_ID
       AND AIA.SOURCE = 'US_OD_CONSIGNMENT_SALES'
       AND ASSA.PAY_SITE_FLAG = 'Y'
       AND ASSA.ATTRIBUTE8 LIKE 'TR%'
       AND ((ASSA.INACTIVE_DATE IS NULL) OR (ASSA.INACTIVE_DATE > SYSDATE))
       AND ((APSC.INACTIVE_DATE IS NULL) OR (APSC.INACTIVE_DATE > SYSDATE))
       AND (:P_VENDOR_NUMBER IS NULL OR HDR.AP_VENDOR = :P_VENDOR_NUMBER)
       AND (:P_INVOICE_NUM IS NULL OR AIA.INVOICE_NUM = :P_INVOICE_NUM )
       AND  AIA.CREATION_DATE  BETWEEN TO_DATE(:P_FROM_DATE||' 00:00:00','DD-MON-RRRR HH24:MI:SS') AND TO_DATE(:P_TO_DATE||' 23:59:59','DD-MON-RRRR HH24:MI:SS')
     ORDER BY AIA.INVOICE_NUM
]]>
</sqlStatement>
<sqlStatement name="Q_DATA1" dataSourceRef="">
<![CDATA[  
    SELECT  LOCATION_NUMBER
		   ,VOUCHER_NUM
		   ,SKU
		   ,DECODE(ACCT_DETAIL,NULL,PO_COST,AVG_COST) COST
		   ,QUANTITY
		   ,DECODE(ACCT_DETAIL,NULL,PO_COST * QUANTITY ,AVG_COST * QUANTITY)  LINE_AMOUNT
		   ,LINE_DESCRIPTION
		   ,SALES_DATE
		   ,COMMENTS
		   ,ACCOUNT_NUMBER
      FROM		   
         (SELECT   LINES.LOCATION_NUMBER    LOCATION_NUMBER
				  ,LINES.VOUCHER            VOUCHER_NUM
				  ,LINES.SKU                SKU
				  ,LINES.COST               AVG_COST
				  ,LINES.PO_COST            PO_COST
				  ,(SELECT TARGET_VALUE8					
                      FROM XX_FIN_TRANSLATEVALUES
                     WHERE TRANSLATE_ID IN (SELECT TRANSLATE_ID 
          			                          FROM XX_FIN_TRANSLATEDEFINITION 
          			                         WHERE TRANSLATION_NAME = 'AP_CONSIGN_LIABILITY' 
          			                           AND ENABLED_FLAG = 'Y')
                       AND SOURCE_VALUE2 = LINES.AP_VENDOR
                       AND SOURCE_VALUE1 = 'USA') ACCT_DETAIL
				  ,LINES.QUANTITY           QUANTITY
				  ,LINES.SKU_DESCRIPTION   LINE_DESCRIPTION
				  ,LINES.INVOICE_DATE       SALES_DATE
				  ,LINES.TRACK_ID           COMMENTS
				  ,LINES.ACCOUNT_NUMBER     ACCOUNT_NUMBER
            FROM  XX_AP_TRADE_INV_LINES LINES
           WHERE  LINES.INVOICE_ID = :INVOICE_ID
		     AND  LINES.CONSIGN_FLAG = 'Y') A
]]>
</sqlStatement>
</dataQuery>
<dataStructure>
<group name="G_SUPPLIER" source="Q_DATA">
<element name="C_INVOICE_NUMBER" value="INVOICE_NUMBER" function=""/>
<element name="C_INVOICE_DATE" value="INVOICE_DATE" function=""/> 
<element name="C_INVOICE_AMOUNT" value="INVOICE_AMOUNT" function=""/>
<element name="C_AP_COMPANY" value="AP_COMPANY" function=""/>
<element name="C_VENDOR_NUMBER" value="VENDOR_NUMBER" function=""/>
<element name="C_EMAIL_ADDRESS" value="EMAIL_ADDRESS" function=""/>
<group name="G_DATA" source="Q_DATA1" groupFilter="">
	 <element name="C_LOCATION_NUMBER" value="LOCATION_NUMBER" function=""/> 
	 <element name="C_VOUCHER_NUM" value="VOUCHER_NUM" function=""/>
	 <element name="C_SKU" value="SKU" function=""/>
	 <element name="C_COST" value="COST" function=""/>
	 <element name="C_QUANTITY" value="QUANTITY" function=""/> 
	 <element name="C_LINE_AMOUNT" value="LINE_AMOUNT" function=""/>
	 <element name="C_LINE_DESCRIPTION" value="LINE_DESCRIPTION" function=""/>
     <element name="C_SALES_DATE" value="SALES_DATE" function=""/>	
     <element name="C_COMMENTS" value="COMMENTS" function=""/>
     <element name="C_ACCOUNT_NUMBER" value="ACCOUNT_NUMBER" function=""/>		 
</group>
</group>
</dataStructure>
</dataTemplate>
<dataTemplate name="EBILLReport" description="" defaultPackage="XX_AR_EBL_DAILY_PROCESS_RPT" Version="1.0">
<properties>
  <property name="scalable_mode" value="on" /> 
  <property name="rtf-output-default-font">Arial:8</property> 
</properties>
<parameters>
<parameter name="P_STATUS" datatype="varchar2" /> 
<parameter name="P_AS_OF_DATE" datatype="varchar2" /> 
</parameters>

<dataQuery>
<sqlStatement name="Q_HEADER">
<![CDATA[ 							 
										 
 Select Account_Number as Account_Number,AOPS_CUSTOMER_NUMBER as Aops_Customer_Number,Customer_Document_ID as Customer_Document_ID,
DECODE(trans_status,'STAGED','FILE STAGED FOR TRANSMISSION'
                                          ,'SEND','FILE NOT YET TRANSMITTED'
                                          ,'ERROR','ERROR, NOT TRANSMITTED'
                                          ,'SENT','FILE TRANSMITTED SUCCESFULLY'
                                          ,'TOOBIG','FILE TOO BIG TO BE TRANSMITTED'
                                          ,'SENTBYCD','FILE SENT BY CD'
                                          ,trans_status
                           ) as Trans_Status,Trans_Status_Detail as Trans_Status_Detail,
DECODE(status,     'RENDER','FILE YET TO BE RENDERED'
                                        ,'MANIP_READY','eXLS FILE MANIPULATION PENDING'
                                        ,'RENDERED','FILE HAS BEEN RENDERED'
                                        ,'FILE INSERT FAILED','FILE INSERTION FAILED'
                                        ,'DATAEXTRACT_FAILED','DATA EXTRACT FAILED'
                                        ,'RENDER_ERROR','ERROR DURING RENDERING'
                                        ,'MANIP_ERROR','DATA MANIPULATION ERROR'
                                        ,status
                           ) as File_Status ,Status_Detail as Reason_For_Failure,
Billing_Associate_Name as Billing_Associate_Name,File_Name as File_Name from (select  xaef.account_number Account_Number
                ,xaef.aops_customer_number aops_customer_number
                ,xaef.cust_doc_id Customer_Document_ID
                ,xaet.status trans_status
                ,translate(SUBSTR(xaet.status_detail,1,1200),chr(13)||chr(10)||'|','   ') trans_status_Detail  
                ,xaef.status status
                ,translate(SUBSTR(xaef.status_detail,1,1200),chr(13)||chr(10)||'|','   ') status_detail   
                ,xaef.billing_associate_name
                ,xaef.file_name  file_name
         from xx_ar_ebl_transmission xaet
             ,xx_ar_ebl_file xaef
         WHERE xaet.transmission_id(+) = xaef.transmission_id
         AND  xaef.file_type IN ('PDF','XLS','TXT')
         AND (:P_STATUS = 'BOTH'
               OR (:P_STATUS = 'SUCCESS' AND xaet.status IN ('SENT','ARCHIVED'))
               OR (:P_STATUS = 'ERROR' AND NVL(xaet.status,'X') NOT IN ('SENT','ARCHIVED'))
             )
         AND xaef.billing_dt = trunc (fnd_conc_date.string_to_date (:P_AS_OF_DATE))
         AND xaef.org_id = fnd_profile.VALUE('ORG_ID')
         AND xaef.file_name NOT LIKE '%REMIT%'
         UNION ALL
         select DISTINCT chdr.oracle_account_number Account_Number
                ,chdr.aops_account_number   aops_customer_number
                ,chdr.parent_cust_doc_id    Customer_Document_ID
                ,NULL trans_Status        
                ,NULL trans_status_Detail  
                ,DECODE(chdr.status,'NEW','FILE NOT PROCESSED - CHECK CDH SETUP'
                                   ,chdr.status) status
                ,NULL status_detail
                ,NULL billing_associate_name
                ,chdr.file_name file_name
         FROM xx_ar_ebl_cons_hdr_main CHDR
         WHERE :P_STATUS IN ('ERROR','BOTH')
         AND chdr.status = 'NEW'
         and chdr.org_id = fnd_profile.VALUE('ORG_ID')
         UNION ALL
         select DISTINCT IHDR.oracle_account_number Account_Number
                ,IHDR.aops_account_number   aops_customer_number
                ,IHDR.parent_cust_doc_id    Customer_Document_ID
                ,NULL trans_Status     
                ,NULL trans_status_Detail   
                ,DECODE(IHDR.status,'NEW','FILE NOT PROCESSED - CHECK CDH SETUP'
                                                   ,IHDR.status) status
                ,NULL status_detail
                ,NULL billing_associate_name
                ,ihdr.file_name file_name
         FROM xx_ar_ebl_ind_hdr_main IHDR
         WHERE :P_STATUS IN ('ERROR','BOTH')
         AND IHDR.status = 'NEW'
         AND IHDR.org_id = fnd_profile.VALUE('ORG_ID'))
]]> 
</sqlStatement>
<sqlStatement name="Q_DETAIL">
<![CDATA[ 
select ORACLE_CUSTOMER_NUMBER as ORACLE_CUSTOMER_NUMBER,AOPSCUSTOMER_NUMBER as AOPSCUSTOMER_NUMBER,CUST_DOC_ID as CUST_DOC_ID,
ERROR_MESSAGE as ERROR_MESSAGE,CONS_BILL_NUMBER as CONS_BILL_NUMBER,TRX_NUMBER as TRX_NUMBER,DOC_TYPE as DOC_TYPE,'ERROR' as STATUS from 
(select  xaeb.oracle_customer_number
                ,xaeb.aopscustomer_number
                ,xaeb.cust_doc_id
                ,xaeb.error_message
                ,xaeb.cons_bill_number
                ,xaeb.trx_number
                ,DECODE(xaeb.document_type,'Y','Paydoc'
                                          ,'N','Infocopy') doc_type
         from XX_AR_EBL_ERROR_BILLS xaeb
         WHERE TRUNC(xaeb.as_of_date) = trunc (fnd_conc_date.string_to_date (:P_AS_OF_DATE))
         AND xaeb.org_id = fnd_profile.VALUE('ORG_ID')) WHERE :P_STATUS <> 'SUCCESS'
]]> 
</sqlStatement>
</dataQuery>
<dataStructure>
<group name="G_HEADER" source="Q_HEADER">
<element name="Account_Number" value="Account_Number" function="" /> 
<element name="Aops_Customer_Number" value="Aops_Customer_Number" function="" /> 
<element name="Customer_Document_ID" value="Customer_Document_ID" function="" /> 
<element name="File_Status" value="File_Status" function="" />
<element name="Reason_For_Failure" value="Reason_For_Failure" function="" />
<element name="Trans_Status" value="Trans_Status" function="" />
<element name="Trans_Status_Detail" value="Trans_Status_Detail" function="" />
<element name="Billing_Associate_Name" value="Billing_Associate_Name" function="" />
<element name="File_Name" value="File_Name" function="" />
</group>
<group name="G_DETAIL" source="Q_DETAIL">
<element name="ORACLE_CUSTOMER_NUMBER" value="ORACLE_CUSTOMER_NUMBER" function="" /> 
<element name="AOPSCUSTOMER_NUMBER" value="AOPSCUSTOMER_NUMBER" function="" /> 
<element name="CUST_DOC_ID" value="CUST_DOC_ID" function="" /> 
<element name="ERROR_MESSAGE" value="ERROR_MESSAGE" function="" />
<element name="CONS_BILL_NUMBER" value="CONS_BILL_NUMBER" function="" />
<element name="TRX_NUMBER" value="TRX_NUMBER" function="" />
<element name="DOC_TYPE" value="DOC_TYPE" function="" />
<element name="STATUS" value="STATUS" function="" />
</group>
</dataStructure>

</dataTemplate>


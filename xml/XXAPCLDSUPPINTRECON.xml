<?xml version="1.0" encoding="UTF-8"?>
<dataTemplate name="XXAPCLDINTR" defaultPackage="XX_AP_SUPP_CLD_INTF_PKG" dataSourceRef="1.0">
	<properties>
		<property name="include_parameters" value="true"/>
		<property name="include_null_Element" value="true"/>
		<property name="db_fetch_size" value="300"/>
	</properties>
	<parameters>
		<parameter name="P_REQUEST_ID" dataType="number" defaultValue=""/>
	</parameters>
<dataQuery>
<sqlStatement name="Q1" dataSourceRef="">
<![CDATA[ SELECT 1 SEQ,'SUPPLIER'|| ' & ' || 'DFF' ENTITY,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPPLIERS_STG
                   WHERE 1 =1
                     AND request_id = :P_REQUEST_ID
                 ) TOTAL_COUNT ,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPPLIERS_STG
                   WHERE 1 = 1
                     AND SUPP_PROCESS_FLAG IN (7,8)
                     AND request_id = :P_REQUEST_ID
                 ) SUCCESS_COUNT,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPPLIERS_STG
                   WHERE 1 =1
                     AND SUPP_PROCESS_FLAG IN (2,3,6)
                     AND request_id = :P_REQUEST_ID
                 ) FAILURE_COUNT
            FROM DUAL
           UNION
          SELECT 2 SEQ,'Site, Address, Assignment'|| ' & ' || 'DFF' ENTITY,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPP_SITES_STG
                   WHERE 1 =1
                     AND request_id = :P_REQUEST_ID
                 ) TOTAL_COUNT,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPP_SITES_STG
                   WHERE 1 = 1
                     AND SITE_PROCESS_FLAG IN (7,8)
                     AND request_id = :P_REQUEST_ID
                 ) SUCCESS_COUNT,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPP_SITES_STG
                   WHERE 1 = 1
                    AND SITE_PROCESS_FLAG IN (2,3,6)
                    AND request_id = :P_REQUEST_ID
                 ) FAILURE_COUNT
            FROM DUAL
           UNION
          SELECT 5 SEQ,'Contacts' ENTITY,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPP_CONTACT_STG
                   WHERE 1 =1
                     AND request_id = :P_REQUEST_ID
                 ) TOTAL_COUNT,
                 (
                 SELECT COUNT(*)
                   FROM XX_AP_CLD_SUPP_CONTACT_STG
                  WHERE 1 = 1
                    AND CONTACT_PROCESS_FLAG IN (7,8)
                    AND request_id = :P_REQUEST_ID
                 ) SUCCESS_COUNT,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPP_CONTACT_STG
                   WHERE 1 = 1
                     AND CONTACT_PROCESS_FLAG IN (2,3,6)
                     AND request_id = :P_REQUEST_ID
                 ) FAILURE_COUNT
            FROM DUAL
           UNION
          SELECT 03 SEQ, 'Custom DFF' ENTITY,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SITE_DFF_STG
                   WHERE 1 =1
                     AND request_id = :P_REQUEST_ID
                 ) TOTAL_COUNT,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SITE_DFF_STG
                   WHERE 1 = 1
                     AND DFF_PROCESS_FLAG IN (7,8)
                     AND request_id = :P_REQUEST_ID
                 ) SUCCESS_COUNT,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SITE_DFF_STG
                   WHERE 1 = 1
                     AND DFF_PROCESS_FLAG IN (2,3,6)
                     AND request_id = :P_REQUEST_ID
                 ) FAILURE_COUNT
            FROM DUAL
           UNION
          SELECT 6 SEQ, 'Bank Assignments' ENTITY,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPP_BNKACT_STG
                   WHERE 1 =1
                     AND request_id = :P_REQUEST_ID
                 ) TOTAL_COUNT,
                 (
                 SELECT COUNT(*)
                   FROM XX_AP_CLD_SUPP_BNKACT_STG
                  WHERE 1 = 1
                    AND BNKACT_PROCESS_FLAG IN (7,8)
                    AND request_id = :P_REQUEST_ID
                 ) SUCCESS_COUNT,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPP_BNKACT_STG
                   WHERE 1 = 1
                     AND BNKACT_PROCESS_FLAG IN (2,3,6)
                     AND request_id = :P_REQUEST_ID
                 ) FAILURE_COUNT
            FROM DUAL
           UNION
          SELECT 4 SEQ,'Business Classification' ENTITY,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPP_BCLS_STG
                   WHERE 1 =1
                     AND request_id = :P_REQUEST_ID
                 ) TOTAL_COUNT,
                 (
                 SELECT COUNT(*)
                   FROM XX_AP_CLD_SUPP_BCLS_STG
                  WHERE 1 = 1
                    AND BCLS_PROCESS_FLAG IN (7,8)
                    AND request_id = :P_REQUEST_ID
                 ) SUCCESS_COUNT,
                 (SELECT COUNT(*)
                    FROM XX_AP_CLD_SUPP_BCLS_STG
                   WHERE 1 = 1
                     AND BCLS_PROCESS_FLAG IN (2,3,6)
                     AND request_id = :P_REQUEST_ID
                 ) FAILURE_COUNT
            FROM DUAL
            order by SEQ
]]>
</sqlStatement>
<sqlStatement name="Q2" dataSourceRef="">
<![CDATA[ 
          SELECT   GLOBAL_NUMBER,
         ENTITY,
         SUPPLIER_NAME,
				 SITE,
				 CONTACT,
				 BANK_ACCOUNT,
				 BUS_CLASSIFICATION,
				 ERROR_MESSAGE,
         SEQ
			FROM
                 ( SELECT 1 SEQ,'SUPPLIER'|| ' & ' || 'DFF' ENTITY,
                           SUPPLIER_NAME,
                           NULL SITE,
                           NULL CONTACT,
                           NULL BANK_ACCOUNT,
                           segment1 GLOBAL_NUMBER,
                           NULL BUS_CLASSIFICATION,
                           SUBSTR(ERROR_MSG,1,100) ERROR_MESSAGE
                      FROM XX_AP_CLD_SUPPLIERS_STG supp
                     WHERE 1=1
                       AND request_id = :P_REQUEST_ID
                       AND SUPP_PROCESS_FLAG IN (2,3,6) 
                     UNION
                     SELECT 2 SEQ,'Business Classification' ENTITY,
                           SUPPLIER_NAME,
                           NULL SITE,
                           NULL CONTACT,
                           NULL BANK_ACCOUNT,
                           SUPPLIER_NUMBER GLOBAL_NUMBER,
                           CLASSIFICATION BUS_CLASSIFICATION,
                           SUBSTR(ERROR_MSG,1,100) ERROR_MESSAGE
                      FROM XX_AP_CLD_SUPP_BCLS_STG  BCLS
                     WHERE 1=1
                       AND BCLS_PROCESS_FLAG IN (2,3,6)
                       AND request_id = :P_REQUEST_ID
                       UNION
                    SELECT 3 SEQ,'Site, Address, Assignment'|| ' & ' || 'DFF' ENTITY,
                           SUPPLIER_NAME,
                           VENDOR_SITE_CODE SITE,
                           NULL CONTACT,
                           NULL BANK_ACCOUNT,
                          SUPPLIER_NUMBER GLOBAL_NUMBER,
                           NULL BUS_CLASSIFICATION,
                           SUBSTR(ERROR_MSG,1,100) ERROR_MESSAGE
                      FROM XX_AP_CLD_SUPP_SITES_STG SITE
                     WHERE 1=1
                       AND request_id = :P_REQUEST_ID
                       AND SITE_PROCESS_FLAG IN (2,3,6)  
                     UNION
                     
                    SELECT 4 SEQ, 'Custom DFF' ENTITY,
                           SUPPLIER_NAME,
                           VENDOR_SITE_CODE SITE,
                           NULL CONTACT,
                           NULL BANK_ACCOUNT,
                           SUPPLIER_NUMBER GLOBAL_NUMBER,
                           NULL BUS_CLASSIFICATION,
                           SUBSTR(ERROR_MSG,1,100) ERROR_MESSAGE
                      FROM XX_AP_CLD_SITE_DFF_STG DFF
                     WHERE 1=1
                       AND request_id = :P_REQUEST_ID
                       AND DFF_PROCESS_FLAG IN (2,3,6)
                       UNION
                    SELECT 5 SEQ,'Contacts' ENTITY,
                           SUPPLIER_NAME,
                           VENDOR_SITE_CODE SITE,  
                           FIRST_NAME||' '||LAST_NAME CONTACT,
                           NULL BANK_ACCOUNT,
                           SUPPLIER_NUMBER GLOBAL_NUMBER,
                           NULL BUS_CLASSIFICATION,
                           SUBSTR(ERROR_MSG,1,100) ERROR_MESSAGE
                      FROM XX_AP_CLD_SUPP_CONTACT_STG CONTACT
                     WHERE 1=1
                       AND request_id = :P_REQUEST_ID
                       AND CONTACT_PROCESS_FLAG IN (2,3,6)
                     UNION 
                    SELECT 6 SEQ, 'Bank Assignments' ENTITY,
                           SUPPLIER_NAME,
                           VENDOR_SITE_CODE SITE,
                           NULL CONTACT,
                           BRANCH_NAME BANK_ACCOUNT,
                           SUPPLIER_NUM GLOBAL_NUMBER,
                           NULL BUS_CLASSIFICATION,
                           SUBSTR(ERROR_MSG,1,100) ERROR_MESSAGE
                      FROM XX_AP_CLD_SUPP_BNKACT_STG BNKACT
                     WHERE 1=1
                       AND BNKACT_PROCESS_FLAG IN (2,3,6)
                       AND request_id = :P_REQUEST_ID
        				    )
		      ORDER BY GLOBAL_NUMBER,SEQ
]]>
</sqlStatement>
<sqlStatement name="Q3" dataSourceRef="">
<![CDATA[ SELECT  (SELECT FND_PROFILE.VALUE('XX_COMN_SMTP_MAIL_SERVER') 
                     FROM DUAL) SMTP_SERVER,
                  XFTV.TARGET_VALUE1 MAIL_FROM,
				  XFTV.TARGET_VALUE2 MAIL_TO,
				  (SELECT SUBSTR(UPPER(SYS_CONTEXT('USERENV','DB_NAME') ), 4,8)
                     FROM DUAL  ) INSTANCE_NAME,
				  TO_CHAR(SYSDATE,'DD-MON-YYYY') TO_DATE
            FROM  XX_FIN_TRANSLATEDEFINITION XFTD ,
                  XX_FIN_TRANSLATEVALUES XFTV
            WHERE XFTD.translate_id   = xftv.translate_id
              AND XFTD.translation_name = 'XX_AP_CLOUD_SUPP_ERR_RPT'
              AND XFTV.source_value1    = 'SUPPLIER_ERROR_REPORT'
              AND SYSDATE BETWEEN XFTV.start_date_active AND NVL(XFTV.end_date_active, sysdate+1)
              AND SYSDATE BETWEEN XFTD.start_date_active AND NVL(XFTD.end_date_active, sysdate+1)
              AND XFTV.enabled_flag = 'Y'
              AND XFTD.enabled_flag = 'Y'
]]>
</sqlStatement>
</dataQuery>
<dataTrigger name="beforeReport" source="XX_AP_SUPP_CLD_INTF_PKG.beforeReport" /> 
<dataStructure>
<group name="G1" source="Q1" groupFilter="">
	 <element name="ENTITY" value="ENTITY" function=""/>
	 <element name="TOTAL_COUNT" value="TOTAL_COUNT" function=""/>
	 <element name="SUCCESS_COUNT" value="SUCCESS_COUNT" function=""/>
	 <element name="FAILURE_COUNT" value="FAILURE_COUNT" function=""/>
</group>
<group name="G2" source="Q2" groupFilter="">
     <element name="GLOBAL_NUMBER" value="GLOBAL_NUMBER" function=""/>
     <element name="SUPPLIER_NAME"  value="SUPPLIER_NAME" function=""/>
     <element name="SITE"    value="SITE" function=""/>
	 <element name="CONTACT"    value="CONTACT" function=""/>
	 <element name="BANK_ACCOUNT"    value="BANK_ACCOUNT" function=""/>
	 <element name="ENTITY1"    value="ENTITY" function=""/>
	 <element name="BUS_CLASSIFICATION"    value="BUS_CLASSIFICATION" function=""/>
	 <element name="ERROR_MESSAGE"    value="ERROR_MESSAGE" function=""/>
</group>
<group name="G3" source="Q3" groupFilter="">
     <element name="C_SMTP_SERVER" value="SMTP_SERVER" function=""/>
     <element name="C_MAIL_FROM"  value="MAIL_FROM" function=""/>
     <element name="C_MAIL_TO"    value="MAIL_TO" function=""/>
	 <element name="C_INSTANCE_NAME"    value="INSTANCE_NAME" function=""/>
	 <element name="C_TO_DATE"    value="TO_DATE" function=""/>
</group>
</dataStructure>
<dataTrigger name="afterReport" source="XX_AP_SUPP_CLD_INTF_PKG.afterReport"/>

</dataTemplate>
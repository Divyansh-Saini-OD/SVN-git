<dataTemplate name="XXACCEPTINACTIVECC" description="" version="1.0">
  <properties>
    <property name="include_parameters" value="true"/>
  </properties>
  <dataQuery>
    <sqlStatement name="Q1">
       <![CDATA[select MAX(wn.notification_id) notification_id,
wn.item_key ,
wn.message_type ,
WN.MESSAGE_NAME ,
wn.recipient_role,
wn.to_user,
wn.status ,
wn.MAIL_STATUS ,
accta.category ,
papf.full_name ,
PAPF.EMPLOYEE_NUMBER,
WN.SUBJECT,
TO_CHAR(PPFS.ACTUAL_TERMINATION_DATE,'MM/DD/YYYY') ACTUAL_TERMINATION_DATE,
TO_CHAR(ppfs.final_process_date,'MM/DD/YYYY') final_process_date
from wf_notifications wn ,
wf_item_activity_statuses wias ,
wf_item_attribute_values wiav ,
per_all_people_f papf,
per_periods_of_service ppfs,
(SELECT  PERSON_ID ,MAX(PERIOD_OF_SERVICE_ID) Maxperiodos FROM APPS.PER_PERIODS_OF_SERVICE
GROUP BY PERSON_ID) ppfs1,
(SELECT  item_key ,MAX(notification_id) Maxnotificid FROM APPS.wf_notifications
GROUP BY item_key) wn1,
ap_credit_card_trxns_all accta,
ap_cards_all aca
where
wn.notification_id=wn1.Maxnotificid
and wn1.item_key=wn.item_key
AND WN.MESSAGE_TYPE=WIAS.ITEM_TYPE
and wn1.item_key=wias.item_key
and wias.item_key=wiav.item_key
and wias.item_type=wiav.item_type
and papf.employee_number=wiav.text_value
and papf.person_id=aca.employee_id
and accta.card_id=aca.card_id
AND accta.card_program_id=aca.card_program_id
and ppfs.person_id=ppfs1.person_id
and ppfs.period_of_service_id=ppfs1.Maxperiodos
and papf.person_id=ppfs1.person_id
AND WN.MESSAGE_TYPE='APCCARD'
AND WN.STATUS='CLOSED'
AND WIAS.ACTIVITY_STATUS='COMPLETE'
AND WIAS.ACTIVITY_RESULT_CODE='ACCEPT'
AND ACCTA.REPORT_HEADER_ID IS NULL
AND WIAV.NAME='INACT_EMP_NAME'
AND EXISTS
  (SELECT 1
  FROM xx_hr_ps_stg
  WHERE emplid   =papf.employee_number
  AND EMPL_STATUS='T'
  )
  AND NOT EXISTS
  (
select 1 from apps.wf_item_activity_statuses wis1
WHERE
wis1.item_type=wias.item_type
AND
wis1.item_key=wias.item_key
and
ACTIVITY_STATUS='ERROR'
)
GROUP BY WN.NOTIFICATION_ID ,WN.ITEM_KEY , WN.MESSAGE_TYPE , WN.MESSAGE_NAME , WN.RECIPIENT_ROLE ,WN.TO_USER,WN.STATUS, WN.MAIL_STATUS , ACCTA.CATEGORY ,PAPF.FULL_NAME ,
papf.employee_number , wn.subject, accta.report_header_id,ppfs.actual_termination_date,ppfs.final_process_date]]>
    </sqlStatement>
  </dataQuery>
  <dataStructure>
    <group name="G_RESULTS" source="Q1">
       <element name="NOTIFICATION_ID"     value="notification_id"/>
       <element name="ITEM_KEY"   value="item_key"/>
       <element name="MESSAGE_TYPE"       value="message_type"/>
       <element name="RECIPIENT_ROLE"   value="recipient_role"/>
	<element name="TO_USER"   value="to_user"/>
       <element name="STATUS" value="status"/>
       <element name="MAIL_STATUS" value="mail_status"/>
       <element name="CATEGORY"       value="category"/>
       <element name="FULL_NAME" value="full_name"/>
       <element name="EMPLOYEE_NUMBER"     value="employee_number"/>
       <element name="SUBJECT"   value="subject"/>
       <element name="ACTUAL_TERMINATION_DATE"  value="actual_termination_date"/>
       <element name="FINAL_PROCESS_DATE"         value="final_process_date"/>
    </group>
  </dataStructure> 
</dataTemplate>
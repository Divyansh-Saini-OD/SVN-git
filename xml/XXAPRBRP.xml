<?xml version="1.0" encoding="WINDOWS-1252" ?>
<dataTemplate name="XXAPRBRP" description="OD: Customer Rebate Upload Report" Version="1.0">
<parameters>
 <parameter name="p_request_id" datatype="character" />
</parameters>
<dataQuery>
<sqlStatement name="Q_INV">
<![CDATA[
 SELECT a.vendor_no,a.vendor_site_code,supp.vendor_name,a.invoice_num,a.invoice_date,
        DECODE(a.line_number,1,a.invoice_amt,null) inv_amt
        ,a.invoice_amt,a.line_amount
        ,DECODE(a.inv_process_flag,4,'Uploaded','Rejected') status
        ,DECODE(a.inv_process_flag,4,'Loaded into Payable Open Interface',a.error_message) comments
   FROM  xx_ap_bulk_check_invoice_stg a,
         ap_suppliers supp
  WHERE a.request_id = :p_request_id
    AND a.vendor_id = supp.vendor_id(+)
  ORDER BY a.vendor_no,a.vendor_site_code,a.invoice_amt,a.line_number
]]>
</sqlStatement>
<sqlStatement name="Q_COUNT">
<![CDATA[
SELECT NVL(COUNT(count(*)),0) inv_count,
       NVL(SUM(count(*)),0) inv_line_count
 FROM xx_ap_bulk_check_invoice_stg a
WHERE a.request_id = :p_request_id
GROUP BY a.vendor_no,
         a.vendor_site_code,
         a.invoice_amt
]]>
</sqlStatement>
<sqlStatement name="Q_COUNT_AMT">
<![CDATA[
SELECT NVL(SUM(DECODE(a.line_number,1,a.invoice_amt,null)),0) TOTAL_AMT_STAGED 
  FROM xx_ap_bulk_check_invoice_stg a 
 WHERE a.request_id = :p_request_id
]]>
</sqlStatement>
<sqlStatement name="Q_PROCESSED_COUNT">
<![CDATA[
SELECT NVL(count(count(*)),0) processed_inv_count,
       NVL(sum(count(*)),0) processed_line_count
 FROM xx_ap_bulk_check_invoice_stg a
WHERE a.request_id = :p_request_id
  AND a.inv_process_flag = 4
GROUP BY a.vendor_no,a.vendor_site_code,
         a.invoice_amt 
]]>
</sqlStatement>
<sqlStatement name="Q_PROCESSED_COUNT_AMT">
<![CDATA[
SELECT NVL(SUM(DECODE(a.line_number,1,a.invoice_amt,null)),0) TOTAL_PROCESSED_AMT 
  FROM xx_ap_bulk_check_invoice_stg a 
 WHERE a.request_id =  :p_request_id
   AND a.inv_process_flag = 4
]]>
</sqlStatement>
<sqlStatement name="Q_REJECT_COUNT">
<![CDATA[
SELECT NVL(count(count(*)),0) reject_inv_count,
       NVL(sum(count(*)),0) reject_line_count
 FROM xx_ap_bulk_check_invoice_stg a
WHERE a.request_id = :p_request_id
  AND nvl(a.inv_process_flag,1) <> 4
GROUP BY a.vendor_no,a.vendor_site_code,
         a.invoice_amt
]]>
</sqlStatement>
<sqlStatement name="Q_REJECT_COUNT_AMT">
<![CDATA[
SELECT NVL(SUM(DECODE(a.line_number,1,a.invoice_amt,null)),0) TOTAL_REJECT_AMT 
   FROM xx_ap_bulk_check_invoice_stg a 
  WHERE a.request_id = :p_request_id
    AND nvl(a.inv_process_flag,1) <> 4 
]]>
</sqlStatement>
</dataQuery>
<dataStructure>
<group name="G_INV" source="Q_INV">
  <element name="VENDOR_NO" value="VENDOR_NO" />
  <element name="VENDOR_SITE_CODE" value="VENDOR_SITE_CODE" />
  <element name="VENDOR_NAME" value="VENDOR_NAME" />  
  <element name="INVOICE_NUM" value="INVOICE_NUM" />
  <element name="INVOICE_DATE" value="INVOICE_DATE" />
  <element name="INV_AMT" value="INV_AMT" />
  <element name="INVOICE_AMT" value="INVOICE_AMT" />
  <element name="LINE_AMOUNT" value="LINE_AMOUNT" />
  <element name="STATUS" value="STATUS" />
  <element name="COMMENTS" value="COMMENTS" />  
</group>
<group name="G_COUNT" source="Q_COUNT">
<element name="INV_COUNT" value="INV_COUNT" />
<element name="INV_LINE_COUNT" value="INV_LINE_COUNT" />
</group>
<group name="G_COUNT_AMT" source="Q_COUNT_AMT">
<element name="TOTAL_AMT_STAGED" value="TOTAL_AMT_STAGED" />
</group>
<group name="G_PROCESSED_COUNT" source="Q_PROCESSED_COUNT">
<element name="PROCESSED_INV_COUNT" value="PROCESSED_INV_COUNT" />
<element name="PROCESSED_LINE_COUNT" value="PROCESSED_LINE_COUNT" />
</group>
<group name="G_PROCESSED_COUNT_AMT" source="Q_PROCESSED_COUNT_AMT">
<element name="TOTAL_PROCESSED_AMT" value="TOTAL_PROCESSED_AMT" />
</group>
<group name="G_REJECT_COUNT" source="Q_REJECT_COUNT">
<element name="REJECT_INV_COUNT" value="REJECT_INV_COUNT" />
<element name="REJECT_LINE_COUNT" value="REJECT_LINE_COUNT" />
</group>
<group name="G_REJECT_COUNT_AMT" source="Q_REJECT_COUNT_AMT">
<element name="TOTAL_REJECT_AMT" value="TOTAL_REJECT_AMT" />
</group>
</dataStructure>
</dataTemplate>

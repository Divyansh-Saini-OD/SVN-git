<?xml version="1.0" encoding="UTF-8"?>
<dataTemplate name="XXOD_SPC_TRANSACTIONS" defaultPackage="" dataSourceRef="">
	<properties>
		<property name="include_parameters" value="true"/>
		<property name="include_null_Element" value="true"/>
		<property name="db_fetch_size" value="300"/>
	</properties>
	<parameters>
		<parameter name="P_AS_OF_DATE" dataType="varchar2" defaultValue=""/>
		<parameter name="P_NO_OF_DAYS" dataType="number" defaultValue=""/>
		<parameter name="P_OPERATING_UNIT" dataType="number" defaultValue=""/>
		<parameter name="P_ORDER_SOURCE" dataType="varchar2" defaultValue=""/>
        <parameter name="P_SMTP_SERVER" dataType="varchar2" defaultValue=""/>
        <parameter name="P_MAIL_FROM" dataType="varchar2" defaultValue=""/>
        <parameter name="P_MAIL_TO" dataType="varchar2" defaultValue=""/>
        <parameter name="P_MAIL_CC" dataType="varchar2" defaultValue=""/>
	</parameters>
<dataQuery>
<sqlStatement name="Q_DATA" dataSourceRef="">
<![CDATA[ SELECT /*+ parallel(apsa,4) */
       /*+ index(ooha,OE_ORDER_HEADERS_U2) */
       /*+ index(xxoh,XX_OM_HEADER_ATTRIBUTES_U1) */
       /*+ index(hca,HZ_CUST_A CCOUNTS_U1) */
       /*+ index(hcp,HZ_CUSTOMER_PROFILES_N1)*/ 
       hca.account_name                  CUSTOMER_NAME ,
       hca.account_number                CUSTOMER_ACCOUNT_NUMBER, 
       SUBSTR(hca.orig_system_reference,1,INSTR(hca.orig_system_reference,'-')-1)  
                                         AOPS_ACCOUNT_NUMBER,
       oos.name                          ORDER_SOURCE,
       rct.trx_number                    TRANSACTION_NUMBER,
       TRUNC(rct.trx_date)               TRANSACTION_DATE,
       TRUNC(SYSDATE - rct.trx_date)     NUMBER_OF_DAYS_OLD,
       apsa.amount_due_remaining         OPEN_TRANSACTION_AMOUNT,
       hr.name                           OPERATING_UNIT
  from oe_order_headers_all          ooha,
       ra_customer_trx_all           rct,
       ar_payment_schedules_all      apsa,
       oe_order_sources              oos,
       xx_om_header_attributes_all   xxoh,
       hz_cust_accounts              hca,
       hz_customer_profiles          hcp,
       hr_operating_units            hr
WHERE ooha.header_id = TO_NUMBER(rct.attribute14)
  AND rct.customer_trx_id = apsa.customer_trx_id
  AND apsa.class = 'INV' 
  AND apsa.status = 'OP' 
  AND apsa.amount_due_remaining > 0 
  AND ooha.order_source_id = oos.order_source_id
  AND xxoh.header_id = ooha.header_id
  AND hca.cust_account_id = apsa.customer_id  
  AND hcp.cust_account_id = hca.cust_account_id 
  AND hcp.site_use_id IS NULL 
  AND hcp.attribute3 = 'N'
  AND hr.organization_id = rct.org_id
  AND rct.trx_date BETWEEN (TO_DATE(:P_AS_OF_DATE,'DD-MON-RRRR')-:P_NO_OF_DAYS)
                              AND TO_DATE(:P_AS_OF_DATE,'DD-MON-RRRR')
  AND hr.organization_id  = :P_OPERATING_UNIT
  AND ((:P_ORDER_SOURCE IS NULL AND OOS.NAME IN ('XML','CXML','EDI','SPC'))
        OR (:P_ORDER_SOURCE = 'XML' AND OOS.NAME = 'XML')
        OR (:P_ORDER_SOURCE = 'CXML' AND OOS.NAME = 'CXML')
        OR (:P_ORDER_SOURCE = 'EDI' AND OOS.NAME = 'EDI')
        OR (:P_ORDER_SOURCE = 'SPC' AND OOS.NAME = 'SPC')
      )
 ORDER BY hca.account_name,
          rct.trx_number
]]>
</sqlStatement>
<sqlStatement name="Q_DATA1" dataSourceRef="">
<![CDATA[ SELECT (SELECT name from hr_operating_units 
                   WHERE organization_id  = :P_OPERATING_UNIT) OPERATING_UNIT,
                 :P_SMTP_SERVER    SMTP_SERVER,
                 :P_MAIL_FROM      MAIL_FROM,
                  NVL(:P_MAIL_TO,(SELECT SOURCE_VALUE1 FROM XX_FIN_TRANSLATEVALUES
                                   WHERE TRANSLATE_ID = (SELECT TRANSLATE_ID FROM XX_FIN_TRANSLATEDEFINITION
                                                          WHERE TRANSLATION_NAME = 'XX_FIN_SPC_CONFIG')))   MAIL_TO,
                  NVL(:P_MAIL_CC,(SELECT SOURCE_VALUE2  FROM XX_FIN_TRANSLATEVALUES
                                   WHERE TRANSLATE_ID = (SELECT TRANSLATE_ID FROM XX_FIN_TRANSLATEDEFINITION
                                                          WHERE TRANSLATION_NAME = 'XX_FIN_SPC_CONFIG')))   MAIL_CC,
                 :P_AS_OF_DATE     AS_OF_DATE,
                 :P_NO_OF_DAYS     NO_OF_DAYS_OLD
            FROM DUAL
]]>
</sqlStatement>
</dataQuery>
<dataStructure>
<group name="G_DATA" source="Q_DATA" groupFilter="">
	 <element name="C_CUSTOMER_NAME" value="CUSTOMER_NAME" function=""/>
     <element name="C_CUSTOMER_ACCOUNT_NUMBER" value="CUSTOMER_ACCOUNT_NUMBER" function=""/>
	 <element name="C_AOPS_ACCOUNT_NUMBER" value="AOPS_ACCOUNT_NUMBER" function=""/> 
     <element name="C_ORDER_SOURCE" value="ORDER_SOURCE" function=""/>
	 <element name="C_TRANSACTION_NUMBER" value="TRANSACTION_NUMBER" function=""/>
	 <element name="C_TRANSACTION_DATE" value="TRANSACTION_DATE" function=""/>
	 <element name="C_NUMBER_OF_DAYS_OLD" value="NUMBER_OF_DAYS_OLD" function=""/>
	 <element name="C_OPEN_TRANSACTION_AMOUNT" value="OPEN_TRANSACTION_AMOUNT" function=""/>
	 <element name="C_OPERATING_UNIT" value="OPERATING_UNIT" function=""/>
</group>
<group name="G_DATA1" source="Q_DATA1" groupFilter="">
     <element name="C_OPERATING_UNIT" value="OPERATING_UNIT" function=""/>
     <element name="C_SMTP_SERVER" value="SMTP_SERVER" function=""/>
     <element name="C_MAIL_FROM"  value="MAIL_FROM" function=""/>
     <element name="C_MAIL_TO"    value="MAIL_TO" function=""/>
     <element name="C_MAIL_CC"    value="MAIL_CC" function=""/>
     <element name="C_AS_OF_DATE" value="AS_OF_DATE" function=""/>
     <element name="C_NO_OF_DAYS_OLD" value="NO_OF_DAYS_OLD" function=""/>
</group>
</dataStructure>
</dataTemplate>
































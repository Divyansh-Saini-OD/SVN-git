<?xml version="1.0" encoding="WINDOWS-1252" ?>
<dataTemplate name="XXAPRADMC" description="OD AP Receipt After DM Created" Version="1.0">
<dataQuery>
<sqlStatement name="Q_RADC">
<![CDATA[
 SELECT	/*+ LEADING (H) */
    	    A.INVOICE_NUM INVOICE_NUM,
    	    SUP.SEGMENT1 VENDOR_NO,
			REPLACE(SUP.VENDOR_NAME,'&',' ') VENDOR_NAME,
    	    APS.VENDOR_SITE_CODE VENDOR_SITE_CODE,
    	    TO_CHAR(A.GL_DATE,'MM-DD-YYYY') GL_DATE,
    	    L.LINE_NUMBER LINE_NUMBER,
    	    MSI.SEGMENT1 ITEM,
    	    L.AMOUNT AMOUNT,
			L.DESCRIPTION VOUCHER_LINE_DESC,
    	    PH.SEGMENT1 AP_PO_NBR,
    	    POL.QUANTITY  PO_ORD_QTY,
    	    RSH.RECEIPT_NUM RECEIPT_NUM,
    	    TO_CHAR(RSH.CREATION_DATE,'MM/DD/YYYY') RECEIPT_DATE,
    	    RSH.ATTRIBUTE1 SHIP_DATE,
    	    RSL.QUANTITY_RECEIVED QUANTITY_RECEIVED,
       	    POL.UNIT_PRICE PO_PRICE,
    	    (RSL.QUANTITY_RECEIVED*POL.UNIT_PRICE) RECD_AMOUNT
        FROM	
            PO_LINES_ALL POL,
            RCV_SHIPMENT_HEADERS RSH,
            RCV_SHIPMENT_LINES RSL,
            MTL_SYSTEM_ITEMS_B MSI,
            PO_HEADERS_ALL PH,
            AP_SUPPLIERS SUP,
            AP_SUPPLIER_SITES_ALL APS,
            AP_INVOICE_LINES_ALL L,
            AP_INVOICES_ALL A,
    		(SELECT 
    		     XTE.SOURCE_ID_INT_1,
    			 XAH.GL_TRANSFER_DATE
    		 FROM 
    		     XLA_EVENTS XE,
    			 XLA_TRANSACTION_ENTITIES XTE,
    			 XLA_AE_HEADERS XAH
    		 WHERE  
    		     XAH.GL_TRANSFER_DATE BETWEEN SYSDATE-90 AND SYSDATE
    			 AND XAH.APPLICATION_ID=200
    			 AND XE.EVENT_ID=XAH.EVENT_ID
    			 AND XE.APPLICATION_ID=XAH.APPLICATION_ID
    			 AND XE.ENTITY_ID=XAH.ENTITY_ID
    			 AND XTE.APPLICATION_ID=XE.APPLICATION_ID
    			 AND XTE.ENTITY_CODE      = 'AP_INVOICES'
    			 AND XTE.ENTITY_ID=XE.ENTITY_ID
    			 AND XE.EVENT_STATUS_CODE='P'
    			 AND XE.PROCESS_STATUS_CODE='P'
    		 GROUP BY 
    		     XTE.SOURCE_ID_INT_1,XAH.GL_TRANSFER_DATE) H
        WHERE 
    	    A.INVOICE_ID=H.SOURCE_ID_INT_1
    		AND A.INVOICE_NUM LIKE '%DM'
    		AND L.INVOICE_ID			=A.INVOICE_ID
    		AND L.LINE_TYPE_LOOKUP_CODE<>'TAX'
    		AND L.AMOUNT<>0
    		AND A.SOURCE				<>'US_OD_CONSIGNMENT_SALES'
    		AND A.INVOICE_NUM NOT LIKE '%ODDBUIA%'
    		AND A.CANCELLED_DATE IS NULL
    		AND APS.VENDOR_SITE_ID		= A.VENDOR_SITE_ID
    		AND SUP.VENDOR_ID=APS.VENDOR_ID
    		AND PH.PO_HEADER_ID(+)		= NVL(A.PO_HEADER_ID,A.QUICK_PO_HEADER_ID)
    		AND MSI.INVENTORY_ITEM_ID(+)=L.INVENTORY_ITEM_ID
    		AND MSI.ORGANIZATION_ID(+)+0=441
    		AND RSL.PO_HEADER_ID=NVL(A.PO_HEADER_ID,A.QUICK_PO_HEADER_ID)
    		AND RSL.ITEM_ID=L.INVENTORY_ITEM_ID
    		AND RSH.SHIPMENT_HEADER_ID=RSL.SHIPMENT_HEADER_ID
            AND RSH.CREATION_DATE>H.GL_TRANSFER_DATE
    		AND POL.PO_HEADER_ID=NVL(A.PO_HEADER_ID,A.QUICK_PO_HEADER_ID)
    		AND POL.ITEM_ID=L.INVENTORY_ITEM_ID
    		AND POL.CLOSED_CODE='OPEN'
    		AND NOT EXISTS ( SELECT 'X'
    						 FROM AP_INVOICES_ALL
    						 WHERE VENDOR_SITE_ID=A.VENDOR_SITE_ID
    							   AND A.ATTRIBUTE6=A.INVOICE_NUM
    						)
    		AND EXISTS (SELECT 'X'
    					FROM  XX_FIN_TRANSLATEVALUES TV
    						  ,XX_FIN_TRANSLATEDEFINITION TD
    					WHERE TD.TRANSLATION_NAME 	='XX_AP_TR_MATCH_INVOICES'
    					      AND TV.TRANSLATE_ID  		=TD.TRANSLATE_ID
    					      AND TV.ENABLED_FLAG			='Y'
    					      AND SYSDATE BETWEEN TV.START_DATE_ACTIVE AND NVL(TV.END_DATE_ACTIVE,SYSDATE)
    					      AND TV.TARGET_VALUE1		=A.SOURCE
    				    )
    		AND EXISTS ( SELECT 'X'
    					 FROM XX_FIN_TRANSLATEDEFINITION XFTD
    					      ,XX_FIN_TRANSLATEVALUES XFTV
    					      ,AP_SUPPLIER_SITES_ALL SITE
    					 WHERE SITE.VENDOR_SITE_ID     = APS.VENDOR_SITE_ID+0
     					       AND XFTD.TRANSLATION_NAME = 'XX_AP_TRADE_CATEGORIES'
                 			   AND XFTD.TRANSLATE_ID     = XFTV.TRANSLATE_ID
    			  	  	       AND XFTV.TARGET_VALUE1    = SITE.ATTRIBUTE8||''
    						   AND XFTV.ENABLED_FLAG = 'Y'
    						   AND SYSDATE BETWEEN XFTV.START_DATE_ACTIVE AND NVL(XFTV.END_DATE_ACTIVE,SYSDATE)
    					   )
        ORDER BY 1,6
 ]]>
</sqlStatement>
</dataQuery>
<dataStructure>
<group name="G_RADC" source="Q_RADC">
<element name="INVOICE_NUM" value="INVOICE_NUM" />
<element name="VENDOR_NO" value="VENDOR_NO" />
<element name="VENDOR_NAME" value="VENDOR_NAME" />
<element name="VENDOR_SITE_CODE" value="VENDOR_SITE_CODE" />
<element name="GL_DATE" value="GL_DATE" />
<element name="LINE_NUMBER" value="LINE_NUMBER" />
<element name="ITEM" value="ITEM" />
<element name="AMOUNT" value="AMOUNT" />
<element name="VOUCHER_LINE_DESC" value="VOUCHER_LINE_DESC" />
<element name="AP_PO_NBR" value="AP_PO_NBR" />
<element name="PO_ORD_QTY" value="PO_ORD_QTY" />
<element name="RECEIPT_NUM" value="RECEIPT_NUM" />
<element name="RECEIPT_DATE" value="RECEIPT_DATE" />
<element name="SHIP_DATE" value="SHIP_DATE" />
<element name="QUANTITY_RECEIVED" value="QUANTITY_RECEIVED" />
<element name="PO_PRICE" value="PO_PRICE" />
<element name="RECD_AMOUNT" value="RECD_AMOUNT" />
</group>
</dataStructure>
</dataTemplate>

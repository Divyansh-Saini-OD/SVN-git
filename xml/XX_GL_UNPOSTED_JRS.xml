<?xml version="1.0" encoding="UTF-8"?>
<dataTemplate name="XX_GL_UNPOSTED_JRS" defaultPackage="XX_GL_UNPOSTED_JRS" dataSourceRef="">
        <properties>
                <property name="include_parameters" value="true"/>
                <property name="include_null_Element" value="true"/>
                <property name="db_fetch_size" value="300"/>
        </properties>
        <parameters>
                <parameter name="P_SEND_EMAIL" dataType="character" defaultValue="N"/>
                <parameter name="P_SMTP_SERVER" dataType="character" defaultValue=""/>
                <parameter name="P_MAIL_FROM" dataType="character" defaultValue=""/>
        </parameters>
<dataQuery>
<sqlStatement name="Q_EMP" dataSourceRef="">
<![CDATA[
select papf.first_name||' '||papf.last_name employee_name,
       papf_sup.first_name||' '||papf_sup.last_name supervisor,
       papf.EMAIL_ADDRESS  employee_email,
       papf_sup.EMAIL_ADDRESS supvisor_email,
	   papf.employee_number,
	   fu.user_id,
       :P_SMTP_SERVER SMTP_SERVER,
       :P_MAIL_FROM FROM_EMAIL,
	   (select initcap(global_name) from global_name) DB_NAME
  from per_all_assignments_f paaf,per_all_people_f papf,per_all_people_f papf_sup,fnd_user fu
 where paaf.supervisor_id = papf_sup.person_id
   and papf.person_id = paaf.person_id
   and fu.employee_id=papf.person_id
   and sysdate between paaf.EFFECTIVE_START_DATE and paaf.EFFECTIVE_END_DATE
   and sysdate between papf.EFFECTIVE_START_DATE and papf.EFFECTIVE_END_DATE
   and sysdate between papf_sup.EFFECTIVE_START_DATE and papf_sup.EFFECTIVE_END_DATE
   and paaf.PRIMARY_FLAG = 'Y'
   and exists (select 1 from gl_je_headers
                where STATUS     ='U'
                  AND JE_SOURCE IN ('Spreadsheet','Manual')
                  and created_by = fu.user_id
   
   )
]]>
</sqlStatement>
<sqlStatement name="Q_DATA" dataSourceRef="">
<![CDATA[
SELECT gjh.RUNNING_TOTAL_DR,
       gjh.RUNNING_TOTAL_CR,
       gjb.name BATCH_NAME,
       gjh.created_by,
       gjh.NAME JOURNAL_NAME,
       gle.name ledger_name,
       gjh.CURRENCY_CODE,
       gjh.DATE_CREATED,
	   TRUNC(SYSDATE)-TRUNC(gjh.DATE_CREATED) Due
 FROM gl_je_batches gjb,
     gl_je_headers gjh,
	 gl_ledgers gle
WHERE gjb.je_batch_id = gjh.je_batch_id
  AND gjh.STATUS     ='U'
  AND gjh.JE_SOURCE IN ('Spreadsheet','Manual')
  AND gle.ledger_id =gjh.ledger_id
  AND gjh.created_by =:USER_ID
  ORDER BY Due DESC,gjh.DATE_CREATED DESC
]]>
</sqlStatement>
</dataQuery>
<link name="DtLink" parentQuery="Q_EMP" parentColumn="USER_ID" childQuery="Q_DATA" childColumn="created_by">
</link>
<dataTrigger name ="afterReport" source="XX_GL_UNPOSTED_JRS.after_report">
</dataTrigger>
<dataStructure>
<group name="G_EMP" source="Q_EMP" groupFilter="">
	 <element name="EMPLOYEE_NAME" value="EMPLOYEE_NAME" function=""/>
	 <element name="SUPERVISOR" value="SUPERVISOR" function=""/>
	 <element name="EMP_EMAIL" value="EMPLOYEE_EMAIL" function=""/>
	 <element name="SUP_EMAIL" value="SUPVISOR_EMAIL" function=""/>
	 <element name="EMPLOYEE_NUMBER" value="EMPLOYEE_NUMBER" function=""/>
	<element name="USER_ID" value="USER_ID" function=""/>
	<element name="SMTP_SERVER" value="SMTP_SERVER" function=""/>
	<element name="FROM_EMAIL" value="FROM_EMAIL" function=""/>
    <element name="DB_NAME" value="DB_NAME" function=""/>
	<group name="G_DATA" source="Q_DATA" groupFilter="">  
		<element name="RUNNING_TOTAL_DR" value="RUNNING_TOTAL_DR" function=""/>
		<element name="RUNNING_TOTAL_CR" value="RUNNING_TOTAL_CR" function=""/>
		<element name="BATCH_NAME" value="BATCH_NAME" function=""/>
		<element name="JOURNAL_NAME" value="JOURNAL_NAME" function=""/>
		<element name="LEDGER_NAME" value="LEDGER_NAME" function=""/>
		<element name="CURRENCY_CODE" value="CURRENCY_CODE" function=""/>
		<element name="DATE_CREATED" value="DATE_CREATED" function=""/>
		<element name="DUE" value="DUE" function=""/>
</group>
</group>
</dataStructure>
</dataTemplate>

<?xml version="1.0" encoding="WINDOWS-1252" ?>
<dataTemplate name="XXHRCRMPOSTEXE" description="OD: HR CRM PostExec" Version="1.0">
<parameters>
 <parameter name="P_PERSON_ID" dataType="character" /> 
</parameters>
<dataQuery>
<sqlStatement name="Q_RES_LOAD_CNT">
<![CDATA[
SELECT count(*)  RES_LOAD_CNT
FROM   jtf_rs_resource_extns JRRE
START WITH JRRE.source_id = :P_PERSON_ID
CONNECT BY PRIOR JRRE.source_id = JRRE.source_mgr_id
AND JRRE.category = 'EMPLOYEE'
and sysdate between start_date_active and nvl(end_date_active,sysdate)                                 
]]>
</sqlStatement>
<sqlStatement name="Q_RES_VALID_ROLE_CNT">
<![CDATA[
SELECT  count(*) RES_VALID_ROLE_CNT
FROM    jtf_rs_resource_extns jrre
WHERE   EXISTS    
          (SELECT 1     
	   FROM JTF_RS_ROLE_RELATIONS JRRR        
	       , JTF_RS_ROLES_B JRRB     
           WHERE jrrr.role_resource_id = jrre.resource_id     
           AND   jrrr.role_id = jrrb.role_id     
           AND    SYSDATE BETWEEN jrrr.start_date_active AND  NVL(jrrr.end_date_active,sysdate)    
           AND   jrrr.delete_flag  = 'N'    
          )
AND  SYSDATE BETWEEN jrre.start_date_active AND   NVL(jrre.end_date_active,sysdate)		  
START WITH jrre.source_id = :P_PERSON_ID    
CONNECT BY PRIOR jrre.source_id = jrre.source_mgr_id                                 
]]>
</sqlStatement>
<sqlStatement name="Q_MGR_LAOD_CNT">
<![CDATA[
SELECT count(*) MGR_LAOD_CNT
FROM  JTF_RS_RESOURCE_EXTNS JRRE
WHERE jrre.category = 'EMPLOYEE'
AND SYSDATE BETWEEN start_date_active AND nvl(end_date_active,SYSDATE)
AND EXISTS
(SELECT 1
 FROM JTF_RS_ROLE_RELATIONS JRRR
    , JTF_RS_ROLES_B JRRB
WHERE jrrr.role_resource_id = jrre.resource_id
AND jrrr.role_id = jrrb.role_id
AND jrrb.role_type_code IN ('SALES','SALES_COMP','COLLECTIONS')
AND NVL(JRRB.active_flag,'N') = 'Y'
AND jrrb.manager_flag = 'Y'
AND jrrr.delete_flag = 'N'
)
START WITH jrre.source_id = :P_PERSON_ID
CONNECT BY PRIOR jrre.source_id = jrre.source_mgr_id                                  
]]>
</sqlStatement>
<sqlStatement name="Q_ADMIN_LOAD_CNT">
<![CDATA[
SELECT count(*) ADMIN_LOAD_CNT
FROM   JTF_RS_RESOURCE_EXTNS JRRE
WHERE jrre.category = 'EMPLOYEE'
AND SYSDATE BETWEEN start_date_active AND nvl(end_date_active,SYSDATE)
AND  EXISTS
(SELECT 1
 FROM JTF_RS_ROLE_RELATIONS JRRR
    , JTF_RS_ROLES_B JRRB
WHERE jrrr.role_resource_id = jrre.resource_id
AND jrrr.role_id = jrrb.role_id
AND jrrb.role_type_code IN ('SALES','COLLECTIONS')
AND NVL(JRRB.active_flag,'N') = 'Y'
AND jrrb.admin_flag = 'Y'
AND jrrr.delete_flag = 'N'
)
START WITH jrre.source_id = :P_PERSON_ID
CONNECT BY PRIOR jrre.source_id = jrre.source_mgr_id	                                  
]]>
</sqlStatement>
<sqlStatement name="Q_SALES_COMP_ANA_LOAD_CNT">
<![CDATA[
SELECT COUNT(*) SALES_COMP_ANA_LOAD_CNT
FROM  JTF_RS_RESOURCE_EXTNS JRRE
WHERE jrre.category = 'EMPLOYEE'
AND SYSDATE BETWEEN start_date_active AND nvl(end_date_active,SYSDATE)
AND EXISTS
(SELECT 1
 FROM JTF_RS_ROLE_RELATIONS JRRR
    , JTF_RS_ROLES_B JRRB
WHERE jrrr.role_resource_id = jrre.resource_id
AND   jrrr.role_id = jrrb.role_id
AND NVL(JRRB.active_flag,'N') = 'Y'
AND   jrrb.role_type_code IN ('SALES_COMP_PAYMENT_ANALIST')
AND   jrrr.delete_flag = 'N'
)
START WITH jrre.source_id = :P_PERSON_ID
CONNECT BY PRIOR jrre.source_id = jrre.source_mgr_id	                                  
]]>
</sqlStatement>
<sqlStatement name="Q_GROUP_LOAD_CNT">
<![CDATA[
SELECT count(*) GROUP_LOAD_CNT
FROM   JTF_RS_GROUPS_VL JRGV
WHERE  jrgv.attribute15 IN
(SELECT  source_id
 FROM    JTF_RS_RESOURCE_EXTNS JRRE
 WHERE   jrre.category    = 'EMPLOYEE'
 AND SYSDATE BETWEEN start_date_active AND nvl(end_date_active,SYSDATE)
START WITH jrre.source_id = :P_PERSON_ID
CONNECT BY PRIOR jrre.source_id = jrre.source_mgr_id
)
]]>
</sqlStatement>
<sqlStatement name="Q_GROUP_MEMBER_CNT">
<![CDATA[
SELECT count(*) MEM_CNT_EACH_GRP, JRGM.group_id GROUP_ID,JRGV.group_name GROUP_NAME
FROM   JTF_RS_GROUP_MEMBERS JRGM
      ,jtf_rs_groups_vl JRGV
WHERE  JRGM.group_id    = JRGV.group_id	  
AND    JRGM.delete_flag = 'N'
AND    jrgv.attribute15 IN
(SELECT  source_id
 FROM    JTF_RS_RESOURCE_EXTNS JRRE
 WHERE   jrre.category    = 'EMPLOYEE'
 AND SYSDATE BETWEEN start_date_active AND NVL(end_date_active,SYSDATE)
 AND EXISTS 
(SELECT 1
 FROM   JTF_RS_ROLE_RELATIONS JRRR
      , JTF_RS_ROLES_B JRRB
 WHERE  jrrr.role_resource_id = jrre.resource_id
 AND    jrrr.role_id = jrrb.role_id
 AND    jrrb.role_type_code in ('SALES', 'SALES_COMP', 'SALES_COMP_PAYMENT_ANALIST','COLLECTIONS')
 AND    NVL(JRRB.active_flag,'N') = 'Y'
 AND    jrrb.manager_flag = 'Y'
 AND    jrrr.delete_flag  = 'N'
)
START WITH jrre.source_id =:P_PERSON_ID
CONNECT BY PRIOR jrre.source_id = jrre.source_mgr_id
)
GROUP BY jrgm.group_id,jrgv.group_name                     
]]>
</sqlStatement>
<sqlStatement name="Q_SALSUPPRT_SREP_CNT">
<![CDATA[
SELECT count(*) SALSUPPRT_SREP_CNT
FROM   jtf_rs_resource_extns JRRE
WHERE   JRRE.category = 'EMPLOYEE'
AND SYSDATE BETWEEN start_date_active AND NVL(end_date_active,SYSDATE)
AND  EXISTS
        (SELECT 1
         FROM   jtf_rs_role_relations JRRR
              , jtf_rs_roles_b JRRB
         WHERE  JRRR.role_resource_id = JRRE.resource_id
         AND    JRRR.role_id = JRRB.role_id
         AND    JRRB.role_type_code IN ('SALES','SALES_COMP')
		 AND    NVL(JRRB.active_flag,'N') = 'Y'    
         AND    JRRB.attribute14 = 'SALES_SUPPORT'
         AND    JRRR.delete_flag = 'N'
        )       
START WITH JRRE.source_id = :P_PERSON_ID
CONNECT BY PRIOR JRRE.source_id = JRRE.source_mgr_id                        
]]>
</sqlStatement>
<sqlStatement name="Q_GRP_HIER_CNT">
<![CDATA[
SELECT count(*) GRP_HIER_CNT
FROM   jtf_rs_grp_relations  
START WITH related_group_id =
			(select group_id
			from    jtf_rs_groups_vl
			where   attribute15 = :P_PERSON_ID
			)
CONNECT BY PRIOR group_id = related_group_id
AND    relation_type = 'PARENT_GROUP' 
AND    delete_flag   = 'N'    	
and sysdate between start_date_active and nvl(end_date_active,sysdate)                      
]]>
</sqlStatement>
<sqlStatement name="Q_TERMIN_RES_CNT">
<![CDATA[
SELECT COUNT(*) TERMIN_RES_CNT
FROM   PER_ALL_ASSIGNMENTS_F PAAF
     , PER_ALL_PEOPLE_F PAPF
	 , per_periods_of_service PPOS
     , per_person_types       PPT
WHERE papf.person_id = paaf.person_id 
AND   PAPF.person_id = PPOS.person_id
AND   PPT.person_type_id = PAPF.person_type_id
AND     PPOS.actual_termination_date    = TRUNC (sysdate)
AND    (PPT.system_person_type          = 'EMP'
OR      PPT.system_person_type          = 'CWK')
AND EXISTS
(
SELECT 1
FROM   JTF_RS_ROLES_B JRRB
     , JTF_RS_JOB_ROLEs JRJR
WHERE jrjr.job_id = paaf.job_id
AND jrjr.role_id = jrrb.role_id
AND jrrb.role_type_code in ('SALES','SALES_COMP','SALES_COMP_PAYMENT_ANALIST','COLLECTIONS')
)
AND EXISTS
(
SELECT 1
FROM   JTF_RS_RESOURCE_EXTNS JRRE
WHERE  jrre.source_id = paaf.person_id
AND    jrre.category = 'EMPLOYEE'
AND    jrre.source_id= ppos.person_id
AND    jrre.end_date_active = ppos.actual_termination_date
)
START WITH paaf.person_id = :P_PERSON_ID
CONNECT BY PRIOR paaf.person_id = paaf.supervisor_id                   
]]>
</sqlStatement>
</dataQuery>
<dataStructure>
<group name="G_RES_LOAD_CNT" source="Q_RES_LOAD_CNT">
<element name="RES_LOAD_CNT" value="RES_LOAD_CNT" />
</group>
<group name="G_RES_VALID_ROLE_CNT" source="Q_RES_VALID_ROLE_CNT">
<element name="RES_VALID_ROLE_CNT" value="RES_VALID_ROLE_CNT" />
</group>
<group name="G_MGR_LAOD_CNT" source="Q_MGR_LAOD_CNT">
<element name="MGR_LAOD_CNT" value="MGR_LAOD_CNT" />
</group>
<group name="G_ADMIN_LOAD_CNT" source="Q_ADMIN_LOAD_CNT">
<element name="ADMIN_LOAD_CNT" value="ADMIN_LOAD_CNT" />
</group>
<group name="G_SALES_COMP_ANA_LOAD_CNT" source="Q_SALES_COMP_ANA_LOAD_CNT">
<element name="SALES_COMP_ANA_LOAD_CNT" value="SALES_COMP_ANA_LOAD_CNT" />
</group>
<group name="G_GROUP_LOAD_CNT" source="Q_GROUP_LOAD_CNT">
<element name="GROUP_LOAD_CNT" value="GROUP_LOAD_CNT" />
</group>
<group name="G_GROUP_MEMBER_CNT" source="Q_GROUP_MEMBER_CNT">
<element name="MEM_CNT_EACH_GRP" value="MEM_CNT_EACH_GRP" />
<element name="GROUP_ID" value="GROUP_ID" />
<element name="GROUP_NAME" value="GROUP_NAME" />
</group>
<group name="G_SALSUPPRT_SREP_CNT" source="Q_SALSUPPRT_SREP_CNT">
<element name="SALSUPPRT_SREP_CNT" value="SALSUPPRT_SREP_CNT" />
</group>
<group name="G_GRP_HIER_CNT" source="Q_GRP_HIER_CNT">
<element name="GRP_HIER_CNT" value="GRP_HIER_CNT" />
</group>
<group name="G_TERMIN_RES_CNT" source="Q_TERMIN_RES_CNT">
<element name="TERMIN_RES_CNT" value="TERMIN_RES_CNT" />
</group>
</dataStructure>
</dataTemplate>


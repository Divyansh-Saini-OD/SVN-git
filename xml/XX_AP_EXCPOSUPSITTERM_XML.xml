<?xml version="1.0" encoding="UTF-8"?>
<dataTemplate name="XX_AP_EXCPOSUPSITTERM_XML"   defaultPackage="XX_AP_EXCPOSUPSITETERM_PKG"  Version="1.0">
<parameters>
  <parameter name="P_START_DATE" dataType="date" /> 
   <parameter name="P_END_DATE" dataType="date" /> 
  </parameters>
 <dataQuery>
  <sqlStatement name="Q1">
 <![CDATA[ SELECT :G_SMTP_SERVER SMTP_SERVER,
   :G_EMAIL_SUBJECT EMAIL_SUBJECT, :G_EMAIL_CONTENT EMAIL_CONTENT, :G_DISTRIBUTION_LIST DISTRIBUTION_LIST from dual]]> 
</sqlStatement>
 <sqlStatement name="Q2">
 <![CDATA[SELECT APS.VENDOR_NAME GLOBAL_SUP,
  PHI.VENDOR_SITE_CODE SITE_NAME,
  PHI.DOCUMENT_NUM PO_NUMBER,
  APT.name PO_TERM_NAME,
  APT2.name SITE_TERM_NAME,
  PIE.ERROR_MESSAGE ERR_CD,
  TO_CHAR(PHI.CREATION_DATE,'MM/DD/YYYY') CREATION_DATE
FROM PO_HEADERS_INTERFACE PHI,
  AP_TERMS APT,
  AP_TERMS APT2,
  AP_SUPPLIER_SITES_ALL ASSA,
  AP_SUPPLIERS APS,
  PO_INTERFACE_ERRORS PIE
WHERE TRUNC(PHI.LAST_UPDATE_DATE) BETWEEN :P_START_DATE AND :P_END_DATE
AND PHI.INTERFACE_HEADER_ID = PIE.INTERFACE_HEADER_ID
AND PIE.TABLE_NAME          = 'PO_HEADERS_INTERFACE'
AND APS.VENDOR_ID           = ASSA.VENDOR_ID
AND ASSA.VENDOR_SITE_ID     = PHI.VENDOR_SITE_ID
AND PHI.TERMS_ID            = APT.TERM_ID
AND ASSA.TERMS_ID(+)        = APT2.TERM_ID
AND NVL(ASSA.TERMS_ID,0)   <> PHI.TERMS_ID
AND UPPER(ASSA.attribute8) IN
  (SELECT UPPER (XFTV.TARGET_VALUE1)
  FROM xx_fin_translatedefinition xftd,
    xx_fin_translatevalues xftv
  WHERE xftd.translation_name = 'XX_AP_TRADE_CATEGORIES'
  AND xftd.translate_id       = xftv.translate_id
  AND xftv.enabled_flag       = 'Y'
  AND SYSDATE BETWEEN xftv.start_date_active AND NVL(xftv.end_date_active,sysdate)
  )
UNION ALL
SELECT APS.VENDOR_NAME GLOBAL_SUP,
  ASSA.VENDOR_SITE_CODE SITE_NAME,
  PHA.SEGMENT1 PO_NUMBER,
  APT.name PO_TERM_NAME,
  APT2.name SITE_TERM_NAME ,
  'PO Supplier Term does not match with Vendor Supplier Site Term ' ERR_CD,
  TO_CHAR(PHA.CREATION_DATE,'MM/DD/YYYY') CREATION_DATE
FROM PO_HEADERS_ALL PHA,
  AP_SUPPLIER_SITES_ALL ASSA,
  AP_SUPPLIERS APS,
  AP_TERMS APT,
  AP_TERMS APT2
WHERE TRUNC(PHA.LAST_UPDATE_DATE) BETWEEN :P_START_DATE AND :P_END_DATE
AND PHA.VENDOR_ID           = ASSA.VENDOR_ID
AND PHA.VENDOR_SITE_ID      = ASSA.VENDOR_SITE_ID
AND ASSA.VENDOR_ID          = APS.VENDOR_ID
AND PHA.TERMS_ID            = APT.TERM_ID
AND ASSA.TERMS_ID           = APT2.TERM_ID
AND PHA.TERMS_ID           <> ASSA.TERMS_ID
AND UPPER(ASSA.attribute8) IN
  (SELECT UPPER (XFTV.TARGET_VALUE1)
  FROM xx_fin_translatedefinition xftd,
    xx_fin_translatevalues xftv
  WHERE xftd.translation_name = 'XX_AP_TRADE_CATEGORIES'
  AND xftd.translate_id       = xftv.translate_id
  AND xftv.enabled_flag       = 'Y'
  AND SYSDATE BETWEEN xftv.start_date_active AND NVL(xftv.end_date_active,sysdate)
  ) ]]> 
</sqlStatement>
  </dataQuery>
<dataTrigger name="beforeReport" source="XX_AP_EXCPOSUPSITETERM_PKG.beforeReport()"/>
 <dataStructure>
  <group name="G_EMAIL_DETAILS" source="Q1">
 <element name="SMTP_SERVER" value= "SMTP_SERVER" />
 <element name="EMAIL_SUBJECT" value= "EMAIL_SUBJECT" />
 <element name="EMAIL_CONTENT" value= "EMAIL_CONTENT" />
 <element name="DISTRIBUTION_LIST" value= "DISTRIBUTION_LIST" />
  <group name="G_EXCPOSUPSITTERM_LINES" source="Q2">
  <element name="GLOBAL_SUP" value="GLOBAL_SUP" /> 
  <element name="VENDOR_SITE_CODE" value="SITE_NAME"/>
  <element name="PO_NUMBER" value="PO_NUMBER" />
  <element name="PO_TERM_NAME" value="PO_TERM_NAME" /> 
  <element name="SITE_TERM_NAME" value="SITE_TERM_NAME"/> 
  <element name="ERR_CD" value="ERR_CD" />
  <element name="CREATION_DATE" value="CREATION_DATE" />
</group>
</group>
</dataStructure>
  <dataTrigger name="afterReport"  source="XX_AP_EXCPOSUPSITETERM_PKG.afterReport()"/>
</dataTemplate> 
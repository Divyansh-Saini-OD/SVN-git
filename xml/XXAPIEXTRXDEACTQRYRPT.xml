<?xml version="1.0" encoding="WINDOWS-1252" ?>
<dataTemplate name="XXAPIEXTRXDEACTQRYRPT" description="OD: Credit Card Transactions Deactivation Query Report" defaultPackage="" Version="1.0">
<properties>
   <property name="include_parameters" value="true" />
   <property name="xml_tag_case" value="as_are" /> 
</properties>
<parameters>
 <parameter name="p_empl_name" datatype="character" />
 <parameter name="p_empl_num" datatype="character" />
 <parameter name="p_card_num" datatype="character" />
 <parameter name="p_start_date" datatype="character" />
 <parameter name="p_end_date" datatype="character" />
 <parameter name="p_amount_from" datatype="number" />
 <parameter name="p_amount_to" datatype="number" />
</parameters>
<dataQuery>
<sqlStatement name="Q_DEACT">
<![CDATA[
SELECT emp.full_name C_FULL_NAME
  ,emp.employee_num  C_EMPLOYEE_NUM
  ,icc.masked_cc_number C_TRX_CARD_NUMBER
  ,txn.posted_date C_TRX_POSTED_DATE
  ,txn.transaction_amount C_TRX_AMOUNT
  ,txn.merchant_name1 C_MERCHANT_NAME
  ,vendor.vendor_name C_VENDOR_NAME
  ,txn.last_update_date C_LAST_UPDATE_DATE
FROM per_employees_x emp,
  ap_cards_all card,
  ap_credit_card_trxns_all txn,
  po_vendors vendor,
  ap_card_programs_all card_prog,
  iby_creditcard icc
WHERE txn.transaction_amount BETWEEN NVL(:p_amount_from, txn.transaction_amount) AND NVL(:p_amount_to,txn.transaction_amount)
AND txn.posted_date BETWEEN (NVL(fnd_date.canonical_to_date(:p_start_date), txn.posted_date-1)) AND (NVL(fnd_date.canonical_to_date(:p_end_date), txn.posted_date))  
AND txn.card_id = nvl(:p_card_num, txn.card_id)
AND txn.report_header_id   =  -1
AND txn.category           ='DEACTIVATED'
AND card.card_program_id   = txn.card_program_id
AND card.card_id           = txn.card_id 
AND card.employee_id(+)    = emp.employee_id
AND emp.employee_id        = NVL(:p_empl_name,emp.employee_id)
AND emp.employee_id        = NVL(:p_empl_num,emp.employee_id)
AND card.card_program_id   = card_prog.card_program_id
AND card_prog.vendor_id    = vendor.vendor_id
AND txn.org_id             = card_prog.org_id
AND card.card_reference_id = icc.instrid
ORDER BY emp.full_name,
  icc.masked_cc_number ,
  txn.posted_date]]>
</sqlStatement>
</dataQuery>
<dataStructure>
<group name="G_TOTAL" source="Q_DEACT">
<element name="TOTAL_TRX_AMOUNT" value="G_DEACT.C_TRX_AMOUNT" function="SUM()"/>
<group name="G_DEACT" source="Q_DEACT">
<element name="C_FULL_NAME" value="C_FULL_NAME" />
<element name="C_EMPLOYEE_NUM" value="C_EMPLOYEE_NUM" />
<element name="C_TRX_CARD_NUMBER" value="C_TRX_CARD_NUMBER" />
<element name="C_TRX_POSTED_DATE" value="C_TRX_POSTED_DATE" />
<element name="C_TRX_AMOUNT" value="C_TRX_AMOUNT" />
<element name="C_MERCHANT_NAME" value="C_MERCHANT_NAME" />
<element name="C_VENDOR_NAME" value="C_VENDOR_NAME" />
<element name="C_LAST_UPDATE_DATE" value="C_LAST_UPDATE_DATE" />
</group>
</group>
</dataStructure>
</dataTemplate>
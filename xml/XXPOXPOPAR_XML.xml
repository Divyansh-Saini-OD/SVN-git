<?xml version="1.0" encoding="UTF-8" ?>
<!-- $Header: POXPOPAR_XML.xml 120.1.12010000.6 2011/05/13 22:54:21 yawang ship $ -->
<!-- dbdrv: exec java oracle/apps/xdo/oa/util XDOLoader.class java &phase=dat checkfile:~PROD:patch/115/publisher/defs:POXPOPAR_XML.xml UPLOAD -DB_USERNAME &un_apps -DB_PASSWORD &pw_apps -JDBC_CONNECTION &jdbc_db_addr -LOB_TYPE DATA_TEMPLATE -APPS_SHORT_NAME ~PROD -LOB_CODE POXPOPAR_XML -LANGUAGE 00 -XDO_FILE_TYPE XML-DATA-TEMPLATE -FILE_NAME &fullpath:~PROD:patch/115/publisher/defs:POXPOPAR_XML.xml -->
<!-- GSCC_Category="Xdo Data Definition" -->

<dataTemplate name="XXPOXPOPAR" defaultPackage="XXPO_POXPOPAR_XMLP_PKG" version="1.0">
<properties>
<property name="xml_tag_case" value="upper" />
</properties>
<parameters>
<parameter name="P_TITLE" dataType = "character"></parameter>
<parameter name="P_CONC_REQUEST_ID" dataType = "number" defaultValue="0"></parameter>
<parameter name="P_QTY_PRECISION" dataType = "number" defaultValue="0"></parameter>
<parameter name="P_COMPANY_FROM" dataType = "character"></parameter>
<parameter name="P_COMPANY_TO" dataType = "character"></parameter>
<parameter name="P_COSTCENTER_FROM" dataType = "character"></parameter>
<parameter name="P_COSTCENTER_TO" dataType = "character"></parameter>
<parameter name="P_ORDERBY" dataType = "character"></parameter>
<parameter name="P_ITEM_STRUCT_NUM" dataType = "character" defaultValue="101"></parameter>
<parameter name="P_FLEX_ITEM" dataType = "character" defaultValue="(MSI.SEGMENT1||&apos;\n&apos;||MSI.SEGMENT2||&apos;\n&apos;||MSI.SEGMENT3||&apos;\n&apos;||MSI.SEGMENT4||&apos;\n&apos;||MSI.SEGMENT5||&apos;\n&apos;||MSI.SEGMENT6||&apos;\n&apos;||MSI.SEGMENT7||&apos;\n&apos;||MSI.SEGMENT8||&apos;\n&apos;||MSI.SEGMENT9||&apos;\n&apos;||MSI.SEGMENT10||&apos;\n&apos;||MSI.SEGMENT11||&apos;\n&apos;||MSI.SEGMENT12||&apos;\n&apos;||MSI.SEGMENT13||&apos;\n&apos;||MSI.SEGMENT14||&apos;\n&apos;||MSI.SEGMENT15||&apos;\n&apos;||MSI.SEGMENT16||&apos;\n&apos;||MSI.SEGMENT17||&apos;\n&apos;||MSI.SEGMENT18||&apos;\n&apos;||MSI.SEGMENT19||&apos;\n&apos;||MSI.SEGMENT20)"></parameter>
<parameter name="P_PO_TYPE" dataType = "character"></parameter>
<!--parameter name="P_ORDERBY_DISPLAYED" dataType = "character"></parameter-->
<!--parameter name="WHERE_CLAUSE" dataType = "character" defaultValue="1=1"></parameter-->
</parameters>
<lexicals>
<lexical type ="oracle.apps.fnd.flex.kff.select"  name ="C_FLEX_ITEM_DISP" application_short_name="INV" id_flex_code="MSTK" id_flex_num="101" multiple_id_flex_num="N" code_combination_table_alias="MSI" segments="ALL" show_parent_segments="Y" output_type="VALUE" />
</lexicals>
<dataQuery>
<sqlStatement name="Q_company">
<![CDATA[
SELECT   --gsb.name                      c_company
		 gl.name                      	 c_company
,        fsp.inventory_organization_id 	 c_organization_id
--,        gsb.currency_code             GL_CURRENCY
,        gl.currency_code             	 GL_CURRENCY
--,        gsb.chart_of_accounts_id      STRUCTURE_ACC
,        gl.chart_of_accounts_id      	 STRUCTURE_ACC
,        mdv.structure_id              	 STRUCTURE_CAT
,        fc.precision                    C_CURRENCY_PRECISION  
,        mdv.category_set_id             c_category_set_id
,        flo1.meaning                  	 c_yes
,        flo2.meaning                    c_no
,        fsa1.application_column_name    c_cost_center
,        fsa2.application_column_name    c_company_name
FROM     --gl_sets_of_books            gsb					--Commented/Added by Shruthi on 10-Sept-13 for R12 Retrofit
		 gl_ledgers              	   gl
,        financials_system_parameters  fsp
,        mtl_default_sets_view         mdv
,        fnd_lookups                   flo1
,        fnd_lookups                   flo2
,        fnd_segment_attribute_values  fsa1
,        fnd_segment_attribute_values  fsa2
,        fnd_currencies	               fc
WHERE    --gsb.set_of_books_id         = fsp.set_of_books_id   --Commented/Added by Shruthi on 10-Sept-13 for R12 Retrofit
		 gl.ledger_id                  = fsp.set_of_books_id
AND      mdv.functional_area_id        = 2
AND      flo1.lookup_type              = 'YES_NO'
AND      flo1.lookup_code              = 'Y'
AND      flo2.lookup_type              = 'YES_NO'
AND      flo2.lookup_code              = 'N'
AND      fsa1.id_flex_code             = 'GL#'
--AND      fsa1.id_flex_num            = gsb.chart_of_accounts_id
AND      fsa1.id_flex_num              = gl.chart_of_accounts_id
AND      fsa1.segment_attribute_type   = 'FA_COST_CTR'
AND      fsa1.attribute_value          = 'Y'
AND      fsa2.id_flex_code             = 'GL#'
--AND      fsa2.id_flex_num            = gsb.chart_of_accounts_id
AND      fsa2.id_flex_num              = gl.chart_of_accounts_id
AND      fsa2.segment_attribute_type   = 'GL_BALANCING'
AND      fsa2.attribute_value          = 'Y'
--AND      fc.currency_code            = gsb.currency_code
AND      fc.currency_code              = gl.currency_code
]]>
</sqlStatement><sqlStatement name="Q_cost_centre">
<![CDATA[
SELECT   distinct(&company_name_lex||&cost_center_lex||poh.currency_code)
,        &company_name_lex               Company_Q2
,        &cost_center_lex                Cost_Center_Q2
,        poh.currency_code           C_CURRENCY, 
	XXPO_POXPOPAR_XMLP_PKG.round_amount_list_subtotal_rep(:C_AMOUNT_OPEN_INV_SUM, :C_CURRENCY_PRECISION) C_AMOUNT_OPEN_INV_SUM_RND
FROM     po_headers                  poh
,        po_lines                    pol
,        po_line_locations           pll
,        po_distributions            pod
,        gl_code_combinations        glcc
WHERE    poh.po_header_id            = pol.po_header_id
&lp_po_type  
AND      pol.po_line_id              = pll.po_line_id
AND      pll.line_location_id        = pod.line_location_id
AND      glcc.chart_of_accounts_id   = :STRUCTURE_ACC
AND      pod.code_combination_id     = glcc.code_combination_id
AND      nvl(poh.closed_code,'OPEN') not in ('CLOSED', 'FINALLY CLOSED')
AND      nvl(pll.closed_code,'OPEN') not in ('CLOSED', 'FINALLY CLOSED')
AND      nvl(pol.closed_code,'OPEN') not in ('CLOSED', 'FINALLY CLOSED')
AND      nvl(pll.cancel_flag,'N') = 'N'
AND      nvl(pol.cancel_flag,'N') = 'N'
AND      nvl(poh.cancel_flag,'N') = 'N'
AND      poh.type_lookup_code        in ('STANDARD','BLANKET','PLANNED')
and  &where_clause
ORDER BY &orderby_clause
]]>
</sqlStatement><sqlStatement name="Q_po">
<![CDATA[
SELECT   distinct(pol.line_num)        Line
--,        decode(por.release_num,NULL, poh.segment1, poh.segment1 ||'-'|| por.release_num)       PO_Number_Release
,        decode(por.release_num,NULL, poh.segment1, poh.segment1 ||''|| '') PO_Number_Release --Commented/Added by Veronica for 11i changes  
--,        pov.vendor_name                     Vendor                       --Commented/Added by Ramya Kuttappa on 30-Aug-13 for R12 Retrofit
,        aps.vendor_name                       Vendor
--,        null                       		   C_FLEX_ITEM 
,        msik.concatenated_segments            C_FLEX_ITEM                  -- Commented/Added by Veronica for 11i PROD changes
,        pol.item_revision                     Rev
,        pol.item_description                  Description
,        poh.po_header_id
,        pol.po_line_id
,        &company_name_lex                     Company_name_Q3
,        &cost_center_lex                      Cost_Center_Q3
,        poh.currency_code                     C_CURRENCY1
,        pol.po_line_id						   po_line_id1
,        decode(psp.manual_po_num_type, 'NUMERIC', to_number(poh.segment1), null)
,        decode(psp.manual_po_num_type, 'NUMERIC', null, poh.segment1)
,        por.release_num
,        nvl(por.po_release_id,-1) release_id1, 
nvl2(pol.item_id,&C_FLEX_ITEM_DISP,null) C_FLEX_ITEM_DISP 
FROM     po_distributions                      pod
,        mtl_system_items                     msi
,        po_line_locations                     pll
,        po_lines                              pol
,        po_releases                           por
,        po_headers                            poh
--,      po_vendors                            pov                    --Commented/Added by Shruthi on 10-Sept-13 for R12 Retrofit
,        ap_suppliers                          aps
,        gl_code_combinations                  glcc
,        po_system_parameters                  psp
,        MTL_SYSTEM_ITEMS_B_KFv                msik                              -- Added by Veronica for 11i PROD changes
WHERE    poh.po_header_id                      = pol.po_header_id
AND      pol.po_line_id                        = pll.po_line_id 
AND      pll.line_location_id                  = pod.line_location_id 
AND      pol.item_id                           = msi.inventory_item_id (+)
AND      msi.organization_id (+)           	   = :c_organization_id
AND      pol.item_id                           = msik.inventory_item_id (+)      -- Added by Veronica for 11i PROD changes
AND      msik.organization_id (+)              = :c_organization_id              -- Added by Veronica for 11i PROD changes
AND      glcc.code_combination_id              = pod.code_combination_id
--AND    poh.vendor_id                         = pov.vendor_id (+)
AND      poh.vendor_id                         = aps.vendor_id (+)
AND      pll.po_release_id                     = por.po_release_id (+)
-- Added for new 11i changes by Veronica on 4th Dec'13 START
AND      nvl(poh.authorization_status,'OPEN')  not in ('INCOMPLETE','IN PROCESS','REQUIRES REAPPROVAL','REJECTED','PRE-APPROVED')  
AND      nvl(por.authorization_status ,'OPEN') not in ('INCOMPLETE','IN PROCESS','REQUIRES REAPPROVAL', 'REJECTED','PRE-APPROVED')   
-- Added for new 11i changes by Veronica on 4th Dec'13  END
AND      pll.shipment_type            in ('STANDARD','BLANKET','SCHEDULED')
AND      nvl(pol.closed_code,'OPEN')           not in ('CLOSED','FINALLY CLOSED')
AND      nvl(pll.closed_code,'OPEN')           not in ('CLOSED','FINALLY CLOSED')
AND      nvl(poh.closed_code,'OPEN')           not in ('CLOSED','FINALLY CLOSED')
AND      nvl(por.closed_code,'OPEN')           not in ('CLOSED','FINALLY CLOSED')
AND      nvl(poh.cancel_flag,'N')        = 'N'
AND      nvl(por.cancel_flag,'N')        = 'N'
AND      nvl(pol.cancel_flag,'N')        = 'N'
AND      nvl(pll.cancel_flag,'N')        = 'N'
AND      &company_name_lex                     = :company_Q2
AND      &cost_center_lex                           =  :cost_center_Q2 
AND      poh.currency_code=:C_CURRENCY   --Bug11928632 uncomment this condition
ORDER BY decode(psp.manual_po_num_type,'NUMERIC', to_number(poh.segment1),
                                                  null),
         decode(psp.manual_po_num_type,'NUMERIC', null, poh.segment1)
,        por.release_num
,        pol.line_num
--,      pov.vendor_name
,        aps.vendor_name
]]>
</sqlStatement><sqlStatement name="Q_Distributions">
<![CDATA[
SELECT   pll.shipment_num||'-'||pod.distribution_num  Distribution
,        decode(plt.order_type_lookup_code,
             'AMOUNT',NULL,pll.price_override)                    Unit_Price
,        pll.promised_date                     Promised_Date
,        pol.unit_meas_lookup_code             Unit
-- Added for new 11i changes by Veronica on 4th Dec'13 START
,        ((decode(plt.order_type_lookup_code,'AMOUNT',NULL,pll.price_override))*(POD.quantity_ordered))             Extended_Cost_Ordered
,        ((decode(plt.order_type_lookup_code,'AMOUNT',NULL,pll.price_override))*(POD.quantity_billed))              Extended_Cost_Billed 
,        ((decode(plt.order_type_lookup_code,'AMOUNT',NULL,pll.price_override))*(POD.quantity_delivered))           Extended_Cost_Delivered
-- Added for new 11i changes by Veronica on 4th Dec'13 END
,        ROUND (DECODE (POL.order_type_lookup_code,                         
                                       'RATE', POD.amount_ordered,
                                       'FIXED PRICE', POD.amount_ordered,
                                       POD.quantity_ordered),
                       :p_qty_precision) Quantity_Amount_Ordered
,        ROUND (DECODE (POL.order_type_lookup_code,                        
                                       'RATE', POD.amount_billed,
                                       'FIXED PRICE', POD.amount_billed,
                                       POD.quantity_billed),
                       :p_qty_precision) Quantity_Amount_Billed
,        ROUND (DECODE (POL.order_type_lookup_code,                        
                                       'RATE', POD.amount_delivered,
                                       'FIXED PRICE', POD.amount_delivered,
                                       POD.quantity_delivered),
                       :p_qty_precision) Quantity_Amount_Delivered
,        DECODE (POL.order_type_lookup_code,                        
                        'RATE', (NVL(POD.amount_ordered, 0) - NVL(POD.amount_billed, 0)) / 
                                       DECODE (NVL(POD.amount_ordered, 0), 0, 1, POD.amount_ordered),
                        'FIXED PRICE', (NVL(POD.amount_ordered, 0) - NVL(POD.amount_billed, 0)) / 
                                       DECODE (NVL(POD.amount_ordered, 0), 0, 1, POD.amount_ordered),
                        (NVL(POD.quantity_ordered, 0) - NVL(POD.quantity_billed, 0)) / 
                                       DECODE (NVL(POD.quantity_ordered, 0), 0, 1, POD.quantity_ordered)) * 100 Percent_Unbilled
,        DECODE (POL.order_type_lookup_code,                        
                        'RATE', POD.amount_ordered - NVL(POD.amount_cancelled, 0)- NVL(POD.amount_billed, 0),
                        'FIXED PRICE', POD.amount_ordered - NVL(POD.amount_cancelled, 0)- NVL(POD.amount_billed, 0),
                        (POD.quantity_ordered - NVL(POD.quantity_cancelled, 0)- NVL(POD.quantity_billed, 0)) * PLL.price_override) C_AMOUNT_OPEN_INV  
,        plc.displayed_field                   Open_For
,        pll.po_line_id							po_line_id2
,       nvl(pll.po_release_id,-1)  release_id
,        &company_name_lex                         Company_name_Q4
,        &cost_center_lex                          Cost_Center_Q4
FROM     po_line_locations                     pll
,        po_distributions                      pod
,        po_lines                              pol
,        po_lookup_codes                       plc
,        po_line_types                         plt
,       gl_code_combinations        glcc
WHERE    pod.line_location_id                  = pll.line_location_id
AND      pol.po_line_id                        = pod.po_line_id
AND      pol.line_type_id                   = plt.line_type_id
AND      nvl(pll.closed_code,'OPEN')  not in ('CLOSED', 'FINALLY CLOSED')
AND      nvl(pol.closed_code,'OPEN')  not in ('CLOSED', 'FINALLY CLOSED')
AND      pll.shipment_type            in ('STANDARD','BLANKET','SCHEDULED')
AND      nvl(pll.closed_code,'OPEN')           = plc.lookup_code
AND      plc.lookup_type                       = 'DOCUMENT STATE'
AND      nvl(pll.cancel_flag,'N')           = 'N'
AND      nvl(pol.cancel_flag,'N')           = 'N'
AND      &company_name_lex                     = :company_name_q3
AND      &cost_center_lex                           =  :cost_center_q3
AND      glcc.code_combination_id              = pod.code_combination_id 
 and pll.po_line_id=:po_line_id 
 and nvl ( pll.po_release_id , - 1 )=:release_id1
ORDER BY pll.shipment_num, pod.distribution_num
]]>
</sqlStatement></dataQuery>
<dataTrigger name="afterParameterFormTrigger" source="XXPO_POXPOPAR_XMLP_PKG.afterpform"/>
<dataTrigger name="beforeReportTrigger" source="XXPO_POXPOPAR_XMLP_PKG.beforereport"/>
<dataStructure>
<element name="P_ORDERBY_DISPLAYED" dataType="varchar2" value="XXPO_POXPOPAR_XMLP_PKG.P_ORDERBY_DISPLAYED"/>
<group name="G_company" dataType="varchar2" source="Q_company">
<element name="c_company" dataType="varchar2" value="C_COMPANY"/>
<element name="c_organization_id" dataType="number" value="C_ORGANIZATION_ID"/>
<element name="GL_CURRENCY" dataType="varchar2" value="GL_CURRENCY"/>
<element name="STRUCTURE_ACC" dataType="number" value="STRUCTURE_ACC"/>
<element name="STRUCTURE_CAT" dataType="number" value="STRUCTURE_CAT"/>
<element name="c_category_set_id" dataType="number" value="C_CATEGORY_SET_ID"/>
<element name="c_yes" dataType="varchar2" value="C_YES"/>
<element name="c_no" dataType="varchar2" value="C_NO"/>
<element name="c_cost_center" dataType="varchar2" value="C_COST_CENTER"/>
<element name="c_company_name" dataType="varchar2" value="C_COMPANY_NAME"/>
<element name="C_CURRENCY_PRECISION" dataType="number" value="C_CURRENCY_PRECISION"/>
<group name="G_cost_centre" dataType="varchar2" source="Q_cost_centre">
<element name="C_CURRENCY" dataType="varchar2" value="C_CURRENCY"/>
<element name="C_AMOUNT_OPEN_INV_SUM_RND"  dataType="number"  value="C_AMOUNT_OPEN_INV_SUM_RND"/>
<element name="C_AMOUNT_OPEN_INV_DISP"  dataType="varchar2" value="C_AMOUNT_OPEN_INV_SUM_RND" function="CURRENCY_FORMAT" currencyCode="C_CURR" width="19" />
<element name="C_AMOUNT_OPEN_INV_SUM" function="sum" dataType="number" value="G_shipments.C_AMOUNT_OPEN_INV"/>
<element name="Company_Q2" dataType="varchar2" value="COMPANY_Q2"/>
<element name="glcc_segment1_glcc_segment1_po" dataType="varchar2" value="(GLCC.SEGMENT1||GLCC.SEGMENT1||POH.CURRENCY_CODE)"/>
<element name="Cost_Center_Q2" dataType="varchar2" value="COST_CENTER_Q2"/>
<group name="G_po" dataType="varchar2" source="Q_po">
<element name="PO_Number_Release" dataType="varchar2" value="PO_NUMBER_RELEASE"/>
<element name="Vendor" dataType="varchar2" value="VENDOR"/>
<element name="C_FLEX_ITEM_DISP"  dataType="varchar2"  value="C_FLEX_ITEM_DISP"/>
<element name="Line" dataType="number" value="LINE"/>
<element name="Rev" dataType="varchar2" value="REV"/>
<element name="Description" dataType="varchar2" value="DESCRIPTION"/>
<element name="po_header_id" dataType="number" value="PO_HEADER_ID"/>
<element name="po_line_id" dataType="number" value="PO_LINE_ID"/>
<element name="C_CURRENCY1" dataType="varchar2" value="C_CURRENCY1"/>
<element name="Company_name_Q3" dataType="varchar2" value="COMPANY_NAME_Q3"/>
<element name="C_FLEX_ITEM" dataType="varchar2" value="C_FLEX_ITEM"/>
<element name="decode_psp_manual_po_num_" dataType="number" value="DECODE(PSP.MANUAL_PO_NUM_TYPE,'NUMERIC',TO_NUMBER(POH.SEGMENT1),NULL)"/>
<element name="decode_psp_manual_po_num_1" dataType="varchar2" value="DECODE(PSP.MANUAL_PO_NUM_TYPE,'NUMERIC',NULL,POH.SEGMENT1)"/>
<element name="release_num" dataType="number" value="RELEASE_NUM"/>
<element name="po_line_id1" dataType="number" value="PO_LINE_ID1"/>
<element name="Cost_Center_Q3" dataType="varchar2" value="COST_CENTER_Q3"/>
<element name="release_id1" dataType="number" value="RELEASE_ID1"/>
<group name="G_shipments" dataType="varchar2" source="Q_Distributions">
<element name="Unit_Price" dataType="varchar2" value="UNIT_PRICE"/>
<element name="Promised_Date" dataType="date" value="PROMISED_DATE"/>
<element name="Unit" dataType="varchar2" value="UNIT"/>
<element name="Extended_Cost_Ordered" dataType="number" value="EXTENDED_COST_ORDERED"/>
<element name="Extended_Cost_Billed" dataType="number" value="EXTENDED_COST_BILLED"/>
<element name="Extended_Cost_Delivered" dataType="number" value="EXTENDED_COST_DELIVERED"/>
<element name="Quantity_Amount_Ordered" dataType="number" value="QUANTITY_AMOUNT_ORDERED"/>
<element name="Quantity_Amount_Billed" dataType="number" value="QUANTITY_AMOUNT_BILLED"/>
<element name="Quantity_Amount_Delivered" dataType="number" value="QUANTITY_AMOUNT_DELIVERED"/>
<element name="Open_For" dataType="varchar2" value="OPEN_FOR"/>
<element name="C_AMOUNT_OPEN_INV" dataType="number" value="C_AMOUNT_OPEN_INV"/>
<element name="po_line_id2" dataType="number" value="PO_LINE_ID2"/>
<element name="Distribution" dataType="varchar2" value="DISTRIBUTION"/>
<element name="Percent_Unbilled" dataType="number" value="PERCENT_UNBILLED"/>
<element name="Company_name_Q4" dataType="varchar2" value="COMPANY_NAME_Q4"/>
<element name="Cost_Center_Q4" dataType="varchar2" value="COST_CENTER_Q4"/>
<element name="release_id" dataType="number" value="RELEASE_ID"/>
</group>
</group>
</group>
</group>
<element name="C_CURR" function="first" dataType="varchar2" value="G_cost_centre.C_CURRENCY"/>
<element name="orderby_clause"  dataType="varchar2"  valueIfNull="poh.currency_code" value="XXPO_POXPOPAR_XMLP_PKG.orderby_clauseformula()"/>
<element name="company" function="first" dataType="varchar2" value="G_company.c_company"/>
<element name="cost_center_lex"  dataType="varchar2"  valueIfNull="glcc.segment1" value="XXPO_POXPOPAR_XMLP_PKG.cost_center(:C_cost_center)"/>
<element name="company_name_lex"  dataType="varchar2"  valueIfNull="glcc.segment1" value="XXPO_POXPOPAR_XMLP_PKG.company(:c_company_name)"/>
<element name="C_company_name_s" function="first" dataType="varchar2" value="G_company.c_company_name"/>
<element name="count_records" function="count" dataType="number" value="G_company.c_company"/>
<element name="C_cost_center_s" function="first" dataType="varchar2" value="G_company.c_cost_center"/>
<element name="C_industry_code" dataType="varchar2" value="XXPO_POXPOPAR_XMLP_PKG.C_industry_code_p"/>
<element name="C_company_title" dataType="varchar2" value="XXPO_POXPOPAR_XMLP_PKG.C_company_title_p"/>
<element name="FORMAT_MASK" dataType="varchar2" value="XXPO_POXPOPAR_XMLP_PKG.FORMAT_MASK"/>
<element name="lp_po_type"  dataType="varchar2"  value="XXPO_POXPOPAR_XMLP_PKG.po_type()"/>
</dataStructure>
<dataTrigger name="afterReportTrigger" source="XXPO_POXPOPAR_XMLP_PKG.afterreport()"/>
</dataTemplate>
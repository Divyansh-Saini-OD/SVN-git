<?xml version="1.0" encoding="WINDOWS-1252"?>
<dataTemplate name="XXARSCAASRPT" defaultPackage="XX_AR_SCAAS_PKG" description="OD: AR SCaaS report" Version="1.0">
  <properties>
    <property name="scalable_mode" value="on"/>
    <property name="rtf-output-default-font">Arial:8</property>
  </properties>
  <parameters>
    <parameter name = "P_PERIOD_NAME"  dataType = "character"/>
    <parameter name = "P_MAIL_TO"      datatype = "character"/>
    <parameter name = "P_SMTP_SERVER"  dataType="character" defaultValue=""/>
    <parameter name = "P_MAIL_FROM"    dataType="character" defaultValue=""/>
  </parameters>
  <dataQuery>
    <sqlStatement name="Q_PARAMS">
      <![CDATA[
         SELECT INITCAP(:P_PERIOD_NAME) PERIOD
               ,:P_MAIL_TO MAIL_TO
               ,:P_SMTP_SERVER SMTP_SERVER
               ,:P_MAIL_FROM FROM_EMAIL
               ,XX_AR_SCAAS_PKG.get_std_message('SUBJECT') SUBJECT
               ,XX_AR_SCAAS_PKG.get_std_message('FILENAME') FILENAME
               ,XX_AR_SCAAS_PKG.get_std_message('BODY') MSGBODY
         FROM   DUAL
      ]]>
    </sqlStatement>
    <sqlStatement name="Q_RPT_QRY">
      <![CDATA[
         SELECT XX.SUBSCRIPTION_NUMBER 
               ,HCA.ACCOUNT_NAME
               ,HCA.ORIG_SYSTEM_REFERENCE
               ,DECODE(XX.C_EXT_ATTR1,'null','',XX.C_EXT_ATTR1) INVOICE_REF
               ,DECODE(XX.C_EXT_ATTR1,'null','',XX.C_EXT_ATTR1) ||'-'||XX.N_EXT_ATTR2 ||'-'||XX.ITEM_NAME||'-'||XX.C_EXT_ATTR2 INV_DET
               ,TO_CHAR(RCTD.GL_date,'MM/DD/RRRR') GL_POSTED_DATE
               ,rt.trx_number TRX_NUMBER
               ,XX.N_EXT_ATTR2 LINE_NUMBER
               ,XX.ITEM_NAME
               ,XX.ITEM_DESCRIPTION
               ,XX.C_EXT_ATTR2 LOCATION
               ,XX.QUANTITY
               ,XX.AMOUNT LINE_AMT
               ,XX.AMOUNT*XX.QUANTITY TOT_AMT
               ,TO_CHAR(FND_CONC_DATE.STRING_TO_DATE(SUBSTR(XX.C_EXT_ATTR1,11,10)),'MM/DD/RR') mainframe_date
               ,TO_CHAR(gp.end_date,'MM/DD/RR') end_date
          FROM xx_ar_scaas_interface_hist xx,
               hz_cust_accounts hca,
               ra_customer_trx_all rt,
               ra_customer_trx_lines_all rtl,
               ra_cust_trx_line_gl_dist_all rctd,
               gl_periods gp
         WHERE xx.cust_account_id = hca.cust_account_id
           AND xx.invoice_number = rt.customer_trx_id
           AND rt.customer_trx_id = rtl.customer_trx_id
           AND rtl.customer_trx_id = rctd.customer_trx_id
           AND rtl.customer_trx_line_id = rctd.customer_trx_line_id
           AND rctd.global_attribute1 = xx.record_id
           AND gp.period_set_name = 'OD 445 CALENDAR'
           AND gp.period_name = :P_PERIOD_NAME
           AND RCTD.GL_date between gp.start_date and gp.end_date
         ]]>
    </sqlStatement>
  </dataQuery>
    <dataStructure>
    <group name = "G_PARAMS" source = "Q_PARAMS">
      <element name = "PERIOD"                    value = "PERIOD"/>
      <element name = "MAIL_TO"                   value = "MAIL_TO"/>
      <element name="SMTP_SERVER"                 value = "SMTP_SERVER"/>
      <element name="FROM_EMAIL"                  value = "FROM_EMAIL"/>
      <element name="SUBJECT"                     value = "SUBJECT"/>
      <element name="FILENAME"                    value = "FILENAME"/>
      <element name="MSGBODY"                     value = "MSGBODY"/>
      <group name="G_RPT_QRY" source="Q_RPT_QRY">
        <element name = "SUBSCRIPTION_NUMBER"     value = "SUBSCRIPTION_NUMBER" />
        <element name = "ACCOUNT_NAME"            value = "ACCOUNT_NAME" />
        <element name = "AOPS_NUMBER"             value = "ORIG_SYSTEM_REFERENCE" />
        <element name = "INVOICE_REF"             value = "INVOICE_REF" />
        <element name = "INV_DET"                 value = "INV_DET" />
        <element name = "GL_POSTED_DATE"          value = "GL_POSTED_DATE" />
        <element name = "TRX_NUMBER"              value = "TRX_NUMBER" />
        <element name = "LINE_NUMBER"             value = "LINE_NUMBER" />
        <element name = "ITEM_NAME"               value = "ITEM_NAME" />
        <element name = "ITEM_DESCRIPTION"        value = "ITEM_DESCRIPTION" />
        <element name = "LOCATION"                value = "LOCATION" />
        <element name = "QUANTITY"                value = "QUANTITY" />
        <element name = "LINE_AMT"                value = "LINE_AMT" />
        <element name = "TOT_AMT"                 value = "TOT_AMT" />
        <element name = "MAINFRAME_DATE"          value = "MAINFRAME_DATE" />
        <element name = "END_DATE"                value = "END_DATE" />
      </group>
    </group>
    </dataStructure>
  <dataTrigger name="afterReportTrigger" source="xx_ar_scaas_pkg.afterreport"/>
</dataTemplate>
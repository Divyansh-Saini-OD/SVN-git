<?xml version="1.0" encoding="UTF-8"?>
<dataTemplate name="XX_ALT_RENEW_CONTRACT_RPT" defaultPackage="XX_ALT_RENEW_CONT_RPT_BURST_F" description="OD: AR OKS/SVC Alternative Renewal Contracts Report" version="1.0">
<dataQuery> 
      <sqlStatement name="Q1">
            <![CDATA[SELECT conts.contract_id               ORIGINAL_CONTRACT_ID,
                            conts.contract_number           ORIGINAL_CONTRACT,
                            conts.initial_order_number      ORIGINAL_ORDER,
                            contls.contract_line_number     ORIGINAL_LINE,
                            contls.contract_line_start_date ORIGINAL_LINE_START_DATE, 
                            contls.contract_line_end_date   ORIGINAL_LINE_END_DATE,
                            conts.contract_number_modifier  ORIGINAL_MODIFIER,
                            contls.item_name                ORIGINAL_SKU,
                            contls.contract_line_amount     ORIGINAL_LINE_AMT,
                            contls.cancellation_date        ORIGINAL_CANCEL_REQ_DATE,
                            contls.close_date               ORIGINAL_LINE_CLOSED_DATE,
                            conts.contract_status           ORIGINAL_HEADER_STATUS,  --ADDED FROM SUBS
                            conts.external_source           ORIGINAL_ORDER_SOURCE,
                            contls.renewal_type             ORIGINAL_LINE_DNR_PRESENT,
                            contls.isdiscontinued_flag      ORIGINAL_SKU_DISCONTINUED,
                            subs.email_autorenew_sent_date  ORIGINAL_45DAY_EMAILDT,
                            subs.email_autorenew_sent_flag  ORIGINAL_45DAY_EMAIL,
                            (
                             select type
                             from xx_od_oks_alt_sku_tbl 
                             where 1=1
                             and org_sku = contls.item_name
                             and rownum < 2
                            )                              ORIGINAL_ALT_SKU_TYPE,
                            subs.auto_renewed_flag         ORDER_SENT_FROM_EBSTOB2B,
                            subs.auto_renewed_date         ORDER_SENT_DATE,
                            conts.payment_type,
                            --subs.billing_date,	   
                            New_Q.contract_id              NEW_CONTRACT_ID,
                            New_Q.contract_number          NEW_CONTRACT,	
                            New_Q.initial_order_number     NEW_ORDER,
                            New_Q.contract_line_number     NEW_LINE,
                            New_Q.contract_line_start_date NEW_START_DATE, 
                            New_Q.contract_line_end_date   NEW_END_DATE,
                            New_Q.contract_number_modifier NEW_MODIFIER,
                            New_Q.item_name                NEW_SKU,
                            New_Q.contract_line_amount     NEW_SKU_AMT,
                            New_Q.renewed_from             NEW_LINE_RENEWED_FROM,	
                            New_Q.external_source          NEW_ORDER_SOURCE,
	                        subs.subscriptions_id,
	                        subs.BILLING_SEQUENCE_NUMBER
                       FROM xx_ar_subscriptions subs,
                            xx_ar_contracts conts,
                            xx_ar_contract_lines contls,
	                       (
		                    select distinct
		                           conts.contract_id,
		                           conts.contract_number,	
		                           conts.initial_order_number,
		                           contls.contract_line_number,
		                           contls.contract_line_start_date, 
		                           contls.contract_line_end_date,
		                           conts.contract_number_modifier,
		                           contls.item_name,
		                           contls.contract_line_amount,
		                           contls.renewed_from,	
		                           conts.external_source,
		                           conts.creation_date,
		                           conts.last_update_date
		                      FROM xx_ar_subscriptions        subs,
		                           xx_ar_contracts            conts,
		                           xx_ar_contract_lines       contls
		                     WHERE 1                          = 1
		                       AND conts.contract_id          = contls.contract_id
		                       AND conts.contract_id          = subs.contract_id
                               AND subs.contract_line_number  = contls.contract_line_number
		                       AND contls.renewed_from        IS NOT NULL
                             ) New_Q
                       WHERE 1                             = 1
                         AND conts.contract_id             = contls.contract_id
                         AND conts.contract_id             = subs.contract_id
                         AND subs.contract_line_number     = contls.contract_line_number
                         AND contls.alternative_sku        is not null
                         AND conts.contract_number         = New_Q.renewed_from
                         AND contls.alternative_sku        = New_Q.item_name
                         AND New_Q.creation_date           >= NVL(:to_date, New_Q.last_update_date-1) 
                         AND subs.billing_sequence_number IN (SELECT MAX(subs1.billing_sequence_number)
                                                                FROM xx_ar_subscriptions        subs1
                                                               WHERE 1                          =1
										                         AND subs1.contract_id          =subs.contract_id
                                                                 AND subs1.contract_line_number = subs.contract_line_number
                                                             )
                        ORDER BY subs.billing_date,subs.BILLING_SEQUENCE_NUMBER
            ]]>
       </sqlStatement>          
           <sqlStatement name="Q_SMTP_DTLS_EMAIL">
               <![CDATA[SELECT SMTP_DTLS.SMTP_SERVER,
                               SMTP_DTLS.SMTP_PORT,
                               SMTP_DTLS.EMAIL_FROM,
                               EMAIL_ADDRESS.EMAIL_ADDR,
                               TO_CHAR((sysdate-1),'DD-MON-YYYY') CURRENT_DATE
                        FROM   (SELECT XFTV.target_value1 SMTP_SERVER,
                                       XFTV.target_value2 SMTP_PORT,
                                       XFTV.target_value3 EMAIL_FROM
                                FROM   xx_fin_translatedefinition XFTD,
                                       xx_fin_translatevalues XFTV 
                                WHERE  XFTD.translation_name ='AR_EBL_EMAIL_CONFIG'
                                 AND   SYSDATE BETWEEN XFTD.start_date_active AND NVL(XFTD.end_date_active, SYSDATE + 1)
                                 AND   XFTD.enabled_flag   = 'Y'
                                 AND   XFTD.translate_id   = XFTV.translate_id
                                 AND   SYSDATE BETWEEN XFTV.start_date_active AND NVL(XFTV.end_date_active, SYSDATE + 1)
                                 AND   XFTV.enabled_flag   = 'Y'
                               )SMTP_DTLS,
                               (SELECT XFTV.source_value1 EMAIL_ADDR
                                FROM   xx_fin_translatedefinition XFTD,
                                       xx_fin_translatevalues XFTV
                                WHERE  XFTD.translation_name = 'XX_ALT_RENEW_CONTRACT_RPT'
                                AND    XFTD.translate_id   = XFTV.translate_id                             
                                AND    SYSDATE BETWEEN XFTD.start_date_active AND NVL(XFTD.end_date_active, SYSDATE + 1)
                                AND    XFTD.enabled_flag   = 'Y'
                                AND    SYSDATE BETWEEN XFTV.start_date_active AND NVL(XFTV.end_date_active, SYSDATE + 1)
                                AND    XFTV.enabled_flag   = 'Y'                             
                               )EMAIL_ADDRESS
               ]]>
           </sqlStatement>  		   		   
</dataQuery>

<dataStructure>          
           <!-- OD: AR OKS/SVC Alternative Renewal Contracts Report --> 
          <group name="G_XX_ALT_RENEW_CONTRACT_RPT"           source="Q1">
		   <element name="ORIGINAL_CONTRACT_ID"                        value="ORIGINAL_CONTRACT_ID" />
	       <element name="ORIGINAL_CONTRACT"                    value="ORIGINAL_CONTRACT" />
		   <element name="ORIGINAL_ORDER"                    value="ORIGINAL_ORDER" />
		   <element name="ORIGINAL_LINE"                    value="ORIGINAL_LINE" />
		   <element name="ORIGINAL_LINE_START_DATE"                    value="ORIGINAL_LINE_START_DATE" />
		   <element name="ORIGINAL_LINE_END_DATE"                    value="ORIGINAL_LINE_END_DATE" />
		   <element name="ORIGINAL_MODIFIER"                    value="ORIGINAL_MODIFIER" />
		   <element name="ORIGINAL_SKU"                    value="ORIGINAL_SKU" />
		   <element name="ORIGINAL_LINE_AMT"                    value="ORIGINAL_LINE_AMT" />
		   <element name="ORIGINAL_CANCEL_REQ_DATE"                    value="ORIGINAL_CANCEL_REQ_DATE" />
		   <element name="ORIGINAL_LINE_CLOSED_DATE"                    value="ORIGINAL_LINE_CLOSED_DATE" />
		   <element name="ORIGINAL_HEADER_STATUS"                    value="ORIGINAL_HEADER_STATUS" />
		   <element name="ORIGINAL_ORDER_SOURCE"                    value="ORIGINAL_ORDER_SOURCE" />
		   <element name="ORIGINAL_LINE_DNR_PRESENT"                    value="ORIGINAL_LINE_DNR_PRESENT" />
		   <element name="ORIGINAL_SKU_DISCONTINUED"                    value="ORIGINAL_SKU_DISCONTINUED" />
		   <element name="ORIGINAL_45DAY_EMAILDT"                    value="ORIGINAL_45DAY_EMAILDT" />
		   <element name="ORIGINAL_45DAY_EMAIL"                    value="ORIGINAL_45DAY_EMAIL" />
		   <element name="ORIGINAL_ALT_SKU_TYPE"                    value="ORIGINAL_ALT_SKU_TYPE" />
		   <element name="ORDER_SENT_FROM_EBSTOB2B"                    value="ORDER_SENT_FROM_EBSTOB2B" />
		   <element name="ORDER_SENT_DATE"                    value="ORDER_SENT_DATE" />
	       <element name="PAYMENT_TYPE"                                value="PAYMENT_TYPE" />
           <element name="NEW_CONTRACT_ID"                           value="NEW_CONTRACT_ID" />	       
	       <element name="NEW_CONTRACT"                value="NEW_CONTRACT" />
	       <element name="NEW_ORDER"                  value="NEW_ORDER"/>
		   <element name="NEW_LINE"               value="NEW_LINE" /> 
	       <element name="NEW_START_DATE"               value="NEW_START_DATE" /> 
	       <element name="NEW_END_DATE"         value="NEW_END_DATE" /> 
           <element name="NEW_MODIFIER"            value="NEW_MODIFIER" />
           <element name="NEW_SKU"            value="NEW_SKU" />  
           <element name="NEW_SKU_AMT"               value="NEW_SKU_AMT" />
           <element name="NEW_LINE_RENEWED_FROM"            value="NEW_LINE_RENEWED_FROM" />
           <element name="NEW_ORDER_SOURCE"               value="NEW_ORDER_SOURCE" />     	
          </group> 		  
           <!-- Bursting Group --> 
          <group name="G_SMTP_DTLS_EMAIL" source="Q_SMTP_DTLS_EMAIL">
            <element name="SMTP_SERVER"   value="SMTP_SERVER"/>
            <element name="SMTP_PORT"     value="SMTP_PORT"/>
            <element name="EMAIL_FROM"    value="EMAIL_FROM"/>
            <element name="EMAIL_SUBJECT" value="EMAIL_SUBJECT"/>
            <element name="EMAIL_ADDR"    value="EMAIL_ADDR"/>
            <element name="CURRENT_DATE"  value="CURRENT_DATE"/>
		  </group> 		  
</dataStructure>   
<dataTrigger name="afterReport" source="XX_ALT_RENEW_CONT_RPT_BURST_F()"/>
<!-- <dataTrigger name="afterReport" source="XXSSN_TIMECARD_MGR_BRST_PKG.XXSSN_SUBMIT_BURSTING" /> -->    
</dataTemplate>
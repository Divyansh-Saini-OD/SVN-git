<?xml version="1.0" encoding='windows-1252'?>
<!DOCTYPE ViewObject SYSTEM "jbo_03_01.dtd">

<ViewObject
   Name="ODSalesSchedsLeadSOpptySVO"
   Extends="oracle.apps.asn.dashboard.server.SalesSchedsLeadSOpptySVO"
   BindingStyle="Oracle"
   CustomQuery="true"
   RowClass="od.oracle.apps.xxcrm.asn.dashboard.server.ODSalesSchedsLeadSOpptySVORowImpl"
   ComponentClass="od.oracle.apps.xxcrm.asn.dashboard.server.ODSalesSchedsLeadSOpptySVOImpl"
   MsgBundleClass="oracle.jbo.common.JboResourceBundle"
   UseGlueCode="false" >
   <SQLQuery><![CDATA[
SELECT        scheds.schedule_id,
               scheds.schedule_name,
               NVL(leads.no_action,0) no_action,
               NVL(leads.in_progress,0) as in_progress,
               NVL(leads.dead,0) as dead,
               NVL(leads.conversion,0) as conversion,
               NVL(oppty.oppty_in_progress,0) as oppty_in_progress,
               NVL(oppty.lost,0) as lost,
               NVL(oppty.won,0) as won,
               NVL(ROUND((decode(oppty.won,0,0,oppty.won)/NVL(oppty.total_oppty,0))*100,2),0) oppty_conversion,
               NVL(leads.source_promotion_id, oppty.source_promotion_id) as source_promotion_id               
      FROM       
      (SELECT schedule_id,
              schedule_name,
              trunc(start_date_time) as start_date_time 
       FROM (
       SELECT   amscb.schedule_id,
                amcst.schedule_name,
                amscb.start_date_time
       FROM     ams_campaign_schedules_tl amcst,
                ams_campaign_schedules_b amscb
       WHERE  amcst.schedule_id = amscb.schedule_id
       AND    amcst.language = USERENV('LANG')
       AND    amscb.activity_id = 500
       AND    amscb.activity_type_code = 'DIRECT_SALES'       
       AND    amscb.purpose in ('UP_SELL', 'CROSS_SELL')
       AND    amscb.status_code  in ('ACTIVE', 'ON_HOLD', 'COMPLETED', 'CLOSED') 
       AND    CEIL(SYSDATE - amscb.start_date_time) <= :1      
       ORDER BY amscb.start_date_time desc)
      )  scheds,
 (SELECT amsc.source_code_for_id, 
              asl.source_promotion_id,
                sum(case when asl.status_code = :2 THEN 1 else 0 END)  as no_action,
                sum(case when asl.status_code <> :3  AND (NVL(asl.status_open_flag, 'N') = 'Y' AND asl.status_code <> 'CONVERTED_TO_OPPORTUNITY') THEN 1 else 0 END) as in_progress,
                sum(case when nvl(asl.status_open_flag, 'N')  = 'N'  AND asl.status_code <> 'CONVERTED_TO_OPPORTUNITY' THEN 1 else 0 END) as dead,
                decode(count(asl.sales_lead_id), 0, 0, ROUND((sum(case when asl.status_code = 'CONVERTED_TO_OPPORTUNITY' THEN 1 ELSE 0 END)/count(asl.sales_lead_id)) * 100, 2))  as conversion,
                count(asl.sales_lead_id) as total_lead
         FROM   as_sales_leads asl,
                ams_source_codes amsc,
                (SELECT /*+ no_merge */ distinct aaa.sales_lead_id, aaa.customer_id
                 FROM   as_accesses_all aaa
                 WHERE  aaa.sales_lead_id IS NOT NULL
                 AND    aaa.lead_id IS NULL
                 AND    aaa.salesforce_id = :4
                 AND    aaa.salesforce_id+0 = :5
AND  CEIL(SYSDATE-aaa.object_creation_date) <= :6
) secu
         WHERE  amsc.source_code_id = asl.source_promotion_id
         AND    asl.sales_lead_id = secu.sales_lead_id
	    AND    asl.customer_id = secu.customer_id
         AND    amsc.arc_source_code_for = 'CSCH'
         group by amsc.source_code_for_id,asl.source_promotion_id) leads, 
        (SELECT amsc.source_code_for_id, 
                ala.source_promotion_id,
                sum(case when (NVL(asb.opp_open_status_flag, 'N') = 'Y'  AND asb.win_loss_indicator <> 'W') THEN 1 else 0 END) as Oppty_in_progress,
                sum(case when (NVL(asb.opp_open_status_flag, 'N') = 'N' and  asb.win_loss_indicator <> 'W') THEN 1 else 0 END) as lost,
                sum(case when asb.win_loss_indicator = 'W' THEN 1 else 0 END) as won,                
                decode(count(ala.lead_id), 0, 0, ROUND((sum(case when asb.win_loss_indicator = 'W' THEN 1 ELSE 0 END)/count(ala.lead_id)) * 100, 2))  as oppty_conversion,
                count(ala.lead_id) as total_oppty                                    
         FROM   as_leads_all ala,
                ams_source_codes amsc,
                as_statuses_b asb,
               (SELECT 
  /*+ no_merge */  DISTINCT    TERR_ENT.ENTITY_ID lead_id,
  HZP.PARTY_ID customer_id
FROM 
  XX_TM_NAM_TERR_ENTITY_DTLS TERR_ENT,
  XX_TM_NAM_TERR_RSC_DTLS TERR_RSC,
  XX_TM_NAM_TERR_DEFN TERR,
  HZ_PARTIES HZP,
  as_leads asl
WHERE 
  TERR.NAMED_ACCT_TERR_ID = TERR_ENT.NAMED_ACCT_TERR_ID AND
  TERR.NAMED_ACCT_TERR_ID = TERR_RSC.NAMED_ACCT_TERR_ID AND
  SYSDATE BETWEEN NVL(TERR.START_DATE_ACTIVE,SYSDATE-1) AND
  NVL(TERR.END_DATE_ACTIVE,SYSDATE+1) AND
  SYSDATE BETWEEN NVL(TERR_ENT.START_DATE_ACTIVE,SYSDATE-1) AND
  NVL(TERR_ENT.END_DATE_ACTIVE,SYSDATE+1) AND
  SYSDATE BETWEEN NVL(TERR_RSC.START_DATE_ACTIVE,SYSDATE-1) AND
  NVL(TERR_RSC.END_DATE_ACTIVE,SYSDATE+1)    AND
  ASL.CUSTOMER_ID = HZP.PARTY_ID AND
  ASL.LEAD_ID = TERR_ENT.ENTITY_ID    AND
  TERR_ENT.ENTITY_TYPE = 'OPPORTUNITY' 		     AND
  TERR_RSC.RESOURCE_ID =:7 AND
  TERR_RSC.RESOURCE_ID+0 =:8) secu  
         WHERE  ala.lead_id = secu.lead_id 
	    AND    ala.customer_id = secu.customer_id
         AND    ala.status = asb.status_code
         AND    amsc.source_code_id =   ala.source_promotion_id  
         AND    amsc.arc_source_code_for = 'CSCH'
	    AND    CEIL(SYSDATE-ala.creation_date) <= :9
         group by amsc.source_code_for_id,ala.source_promotion_id) oppty
  WHERE  scheds.schedule_id = leads.source_code_for_id(+)
  AND    scheds.schedule_id = oppty.source_code_for_id(+)  
  AND  
         ( no_action > 0 
    	   OR in_progress > 0
    	   OR dead > 0
    	   OR conversion > 0
    	   OR oppty_in_progress > 0
    	   OR lost > 0
     	   OR won > 0
    	   OR oppty_conversion > 0
  	 )                   
  ORDER BY  scheds.start_date_time  desc
   ]]></SQLQuery>
   <DesignTime>
      <Attr Name="_isCodegen" Value="true" />
      <Attr Name="_version" Value="9.0.3.13.93" />
      <Attr Name="_CodeGenFlagNew" Value="36" />
   </DesignTime>
   <ViewAttribute
      Name="ScheduleId"
      IsQueriable="false"
      IsPersistent="false"
      IsNotNull="true"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="SCHEDULE_ID"
      Expression="SCHEDULE_ID"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="ScheduleName"
      IsQueriable="false"
      IsPersistent="false"
      IsNotNull="true"
      Precision="240"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="SCHEDULE_NAME"
      Expression="SCHEDULE_NAME"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="240" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="NoAction"
      IsQueriable="false"
      IsPersistent="false"
      Precision="240"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="NO_ACTION"
      Expression="NO_ACTION"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="InProgress"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="IN_PROGRESS"
      Expression="IN_PROGRESS"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Dead"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="DEAD"
      Expression="DEAD"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Conversion"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="CONVERSION"
      Expression="CONVERSION"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="OpptyInProgress"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="OPPTY_IN_PROGRESS"
      Expression="OPPTY_IN_PROGRESS"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Lost"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="LOST"
      Expression="LOST"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Won"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="WON"
      Expression="WON"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="OpptyConversion"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="OPPTY_CONVERSION"
      Expression="OPPTY_CONVERSION"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="NoActionZeroFlag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="VIEW_ATTR"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="InProgressZeroFlag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="INPROGRESS_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="DeadZeroFlag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="DEAD_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="OpptyInProgressZeroFlag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="OPPTYINPROGRESS_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="LostZeroFlag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="LOST_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="WonZeroFlag"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="WON_ZERO_FLAG"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="SourcePromotionId"
      IsUpdateable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="SOURCEPROMOTIONID"
      Expression="SourcePromotionId"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="CampaignBinDays"
      IsQueriable="false"
      IsPersistent="false"
      Precision="30"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="CAMPAIGN_BIN_DAYS"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
</ViewObject>

<?xml version="1.0" encoding="UTF-8" ?>
<?oracle-xsl-mapper
  <!-- SPECIFICATION OF MAP SOURCES AND TARGETS, DO NOT MODIFY. -->
  <mapSources>
    <source type="XSD">
      <schema location="ODAMEXL3CPC.xsd"/>
      <rootElement name="container" namespace="http://www.officedepot.com/GetODAmexL3CpcSrvc"/>
    </source>
  </mapSources>
  <mapTargets>
    <target type="XSD">
      <schema location="http://chilsoa01d.na.odcorp.net:7778/orabpel/xmllib/eaixml/oagis/v91/message/bod/ProcessInvoice.xsd"/>
      <rootElement name="ProcessInvoice" namespace="http://www.openapplications.org/oagis/9"/>
    </target>
  </mapTargets>
  <!-- GENERATED BY ORACLE XSL MAPPER 10.1.3.1.0(build 061009.0802) AT [THU DEC 20 14:13:46 EST 2007]. -->
?>
<xsl:stylesheet version="1.0"
                xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
                xmlns:ns5="http://www.openapplications.org/oagis/9/unqualifieddatatypes/1.1"
                xmlns:ehdr="http://www.oracle.com/XSL/Transform/java/oracle.tip.esb.server.headers.ESBHeaderFunctions"
                xmlns:ns8="http://www.openapplications.org/oagis/9/currencycode/54217:2001"
                xmlns:ns4="http://www.openapplications.org/oagis/9/qualifieddatatypes/1.1"
                xmlns:ns1="http://www.openapplications.org/oagis/9/officedepot/1/codelists"
                xmlns:ns2="http://www.openapplications.org/oagis/9/IANAMIMEMediaTypes:2003"
                xmlns:tns="http://www.officedepot.com/GetODAmexL3CpcSrvc"
                xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                xmlns:ns3="http://www.openapplications.org/oagis/9/codelists"
                xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
                xmlns:nxsd="http://xmlns.oracle.com/pcbpel/nxsd"
                xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
                xmlns:ns7="http://www.openapplications.org/oagis/9/officedepot/1"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:ora="http://schemas.oracle.com/xpath/extension"
                xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
                xmlns:orcl="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
                xmlns:ns0="http://www.openapplications.org/oagis/9"
                xmlns:ns6="http://www.openapplications.org/oagis/9/unitcode/66411:2001"
                xmlns:ns9="http://www.openapplications.org/oagis/9/languagecode/5639:1988"
                exclude-result-prefixes="xsl tns xsd nxsd ns5 ns8 ns4 ns1 ns2 ns3 ns7 ns0 ns6 ns9 bpws ehdr hwf xp20 ora ids orcl">
  <xsl:template match="/">
    <ns0:ProcessInvoice>
      <ns0:DataArea>
        <xsl:for-each select="/tns:container/tns:CCMaster">
          <ns0:Invoice>
            <xsl:attribute name="type">
              <xsl:variable name="typ-var" select="tns:C6"/>
                <xsl:choose>
                  <xsl:when test='$typ-var = "Credit"'>
                    <xsl:text disable-output-escaping="no">CR</xsl:text>
                  </xsl:when>
                  <xsl:otherwise>
                    <xsl:text disable-output-escaping="no">DR</xsl:text>
                  </xsl:otherwise>
                </xsl:choose>
            </xsl:attribute>
            <ns0:InvoiceHeader>
            <!-- Added for defect 4180 Start-->
              <ns0:RemitToParty>
                <ns0:PartyIDs>
                  <ns0:ID>
                    <xsl:value-of select="tns:C97"/>
                  </ns0:ID>
                </ns0:PartyIDs>
              </ns0:RemitToParty>
            <!-- Added for defect 4180 End-->
              <ns0:DocumentID>
                <ns0:ID>
                  <xsl:value-of select="tns:C17"/>
                </ns0:ID>
              </ns0:DocumentID>
              <ns0:DocumentDateTime>
                <xsl:value-of select="tns:C50"/>
              </ns0:DocumentDateTime>
              <ns0:DocumentReference>
                <xsl:attribute name="type">
                  <xsl:text disable-output-escaping="no">OriginalInvoice</xsl:text>
                </xsl:attribute>
                <ns0:DocumentID>
                  <ns0:ID>
                    <xsl:value-of select="tns:C89"/>
                  </ns0:ID>
                </ns0:DocumentID>
              </ns0:DocumentReference>
              <ns0:ExtendedAmount>
                <xsl:variable name="extn-var" select="tns:C66"/>
                <xsl:value-of select="format-number($extn-var, '0.00','0.00')"/>
              </ns0:ExtendedAmount>
              <ns0:TotalAmount>
                <xsl:variable name="ttl-var" select="tns:C16"/>
                <xsl:value-of select="format-number($ttl-var, '0.00','0.00')"/>
              </ns0:TotalAmount>
              <ns0:CustomerParty>
                <ns0:Location>
                  <ns0:Address>
                    <ns0:CountryCode>
                      <xsl:value-of select="tns:C74"/>
                    </ns0:CountryCode>
                  </ns0:Address>
                </ns0:Location>
                <ns0:CustomerAccountID>
                      <xsl:value-of select="tns:C85"/>
                </ns0:CustomerAccountID>
                <ns0:ReceivingContact>
                  <ns0:Name>
                    <xsl:value-of select="tns:C70"/>
                  </ns0:Name>
                  <ns0:Communication>
                    <ns0:Address>
                      <ns0:PostalCode>
                        <xsl:value-of select="tns:C75"/>
                      </ns0:PostalCode>
                      <!--Added for defect 6232 -->
                      <ns0:CountrySubDivisionCode>
                        <xsl:value-of select="tns:C73"/>
                      </ns0:CountrySubDivisionCode>
                    </ns0:Address>
                  </ns0:Communication>
                </ns0:ReceivingContact>
              </ns0:CustomerParty>
              <ns0:Party>
                <xsl:attribute name="role">
                  <xsl:text disable-output-escaping="no">SenderParty</xsl:text>
                </xsl:attribute>
                <ns0:Name>
                  <xsl:variable name="pname-var" select="tns:C84"/>
                  <xsl:choose>
                    <xsl:when test='$pname-var = "US"'>
                      <xsl:text disable-output-escaping="no">AMEXAM</xsl:text>
                    </xsl:when>
                    <xsl:when test='$pname-var = "CA"'>
                      <xsl:text disable-output-escaping="no">AMEXAC</xsl:text>
                    </xsl:when>
                  </xsl:choose>
                </ns0:Name>
              </ns0:Party>
              <ns0:PurchaseOrderReference>
                <ns0:DocumentID>
                  <ns0:ID>
                    <xsl:value-of select="tns:C60"/>
                  </ns0:ID>
                </ns0:DocumentID>
                <ns0:DocumentDateTime>
                  <xsl:value-of select="tns:C77"/>
                </ns0:DocumentDateTime>
                <ns0:ReleaseNumber>
                  <xsl:value-of select="tns:C88"/>
                </ns0:ReleaseNumber>
              </ns0:PurchaseOrderReference>
              <ns7:Settlement>
            <!-- Added for defect 4180 Start-->
                <ns0:SourceSystemCode>
                  <xsl:value-of select="tns:C96"/>
                </ns0:SourceSystemCode>
            <!-- Added for defect 4180 End-->
                <ns0:CreditCard>
                  <ns0:Expiration>
                    <xsl:choose>
                      <xsl:when test="string-length(tns:C14) > 0">
                        <ns0:Month>
                          <xsl:value-of select="substring(tns:C14,'3','2')"/>
                        </ns0:Month>
                        <ns0:Year>
                          <xsl:value-of select="substring(tns:C14,'1','2')"/>
                        </ns0:Year>
                      </xsl:when>
                    <xsl:when test="string-length(tns:C15) > 0">
                        <ns0:Month>
                              <xsl:value-of select="substring(tns:C15,string-length(tns:C15)-1,2)"/>
 <!--                         <xsl:value-of select="substring(substring-after(tns:C15,&quot;=&quot;),'3','2')"/>   -->
                        </ns0:Month>
                        <ns0:Year>
                            <xsl:value-of select="substring(tns:C15,string-length(tns:C15)-3,2)"/>
<!--                          <xsl:value-of select="substring(substring-after(tns:C15,&quot;=&quot;),'1','2')"/>  -->
                        </ns0:Year>
                    </xsl:when>
                    </xsl:choose>
                  </ns0:Expiration>
                  <ns0:PaymentAuthorization>
                    <ns0:ID>
                      <xsl:value-of select="tns:C37"/>
                    </ns0:ID>
            <!-- Added for defect 4180 Start-->
                    <ns0:ResponseCode>
                      <xsl:value-of select="tns:C95"/>
                    </ns0:ResponseCode>
            <!-- Added for defect 4180 End-->
                  </ns0:PaymentAuthorization>
                  <xsl:choose>
                    <xsl:when test="string-length(tns:C13) > 0">
                      <ns7:MaskedNumber>
                        <xsl:value-of select="tns:C13"/>
                      </ns7:MaskedNumber>
                   </xsl:when>
                    <xsl:when test="string-length(tns:C15) > 0">
                      <ns7:MaskedNumber>
                          <xsl:value-of select="substring(tns:C15,1,string-length(tns:C15)-5)"/>
 <!--                       <xsl:value-of select="substring-before(tns:C15, '=')"/>  -->
                      </ns7:MaskedNumber>
                   </xsl:when>
                  </xsl:choose>
                  <ns0:Number>
                      <xsl:value-of select="tns:C94"/>
                  </ns0:Number>
                </ns0:CreditCard>
                <ns7:ProcessControlID>
                  <xsl:text disable-output-escaping="no">015003</xsl:text>
                </ns7:ProcessControlID>
                <ns7:MerchantNumber>
                      <xsl:value-of select="tns:C93"/>
                 </ns7:MerchantNumber>
                <ns7:ChainNumber>
                  <xsl:text disable-output-escaping="no">4094854312</xsl:text>
                </ns7:ChainNumber>
              </ns7:Settlement>
              <xsl:variable name="cntry-var" select="tns:C84"/>
              <xsl:choose>
                <xsl:when test='$cntry-var = "US"'>
                <ns0:Tax>
                    <ns0:BasisAmount>
                      <xsl:variable name="usbas-var" select="tns:C26 "/>
                        <xsl:value-of select="format-number($usbas-var, '0.00','0.00')"/>
                    </ns0:BasisAmount>
                </ns0:Tax>
                </xsl:when>
                <xsl:when test='$cntry-var = "CA"'>
                <ns0:Tax>
                    <ns0:BasisAmount>
                      <xsl:variable name="usbas-var" select="tns:C62 + tns:C63"/>
                        <xsl:value-of select="format-number($usbas-var, '0.00','0.00')"/>
                    </ns0:BasisAmount>
                </ns0:Tax>
                <ns0:Tax>
                    <xsl:attribute name="type">
                      <xsl:text disable-output-escaping="no">STGST</xsl:text>
                    </xsl:attribute>
                    <ns0:BasisAmount>
                      <xsl:variable name="cabas1-var" select="tns:C62 "/>
                        <xsl:value-of select="format-number($cabas1-var, '0.00','0.00')"/>
                    </ns0:BasisAmount>
                </ns0:Tax>
                <ns0:Tax>
                    <xsl:attribute name="type">
                      <xsl:text disable-output-escaping="no">COPST</xsl:text>
                    </xsl:attribute>
                    <ns0:BasisAmount>
                      <xsl:variable name="cabas2-var" select="tns:C63 "/>
                        <xsl:value-of select="format-number($cabas2-var, '0.00','0.00')"/>
                    </ns0:BasisAmount>
                </ns0:Tax>
                </xsl:when>
              </xsl:choose>
             <xsl:choose>
              <xsl:when test='tns:C65 != "0.00"'>
              <ns0:Charge>
                <xsl:attribute name="type">
                  <xsl:text disable-output-escaping="no">Delivery</xsl:text>
                </xsl:attribute>
                <ns0:Amount>
                  <xsl:variable name="amt1-var" select="tns:C65 "/>
                  <xsl:value-of select="format-number($amt1-var, '0.00','0.00')"/>
                </ns0:Amount>
              </ns0:Charge>
               </xsl:when>
              <xsl:when test='tns:C67 != "0.00"'>
              <ns0:Charge>
                <xsl:attribute name="type">
                  <xsl:text disable-output-escaping="no">Miscellaneous</xsl:text>
                </xsl:attribute>
                <ns0:Amount>
                  <xsl:variable name="amt2-var" select="tns:C67 "/>
                  <xsl:value-of select="format-number($amt2-var, '0.00','0.00')"/>
                </ns0:Amount>
              </ns0:Charge>
              </xsl:when>
            </xsl:choose>
              <ns7:DiscountAmount>
                <xsl:variable name="dis-var" select="tns:C64 "/>
                <xsl:value-of select="format-number($dis-var, '0.00','0.00')"/>
              </ns7:DiscountAmount>
              <ns7:DesktopLocation>
                <ns0:ID>
                  <xsl:value-of select="tns:C87"/>
                </ns0:ID>
              </ns7:DesktopLocation>
              <ns7:CostCenterID>
                <xsl:value-of select="tns:C86"/>
              </ns7:CostCenterID>
              <ns7:POSIndicator>
                <xsl:variable name="pos-var" select="tns:C9"/>
                 <xsl:choose>
                   <xsl:when test='$pos-var = "55"'>
                    <xsl:text disable-output-escaping="no">I</xsl:text>
                  </xsl:when>
                 <xsl:when test='$pos-var = "99"'>
                    <xsl:text disable-output-escaping="no">I</xsl:text>
                  </xsl:when>
                   <xsl:otherwise>
                    <xsl:text disable-output-escaping="no">P</xsl:text>
                  </xsl:otherwise>
                  </xsl:choose>
              </ns7:POSIndicator>
            </ns0:InvoiceHeader>
            <xsl:for-each select="tns:Detail/tns:CC-Dtl">
              <ns0:InvoiceLine>
                <ns0:LineNumber>
                  <xsl:value-of select="tns:C45"/>
                </ns0:LineNumber>
                <ns0:Item>
                  <ns0:ItemID>
                    <ns0:ID>
                      <xsl:value-of select="tns:C36"/>
                    </ns0:ID>
                  </ns0:ItemID>
                  <ns0:CustomerItemID>
                    <ns0:ID>
                      <xsl:value-of select="tns:C47"/>
                    </ns0:ID>
                  </ns0:CustomerItemID>
                  <ns0:Description>
                    <xsl:value-of select="tns:C37"/>
                  </ns0:Description>
                </ns0:Item>
                <ns0:Quantity>
                  <xsl:value-of select="tns:C38"/>
                </ns0:Quantity>
                <ns0:UnitPrice>
                  <ns0:Amount>
                    <xsl:variable name="amnt-var" select="tns:C39 "/>
                    <xsl:value-of select="format-number($amnt-var, '0.00','0.00')"/>
                  </ns0:Amount>
                  <ns0:PerQuantity>
                    <xsl:attribute name="unitCode">
                      <xsl:value-of select="tns:C40"/>
                    </xsl:attribute>
                  </ns0:PerQuantity>
                </ns0:UnitPrice>
                <ns0:PurchaseOrderReference>
                  <ns0:LineNumber>
                    <xsl:value-of select="tns:C46"/>
                  </ns0:LineNumber>
                </ns0:PurchaseOrderReference>
                <!-- <ns0:ExtendedAmount>
                  <xsl:variable name="fmt-var" select="tns:C38 * tns:C39 "/>
               <xsl:value-of select="format-number($fmt-var, '0.00','0.00')"/>
                </ns0:ExtendedAmount> -->
                <ns0:ExtendedAmount>
                    <xsl:variable name="fmt-var" select="tns:C38 * tns:C39"/>
                    <xsl:choose>
                <xsl:when test='$fmt-var = -0.00'>
                    <xsl:value-of select="format-number(abs($fmt-var), '0.00','0.00')"/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:value-of select="format-number(number($fmt-var), '0.00','0.00')"/>
                </xsl:otherwise>
            </xsl:choose>
                </ns0:ExtendedAmount>


                <ns7:OriginalCustomerData>
                  <ns0:NameValue>
                    <xsl:attribute name="name">
                      <xsl:value-of select="tns:C48"/>
                    </xsl:attribute>
                    <xsl:attribute name="type">
                      <xsl:text disable-output-escaping="no">Description</xsl:text>
                    </xsl:attribute>
                  </ns0:NameValue>
                </ns7:OriginalCustomerData>
              </ns0:InvoiceLine>
            </xsl:for-each>
          </ns0:Invoice>
        </xsl:for-each>
      </ns0:DataArea>
    </ns0:ProcessInvoice>
  </xsl:template>
</xsl:stylesheet>
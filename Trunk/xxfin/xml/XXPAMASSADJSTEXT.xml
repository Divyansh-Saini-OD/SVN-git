<dataTemplate name="ProjectMassAdjustmentsExtractReport" description="" Version="1.0">
<properties>
    <property name="scalable_mode" value="on" /> 
    <property name="rtf-output-default-font">Arial:8</property> 
</properties>
<parameters>
</parameters>
<dataQuery>
    <sqlStatement name="Q_PROJECT_INFO">
        <![CDATA[
		SELECT * FROM (SELECT PPA.SEGMENT1 "PROJECT_NUMBER",
  PPA.NAME "PROJECT_NAME",
  PPA.LONG_NAME "PROJECT_LONG_NAME",
  PPS.project_status_name "PROJECT_STATUS",
  SUBSTR(PPA.START_DATE,1,10) "PROJECT_START_DATE",
  SUBSTR(PPA.COMPLETION_DATE,1,10) "PROJECT_END_DATE",
  PPA.ATTRIBUTE1 "PROJECT_LOCATION",
  HAOU.NAME "PROJECT_ORG",
  PT.TASK_NUMBER "TASK_NUMBER",
  PT.TASK_NAME "TASK_NAME",
  SUBSTR(PT.START_DATE,1,10) "TASK_START_DATE",
  SUBSTR(PT.COMPLETION_DATE,1,10) "TASK_END_DATE",
  PT.ATTRIBUTE1 "TASK_LOCATION",
  HAOU1.NAME "TASK_ORG",
  PAC.asset_name "ASSIGN_ASSETS",
  PT.CHARGEABLE_FLAG "ALLOW_CHARGES",
  (SELECT meaning FROM FND_LOOKUP_VALUES WHERE lookup_type='SERVICE TYPE' AND language=USERENV('LANG') AND lookup_code=pt.service_type_code) "SERVICE_TYPE",
  HRE.FULL_NAME "EMPLOYEE_NAME",
  HRE.EMPLOYEE_NUM "EMPLOYEE_NUMBER",
  PPRT.MEANING "ROLE",
  SUBSTR(PPP.START_DATE_ACTIVE,1,10) "ROLE_START_DATE",
  SUBSTR(PPP.END_DATE_ACTIVE,1,10) "ROLE_END_DATE"
FROM PA_PROJECTS_ALL PPA,
  PA_TASKS PT,
 -- PA_PROJECT_ASSETS_ALL PPAA,
 -- PA_PROJECT_ASSET_ASSIGNMENTS PASSG,
  HR_ALL_ORGANIZATION_UNITS HAOU,
  HR_ALL_ORGANIZATION_UNITS HAOU1,
  HR_EMPLOYEES HRE,
  PA_PROJECT_PLAYERS PPP,
  PA_PROJECT_ROLE_TYPES PPRT,
  PA_PROJECT_STATUSES PPS,
  (select passg.project_id project_id, passg.task_id task_id ,passg.project_asset_id project_asset_id,pass.asset_name  
  from PA_PROJECT_ASSET_ASSIGNMENTS passg, PA_PROJECT_ASSETS_ALL pass where pass.project_asset_id=passg.project_asset_id) pac
WHERE PPA.PROJECT_ID(+)=PT.PROJECT_ID
AND PPA.CARRYING_OUT_ORGANIZATION_ID=HAOU.ORGANIZATION_ID(+)
AND PT.CARRYING_OUT_ORGANIZATION_ID =HAOU1.ORGANIZATION_ID(+)
AND PPA.PROJECT_ID                  =PPP.PROJECT_ID
AND PPP.PERSON_ID                   =HRE.EMPLOYEE_ID(+)
AND PPP.PROJECT_ROLE_TYPE           =PPRT.PROJECT_ROLE_TYPE
and pac.task_id(+)=pt.task_id 
AND pps.project_status_code=PPA.project_status_code
AND pps.status_type='PROJECT'
AND (UPPER(PPA.segment1) IN (SELECT UPPER(TRIM(project_number)) project_number FROM XX_PA_MASS_ADJUST_EXT_STG WHERE status ='P'))
UNION
    SELECT UPPER(TRIM(PROJECT_NUMBER)) project_number,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL
        FROM XX_PA_MASS_ADJUST_EXT_STG
        WHERE status ='E')
        ORDER BY PROJECT_NUMBER,PROJECT_NAME,TASK_NUMBER,TASK_NAME,ASSIGN_ASSETS,EMPLOYEE_NUMBER
        ]]> 
    </sqlStatement>
</dataQuery>
<dataStructure>
    <group name="G_PROJECT_INFO" source="Q_PROJECT_INFO">
        <element name="PROJECT_NUMBER" value="PROJECT_NUMBER" function="" /> 
        <element name="PROJECT_NAME" value="PROJECT_NAME" function="" /> 
        <element name="PROJECT_LONG_NAME" value="PROJECT_LONG_NAME" function="" />
        <element name="PROJECT_STATUS" value="PROJECT_STATUS" function="" />
        <element name="PROJECT_START_DATE" value="PROJECT_START_DATE" function="" /> 
		<element name="PROJECT_END_DATE" value="PROJECT_END_DATE" function="" />
        <element name="PROJECT_LOCATION" value="PROJECT_LOCATION" function="" />
        <element name="PROJECT_ORG" value="PROJECT_ORG" function="" />
        <element name="TASK_NUMBER" value="TASK_NUMBER" function="" />
        <element name="TASK_NAME" value="TASK_NAME" function="" />
        <element name="TASK_START_DATE" value="TASK_START_DATE" function="" />
        <element name="TASK_END_DATE" value="TASK_END_DATE" function="" />
        <element name="TASK_LOCATION" value="TASK_LOCATION" function="" />
        <element name="TASK_ORG" value="TASK_ORG" function="" />
        <element name="ASSIGN_ASSETS" value="ASSIGN_ASSETS" function="" />
        <element name="ALLOW_CHARGES" value="ALLOW_CHARGES" function="" />
        <element name="SERVICE_TYPE" value="SERVICE_TYPE" function="" />
        <element name="EMPLOYEE_NAME" value="EMPLOYEE_NAME" function="" />
        <element name="EMPLOYEE_NUMBER" value="EMPLOYEE_NUMBER" function="" />
        <element name="ROLE" value="ROLE" function="" />
        <element name="ROLE_START_DATE" value="ROLE_START_DATE" function="" />
        <element name="ROLE_END_DATE" value="ROLE_END_DATE" function="" />
	</group>
</dataStructure>
</dataTemplate>

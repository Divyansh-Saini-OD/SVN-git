<?xml version="1.0" encoding="WINDOWS-1252" ?>
<dataTemplate name="XXCEMPLR" defaultPackage="XX_CE_MRKTPLC_LOAD_PKG" description="OD: CE Market Place Exception Report" Version="1.0">
<parameters>
 <parameter name="p_from_date" datatype="varchar2" />
 <parameter name="p_to_date" datatype="varchar2" />
</parameters>
<dataQuery>
<sqlStatement name="Q_MPLR">
<![CDATA[
 SELECT report_date,
  'EBAY_MPL' process_name,
  filename,
  channel_advisor_order_id order_id,
  NULL po_num,
  NULL txn_date,
  NULL txn_type,
  NULL line_no ,
  NULL price_type,
  NULL Fee_type,
  TO_CHAR(order_total) amount,
  'LOAD' exp_type,
  err_msg
FROM xx_ce_ebay_ca_dtl_stg
WHERE process_flag='E'
AND TRUNC(report_date) BETWEEN TRUNC(apps.fnd_conc_date.string_to_date(NVL(:p_from_date,report_date))) AND TRUNC(apps.fnd_conc_date.string_to_date(NVL(:p_to_date,report_date)))
UNION ALL
SELECT report_date,
  'EBAY_MPL'process_name,
  filename,
  transaction_id order_id,
  NULL po_num,
  transaction_completion_date txn_date,
  transaction_event_code txn_type,
  NULL line_no ,
  NULL price_type,
  NULL Fee_type,
  TO_CHAR((gross_transaction_amount/100)) amount,
  'LOAD' exp_type,
  err_msg
FROM xx_ce_ebay_trx_dtl_stg
WHERE process_flag='E'
AND TRUNC(report_date) BETWEEN TRUNC(apps.fnd_conc_date.string_to_date(NVL(:p_from_date,report_date))) AND TRUNC(apps.fnd_conc_date.string_to_date(NVL(:p_to_date,report_date)))
UNION ALL
SELECT a.creation_date,
  a.marketplace_name process_name,
  a.ajb_file_name filename,
  a.order_id order_id,
  NULL po_num,
  NULL txn_date,
  a.transaction_type txn_type,
  NULL line_no,
  b.price_type,
  b.item_related_fee_type fee_type,
  TO_CHAR(a.total_amount) amount,
  'PROCESS' exp_type,
  b.error_description
FROM XX_CE_MPL_SETTLEMENT_DTL b,
  XX_CE_MPL_SETTLEMENT_HDR a
WHERE TRUNC(a.creation_date) BETWEEN TRUNC(apps.fnd_conc_date.string_to_date(NVL(:p_from_date,a.creation_date))) AND TRUNC(apps.fnd_conc_date.string_to_date(NVL(:p_to_date,a.creation_date)))
AND b.order_id     =a.order_id
AND a.record_status='E'
AND b.record_status='E'
UNION ALL
SELECT report_date,
  'WALMART_MPL'process_name,
  filename,
  walmart_po order_id,
  NULL po_num,
  transaction_date_time txn_date,
  transaction_type txn_type,
  walmart_po_line line_no ,
  NULL price_type,
  NULL Fee_type,
  TO_CHAR(total_tender_customer) amount,
  'LOAD' exp_type,
  err_msg
FROM xx_ce_walmart_pre_stg_v
WHERE process_flag='E'
AND TRUNC(report_date) BETWEEN TRUNC(apps.fnd_conc_date.string_to_date(NVL(:p_from_date,report_date))) AND TRUNC(apps.fnd_conc_date.string_to_date(NVL(:p_to_date,report_date)))
UNION ALL
SELECT REPORT_DATE,
  'RAKUTEN_MPL' PROCESS_NAME,
  FILENAME,
  ORDERID ORDER_ID,
  NULL PO_NUM,
  TRANDATE TXN_DATE,
  TRANTYPE TXN_TYPE,
  NULL LINE_NO ,
  NULL PRICE_TYPE,
  NULL FEE_TYPE,
  TO_CHAR(BUYERPAID) amount,
  'LOAD' EXP_TYPE,
  ERR_MSG
FROM XX_CE_RAKUTEN_PRE_STG_V
WHERE process_flag='E'
AND TRUNC(REPORT_DATE) BETWEEN TRUNC(APPS.FND_CONC_DATE.STRING_TO_DATE(NVL(:P_FROM_DATE,REPORT_DATE))) AND TRUNC(apps.fnd_conc_date.string_to_date(NVL(:p_to_date,report_date)))
UNION ALL
SELECT REPORT_DATE,
  'SEARS_MPL' PROCESS_NAME,
  FILENAME,
  NULL ORDER_ID,
  PO_NUMBER PO_NUM,
  PO_DATE TXN_DATE,
  TYPE TXN_TYPE,
  NULL LINE_NO ,
  NULL PRICE_TYPE,
  NULL FEE_TYPE,
  INVOICE_AMOUNT AMOUNT,
  'LOAD' EXP_TYPE,
  ERR_MSG
FROM XX_CE_SEARS_PRE_STG_V
WHERE PROCESS_FLAG='E'
AND TRUNC(REPORT_DATE) BETWEEN TRUNC(APPS.FND_CONC_DATE.STRING_TO_DATE(NVL(:P_FROM_DATE,REPORT_DATE))) AND TRUNC(APPS.FND_CONC_DATE.STRING_TO_DATE(NVL(:P_TO_DATE,REPORT_DATE)))
UNION ALL
SELECT report_date,
  process_name,
  filename,
  order_id,
  po_num,
  txn_date,
  txn_type,
  line_no ,
  price_type,
  Fee_type,
  amount,
  EXP_TYPE,
  ERR_MSG
FROM XX_CE_OD_MKTPLC_EXCP_V
WHERE TRUNC(REPORT_DATE) BETWEEN TRUNC(APPS.FND_CONC_DATE.STRING_TO_DATE(NVL(:P_FROM_DATE,REPORT_DATE))) AND TRUNC(apps.fnd_conc_date.string_to_date(NVL(:p_to_date,report_date)))
ORDER BY 1,2,3,4,8,11 
 ]]>
</sqlStatement>
</dataQuery>
<dataTrigger name="beforeReport" source="XX_CE_MRKTPLC_LOAD_PKG.beforeReport()"/>
<dataStructure>
<group name="G_MPLR" source="Q_MPLR">
<element name="REPORT_DATE" value="REPORT_DATE" />
<element name="PROCESS_NAME" value="PROCESS_NAME" />
<element name="FILENAME" value="FILENAME" />
<element name="ORDER_ID" value="ORDER_ID" />
<element name="PO_NUM" value="PO_NUM" />
<element name="TXN_DATE" value="TXN_DATE" />
<element name="TXN_TYPE" value="TXN_TYPE" />
<element name="LINE_NO" value="LINE_NO" />
<element name="PRICE_TYPE" value="PRICE_TYPE" />
<element name="FEE_TYPE" value="FEE_TYPE" />
<element name="AMOUNT" value="AMOUNT" />
<element name="EXP_TYPE" value="EXP_TYPE" />
<element name="ERR_MSG" value="ERR_MSG" />
</group>
</dataStructure>
</dataTemplate>

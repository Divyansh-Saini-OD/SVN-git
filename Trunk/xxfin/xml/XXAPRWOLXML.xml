<?xml version="1.0" encoding="UTF-8"?>
<dataTemplate name="XX_AP_RWOLXML"   defaultPackage="XX_AP_RWOLXML_PKG" Version="1.0">
<parameters>
<parameter name="P_DATE_FROM" dataType="date"/>
<parameter name="P_DATE_TO" dataType="date"/>
<parameter name="P_SUPPLIER_SITE_CODE" dataType="string"/>
<parameter name="P_CONC_REQUEST_ID" dataType="number"/>

  </parameters>
 <dataQuery>
 <sqlStatement name="Q1">
 <![CDATA[ SELECT DISTINCT
  DECODE(SUBSTR(aspa.base_currency_code,1,2),'US','USTR','CA','CNTR',SUBSTR(aspa.base_currency_code,1,2)) comp,
  hls.location_code loc,
  pov.vendor_name supplier_name,
  cwo.write_off_amount amt_write_off,
  TO_CHAR(cwo.transaction_date,'MM/DD/YYYY') written_off_date,
  gcc.concatenated_segments offset_account,  
  NVL(poh.CLM_DOCUMENT_NUMBER,poh.SEGMENT1) po_number,--Changed as a part of CLM
  DECODE( fus.user_id,'-1','System SPID',fus.user_name) userid,
  pov.segment1 global_number,
  ass.vendor_site_code supplier_site_name,
  ass.attribute8 supplier_site_category,
  mtr.reason_name wo_code,
  it.segment1 sku
FROM apps.cst_write_offs cwo,
  apps.mtl_system_items_b it,
  apps.ap_suppliers pov,         
  apps.ap_supplier_sites_all ass,
  apps.mtl_transaction_reasons mtr,
  apps.po_headers_all poh,
  apps.po_lines_all pol,
  apps.po_releases_all por,
  apps.po_line_locations_all poll,
  apps.po_distributions_all pod,
  apps.cst_write_off_details cwod,
  apps.ap_invoices_all apia,
  apps.ap_invoice_distributions_all aida,
  apps.rcv_transactions rct,
  apps.rcv_shipment_headers rsh,
  apps.mtl_parameters mp,
--  apps.po_destination_types_all_v pdt,
  apps.gl_code_combinations_kfv gcc,
  apps.mtl_material_transactions mmt,
  apps.cst_accrual_accounts caa,
  apps.hr_locations hls,
  apps.fnd_user fus,
  apps.ap_system_parameters_all aspa,
  apps.xla_ae_lines xel,
  apps.xla_ae_headers xeh,
  apps.xla_transaction_entities_upg xte
WHERE cwo.write_off_id           = cwod.write_off_id
AND pov.vendor_id(+)             = cwo.vendor_id
AND mtr.reason_id(+)             = cwo.reason_id
AND pov.vendor_id                = ass.vendor_id
AND cwo.inventory_item_id        = it.inventory_item_id 
AND it.organization_id           = 441                  
AND poh.vendor_id                = pov.vendor_id
AND poh.vendor_site_id           =ass.vendor_site_id
AND pod.po_distribution_id(+)    = cwo.po_distribution_id
AND poll.line_location_id(+)     = pod.line_location_id
AND pol.po_line_id(+)            = pod.po_line_id
AND por.po_release_id(+)         = pod.po_release_id
AND poh.po_header_id             = pod.po_header_id
AND cwod.invoice_distribution_id = aida.invoice_distribution_id (+)
AND apia.invoice_id(+)           = aida.invoice_id
AND cwod.rcv_transaction_id      = rct.transaction_id(+)
AND rsh.shipment_header_id(+)    = rct.shipment_header_id
--AND pdt.lookup_code(+)             = cwo.destination_type_code
AND cwod.inventory_organization_id = mp.organization_id(+)
AND cwod.inventory_transaction_id  = mmt.transaction_id (+)
AND cwo.accrual_account_id         = caa.accrual_account_id
AND cwo.created_by                 = fus.user_id
AND hls.location_id                = poh.ship_to_location_id
AND cwo.operating_unit_id          =aspa.org_id
AND RSH.RECEIPT_NUM               IS NOT NULL
AND cwo.transaction_date BETWEEN nvl( :P_date_from, cwo.transaction_date - 1 )
                                AND nvl(  :P_date_to, cwo.transaction_date + 1 )
AND ass.vendor_site_code   =NVL(:p_supplier_site_code,ass.vendor_site_code)
AND xel.application_id     = xeh.application_id
AND xte.application_id     = xeh.application_id
AND xel.ae_header_id       = xeh.ae_header_id
AND xte.entity_code        = 'WO_ACCOUNTING_EVENTS'
AND xte.source_id_int_1    = cwo.write_off_id
AND xte.entity_id          = xeh.entity_id
AND gcc.code_combination_id=xel.code_combination_id
AND accounting_class_code  ='OFFSET'
]]> 
</sqlStatement>
 
  </dataQuery>
  <dataTrigger name="beforeReport" 
source="XX_AP_RWOLXML_PKG.beforeReport()"/>
 <dataStructure>
 <group name="G_XXAPRWOL_DUP" source="Q1">
<element name="AMTSUM" value="G_XXAPRWOL_HEADER.AMT_WRITE_OFF" function="SUM()"/>
-<group name="G_XXAPRWOL_HEADER" source="Q1">
<element name="COMP" value="COMP"/>
<element name="LOC" value="LOC"/>
<element name="SUPPLIER_NAME" value="SUPPLIER_NAME"/> 
<!--<element name="RECEIVER_NUMBER" value="RECEIVER_NUMBER"/> Removed as per defect 44994 Jira NAIT-39515-->
<!--<element name="RCVR_DATE" value="RCVR_DATE"/> Removed as per defect 44994 Jira NAIT-39515-->
<element name="AMT_WRITE_OFF" value="AMT_WRITE_OFF"/>
<element name="WRITTEN_OFF_DATE" value="WRITTEN_OFF_DATE"/>
<element name="OFFSET_ACCOUNT" value="OFFSET_ACCOUNT"/>
<element name="PO_NUMBER" value="PO_NUMBER"/>
<element name="USERID" value="USERID"/>
<element name="GLOBAL_NUMBER" value="GLOBAL_NUMBER"/>
<element name="SUPPLIER_SITE_NAME" value="SUPPLIER_SITE_NAME"/>
<element name="SUPPLIER_SITE_CATEGORY" value="SUPPLIER_SITE_CATEGORY"/>
<element name="WO_CODE" value="WO_CODE"/>
</group>
</group>
  </dataStructure>
  <dataTrigger name="afterReport" 
source="XX_AP_RWOLXML_PKG.afterReport()"/>

  </dataTemplate>  

package od.oracle.apps.xxfin.ap.idms.traitmatrix.server;

import java.sql.CallableStatement;
import java.sql.PreparedStatement;

import java.sql.Types;

import oracle.apps.fnd.framework.server.OAApplicationModuleImpl;

import oracle.apps.fnd.framework.server.OADBTransaction;

import oracle.jbo.Row;

import od.oracle.apps.xxfin.ap.idms.traitmatrix.PopList.StatusPopListVOImpl;
import od.oracle.apps.xxfin.ap.idms.traitmatrix.lov.server.XXOperatingUnitLovVOImpl;
import od.oracle.apps.xxfin.ap.idms.traitmatrix.lov.server.XXSuppTraitImpl;
import od.oracle.apps.xxfin.ap.idms.traitmatrix.lov.server.xxsuppliernamelovImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class XXSupplierMatrixAMImpl extends OAApplicationModuleImpl {
    /**This is the default constructor (do not remove)
     */
    public XXSupplierMatrixAMImpl() {
    }

    /**Sample main for debugging Business Components code using the tester.
     */
    public static void main(String[] args) {
        launchTester("od.oracle.apps.xxfin.ap.idms.traitmatrix.server", /* package name */
      "XXSupplierMatrixAMLocal" /* Configuration Name */);
    }


    /**Container's getter for xxsuppliernamelov1
     */
    public xxsuppliernamelovImpl getxxsuppliernamelov1() {
        return (xxsuppliernamelovImpl)findViewObject("xxsuppliernamelov1");
    }

    /**Container's getter for XXOperatingUnitLovVO1
     */
    public XXOperatingUnitLovVOImpl getXXOperatingUnitLovVO1() {
        return (XXOperatingUnitLovVOImpl)findViewObject("XXOperatingUnitLovVO1");
    }

    /**Container's getter for StatusPopListVO1
     */
    public StatusPopListVOImpl getStatusPopListVO1() {
        return (StatusPopListVOImpl)findViewObject("StatusPopListVO1");
    }

    /**Container's getter for SupplierMatrixAdvVO1
     */
    public SupplierMatrixAdvVOImpl getSupplierMatrixAdvVO1() {
        return (SupplierMatrixAdvVOImpl)findViewObject("SupplierMatrixAdvVO1");
    }


    public void initSuppTraitLov(String sNo) {
        
    XXSuppTraitImpl   vo =this.getXXSuppTrait1();
    vo.clearCache();
    vo.setWhereClause(null);
    vo.setWhereClauseParams(null);
    vo.setWhereClauseParam(0,null);
    vo.setWhereClauseParam(0,Integer.parseInt(sNo));  
    vo.executeQuery();
    System.out.println("supplier trait lov query "+vo.getQuery());
    }
    
    
    public  void  enableTarget(String  flag) {
        
        XXTransVOImpl vo =getXXTransVO1();
        
        vo.executeQuery();
        
        if(flag.equals("F")) {
            
            if(vo.first()!=null) {
                
            vo.first().setAttribute("XXDispAttr",false);
            }
        }
        
        if(flag.equals("N")) {
            
            if(vo.first()!=null) {
                
            vo.first().setAttribute("XXDispAttr",true);
            }
        }
    }
    
    
    public void initRow() {
        
        SupplierMatrixAdvVOImpl vo =getSupplierMatrixAdvVO1();
        
        Row  r = vo.createRow();
        
        if(!vo.isPreparedForExecution()) {
            
            vo.setMaxFetchSize(0);
        }
        
        vo.insertRow(r);
        
        r.setNewRowState(Row.STATUS_INITIALIZED);
    }


    public void initMatrixRow(String supNo) {
        
       //SupplierMatrixAdvVOImpl svo =getSupplierMatrixAdvVO1();
        XXSuppMatrixVOImpl  vo =  getXXSuppMatrixVO1();
        Row  r = vo.createRow();
        
        if(!vo.isPreparedForExecution()) {
            
            vo.setMaxFetchSize(0);
        }
        
        vo.insertRow(r);
        
        r.setNewRowState(Row.STATUS_INITIALIZED);
       // r.setAttribute("Supplier",svo.first().getAttribute("Supplier"));
        r.setAttribute("Supplier",supNo);
        r.setAttribute("EnableFlag","Y");
        //r.setAttribute("Attribute1","A");
        
        enableTarget("F");
    }
    
    
    public void updMatrixRow(String tId,String sNo, String straitid) {
        XXSuppMatrixVOImpl  vo =  getXXSuppMatrixVO1();
        vo.clearCache();
        vo.setWhereClause(null);
        String wclause  = "  SUPPLIER = '"+sNo+"'  AND  SUP_TRAIT_ID = '"+straitid+"'";
        vo.setWhereClause(wclause); 
        System.out.println("TRAIT "+tId+" -- Sno "+sNo);
        System.out.println("SuppMatriv Query "+vo.getQuery());
        vo.executeQuery();    
       /* if(vo.first()!=null) {
            
            vo.first().setAttribute("Attribute1","U");
        } */      
        enableTarget("N");
        
    }


    public void saveData() {
       
       getOADBTransaction().commit();
   }
   
   public void updateFlag(String  rowRef) {
   
       Row   row = this.findRowByRef(rowRef);
       
    
       String sId  = null;
       String sNo  = null;
       
       if(row!=null) {
           if(row.getAttribute("Suptrait")!=null) {
               
              sId = row.getAttribute("Suptrait").toString();
           }
           
           if(row.getAttribute("Supplier")!=null) {
               
              sNo = row.getAttribute("Supplier").toString();
           }
       }
       PreparedStatement ps = null;
       String sql  = "UPDATE XX_AP_SUP_TRAITS_MATRIX  SET ATTRIBUTE1 = ' ' WHERE SUP_TRAIT = '"+sId+"'  and SUPPLIER = '"+sNo+"'";
       try  {
       
       ps  = this.getOADBTransaction().getJdbcConnection().prepareStatement(sql);
       
       ps.executeUpdate();
       
       this.getOADBTransaction().commit();
       
       ps.close();
       
           row.removeFromCollection();
           
       } catch (Exception ex)  {
           ex.printStackTrace();
       } finally  {
       }
       
   }

    /**Container's getter for XXSuppTrait1
     */
    public XXSuppTraitImpl getXXSuppTrait1() {
        return (XXSuppTraitImpl)findViewObject("XXSuppTrait1");
    }
    
    public void updateTelex(String Supplier) {
    

    
        CallableStatement callableStatement = 
            getOADBTransaction().createCallableStatement("begin  XX_AP_SUP_REAL_OUT_RMS_XML_pkg.xx_ap_supp_rms_update_telex(:1,:2); end;", 
                                                         OADBTransaction.DEFAULT);
    
        try {  
            //registering out parameter
             callableStatement.registerOutParameter(2, Types.VARCHAR);
            
            callableStatement.setString(1,Supplier);
           
            callableStatement.execute();
    
           // String tagValue = callableStatement.getString(3);
    
          //  if (tagValue != null) {
    
            //    System.out.println("Tag value: " + tagValue);
    
           // }
    
        } catch (Exception e) {
    
            System.out.println(" XX in Catch Block of callableStatement: " + 
                               e.getMessage());
        }
    }


    /**Container's getter for XXTransVO1
     */
    public XXTransVOImpl getXXTransVO1() {
        return (XXTransVOImpl)findViewObject("XXTransVO1");
    }

    /**Container's getter for XXSuppMatrixVO1
     */
    public XXSuppMatrixVOImpl getXXSuppMatrixVO1() {
        return (XXSuppMatrixVOImpl)findViewObject("XXSuppMatrixVO1");
    }
}

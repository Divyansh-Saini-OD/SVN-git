/*===========================================================================+

 |      		       Office Depot - Project Simplify                           |

 |            Oracle NAIO/WIPRO/Office Depot/Consulting Organization         |

 +===========================================================================+

 |  FILENAME                                                                 |

 |             ODCustomerSearchResultsVOImpl.java                            |

 |                                                                           |

 |  DESCRIPTION                                                              |

 |             ViewObject Implementation file for the sales customer         |     

 |             search results table region .                                 |                                        

 |                                                                           |

 | Subversion Info:

 | $HeadURL: http://svn.na.odcorp.net/svn/od/common/trunk/xxcomn/java/od/oracle/apps/xxcrm/asn/custsrch/common/customer/server/ODCustomerSearchResultsVOImpl.java $

 | $Rev: 98780 $

 | $Date: 2010-04-12 16:41:24 -0400 (Mon, 12 Apr 2010) $

 |                                                                           |

 |  NOTES                                                                    |

 |                                                                           |

 |                                                                           |

 |                                                                           |

 |  HISTORY                                                                  |

 |                                                                           |

 |    17-Mar-2008 Jasmine Sujithra   Created                                 |                         

 |    03-Apr-2008 Jasmine Sujithra   Added Log message in executeQuery       |
 |    16-Sep-2009 Anirban Chaudhuri  Fixed defect#2525 in PRDGB.             |
 |    12-Apr-2010 Indra Varada	     Fix for QC#4338                         |
 +===========================================================================*/



package od.oracle.apps.xxcrm.asn.custsrch.common.customer.server;



import oracle.apps.fnd.framework.server.OAViewObjectImpl;

import oracle.apps.fnd.framework.server.OADBTransactionImpl;

import oracle.apps.fnd.framework.OAFwkConstants;

import oracle.apps.fnd.common.MessageToken;

import oracle.apps.asn.common.schema.server.ASNUtil;

//import com.sun.java.util.collections.Iterator;



//  ---------------------------------------------------------------

//  ---    File generated by Oracle Business Components for Java.

//  ---------------------------------------------------------------



public class ODCustomerSearchResultsVOImpl extends OAViewObjectImpl {



    public void initQuery(String loginResourceId)

    {

        OADBTransactionImpl oadbtransactionimpl = (OADBTransactionImpl)getApplicationModule().getTransaction();

        boolean isStatLogEnabled = oadbtransactionimpl.isLoggingEnabled(OAFwkConstants.STATEMENT);

        if(isStatLogEnabled)   

        {

          oadbtransactionimpl.writeDiagnostics(this,  "ODCustomerSearchResultsVOImpl: In initQuery", OAFwkConstants.STATEMENT);

        }

        /* Modified to get the Maximum number of rows to be displayed from a profile */

        String maxDefaultCustRows = (String)oadbtransactionimpl.getProfile("XX_ASN_MAX_DEFAULT_CUST_SRCH_ROWS");

        if(maxDefaultCustRows == null || "".equals(maxDefaultCustRows))

        {

          maxDefaultCustRows = "200";

        }



        setWhereClauseParams(null);

        String whereClause ="EXISTS( SELECT 1 FROM xx_tm_nam_terr_entity_dtls   xtnted  ,xx_tm_nam_terr_rsc_dtls      xtntrd  ,xx_tm_nam_terr_defn  xtntd WHERE xtnted.entity_id  = QRSLT.party_site_id  AND   xtntrd.named_acct_terr_id = xtnted.named_acct_terr_id AND   xtntd.named_acct_terr_id  = xtntrd.named_acct_terr_id  AND   xtnted.named_acct_terr_id = xtntd.named_acct_terr_id  AND   xtntrd.resource_id        = :1 AND   xtnted.entity_type        = 'PARTY_SITE' ";

        whereClause = whereClause + "AND sysdate between nvl(xtntrd.start_date_active,sysdate-1) and nvl(xtntrd.end_date_active,sysdate +1) AND   sysdate between nvl(xtnted.start_date_active,sysdate-1) and nvl(xtnted.end_date_active, sysdate+1)  AND   sysdate between nvl(xtntd.start_date_active,sysdate-1) and nvl(xtntd.end_date_active,sysdate+1) AND   xtnted.status  = 'A' AND   xtntrd.status = 'A' AND   xtntd.status = 'A' )AND ROWNUM <= :2";



        setWhereClause(whereClause);



        if(loginResourceId != null && !"".equals(loginResourceId.trim()))

        {

            MessageToken amessagetoken[] = {

                new MessageToken("IDNAME", loginResourceId)

            };

            oracle.jbo.domain.Number number = ASNUtil.stringToJboNumber(loginResourceId, "ASN_CMMN_STR_TO_JBONUM_ERR", amessagetoken);

            setWhereClauseParam(0, number);

			//setWhereClauseParam(1, number);

        }

       setWhereClauseParam(1, maxDefaultCustRows);

	     String Query = getQuery();

       oadbtransactionimpl.writeDiagnostics(this,  "In initQuery ODCustomerSearchResultsVOImpl PRINTING THE VO QUERY - "+Query, OAFwkConstants.STATEMENT);

       //executeQuery();

    }



    public void executeQuery()

    {

         OADBTransactionImpl oadbtransactionimpl = (OADBTransactionImpl)getApplicationModule().getTransaction();

        boolean isStatLogEnabled = oadbtransactionimpl.isLoggingEnabled(OAFwkConstants.STATEMENT);

        if(isStatLogEnabled)   

        {

          oadbtransactionimpl.writeDiagnostics(this,  "ODCustomerSearchResultsVOImpl: In executeQuery", OAFwkConstants.STATEMENT);

        }

        String query = getQuery();

        String whereClause = getWhereClause();

        oadbtransactionimpl.writeDiagnostics(this,  "ODCustomerSearchResultsVOImpl: Where Clause is : "+whereClause, OAFwkConstants.STATEMENT);

        oadbtransactionimpl.writeDiagnostics(this,  "ODCustomerSearchResultsVOImpl: In executeQuery : "+query, OAFwkConstants.STATEMENT);

        super.executeQuery();



        query = getQuery();

        whereClause = getWhereClause();

        oadbtransactionimpl.writeDiagnostics(this,  "ODCustomerSearchResultsVOImpl: After call to super.executeQuery Where Clause is : "+whereClause, OAFwkConstants.STATEMENT);

        oadbtransactionimpl.writeDiagnostics(this,  "ODCustomerSearchResultsVOImpl: In executeQuery - After call to super.executeQuery: "+query, OAFwkConstants.STATEMENT);

    }



    



  /**

   * 

   * This is the default constructor (do not remove)

   */

    public ODCustomerSearchResultsVOImpl()

    {

    } 

    

}
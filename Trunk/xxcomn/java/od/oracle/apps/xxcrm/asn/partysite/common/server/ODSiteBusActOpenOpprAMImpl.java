/*===========================================================================+
 |                       Office Depot - Project Simplify                     |
 |            Oracle NAIO/WIPRO/Office Depot/Consulting Organization         |
 +===========================================================================+
 |  FILENAME                                                                 |
 |             ODSiteBusActOpenOpprAMImpl.java                               |
 |                                                                           |
 |  DESCRIPTION                                                              |
 |    Application Module for open opportunities business activities at the   |
 |    party site level.                                                      |
 |                                                                           |
 |  NOTES                                                                    |
 |                                                                           |
 |                                                                           |
 |  DEPENDENCIES                                                             |
 |    This class file is called from ODSiteBusActOpenOpprCOImpl.java         |
 |                                                                           |
 |  HISTORY                                                                  |
 |                                                                           |
 |    04/09/2007 Ashok Kumar   Created                                       |
 |                                                                           |
 +===========================================================================*/
package od.oracle.apps.xxcrm.asn.partysite.common.server;
import od.oracle.apps.xxcrm.asn.common.fwk.server.ODASNApplicationModuleImpl;
import oracle.apps.fnd.common.MessageToken;
import oracle.apps.fnd.common.VersionInfo;
import oracle.apps.fnd.framework.OAException;
import oracle.apps.fnd.framework.OAFwkConstants;
import oracle.apps.fnd.framework.server.OADBTransaction;
import oracle.apps.asn.common.customer.server.BusActOpportunitiesPVOImpl;
import oracle.apps.asn.common.customer.server.BusActOpportunitiesPVORowImpl;

//  ---------------------------------------------------------------
//  ---    File generated by Oracle Business Components for Java.
//  ---------------------------------------------------------------

public class ODSiteBusActOpenOpprAMImpl extends ODASNApplicationModuleImpl 
{
  /**
  * Oracle Applications internal source control identifier.
  */
  public static final String RCS_ID="$Header: ODSiteBusActOpenOpprAMImpl.java 115.01 2007/09/04 18:25:36 Ashokuma noship $";

  /**
  * Oracle Applications internal source control identifier.
  */
  public static final boolean RCS_ID_RECORDED =
    VersionInfo.recordClassVersion(RCS_ID, "od.oracle.apps.xxcrm.asn.partysite.common.server");

  /**
   * 
   * This is the default constructor (do not remove)
   */
  public ODSiteBusActOpenOpprAMImpl()
  {
  }

  /**
   * 
   * Sample main for debugging Business Components code using the tester.
   */
  public static void main(String[] args)
  {
    launchTester("od.oracle.apps.xxcrm.asn.partysite.common.server", "ODSiteBusActOpenOpprAMLocal");
  }


  /**
   * 
   * Container's getter for BusActOpportunitiesPVO
   */
  public BusActOpportunitiesPVOImpl getBusActOpportunitiesPVO()
  {
    return (BusActOpportunitiesPVOImpl)findViewObject("BusActOpportunitiesPVO");
  }

  /**
   *
   * Method to initialize the opportunity transient VO
   */
  public void initOpenOpptyPVO(String lookupCode)
  {
    final String METHOD_NAME = "xxcrm.asn.partysite.common.server.ODSiteBusActOpenOpprAMImpl.initOpenOpptyPVO";
    OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
    boolean isProcLogEnabled = dbTrx.isLoggingEnabled(OAFwkConstants.PROCEDURE);

    if (isProcLogEnabled)
    {
      dbTrx.writeDiagnostics(METHOD_NAME, "Begin", OAFwkConstants.PROCEDURE);
    }
    BusActOpportunitiesPVOImpl voChild = getBusActOpportunitiesPVO();
    if (voChild == null)
    {
       MessageToken[] tokens = { new MessageToken("OBJECT_NAME", "BusActOpportunitiesPVOImpl") };
       throw new OAException("ASN", "ASN_CMMN_OBJ_MISS_ERR", tokens);
    }
    int fetchedRowCount = voChild.getFetchedRowCount();
    if(fetchedRowCount <= 0)
    {
       voChild.setMaxFetchSize(0);
       voChild.insertRow(voChild.createRow());
    }
    BusActOpportunitiesPVORowImpl rowChild = (BusActOpportunitiesPVORowImpl)voChild.first();

    if(lookupCode !=null && "XX_SITE_OPEN_OPPTY".equals(lookupCode))
    {
       rowChild.setRenderOpp(Boolean.TRUE);       
    }else
    {
       rowChild.setRenderOpp(Boolean.FALSE);
    }

    if (isProcLogEnabled)
    {
       dbTrx.writeDiagnostics(METHOD_NAME,"End", OAFwkConstants.PROCEDURE);
    }

  }  

  /**
   *
   * Method to initialize the open opportunity VO
   */
  public void initOpenOpptyVO(String partySiteId, String lookupCode)
  {
    final String METHOD_NAME = "xxcrm.asn.partysite.common.server.ODSiteBusActOpenOpprAMImpl.initOpenOpptyVO";
    OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
    boolean isProcLogEnabled = dbTrx.isLoggingEnabled(OAFwkConstants.PROCEDURE);

    if (isProcLogEnabled)
    {
      dbTrx.writeDiagnostics(METHOD_NAME, "Begin", OAFwkConstants.PROCEDURE);
    }
    if(partySiteId != null && lookupCode != null && lookupCode.equals("XX_SITE_OPEN_OPPTY"))
    {
        ODSiteOpenOpprVOImpl vo = getODSiteOpenOpprVO();
        if (vo == null)
        {
          MessageToken[] tokens = { new MessageToken("OBJECT_NAME", "ODSiteOpenOpprVOImpl") };
          throw new OAException("ASN", "ASN_CMMN_OBJ_MISS_ERR", tokens);
        }
        vo.setMaxFetchSize(-1);
        vo.initQuery(partySiteId);
    }

    if (isProcLogEnabled)
    {
      dbTrx.writeDiagnostics(METHOD_NAME,"End", OAFwkConstants.PROCEDURE);
    }

  } // end initOpenOpportunities
 
  /**
   *
   * Method to reset the open opportunity VO
   */
  public void resetQuery()
  {
    final String METHOD_NAME = "xxcrm.asn.partysite.common.server.ODSiteBusActOpenOpprAMImpl.resetQuery";
    OADBTransaction dbTrx = (OADBTransaction)getOADBTransaction();
    boolean isProcLogEnabled = dbTrx.isLoggingEnabled(OAFwkConstants.PROCEDURE);

    if (isProcLogEnabled)
    {
      dbTrx.writeDiagnostics(METHOD_NAME, "Begin", OAFwkConstants.PROCEDURE);
    }
      ODSiteOpenOpprVOImpl vo1 = getODSiteOpenOpprVO();
      if (vo1 == null)
      {
        MessageToken[] tokens = { new MessageToken("OBJECT_NAME", "ODSiteOpenOpprVOImpl") };
        throw new OAException("ASN", "ASN_CMMN_OBJ_MISS_ERR", tokens);
      }
      if(vo1.isPreparedForExecution())
      {
        vo1.setPreparedForExecution(false);
      }

      if (isProcLogEnabled)
      {
        dbTrx.writeDiagnostics(METHOD_NAME,"End", OAFwkConstants.PROCEDURE);
      }

  }

  /**
   * 
   * Container's getter for ODSiteOpenOpprVO
   */
  public ODSiteOpenOpprVOImpl getODSiteOpenOpprVO()
  {
    return (ODSiteOpenOpprVOImpl)findViewObject("ODSiteOpenOpprVO");
  }


}
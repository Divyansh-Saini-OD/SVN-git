<?xml version="1.0" encoding='windows-1252'?>
<!DOCTYPE ViewObject SYSTEM "jbo_03_01.dtd">

<ViewObject
   Name="ODTopOpenOpptyResourceVO"
   Extends="oracle.apps.asn.dashboard.server.TopOpenOpptyResourceVO"
   BindingStyle="Oracle"
   CustomQuery="true"
   RowClass="od.oracle.apps.xxcrm.asn.dashboard.server.ODTopOpenOpptyResourceVORowImpl"
   ComponentClass="od.oracle.apps.xxcrm.asn.dashboard.server.ODTopOpenOpptyResourceVOImpl"
   MsgBundleClass="oracle.jbo.common.JboResourceBundle"
   UseGlueCode="false" >
   <SQLQuery><![CDATA[
SELECT  top_oppty.description,
        top_oppty.lead_id,
        top_oppty.party_id,
        hp.party_name,
        asst.name as sales_stage_name,
        top_oppty.total_amount,
        top_oppty.forecast_amount,
        top_oppty.forecast_rank,
        top_oppty.decision_date,
        top_oppty.win_probability,
        :1 as CurrenyCode
FROM    (SELECT  * 
         FROM    (SELECT ala.description as description,
                       ala.lead_id ,
                       ala.customer_id as party_id,
                       ala.sales_stage_id,
                       ala.win_probability,
                       ala.decision_date,
                       sum(ala.total_amount * conversion_rate) as total_amount,
                       sum(ala.total_revenue_opp_forecast_amt * conversion_rate) forecast_amount,
 	                   row_number() over(ORDER BY  sum(ala.total_revenue_opp_forecast_amt * conversion_rate) desc) as forecast_rank
               FROM    as_leads_all ala,
                       (SELECT 
  /*+ no_merge */  DISTINCT    TERR_ENT.ENTITY_ID lead_id,
  HZP.PARTY_ID customer_id
FROM 
  XX_TM_NAM_TERR_ENTITY_DTLS TERR_ENT,
  XX_TM_NAM_TERR_RSC_DTLS TERR_RSC,
  XX_TM_NAM_TERR_DEFN TERR,
  HZ_PARTIES HZP,
  AS_LEADS ASL,
  AS_STATUSES_VL STATUS
WHERE 
  TERR.NAMED_ACCT_TERR_ID = TERR_ENT.NAMED_ACCT_TERR_ID AND
  TERR.NAMED_ACCT_TERR_ID = TERR_RSC.NAMED_ACCT_TERR_ID AND
  SYSDATE BETWEEN NVL(TERR.START_DATE_ACTIVE,SYSDATE-1) AND
  NVL(TERR.END_DATE_ACTIVE,SYSDATE+1) AND
  SYSDATE BETWEEN NVL(TERR_ENT.START_DATE_ACTIVE,SYSDATE-1) AND
  NVL(TERR_ENT.END_DATE_ACTIVE,SYSDATE+1) AND
  SYSDATE BETWEEN NVL(TERR_RSC.START_DATE_ACTIVE,SYSDATE-1) AND
  NVL(TERR_RSC.END_DATE_ACTIVE,SYSDATE+1)    AND
  ASL.CUSTOMER_ID = HZP.PARTY_ID AND
  ASL.LEAD_ID = TERR_ENT.ENTITY_ID    AND
  TERR_ENT.ENTITY_TYPE = 'OPPORTUNITY' 		     AND
STATUS.STATUS_CODE = ASL.STATUS AND
STATUS.OPP_OPEN_STATUS_FLAG = 'Y'
                        AND    TERR_RSC.RESOURCE_ID = :2
                        AND    TERR_RSC.RESOURCE_ID+0 = :3
                        ) secu,
                        as_period_rates apr,
				    as_statuses_b asb
                WHERE  ala.lead_id = secu.lead_id
                AND    ala.customer_id = secu.customer_id
                AND    ala.status = asb.status_code
			 AND    asb.opp_flag = 'Y'
			 AND    asb.forecast_rollup_flag = 'Y'
                AND    ala.currency_code = apr.from_currency 
                AND    apr.to_currency =  :4
                AND    apr.period_type = :5
                AND    apr.period_name =   (SELECT  period_name
                                       FROM gl_periods
                                       WHERE  period_set_name = :6
                                       AND    period_type = :7
                                       AND    start_date <= TRUNC(SYSDATE)
                                       AND    end_date  >= TRUNC(SYSDATE)
                                       AND    adjustment_period_flag = 'N')
                AND    apr.period_set_name = :8
                GROUP BY  ala.description,
                      ala.lead_id,
                      ala.customer_id,
                      ala.sales_stage_id,
                      ala.win_probability,
                      ala.decision_date)
           WHERE  forecast_rank < 11) top_oppty,
           hz_parties hp,
           as_sales_stages_all_tl asst
 WHERE     top_oppty.sales_stage_id = asst.sales_stage_id (+)
 AND       asst.language (+) = USERENV('LANG')
 AND       top_oppty.party_id = hp.party_id
 ORDER BY top_oppty.forecast_rank
   ]]></SQLQuery>
   <DesignTime>
      <Attr Name="_isCodegen" Value="true" />
      <Attr Name="_version" Value="9.0.3.13.93" />
      <Attr Name="_CodeGenFlagNew" Value="36" />
   </DesignTime>
   <ViewAttribute
      Name="Description"
      IsQueriable="false"
      IsPersistent="false"
      Precision="240"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="DESCRIPTION"
      Expression="DESCRIPTION"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="240" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="LeadId"
      IsQueriable="false"
      IsPersistent="false"
      IsNotNull="true"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="LEAD_ID"
      Expression="LEAD_ID"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="PartyId"
      IsQueriable="false"
      IsPersistent="false"
      IsNotNull="true"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="PARTY_ID"
      Expression="PARTY_ID"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="PartyName"
      IsQueriable="false"
      IsPersistent="false"
      IsNotNull="true"
      Precision="360"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="PARTY_NAME"
      Expression="PARTY_NAME"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="360" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="SalesStageName"
      IsQueriable="false"
      IsPersistent="false"
      Precision="60"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="SALES_STAGE_NAME"
      Expression="SALES_STAGE_NAME"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="60" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="TotalAmount"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="TOTAL_AMOUNT"
      Expression="TOTAL_AMOUNT"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="ForecastAmount"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="FORECAST_AMOUNT"
      Expression="FORECAST_AMOUNT"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="ForecastRank"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="FORECAST_RANK"
      Expression="FORECAST_RANK"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="DecisionDate"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Date"
      ColumnType="Date"
      AliasName="DECISION_DATE"
      Expression="DECISION_DATE"
      SQLType="DATE" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="7" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="WinProbability"
      IsQueriable="false"
      IsPersistent="false"
      Type="oracle.jbo.domain.Number"
      ColumnType="Number"
      AliasName="WIN_PROBABILITY"
      Expression="WIN_PROBABILITY"
      SQLType="NUMERIC" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
         <Attr Name="_DisplaySize" Value="22" />
      </DesignTime>
   </ViewAttribute>
   <ViewAttribute
      Name="Currenycode"
      IsPersistent="false"
      Type="java.lang.String"
      ColumnType="VARCHAR2"
      AliasName="CURRENYCODE"
      Expression="CURRENYCODE"
      SQLType="VARCHAR" >
      <DesignTime>
         <Attr Name="_OverrideAttr" Value="true" />
      </DesignTime>
   </ViewAttribute>
</ViewObject>

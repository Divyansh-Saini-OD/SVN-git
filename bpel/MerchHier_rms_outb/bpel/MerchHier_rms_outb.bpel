<?xml version = "1.0" encoding = "UTF-8" ?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Mon May 14 20:14:39 EDT 2007
  Author:  Steve-Abbott
  Purpose: Synchronous BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->
<process name="MerchHier_rms_outb"
         targetNamespace="http://xmlns.oracle.com/MerchHier_rms_outb"
         xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
         xmlns:ns13="http://xmlns.oracle.com/pcbpel/adapter/ftp/FtpToEbs/"
         xmlns:ns4="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
         xmlns:ns7="http://xmlns.oracle.com/pcbpel/adapter/db/RMS10/OD_BPEL_FND_SQL/STARTRUNNING/"
         xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema"
         xmlns:ns12="http://xmlns.oracle.com/pcbpel/adapter/db/RMS10/OD_BPEL_FND_SQL/GETNEXTMERCHHIERMESSAGE/"
         xmlns:ns5="http://www.oracle.com/XSL/Transform/java/oracle.tip.esb.server.headers.ESBHeaderFunctions"
         xmlns:client="http://xmlns.oracle.com/MerchHier_rms_outb"
         xmlns:ns6="http://xmlns.oracle.com/pcbpel/adapter/db/StartProcess/"
         xmlns:ora="http://schemas.oracle.com/xpath/extension"
         xmlns:ns11="http://xmlns.oracle.com/pcbpel/adapter/db/GetNextMessage/"
         xmlns:ns9="http://xmlns.oracle.com/pcbpel/adapter/db/StopProcess/"
         xmlns:ns1="http://xmlns.oracle.com/ODErrorLogger"
         xmlns:ns3="http://xmlns.oracle.com/bpel/workflow/xpath"
         xmlns:ns14="http://www.openapplications.org/officedepot/merchandising/foundation/1"
         xmlns:ns2="ODError"
         xmlns:bpelx="http://schemas.oracle.com/bpel/extension"
         xmlns:orcl="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
         xmlns:ns15="http://xmlns.oracle.com/I1116_Merchandising_Hierarchy_EBS_In"
         xmlns:ns8="http://xmlns.oracle.com/ias/pcbpel/NotificationService"
         xmlns:ns10="http://xmlns.oracle.com/pcbpel/adapter/db/RMS10/OD_BPEL_FND_SQL/STOPRUNNING/">
    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        PARTNERLINKS                                                      
        List of services participating in this BPEL process               
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
    <partnerLinks>
        <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
        <partnerLink name="client" partnerLinkType="client:MerchHier_rms_outb"
                     myRole="MerchHier_rms_outbProvider"
                     partnerRole="MerchHier_rms_outbProvider"/>
        <partnerLink myRole="ODErrorLoggerRequester" name="ODErrorLogger"
                     partnerRole="ODErrorLoggerProvider"
                     partnerLinkType="ns1:ODErrorLogger"/>
        <partnerLink name="StartProcess" partnerRole="StartProcess_role"
                     partnerLinkType="ns6:StartProcess_plt"/>
        <partnerLink name="NotificationService"
                     partnerRole="NotificationServiceProvider"
                     partnerLinkType="ns8:NotificationServiceLink"/>
        <partnerLink name="StopProcess" partnerRole="StopProcess_role"
                     partnerLinkType="ns9:StopProcess_plt"/>
        <partnerLink name="GetNextMessage" partnerRole="GetNextMessage_role"
                     partnerLinkType="ns11:GetNextMessage_plt"/>
        <partnerLink name="I1116_Merchandising_Hierarchy_EBS_In"
                     partnerRole="I1116_Merchandising_Hierarchy_EBS_InProvider"
                     partnerLinkType="ns15:I1116_Merchandising_Hierarchy_EBS_In"/>
    </partnerLinks>
    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        VARIABLES                                                        
        List of messages and XML documents used within this BPEL process 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
    <variables>
        <!-- Reference to the message passed as input during initiation -->
        <variable name="inputVariable"
                  messageType="client:MerchHier_rms_outbRequestMessage"/>
        <!-- Reference to the message that will be sent back to the requester during callback -->
        <variable name="outputVariable"
                  messageType="client:MerchHier_rms_outbResponseMessage"/>
        <variable name="exception" messageType="bpelx:RuntimeFaultMessage"/>
        <variable name="stopProcess" type="xsd:string"/>
        <variable name="xsd_merchhier" messageType="client:msgtype_merchhier"/>
        <variable name="Invoke_CatchAll_Exception_initiate_InputVariable"
                  messageType="ns1:ODErrorLoggerRequestMessage"/>
        <variable name="Invoke_Catch_BindingFault_initiate_InputVariable"
                  messageType="ns1:ODErrorLoggerRequestMessage"/>
        <variable name="Invoke_StartProcess_StartProcess_InputVariable"
                  messageType="ns6:args_in_msg"/>
        <variable name="Invoke_StartProcess_StartProcess_OutputVariable"
                  messageType="ns6:args_out_msg"/>
        <variable name="Invoke_StopProcess_StopProcess_InputVariable"
                  messageType="ns9:args_in_msg"/>
        <variable name="Invoke_StopProcess_StopProcess_OutputVariable"
                  messageType="ns9:args_out_msg"/>
        <variable name="Invoke_GetNextMessage_GetNextMessage_InputVariable"
                  messageType="ns11:args_in_msg"/>
        <variable name="Invoke_GetNextMessage_GetNextMessage_OutputVariable"
                  messageType="ns11:args_out_msg"/>
        <variable name="Invoke_I1116_MerchHierEBS_Input"
                  messageType="ns15:I1116_Merchandising_Hierarchy_EBS_InRequestMessage"/>
        <variable name="Invoke_I1116_MerchHierEBS_Output"
                  messageType="ns15:I1116_Merchandising_Hierarchy_EBS_InResponseMessage"/>
        <variable name="FaultVar_Binding"
                  messageType="bpelx:RuntimeFaultMessage"/>
        <variable name="FaultVar_Remote"
                  messageType="bpelx:RuntimeFaultMessage"/>
        <variable name="Invoke_BindFault_Input"
                  messageType="ns1:ODErrorLoggerRequestMessage"/>
        <variable name="Invoke_RemoteFault_Input"
                  messageType="ns1:ODErrorLoggerRequestMessage"/>
        <variable name="bpelprocessname" type="xsd:string"/>
    </variables>
    <faultHandlers>
        <catch faultName="bpelx:bindingFault" faultVariable="exception">
            <sequence name="Sequence_BindingFault">
                <assign name="Assign_Catch_BindingFault">
                    <copy>
                        <from expression="concat(ora:getProcessId(), ora:getProcessVersion())"/>
                        <to variable="Invoke_Catch_BindingFault_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessName"/>
                    </copy>
                    <copy>
                        <from expression="ora:getInstanceId()"/>
                        <to variable="Invoke_Catch_BindingFault_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessId"/>
                    </copy>
                    <copy>
                        <from expression="'MerchHier_rms_outb Catch BindingFault Exception'"/>
                        <to variable="Invoke_Catch_BindingFault_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessStep"/>
                    </copy>
                    <copy>
                        <from expression="ora:getDomainId()"/>
                        <to variable="Invoke_Catch_BindingFault_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessDomain"/>
                    </copy>
                    <copy>
                        <from expression="ora:getProcessURL()"/>
                        <to variable="Invoke_Catch_BindingFault_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ProcessInfo/ns2:SystemName"/>
                    </copy>
                    <copy>
                        <from variable="exception" part="code"/>
                        <to variable="Invoke_Catch_BindingFault_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorCode"/>
                    </copy>
                    <copy>
                        <from variable="exception" part="summary"/>
                        <to variable="Invoke_Catch_BindingFault_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorDescription"/>
                    </copy>
                    <copy>
                        <from variable="exception" part="detail"/>
                        <to variable="Invoke_Catch_BindingFault_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorText"/>
                    </copy>
                    <copy>
                        <from expression="xp20:current-dateTime()"/>
                        <to variable="Invoke_Catch_BindingFault_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorDateTime"/>
                    </copy>
                </assign>
                <invoke name="Invoke_Catch_BindingFault"
                        partnerLink="ODErrorLogger" portType="ns1:ODErrorLogger"
                        operation="initiate"
                        inputVariable="Invoke_Catch_BindingFault_initiate_InputVariable"/>
            </sequence>
        </catch>
        <catchAll>
            <sequence name="Sequence_CatchAll">
                <assign name="Assign_CatchAll_Exception">
                    <copy>
                        <from expression="concat(ora:getProcessId(), ora:getProcessVersion())"/>
                        <to variable="Invoke_CatchAll_Exception_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessName"/>
                    </copy>
                    <copy>
                        <from expression="ora:getInstanceId()"/>
                        <to variable="Invoke_CatchAll_Exception_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessId"/>
                    </copy>
                    <copy>
                        <from expression="'MerchHier_rms_outb CatchAll Exception'"/>
                        <to variable="Invoke_CatchAll_Exception_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessStep"/>
                    </copy>
                    <copy>
                        <from expression="ora:getDomainId()"/>
                        <to variable="Invoke_CatchAll_Exception_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessDomain"/>
                    </copy>
                    <copy>
                        <from expression="ora:getProcessURL()"/>
                        <to variable="Invoke_CatchAll_Exception_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ProcessInfo/ns2:SystemName"/>
                    </copy>
                    <copy>
                        <from expression="ora:getFaultAsString()"/>
                        <to variable="Invoke_CatchAll_Exception_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorText"/>
                    </copy>
                    <copy>
                        <from expression="xp20:current-dateTime()"/>
                        <to variable="Invoke_CatchAll_Exception_initiate_InputVariable"
                            part="payload"
                            query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorDateTime"/>
                    </copy>
                </assign>
                <invoke name="Invoke_CatchAll_Exception"
                        partnerLink="ODErrorLogger" portType="ns1:ODErrorLogger"
                        operation="initiate"
                        inputVariable="Invoke_CatchAll_Exception_initiate_InputVariable"/>
            </sequence>
        </catchAll>
    </faultHandlers>
    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
       ORCHESTRATION LOGIC                                               
       Set of activities coordinating the flow of messages across the    
       services integrated within this business process                  
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
    <sequence name="main">
        <!-- Receive input from requestor. (Note: This maps to operation defined in MerchHier_rms_outb.wsdl) -->
        <receive name="Start_Request" partnerLink="client"
                 portType="client:MerchHier_rms_outb" operation="process"
                 variable="inputVariable" createInstance="yes"/>
        <!-- 
          Synchronous callback to the requester. (Note: the callback location and correlation id is transparently handled using WS-addressing.)
        -->
        <assign name="Assign_Initial_Variables">
            <copy>
                <from expression="'N'"/>
                <to variable="stopProcess"/>
            </copy>
            <copy>
                <from expression="'MerchHier_rms_outb'"/>
                <to variable="outputVariable" part="payload"
                    query="/client:MerchHier_rms_outbProcessResponse/client:result"/>
            </copy>
            <copy>
                <from expression="'MerchHier_rms_outb'"/>
                <to variable="Invoke_StartProcess_StartProcess_InputVariable"
                    part="InputParameters"
                    query="/ns7:InputParameters/I_PROCESS_NAME"/>
            </copy>
            <copy>
                <from expression="'MerchHier_rms_outb'"/>
                <to variable="Invoke_GetNextMessage_GetNextMessage_InputVariable"
                    part="InputParameters"
                    query="/ns12:InputParameters/I_PROCESS_NAME"/>
            </copy>
            <copy>
                <from expression="'MerchHier_rms_outb'"/>
                <to variable="Invoke_StopProcess_StopProcess_InputVariable"
                    part="InputParameters"
                    query="/ns10:InputParameters/I_PROCESS_NAME"/>
            </copy>
            <copy>
                <from expression="'MerchHier_rms_outb'"/>
                <to variable="bpelprocessname"/>
            </copy>
        </assign>
        <invoke name="Invoke_StartProcess" partnerLink="StartProcess"
                portType="ns6:StartProcess_ptt" operation="StartProcess"
                inputVariable="Invoke_StartProcess_StartProcess_InputVariable"
                outputVariable="Invoke_StartProcess_StartProcess_OutputVariable"/>
        <assign name="Assign_ReplyStartProcess">
            <copy>
                <from expression="concat(&quot;RC=&quot;,bpws:getVariableData('Invoke_StartProcess_StartProcess_OutputVariable','OutputParameters','/ns7:OutputParameters/O_RET_CODE'),&quot;, MSG=&quot;,bpws:getVariableData('Invoke_StartProcess_StartProcess_OutputVariable','OutputParameters','/ns7:OutputParameters/O_RET_MESSAGE'))"/>
                <to variable="outputVariable" part="payload"
                    query="/client:MerchHier_rms_outbProcessResponse/client:result"/>
            </copy>
        </assign>
        <reply name="Reply_StartProcess" partnerLink="client"
               portType="client:MerchHier_rms_outb" operation="process"
               variable="outputVariable"/>
        <switch name="Switch_StartProcess">
            <case condition="bpws:getVariableData('Invoke_StartProcess_StartProcess_OutputVariable','OutputParameters','/ns7:OutputParameters/O_RET_CODE') = 0">
                <bpelx:annotation>
                    <bpelx:pattern>Start</bpelx:pattern>
                </bpelx:annotation>
                <sequence name="Sequence_CaseStart">
                    <while name="While_1"
                           condition="bpws:getVariableData('stopProcess') = 'N'">
                        <sequence name="Sequence_WhileNotStopped">
                            <invoke name="Invoke_GetNextMessage"
                                    partnerLink="GetNextMessage"
                                    portType="ns11:GetNextMessage_ptt"
                                    operation="GetNextMessage"
                                    inputVariable="Invoke_GetNextMessage_GetNextMessage_InputVariable"
                                    outputVariable="Invoke_GetNextMessage_GetNextMessage_OutputVariable"/>
                            <assign name="Assign_StopProcess">
                                <copy>
                                    <from variable="Invoke_GetNextMessage_GetNextMessage_OutputVariable"
                                          part="OutputParameters"
                                          query="/ns12:OutputParameters/O_STOP_RUNNING_FLAG"/>
                                    <to variable="stopProcess"/>
                                </copy>
                            </assign>
                            <switch name="Switch_ProcessMessage">
                                <case condition="bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_RET_CODE') = 0">
                                    <bpelx:annotation>
                                        <bpelx:pattern>GotMessage</bpelx:pattern>
                                    </bpelx:annotation>
                                    <sequence name="Sequence_GotMessage">
                                        <switch name="Switch_Type">
                                            <case condition="bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_HIERARCHY_TYPE') = 'DIVISION'">
                                                <bpelx:annotation>
                                                    <bpelx:pattern>DIVISION</bpelx:pattern>
                                                </bpelx:annotation>
                                                <assign name="Transform_DIVISION">
                                                    <bpelx:annotation>
                                                        <bpelx:pattern>transformation</bpelx:pattern>
                                                    </bpelx:annotation>
                                                    <copy>
                                                        <from expression="ora:processXSLT('Transformation_DIVISION.xsl',bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters'))"/>
                                                        <to variable="xsd_merchhier"
                                                            part="msgpart_merchhier"/>
                                                    </copy>
                                                </assign>
                                            </case>
                                            <case condition="bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_HIERARCHY_TYPE') = 'GROUP'">
                                                <bpelx:annotation>
                                                    <bpelx:pattern>GROUP</bpelx:pattern>
                                                </bpelx:annotation>
                                                <assign name="Transform_GROUP">
                                                    <bpelx:annotation>
                                                        <bpelx:pattern>transformation</bpelx:pattern>
                                                    </bpelx:annotation>
                                                    <copy>
                                                        <from expression="ora:processXSLT('Transformation_GROUP.xsl',bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters'))"/>
                                                        <to variable="xsd_merchhier"
                                                            part="msgpart_merchhier"/>
                                                    </copy>
                                                </assign>
                                            </case>
                                            <case condition="bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_HIERARCHY_TYPE') = 'DEPARTMENT'">
                                                <bpelx:annotation>
                                                    <bpelx:pattern>DEPARTMENT</bpelx:pattern>
                                                </bpelx:annotation>
                                                <assign name="Transform_DEPARTMENT">
                                                    <bpelx:annotation>
                                                        <bpelx:pattern>transformation</bpelx:pattern>
                                                    </bpelx:annotation>
                                                    <copy>
                                                        <from expression="ora:processXSLT('Transformation_DEPARTMENT.xsl',bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters'))"/>
                                                        <to variable="xsd_merchhier"
                                                            part="msgpart_merchhier"/>
                                                    </copy>
                                                </assign>
                                            </case>
                                            <case condition="bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_HIERARCHY_TYPE') = 'CLASS'">
                                                <bpelx:annotation>
                                                    <bpelx:pattern>CLASS</bpelx:pattern>
                                                </bpelx:annotation>
                                                <assign name="Transform_CLASS">
                                                    <bpelx:annotation>
                                                        <bpelx:pattern>transformation</bpelx:pattern>
                                                    </bpelx:annotation>
                                                    <copy>
                                                        <from expression="ora:processXSLT('Transformation_CLASS.xsl',bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters'))"/>
                                                        <to variable="xsd_merchhier"
                                                            part="msgpart_merchhier"/>
                                                    </copy>
                                                </assign>
                                            </case>
                                            <case condition="bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_HIERARCHY_TYPE') = 'SUBCLASS'">
                                                <bpelx:annotation>
                                                    <bpelx:pattern>SUBCLASS</bpelx:pattern>
                                                </bpelx:annotation>
                                                <assign name="Transform_SUBCLASS">
                                                    <bpelx:annotation>
                                                        <bpelx:pattern>transformation</bpelx:pattern>
                                                    </bpelx:annotation>
                                                    <copy>
                                                        <from expression="ora:processXSLT('Transformation_SUBCLASS.xsl',bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters'))"/>
                                                        <to variable="xsd_merchhier"
                                                            part="msgpart_merchhier"/>
                                                    </copy>
                                                </assign>
                                            </case>
                                            <otherwise>
                                                <assign name="Transform_All">
                                                    <bpelx:annotation>
                                                        <bpelx:pattern>transformation</bpelx:pattern>
                                                    </bpelx:annotation>
                                                    <copy>
                                                        <from expression="ora:processXSLT('Transformation_All.xsl',bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters'))"/>
                                                        <to variable="xsd_merchhier"
                                                            part="msgpart_merchhier"/>
                                                    </copy>
                                                </assign>
                                            </otherwise>
                                        </switch>
                                        <assign name="AsnRMStoEBS">
                                            <copy>
                                                <from variable="xsd_merchhier"
                                                      part="msgpart_merchhier"
                                                      query="/ns14:MerchandisingHierarchy"/>
                                                <to variable="Invoke_I1116_MerchHierEBS_Input"
                                                    part="payload"
                                                    query="/ns14:MerchandisingHierarchy"/>
                                            </copy>
                                        </assign>
                                        <scope name="Scope_I1116_MerchHierEBS">
                                            <faultHandlers>
                                                <catch faultName="bpelx:bindingFault"
                                                       faultVariable="FaultVar_Binding">
                                                    <sequence name="Sequence_7">
                                                        <assign name="AsnBindFault">
                                                            <copy>
                                                                <from expression="concat(ora:getProcessId(), ora:getProcessVersion())"/>
                                                                <to variable="Invoke_BindFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessName"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="ora:getInstanceId()"/>
                                                                <to variable="Invoke_BindFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessId"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="'MerchHier_rms_outb Binding Fault'"/>
                                                                <to variable="Invoke_BindFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessStep"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="ora:getDomainId()"/>
                                                                <to variable="Invoke_BindFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessDomain"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="ora:getProcessURL()"/>
                                                                <to variable="Invoke_BindFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ProcessInfo/ns2:SystemName"/>
                                                            </copy>
                                                            <copy>
                                                                <from variable="FaultVar_Binding"
                                                                      part="code"/>
                                                                <to variable="Invoke_BindFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorCode"/>
                                                            </copy>
                                                            <copy>
                                                                <from variable="FaultVar_Binding"
                                                                      part="summary"/>
                                                                <to variable="Invoke_BindFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorDescription"/>
                                                            </copy>
                                                            <copy>
                                                                <from variable="FaultVar_Binding"
                                                                      part="detail"/>
                                                                <to variable="Invoke_BindFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorText"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="xp20:current-dateTime()"/>
                                                                <to variable="Invoke_BindFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorDateTime"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="'Y'"/>
                                                                <to variable="stopProcess"/>
                                                            </copy>
                                                        </assign>
                                                        <scope name="Email_BindFault">
                                                            <bpelx:annotation>
                                                                <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                            </bpelx:annotation>
                                                            <variables>
                                                                <variable name="varNotificationReq"
                                                                          messageType="ns8:EmailNotificationRequest"/>
                                                                <variable name="varNotificationResponse"
                                                                          messageType="ns8:ArrayOfResponse"/>
                                                                <variable name="NotificationServiceFaultVariable"
                                                                          messageType="ns8:NotificationServiceErrorMessage"/>
                                                            </variables>
                                                            <sequence name="Sequence_4">
                                                                <assign name="EmailParamsAssign">
                                                                    <copy>
                                                                        <from expression="string('SOAEmailNotify')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:FromAccountName"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="string('')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Bcc"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="string('')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Cc"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="string('')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:ReplyToAddress"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="concat(bpws:getVariableData('bpelprocessname'), string(' notification - binding fault error while connecting to EBS.! '))"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Subject"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="bpws:getVariableData('Invoke_StartProcess_StartProcess_OutputVariable','OutputParameters','/ns7:OutputParameters/O_EMAIL_TO')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:To"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from>
                                                                            <Content xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">multipart/mixed</MimeType>
                                                                                <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                    <MultiPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                        <BodyPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                            <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                            <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                            <BodyPartName xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                        </BodyPart>
                                                                                    </MultiPart>
                                                                                </ContentBody>
                                                                            </Content>
                                                                        </from>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Content"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="string('text/html; charset=UTF-8')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:MimeType"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="string('NotificationAttachment1.html')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:BodyPartName"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="concat(string('Input Msg:
'), bpws:getVariableData('Invoke_I1116_MerchHierEBS_Input','payload'), string('
&lt;br>
Error Code: '), bpws:getVariableData('FaultVar_Binding','code'), string('
&lt;br>
Error Desc: '), bpws:getVariableData('FaultVar_Binding','summary'), string('
&lt;br>
'))"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:ContentBody"/>
                                                                    </copy>
                                                                </assign>
                                                                <invoke name="InvokeNotificationService"
                                                                        partnerLink="NotificationService"
                                                                        portType="ns8:NotificationService"
                                                                        operation="sendEmailNotification"
                                                                        inputVariable="varNotificationReq"
                                                                        outputVariable="varNotificationResponse"/>
                                                            </sequence>
                                                        </scope>
                                                        <invoke name="Invoke_BindFault"
                                                                partnerLink="ODErrorLogger"
                                                                portType="ns1:ODErrorLogger"
                                                                operation="initiate"
                                                                inputVariable="Invoke_BindFault_Input"/>
                                                    </sequence>
                                                </catch>
                                                <catch faultName="bpelx:remoteFault"
                                                       faultVariable="FaultVar_Remote">
                                                    <sequence name="Sequence_8">
                                                        <assign name="AsnRemoteFault">
                                                            <copy>
                                                                <from expression="concat(ora:getProcessId(), ora:getProcessVersion())"/>
                                                                <to variable="Invoke_RemoteFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessName"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="ora:getInstanceId()"/>
                                                                <to variable="Invoke_RemoteFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessId"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="'MerchHier_rms_outb Remote Fault'"/>
                                                                <to variable="Invoke_RemoteFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessStep"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="ora:getDomainId()"/>
                                                                <to variable="Invoke_RemoteFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ProcessInfo/ns2:BusinessProcessDomain"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="ora:getProcessURL()"/>
                                                                <to variable="Invoke_RemoteFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ProcessInfo/ns2:SystemName"/>
                                                            </copy>
                                                            <copy>
                                                                <from variable="FaultVar_Remote"
                                                                      part="code"/>
                                                                <to variable="Invoke_RemoteFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorCode"/>
                                                            </copy>
                                                            <copy>
                                                                <from variable="FaultVar_Remote"
                                                                      part="summary"/>
                                                                <to variable="Invoke_RemoteFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorDescription"/>
                                                            </copy>
                                                            <copy>
                                                                <from variable="FaultVar_Remote"
                                                                      part="detail"/>
                                                                <to variable="Invoke_RemoteFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorText"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="xp20:current-dateTime()"/>
                                                                <to variable="Invoke_RemoteFault_Input"
                                                                    part="payload"
                                                                    query="/ns2:ErrorData/ns2:ErrorDetails/ns2:ErrorDateTime"/>
                                                            </copy>
                                                            <copy>
                                                                <from expression="'Y'"/>
                                                                <to variable="stopProcess"/>
                                                            </copy>
                                                        </assign>
                                                        <scope name="Email_RemoteFault">
                                                            <bpelx:annotation>
                                                                <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                            </bpelx:annotation>
                                                            <variables>
                                                                <variable name="varNotificationReq"
                                                                          messageType="ns8:EmailNotificationRequest"/>
                                                                <variable name="varNotificationResponse"
                                                                          messageType="ns8:ArrayOfResponse"/>
                                                                <variable name="NotificationServiceFaultVariable"
                                                                          messageType="ns8:NotificationServiceErrorMessage"/>
                                                            </variables>
                                                            <sequence name="Sequence_5">
                                                                <assign name="EmailParamsAssign">
                                                                    <copy>
                                                                        <from expression="string('SOAEmailNotify')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:FromAccountName"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="string('')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Bcc"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="string('')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Cc"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="string('')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:ReplyToAddress"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="concat(bpws:getVariableData('bpelprocessname'), string(' notification - remote fault error while connecting to EBS.! '))"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Subject"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="bpws:getVariableData('Invoke_StartProcess_StartProcess_OutputVariable','OutputParameters','/ns7:OutputParameters/O_EMAIL_TO')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:To"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from>
                                                                            <Content xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">multipart/mixed</MimeType>
                                                                                <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                    <MultiPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                        <BodyPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                            <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                            <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                            <BodyPartName xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                        </BodyPart>
                                                                                    </MultiPart>
                                                                                </ContentBody>
                                                                            </Content>
                                                                        </from>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Content"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="string('text/html; charset=UTF-8')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:MimeType"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="string('NotificationAttachment1.html')"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:BodyPartName"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from expression="concat(string('Input Msg:
'), bpws:getVariableData('Invoke_I1116_MerchHierEBS_Input','payload'), string('
&lt;br>
Error Code: '), bpws:getVariableData('FaultVar_Remote','code'), string('
&lt;br>
Error Desc: '), bpws:getVariableData('FaultVar_Remote','summary'), string('
&lt;br>
'))"/>
                                                                        <to variable="varNotificationReq"
                                                                            part="EmailPayload"
                                                                            query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:ContentBody"/>
                                                                    </copy>
                                                                </assign>
                                                                <invoke name="InvokeNotificationService"
                                                                        partnerLink="NotificationService"
                                                                        portType="ns8:NotificationService"
                                                                        operation="sendEmailNotification"
                                                                        inputVariable="varNotificationReq"
                                                                        outputVariable="varNotificationResponse"/>
                                                            </sequence>
                                                        </scope>
                                                        <invoke name="Invoke_RemoteFault"
                                                                partnerLink="ODErrorLogger"
                                                                portType="ns1:ODErrorLogger"
                                                                operation="initiate"
                                                                inputVariable="Invoke_RemoteFault_Input"/>
                                                    </sequence>
                                                </catch>
                                            </faultHandlers>
                                            <sequence name="Sequence_1">
                                                <invoke name="Invoke_I1116_MerchHierEBS"
                                                        partnerLink="I1116_Merchandising_Hierarchy_EBS_In"
                                                        portType="ns15:I1116_Merchandising_Hierarchy_EBS_In"
                                                        operation="process"
                                                        inputVariable="Invoke_I1116_MerchHierEBS_Input"
                                                        outputVariable="Invoke_I1116_MerchHierEBS_Output"/>
                                                <switch name="Switch_I1116_MerchHierEBS">
                                                    <case condition="bpws:getVariableData('Invoke_I1116_MerchHierEBS_Output','payload','/ns14:CommonResponse/ns14:ReturnCode')=-1">
                                                        <sequence name="Seq_I1116_MerchHierEBS">
                                                            <assign name="Asnstopprocess">
                                                                <copy>
                                                                    <from expression="'Y'"/>
                                                                    <to variable="stopProcess"/>
                                                                </copy>
                                                            </assign>
                                                            <scope name="Email_I1116_MerchHierEBS">
                                                                <bpelx:annotation>
                                                                    <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                                </bpelx:annotation>
                                                                <variables>
                                                                    <variable name="varNotificationReq"
                                                                              messageType="ns8:EmailNotificationRequest"/>
                                                                    <variable name="varNotificationResponse"
                                                                              messageType="ns8:ArrayOfResponse"/>
                                                                    <variable name="NotificationServiceFaultVariable"
                                                                              messageType="ns8:NotificationServiceErrorMessage"/>
                                                                </variables>
                                                                <sequence name="Sequence_3">
                                                                    <assign name="EmailParamsAssign">
                                                                        <copy>
                                                                            <from expression="string('SOAEmailNotify')"/>
                                                                            <to variable="varNotificationReq"
                                                                                part="EmailPayload"
                                                                                query="/EmailPayload/ns8:FromAccountName"/>
                                                                        </copy>
                                                                        <copy>
                                                                            <from expression="string('')"/>
                                                                            <to variable="varNotificationReq"
                                                                                part="EmailPayload"
                                                                                query="/EmailPayload/ns8:Bcc"/>
                                                                        </copy>
                                                                        <copy>
                                                                            <from expression="string('')"/>
                                                                            <to variable="varNotificationReq"
                                                                                part="EmailPayload"
                                                                                query="/EmailPayload/ns8:Cc"/>
                                                                        </copy>
                                                                        <copy>
                                                                            <from expression="string('')"/>
                                                                            <to variable="varNotificationReq"
                                                                                part="EmailPayload"
                                                                                query="/EmailPayload/ns8:ReplyToAddress"/>
                                                                        </copy>
                                                                        <copy>
                                                                            <from expression="string('MerchHier_rms_outb - Error while invoking EBS process')"/>
                                                                            <to variable="varNotificationReq"
                                                                                part="EmailPayload"
                                                                                query="/EmailPayload/ns8:Subject"/>
                                                                        </copy>
                                                                        <copy>
                                                                            <from expression="bpws:getVariableData('Invoke_StartProcess_StartProcess_OutputVariable','OutputParameters','/ns7:OutputParameters/O_EMAIL_TO')"/>
                                                                            <to variable="varNotificationReq"
                                                                                part="EmailPayload"
                                                                                query="/EmailPayload/ns8:To"/>
                                                                        </copy>
                                                                        <copy>
                                                                            <from>
                                                                                <Content xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                    <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">multipart/mixed</MimeType>
                                                                                    <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                        <MultiPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                            <BodyPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                                <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                                <BodyPartName xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                            </BodyPart>
                                                                                        </MultiPart>
                                                                                    </ContentBody>
                                                                                </Content>
                                                                            </from>
                                                                            <to variable="varNotificationReq"
                                                                                part="EmailPayload"
                                                                                query="/EmailPayload/ns8:Content"/>
                                                                        </copy>
                                                                        <copy>
                                                                            <from expression="string('text/html; charset=UTF-8')"/>
                                                                            <to variable="varNotificationReq"
                                                                                part="EmailPayload"
                                                                                query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:MimeType"/>
                                                                        </copy>
                                                                        <copy>
                                                                            <from expression="string('NotificationAttachment1.html')"/>
                                                                            <to variable="varNotificationReq"
                                                                                part="EmailPayload"
                                                                                query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:BodyPartName"/>
                                                                        </copy>
                                                                        <copy>
                                                                            <from expression="concat(string('Input Msg:
'), bpws:getVariableData('Invoke_I1116_MerchHierEBS_Input','payload'), string('
&lt;br>
&lt;br>
RC: '), bpws:getVariableData('Invoke_I1116_MerchHierEBS_Output','payload','/ns14:CommonResponse/ns14:ReturnCode'), string('
&lt;br>
MSG: '), bpws:getVariableData('Invoke_I1116_MerchHierEBS_Output','payload','/ns14:CommonResponse/ns14:ReturnMessage'), string('
&lt;br>
Change cd: '), bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_CHANGE_CD'), string('
&lt;br>
Hier Type: '), bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_HIERARCHY_TYPE'), string('
&lt;br>
Hier Id: '), bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_HIERARCHY_ID'), string('
&lt;br>
Hier Name: '), bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_HIERARCHY_NAME'), string('
&lt;br>'))"/>
                                                                            <to variable="varNotificationReq"
                                                                                part="EmailPayload"
                                                                                query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:ContentBody"/>
                                                                        </copy>
                                                                    </assign>
                                                                    <invoke name="InvokeNotificationService"
                                                                            partnerLink="NotificationService"
                                                                            portType="ns8:NotificationService"
                                                                            operation="sendEmailNotification"
                                                                            inputVariable="varNotificationReq"
                                                                            outputVariable="varNotificationResponse"/>
                                                                </sequence>
                                                            </scope>
                                                        </sequence>
                                                    </case>
                                                    <otherwise/>
                                                </switch>
                                            </sequence>
                                        </scope>
                                    </sequence>
                                </case>
                                <case condition="bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_RET_CODE') = 1">
                                    <bpelx:annotation>
                                        <bpelx:pattern>NoMessage</bpelx:pattern>
                                    </bpelx:annotation>
                                    <switch name="Switch_NoMessageSleepStop">
                                        <case condition="bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters','/ns12:OutputParameters/O_STOP_RUNNING_FLAG') = 'N'">
                                            <bpelx:annotation>
                                                <bpelx:pattern>Sleep</bpelx:pattern>
                                            </bpelx:annotation>
                                            <wait name="Wait_NoMessge"
                                                  for="concat('PT',bpws:getVariableData('Invoke_StartProcess_StartProcess_OutputVariable','OutputParameters','/ns7:OutputParameters/O_SLEEP_TIME'),'M')"/>
                                        </case>
                                        <otherwise/>
                                    </switch>
                                </case>
                                <otherwise>
                                    <sequence name="Sequence_StoppedProcess">
                                        <assign name="Assign_StoppedProcess">
                                            <copy>
                                                <from expression="'Y'"/>
                                                <to variable="stopProcess"/>
                                            </copy>
                                        </assign>
                                        <bpelx:exec name="Java_Embedding_NoMessage"
                                                    language="java"
                                                    version="1.3">
                                            <![CDATA[/*Write your java code below e.g.   
	System.out.println("Hello, World");  
*/  
checkpoint();]]>
                                        </bpelx:exec>
                                        <scope name="Scope_StoppedProcess">
                                            <scope name="Email_StoppedProcess">
                                                <bpelx:annotation>
                                                    <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                                </bpelx:annotation>
                                                <variables>
                                                    <variable name="varNotificationReq"
                                                              messageType="ns8:EmailNotificationRequest"/>
                                                    <variable name="varNotificationResponse"
                                                              messageType="ns8:ArrayOfResponse"/>
                                                    <variable name="NotificationServiceFaultVariable"
                                                              messageType="ns8:NotificationServiceErrorMessage"/>
                                                </variables>
                                                <sequence name="Sequence_EmailStoppedProcess">
                                                    <assign name="EmailParamsAssign">
                                                        <copy>
                                                            <from expression="string('SOAEmailNotify')"/>
                                                            <to variable="varNotificationReq"
                                                                part="EmailPayload"
                                                                query="/EmailPayload/ns8:FromAccountName"/>
                                                        </copy>
                                                        <copy>
                                                            <from expression="string('')"/>
                                                            <to variable="varNotificationReq"
                                                                part="EmailPayload"
                                                                query="/EmailPayload/ns8:Bcc"/>
                                                        </copy>
                                                        <copy>
                                                            <from expression="string('')"/>
                                                            <to variable="varNotificationReq"
                                                                part="EmailPayload"
                                                                query="/EmailPayload/ns8:Cc"/>
                                                        </copy>
                                                        <copy>
                                                            <from expression="string('')"/>
                                                            <to variable="varNotificationReq"
                                                                part="EmailPayload"
                                                                query="/EmailPayload/ns8:ReplyToAddress"/>
                                                        </copy>
                                                        <copy>
                                                            <from expression="concat(string('Stopped Process = '), bpws:getVariableData('Invoke_StopProcess_StopProcess_InputVariable','InputParameters','/ns10:InputParameters/I_PROCESS_NAME'))"/>
                                                            <to variable="varNotificationReq"
                                                                part="EmailPayload"
                                                                query="/EmailPayload/ns8:Subject"/>
                                                        </copy>
                                                        <copy>
                                                            <from expression="concat(bpws:getVariableData('Invoke_StartProcess_StartProcess_OutputVariable','OutputParameters','/ns7:OutputParameters/O_EMAIL_TO'), string(','))"/>
                                                            <to variable="varNotificationReq"
                                                                part="EmailPayload"
                                                                query="/EmailPayload/ns8:To"/>
                                                        </copy>
                                                        <copy>
                                                            <from>
                                                                <Content xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                    <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">multipart/mixed</MimeType>
                                                                    <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                        <MultiPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                            <BodyPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                                <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                                <BodyPartName xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                            </BodyPart>
                                                                        </MultiPart>
                                                                    </ContentBody>
                                                                </Content>
                                                            </from>
                                                            <to variable="varNotificationReq"
                                                                part="EmailPayload"
                                                                query="/EmailPayload/ns8:Content"/>
                                                        </copy>
                                                        <copy>
                                                            <from expression="string('text/html; charset=UTF-8')"/>
                                                            <to variable="varNotificationReq"
                                                                part="EmailPayload"
                                                                query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:MimeType"/>
                                                        </copy>
                                                        <copy>
                                                            <from expression="string('NotificationAttachment1.html')"/>
                                                            <to variable="varNotificationReq"
                                                                part="EmailPayload"
                                                                query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:BodyPartName"/>
                                                        </copy>
                                                        <copy>
                                                            <from expression="concat(string('Input Msg:
'), bpws:getVariableData('Invoke_GetNextMessage_GetNextMessage_OutputVariable','OutputParameters'), string('
&lt;br>
&lt;br>
Stopped Process = '), bpws:getVariableData('Invoke_StopProcess_StopProcess_InputVariable','InputParameters','/ns10:InputParameters/I_PROCESS_NAME'), string('
&lt;br>
&lt;br>
RC = '), bpws:getVariableData('Invoke_StopProcess_StopProcess_OutputVariable','OutputParameters','/ns10:OutputParameters/O_RET_CODE'), string('
&lt;br>
&lt;br>
MSG = '), bpws:getVariableData('Invoke_StopProcess_StopProcess_OutputVariable','OutputParameters','/ns10:OutputParameters/O_RET_MESSAGE'))"/>
                                                            <to variable="varNotificationReq"
                                                                part="EmailPayload"
                                                                query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:ContentBody"/>
                                                        </copy>
                                                    </assign>
                                                    <invoke name="InvokeNotificationService"
                                                            partnerLink="NotificationService"
                                                            portType="ns8:NotificationService"
                                                            operation="sendEmailNotification"
                                                            inputVariable="varNotificationReq"
                                                            outputVariable="varNotificationResponse"/>
                                                </sequence>
                                            </scope>
                                        </scope>
                                    </sequence>
                                </otherwise>
                            </switch>
                        </sequence>
                    </while>
                    <invoke name="Invoke_StopProcess" partnerLink="StopProcess"
                            portType="ns9:StopProcess_ptt"
                            operation="StopProcess"
                            inputVariable="Invoke_StopProcess_StopProcess_InputVariable"
                            outputVariable="Invoke_StopProcess_StopProcess_OutputVariable"/>
                </sequence>
            </case>
            <otherwise/>
        </switch>
    </sequence>
</process>
<?xml version = "1.0" encoding = "UTF-8" ?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Sat Apr 24 22:06:07 EDT 2010
  Author:  bala-edupuganti
  Purpose: Asynchronous BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->
<process name="ServiceRequestCreate"
         targetNamespace="http://xmlns.oracle.com/ServiceRequestCreate"
         xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:client="http://xmlns.oracle.com/ServiceRequestCreate"
         xmlns:ns21="http://xmlns.oracle.com/pcbpel/adapter/db/APPS/XX_CS_TDS_SR_PKG/UPDATE_SERVICEREQUEST/"
         xmlns:ns22="http://xmlns.oracle.com/ServiceRequestCreateWrapper"
         xmlns:ns20="http://TargetNamespace.com/ebsSrresponseSrvc"
         xmlns:ehdr="http://www.oracle.com/XSL/Transform/java/oracle.tip.esb.server.headers.ESBHeaderFunctions"
         xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
         xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
         xmlns:ns16="http://xmlns.oracle.com/pcbpel/adapter/mq/headerSRresponse2Aops/"
         xmlns:ns17="http://xmlns.oracle.com/pcbpel/adapter/db/APPS/BAP_TDS_SR_PKG/CREATE_SERVICEREQUEST/"
         xmlns:ns14="http://xmlns.oracle.com/pcbpel/adapter/db/APPS/XX_CS_TDS_SR_PKG/CREATE_SERVICEREQUEST/"
         xmlns:ns15="http://TargetNamespace.com/InboundService"
         xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
         xmlns:ns18="http://xmlns.oracle.com/pcbpel/adapter/mq/headerebsSrresponseSrvc/"
         xmlns:ns19="http://xmlns.oracle.com/pcbpel/adapter/apps/EbsUpdateSR/"
         xmlns:ns9="http://xmlns.oracle.com/SRException"
         xmlns:ns5="http://xmlns.oracle.com/ODErrorLogger"
         xmlns:ns12="http://xmlns.oracle.com/pcbpel/adapter/db/SenMail/"
         xmlns:ns13="http://xmlns.oracle.com/pcbpel/adapter/db/APPS/XX_OM_EMAIL_HANDLER_OUT/MIME_MAIL/"
         xmlns:ns6="ODError" xmlns:ns10="http://xmlns.oracle.com/SRexceptions"
         xmlns:ns7="http://TargetNamespace.com/DequeueAopsSOsubscribe"
         xmlns:ns8="http://xmlns.oracle.com/ias/pcbpel/NotificationService"
         xmlns:ns11="ODSRExceptions"
         xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/apps/EbsCreateSR/"
         xmlns:ns1="http://xmlns.oracle.com/pcbpel/adapter/mq/headerDequeueSR2Ebs/"
         xmlns:ns4="http://xmlns.oracle.com/pcbpel/adapter/db/APPS/XX_CS_SERVICEREQUEST_PKG/CREATE_SERVICEREQUEST/"
         xmlns:ns3="http://xmlns.oracle.com/pcbpel/adapter/mq/headerAopsSRresponse/"
         xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap"
         xmlns:ora="http://schemas.oracle.com/xpath/extension"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema"
         xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions"
         xmlns:bpelx="http://schemas.oracle.com/bpel/extension"
         xmlns:orcl="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc">
    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        PARTNERLINKS                                                      
        List of services participating in this BPEL process               
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
    <partnerLinks>
        <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
        <partnerLink myRole="Dequeue_role" name="DequeueSR2Ebs"
                     partnerLinkType="ns1:Dequeue_plt"/>
        <partnerLink myRole="ODErrorLoggerRequester" name="ODErrorLogger"
                     partnerRole="ODErrorLoggerProvider"
                     partnerLinkType="ns5:ODErrorLogger"/>
        <partnerLink name="NotificationService"
                     partnerRole="NotificationServiceProvider"
                     partnerLinkType="ns8:NotificationServiceLink"/>
        <!-- <partnerLink name="SRexceptions" partnerLinkType="ns10:SRexceptions"
                     myRole="SRexceptionsRequester"
                     partnerRole="SRexceptionsProvider"/>-->
        <partnerLink myRole="SRexceptionsRequester" name="SRexceptions"
                     partnerRole="SRexceptionsProvider"
                     partnerLinkType="ns10:SRexceptions"/>
        <!--        <partnerLink name="SendMail" partnerRole="SenMail_role"
                     partnerLinkType="ns12:SenMail_plt"/> -->
        <partnerLink name="ebsSrresponseSrvc" partnerRole="Enqueue_role"
                     partnerLinkType="ns18:Enqueue_plt"/>
        <partnerLink name="EbsUpdateSR" partnerRole="EbsUpdateSR_role"
                     partnerLinkType="ns19:EbsUpdateSR_plt"/>
        <partnerLink name="ServiceRequestCreateWrapper"
                     partnerRole="ServiceRequestCreateWrapperProvider"
                     partnerLinkType="ns22:ServiceRequestCreateWrapper"/>
    </partnerLinks>
    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        VARIABLES                                                        
        List of messages and XML documents used within this BPEL process 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
    <variables>
        <!-- Reference to the message passed as input during initiation -->
        <!--        <variable name="inputVariable"
                  messageType="client:ServiceRequestCreateRequestMessage"/> -->
        <!-- Reference to the message that will be sent back to the requester during callback -->
        <!-- <variable name="outputVariable"
                  messageType="client:ServiceRequestCreateResponseMessage"/> -->
        <variable name="DequeueAopsSR_InputVariable"
                  messageType="ns1:Root-Element_msg"/>
        <!--        <variable name="InvokeAopsSRresponse_InputVariable"
                  messageType="ns3:Root-Element_msg"/>-->
        <!--        <variable name="InvokeAopsErrorResponse_InputVariable"
                  messageType="ns3:Root-Element_msg"/> -->
        <variable name="invokeCreateFault_InputVariable"
                  messageType="ns5:ODErrorLoggerRequestMessage"/>
        <variable name="invokeResponseFault_InputVariable"
                  messageType="ns5:ODErrorLoggerRequestMessage"/>
        <variable name="invokeDequeueFault_InputVariable"
                  messageType="ns5:ODErrorLoggerRequestMessage"/>
        <!--      <variable name="InvokeSRexceptions_InputVariable"
                  messageType="ns9:SRExceptionRequestMessage"/>-->
        <variable name="InvokeSrexceptions_inputVariable"
                  messageType="ns10:SRexceptionsRequestMessage"/>
        <!--        <variable name="Invokesendmail_InputVariable"
                  messageType="ns12:args_in_msg"/> -->
        <!--        <variable name="InvokeResponseError_InputVariable"
                  messageType="ns3:Root-Element_msg"/> -->
        <!--        <variable name="InvokeResponseError_Enqueue_InputVariable"
                  messageType="ns3:Root-Element_msg"/> -->
        <!--        <variable name="InvokeResponseError_Enqueue_InputVariable_1"
                  messageType="ns3:Root-Element_msg"/>  -->
        <!--        <variable name="InvokeResponseError_Enqueue_InputVariable_2"
                  messageType="ns3:Root-Element_msg"/> -->
        <!--        <variable name="InvokeResponseError_EnqInputVariable"
                  messageType="ns3:Root-Element_msg"/> -->
        <!--        <variable name="Invoke_1_Enqueue_InputVariable"
                  messageType="ns3:Root-Element_msg"/> -->
        <!--        <variable name="Invoke_1_Enqueue_InputVariable_1"
                  messageType="ns3:Root-Element_msg"/> -->
        <!--        <variable name="InvokeResponse_Enqueue_InputVariable"
                  messageType="ns16:Root-Element_msg"/> -->
        <!--        <variable name="InvokeAopsSRresponse_Enqueue_InputVariable"
                  messageType="ns16:Root-Element_msg"/> -->
        <!--        <variable name="InvokeSrResponse_InputVariable"
                  messageType="ns16:Root-Element_msg"/> -->
        <variable name="InvokeSrResponse_Enqueue_InputVariable"
                  messageType="ns18:Root-Element_msg"/>
        <variable name="InvokeUpdateSR_InputVariable"
                  messageType="ns19:args_in_msg"/>
        <variable name="InvokeUpdateSR_OutputVariable"
                  messageType="ns19:args_out_msg"/>
        <variable name="EbsUpdateSR_InputVariable"
                  messageType="ns19:args_in_msg"/>
        <variable name="EbsUpdateSR_OutputVariable"
                  messageType="ns19:args_out_msg"/>
        <variable name="invokeUpdateSRFault_InputVariable"
                  messageType="ns5:ODErrorLoggerRequestMessage"/>
        <variable name="TempErrmsg" type="xsd:string"/>
        <variable name="globalOrderNumber" type="xsd:string"/>
        <variable name="globalSRnumber" type="xsd:string"/>
        <variable name="EbsCreateSR_InputVariable"
                  messageType="ns22:ServiceRequestCreateWrapperRequestMessage"/>
        <variable name="EbsCreateSR_OutputVariable"
                  messageType="ns22:ServiceRequestCreateWrapperResponseMessage"/>
        <variable name="FaultVar" messageType="ns22:FaultResponseMessage"/>
    </variables>
    <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
       ORCHESTRATION LOGIC                                               
       Set of activities coordinating the flow of messages across the    
       services integrated within this business process                  
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
    <sequence name="SRCreate">
        <!-- Receive input from requestor. (Note: This maps to operation defined in ServiceRequestCreate.wsdl) -->
        <!-- 
          Asynchronous callback to the requester. (Note: the callback location and correlation id is transparently handled using WS-addressing.)
        -->
        <scope name="DequeueSRfromAops">
            <faultHandlers>
                <catchAll>
                    <sequence name="SequenceCatchAll">
                        <assign name="assignDequeueSRFault">
                            <copy>
                                <from expression="concat(ora:getProcessId(),ora:getProcessVersion())"/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessName"/>
                            </copy>
                            <copy>
                                <from expression="ora:getInstanceId()"/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessId"/>
                            </copy>
                            <copy>
                                <from expression="ora:getDomainId()"/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessDomain"/>
                            </copy>
                            <copy>
                                <from expression='"DEQUEUE SR"'/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:SystemName"/>
                            </copy>
                            <copy>
                                <from expression="ora:getCurrentDateTime()"/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorDateTime"/>
                            </copy>
                            <copy>
                                <from expression="bpws:getVariableData('DequeueAopsSR_InputVariable','Root-Element','/ns15:Root-Element')"/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:MessageDetails/ns6:MessageData"/>
                            </copy>
                            <copy>
                                <from expression='"Catch All at Dequeue the SR message"'/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessStep"/>
                            </copy>
                            <copy>
                                <from expression="ora:getFaultName()"/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorCode"/>
                            </copy>
                            <copy>
                                <from expression="ora:getFaultAsString()"/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorText"/>
                            </copy>
                            <copy>
                                <from expression='"System"'/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorType"/>
                            </copy>
                            <copy>
                                <from expression='"Fatal"'/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorSeverity"/>
                            </copy>
                            <copy>
                                <from expression="ora:doc('${server_url}/xmllib/otc/GlobalParameters.xml','/GlobalParameters/ServiceRequestCreate/FaultNotification/SendNotification')"/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:Notification/ns6:sendNotification"/>
                            </copy>
                            <copy>
                                <from variable="DequeueAopsSR_InputVariable"
                                      part="Root-Element"
                                      query="/ns15:Root-Element"/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:Notification/ns6:Body"/>
                            </copy>
                            <copy>
                                <from expression="ora:doc('${server_url}/xmllib/otc/GlobalParameters.xml','/GlobalParameters/ServiceRequestCreate/FaultNotification/EmailTo')"/>
                                <to variable="invokeDequeueFault_InputVariable"
                                    part="payload"
                                    query="/ns6:ErrorData/ns6:Notification/ns6:RecipientList/ns6:Recipient/ns6:RecipientAddress"/>
                            </copy>
                        </assign>
                        <invoke name="invokeDequeueFault"
                                partnerLink="ODErrorLogger"
                                portType="ns5:ODErrorLogger"
                                operation="initiate"
                                inputVariable="invokeDequeueFault_InputVariable"/>
                        <terminate name="terminateProcess"/>
                    </sequence>
                </catchAll>
            </faultHandlers>
            <sequence name="SequenceDequeueSR">
                <receive name="DequeueAopsSR" partnerLink="DequeueSR2Ebs"
                         portType="ns1:Dequeue_ptt" operation="Dequeue"
                         variable="DequeueAopsSR_InputVariable"
                         createInstance="yes"/>
                <assign name="TransformSR">
                    <bpelx:annotation>
                        <bpelx:pattern>transformation</bpelx:pattern>
                    </bpelx:annotation>
                    <copy>
                        <from expression="ora:processXSLT('Transform_SRcreate.xsl',bpws:getVariableData('DequeueAopsSR_InputVariable','Root-Element'))"/>
                        <to variable="EbsCreateSR_InputVariable"
                            part="InputParameters"/>
                    </copy>
                </assign>
                <assign name="assignOrderNumber">
                    <copy>
                        <from variable="DequeueAopsSR_InputVariable"
                              part="Root-Element"
                              query="/ns15:Root-Element/ns15:SERVICE_MQ/ns15:order_number"/>
                        <to variable="globalOrderNumber"/>
                    </copy>
                </assign>
                <bpelx:exec name="SetInstanceTitle" language="java"
                            version="1.3">
                    <![CDATA[try {                       
  String title1 = "ServiceCreateOrder#";   
  String title2 = (String)getVariableData("globalOrderNumber");   
  String title = title1 + title2;   
  setTitle(title);                       
  addAuditTrailEntry(title) ;                       
} catch (Exception ex) {                       
  addAuditTrailEntry(ex.toString());                       
  ex.printStackTrace();                       
}]]>
                </bpelx:exec>
                <switch name="Switch_1">
                    <case condition="bpws:getVariableData('DequeueAopsSR_InputVariable','Root-Element','/ns15:Root-Element/ns15:SERVICE_MQ/ns15:action_code')= &quot;NEW&quot;">
                        <bpelx:annotation>
                            <bpelx:pattern>action_code_check</bpelx:pattern>
                        </bpelx:annotation>
                        <scope name="CreateSRinEbs">
                            <faultHandlers>
                                <catchAll>
                                    <sequence name="SequenceCreateSRFault">
                                        <assign name="assignCreateSRFault">
                                            <copy>
                                                <from expression="concat(ora:getProcessId(),ora:getProcessVersion())"/>
                                                <to variable="invokeCreateFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessName"/>
                                            </copy>
                                            <copy>
                                                <from expression="ora:getInstanceId()"/>
                                                <to variable="invokeCreateFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessId"/>
                                            </copy>
                                            <copy>
                                                <from expression="ora:getDomainId()"/>
                                                <to variable="invokeCreateFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessDomain"/>
                                            </copy>
                                            <copy>
                                                <from expression="'CREATE SR'"/>
                                                <to variable="invokeCreateFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:SystemName"/>
                                            </copy>
                                            <copy>
                                                <from expression="ora:getCurrentDateTime()"/>
                                                <to variable="invokeCreateFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorDateTime"/>
                                            </copy>
                                            <copy>
                                                <from expression="ora:doc('${server_url}/xmllib/otc/GlobalParameters.xml','/GlobalParameters/ServiceRequestCreate/FaultNotification/SendNotification')"/>
                                                <to variable="invokeCreateFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:Notification/ns6:sendNotification"/>
                                            </copy>
                                            <copy>
                                                <from expression="'System'"/>
                                                <to variable="invokeCreateFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorType"/>
                                            </copy>
                                            <copy>
                                                <from expression="'Fatal'"/>
                                                <to variable="invokeCreateFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorSeverity"/>
                                            </copy>
                                            <copy>
                                                <from expression="ora:getFaultName()"/>
                                                <to variable="invokeCreateFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorCode"/>
                                            </copy>
                                            <copy>
                                                <from variable="EbsCreateSR_OutputVariable"
                                                      part="OutputParameters"
                                                      query="/ns14:OutputParameters/ns14:X_MSG_DATA"/>
                                                <to variable="invokeCreateFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorDescription"/>
                                            </copy>
                                        </assign>
                                        <invoke name="invokeCreateSRFault"
                                                partnerLink="ODErrorLogger"
                                                portType="ns5:ODErrorLogger"
                                                operation="initiate"
                                                inputVariable="invokeCreateFault_InputVariable"/>
                                        <terminate name="terminateProcess"/>
                                    </sequence>
                                </catchAll>
                            </faultHandlers>
                            <sequence name="SequenceInvokeEbs">
                                <scope name="ScopeInvokeSRWrapper">
                                    <faultHandlers>
                                        <catch faultName="ns22:CustomerNotFoundFault"
                                               faultVariable="FaultVar">
                                            <sequence name="Sequence_12">
                                                <assign name="AssignFaultAsWrapperOutput">
                                                    <copy>
                                                        <from variable="FaultVar"
                                                              part="OutputParameters"
                                                              query="/ns14:OutputParameters"/>
                                                        <to variable="EbsCreateSR_OutputVariable"
                                                            part="OutputParameters"
                                                            query="/ns14:OutputParameters"/>
                                                    </copy>
                                                </assign>
                                                <throw name="ThrowFaultToSendEmail"
                                                       faultName="ns22:CustomerNotFoundFault"/>
                                            </sequence>
                                        </catch>
                                    </faultHandlers>
                                    <invoke name="InvokeCreateSRWrapper"
                                            partnerLink="ServiceRequestCreateWrapper"
                                            portType="ns22:ServiceRequestCreateWrapper"
                                            operation="processServiceRequestCreate"
                                            inputVariable="EbsCreateSR_InputVariable"
                                            outputVariable="EbsCreateSR_OutputVariable"/>
                                </scope>
                                <assign name="Transformcoomon">
                                    <bpelx:annotation>
                                        <bpelx:pattern>transformation</bpelx:pattern>
                                    </bpelx:annotation>
                                    <copy>
                                        <from expression="ora:processXSLT('TransformCreatecommon.xsl',bpws:getVariableData('EbsCreateSR_OutputVariable','OutputParameters'))"/>
                                        <to variable="InvokeSrResponse_Enqueue_InputVariable"
                                            part="Root-Element"/>
                                    </copy>
                                </assign>
                                <assign name="AssignErrMsg">
                                    <copy>
                                        <from variable="EbsCreateSR_OutputVariable"
                                              part="OutputParameters"
                                              query="/ns14:OutputParameters/ns14:X_MSG_DATA"/>
                                        <to variable="InvokeSrexceptions_inputVariable"
                                            part="payload"
                                            query="/ns11:ExceptionData/ns11:MessageDetails/ns11:MessageType"/>
                                    </copy>
                                </assign>
                            </sequence>
                        </scope>
                    </case>
                    <otherwise>
                        <scope name="UpdateSREbs">
                            <faultHandlers>
                                <catchAll>
                                    <sequence name="Sequence_10">
                                        <assign name="assignUpdateSRFault">
                                            <copy>
                                                <from expression="concat(ora:getProcessId(),ora:getProcessVersion())"/>
                                                <to variable="invokeUpdateSRFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessName"/>
                                            </copy>
                                            <copy>
                                                <from expression="ora:getInstanceId()"/>
                                                <to variable="invokeUpdateSRFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessId"/>
                                            </copy>
                                            <copy>
                                                <from expression="ora:getDomainId()"/>
                                                <to variable="invokeUpdateSRFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessDomain"/>
                                            </copy>
                                            <copy>
                                                <from expression="'UPDATE SR'"/>
                                                <to variable="invokeUpdateSRFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ProcessInfo/ns6:SystemName"/>
                                            </copy>
                                            <copy>
                                                <from expression="ora:getCurrentDateTime()"/>
                                                <to variable="invokeUpdateSRFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorDateTime"/>
                                            </copy>
                                            <copy>
                                                <from expression="ora:doc('${server_url}/xmllib/otc/GlobalParameters.xml','/GlobalParameters/ServiceRequestCreate/FaultNotification/SendNotification')"/>
                                                <to variable="invokeUpdateSRFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:Notification/ns6:sendNotification"/>
                                            </copy>
                                            <copy>
                                                <from expression="'System'"/>
                                                <to variable="invokeUpdateSRFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorType"/>
                                            </copy>
                                            <copy>
                                                <from expression="'Fatal'"/>
                                                <to variable="invokeUpdateSRFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorSeverity"/>
                                            </copy>
                                            <copy>
                                                <from variable="EbsUpdateSR_OutputVariable"
                                                      part="OutputParameters"
                                                      query="/ns21:OutputParameters/ns21:X_MSG_DATA"/>
                                                <to variable="invokeUpdateSRFault_InputVariable"
                                                    part="payload"
                                                    query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorDescription"/>
                                            </copy>
                                        </assign>
                                        <invoke name="invokeUpdateSRFault"
                                                partnerLink="ODErrorLogger"
                                                portType="ns5:ODErrorLogger"
                                                operation="initiate"
                                                inputVariable="invokeUpdateSRFault_InputVariable"/>
                                        <terminate name="terminateProcess"/>
                                    </sequence>
                                </catchAll>
                            </faultHandlers>
                            <sequence name="SequenceUpdateEbs">
                                <assign name="Transformupdate">
                                    <bpelx:annotation>
                                        <bpelx:pattern>transformation</bpelx:pattern>
                                    </bpelx:annotation>
                                    <copy>
                                        <from expression="ora:processXSLT('TransformUpdate.xsl',bpws:getVariableData('EbsCreateSR_InputVariable','InputParameters'))"/>
                                        <to variable="EbsUpdateSR_InputVariable"
                                            part="InputParameters"/>
                                    </copy>
                                </assign>
                                <invoke name="InvokeUpdateSR"
                                        partnerLink="EbsUpdateSR"
                                        portType="ns19:EbsUpdateSR_ptt"
                                        operation="EbsUpdateSR"
                                        inputVariable="EbsUpdateSR_InputVariable"
                                        outputVariable="EbsUpdateSR_OutputVariable"/>
                                <assign name="AssignUpdateRetMsg">
                                    <copy>
                                        <from variable="EbsUpdateSR_OutputVariable"
                                              part="OutputParameters"
                                              query="/ns21:OutputParameters/ns21:X_MSG_DATA"/>
                                        <to variable="InvokeSrexceptions_inputVariable"
                                            part="payload"
                                            query="/ns11:ExceptionData/ns11:MessageDetails/ns11:MessageType"/>
                                    </copy>
                                    <copy>
                                        <from variable="globalOrderNumber"/>
                                        <to variable="InvokeSrResponse_Enqueue_InputVariable"
                                            part="Root-Element"
                                            query="/ns20:Root-Element/ns20:RESPONSE_MQ/ns20:order_number"/>
                                    </copy>
                                    <copy>
                                        <from expression="'SUC'"/>
                                        <to variable="InvokeSrResponse_Enqueue_InputVariable"
                                            part="Root-Element"
                                            query="/ns20:Root-Element/ns20:RESPONSE_MQ/ns20:action_code"/>
                                    </copy>
                                    <copy>
                                        <from expression="'TD SERVICE'"/>
                                        <to variable="InvokeSrResponse_Enqueue_InputVariable"
                                            part="Root-Element"
                                            query="/ns20:Root-Element/ns20:RESPONSE_MQ/ns20:request_type"/>
                                    </copy>
                                </assign>
                            </sequence>
                        </scope>
                    </otherwise>
                </switch>
                <scope name="EnqueueSRNumber2Aops">
                    <faultHandlers>
                        <catchAll>
                            <sequence name="SequenceSRresponseFault">
                                <assign name="assignResponseFault">
                                    <copy>
                                        <from expression="ora:getProcessId()"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessName"/>
                                    </copy>
                                    <copy>
                                        <from expression="ora:getInstanceId()"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessId"/>
                                    </copy>
                                    <copy>
                                        <from expression="'Error At Sending Response step'"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessStep"/>
                                    </copy>
                                    <copy>
                                        <from expression="ora:getDomainId()"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:ProcessInfo/ns6:BusinessProcessDomain"/>
                                    </copy>
                                    <copy>
                                        <from expression="ora:getProcessURL()"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:ProcessInfo/ns6:SystemName"/>
                                    </copy>
                                    <copy>
                                        <from expression="xp20:current-dateTime()"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorDateTime"/>
                                    </copy>
                                    <copy>
                                        <from expression="ora:getFaultName()"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorCode"/>
                                    </copy>
                                    <copy>
                                        <from expression="ora:getFaultAsString()"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorText"/>
                                    </copy>
                                    <copy>
                                        <from expression="'System'"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorType"/>
                                    </copy>
                                    <copy>
                                        <from expression="'Fatal'"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:ErrorDetails/ns6:ErrorSeverity"/>
                                    </copy>
                                    <copy>
                                        <from expression="bpws:getVariableData('DequeueAopsSR_InputVariable','Root-Element','/ns15:Root-Element')"/>
                                        <to variable="invokeResponseFault_InputVariable"
                                            part="payload"
                                            query="/ns6:ErrorData/ns6:MessageDetails/ns6:MessageData"/>
                                    </copy>
                                </assign>
                                <invoke name="invokeResponseFault"
                                        partnerLink="ODErrorLogger"
                                        portType="ns5:ODErrorLogger"
                                        operation="initiate"
                                        inputVariable="invokeResponseFault_InputVariable"/>
                                <terminate name="terminateProcess"/>
                            </sequence>
                        </catchAll>
                    </faultHandlers>
                    <switch name="checkErrorStatus">
                        <case condition="bpws:getVariableData('EbsCreateSR_OutputVariable','OutputParameters','/ns14:OutputParameters/ns14:X_RETURN_STATUS') ='S' or bpws:getVariableData('EbsUpdateSR_OutputVariable','OutputParameters','/ns21:OutputParameters/ns21:X_RETURN_STATUS') = 'S'">
                            <bpelx:annotation>
                                <bpelx:pattern>Create SR Status</bpelx:pattern>
                            </bpelx:annotation>
                            <sequence name="SequenceEnsqueueSRNo">
                                <invoke name="InvokeAopsSRresponse"
                                        portType="ns18:Enqueue_ptt"
                                        inputVariable="InvokeSrResponse_Enqueue_InputVariable"
                                        partnerLink="ebsSrresponseSrvc"
                                        operation="Enqueue"/>
                            </sequence>
                        </case>
                        <otherwise>
                            <sequence name="SequenceInvokeExceptions">
                                <assign name="AssignErrStatus">
                                    <copy>
                                        <from expression="'ERR'"/>
                                        <to variable="InvokeSrResponse_Enqueue_InputVariable"
                                            part="Root-Element"
                                            query="/ns20:Root-Element/ns20:RESPONSE_MQ/ns20:action_code"/>
                                    </copy>
                                    <copy>
                                        <from variable="InvokeSrexceptions_inputVariable"
                                              part="payload"
                                              query="/ns11:ExceptionData/ns11:MessageDetails/ns11:MessageType"/>
                                        <to variable="TempErrmsg"/>
                                    </copy>
                                </assign>
                                <invoke name="InvokeSrResponse"
                                        partnerLink="ebsSrresponseSrvc"
                                        portType="ns18:Enqueue_ptt"
                                        operation="Enqueue"
                                        inputVariable="InvokeSrResponse_Enqueue_InputVariable"/>
                                <switch name="EmailCheck">
                                    <case condition="ora:doc('${server_url}/xmllib/otc/GlobalParameters.xml','/GlobalParameters/ServiceRequestCreate/FaultNotification/SendNotification') = 'Y'">
                                        <bpelx:annotation>
                                            <bpelx:pattern>CheckEmailAlert</bpelx:pattern>
                                        </bpelx:annotation>
                                        <scope name="Email2Support">
                                            <bpelx:annotation>
                                                <bpelx:pattern patternName="bpelx:email"></bpelx:pattern>
                                            </bpelx:annotation>
                                            <variables>
                                                <variable name="varNotificationReq"
                                                          messageType="ns8:EmailNotificationRequest"/>
                                                <variable name="varNotificationResponse"
                                                          messageType="ns8:ArrayOfResponse"/>
                                                <variable name="NotificationServiceFaultVariable"
                                                          messageType="ns8:NotificationServiceErrorMessage"/>
                                            </variables>
                                            <sequence name="Sequence_9">
                                                <assign name="EmailParamsAssign">
                                                    <copy>
                                                        <from expression="string('SOAEmailNotify')"/>
                                                        <to variable="varNotificationReq"
                                                            part="EmailPayload"
                                                            query="/EmailPayload/ns8:FromAccountName"/>
                                                    </copy>
                                                    <copy>
                                                        <from expression="string('')"/>
                                                        <to variable="varNotificationReq"
                                                            part="EmailPayload"
                                                            query="/EmailPayload/ns8:Bcc"/>
                                                    </copy>
                                                    <copy>
                                                        <from expression="string('')"/>
                                                        <to variable="varNotificationReq"
                                                            part="EmailPayload"
                                                            query="/EmailPayload/ns8:Cc"/>
                                                    </copy>
                                                    <copy>
                                                        <from expression="string('')"/>
                                                        <to variable="varNotificationReq"
                                                            part="EmailPayload"
                                                            query="/EmailPayload/ns8:ReplyToAddress"/>
                                                    </copy>
                                                    <copy>
                                                        <from expression="concat('Create SR Error', concat('Create SR Failed -',bpws:getVariableData('DequeueAopsSR_InputVariable','Root-Element','/ns15:Root-Element/ns15:SERVICE_MQ/ns15:order_number')))"/>
                                                        <to variable="varNotificationReq"
                                                            part="EmailPayload"
                                                            query="/EmailPayload/ns8:Subject"/>
                                                    </copy>
                                                    <copy>
                                                        <from expression="ora:doc('${server_url}/xmllib/otc/GlobalParameters.xml','/GlobalParameters/ServiceRequestCreate/FaultNotification/EmailTo')"/>
                                                        <to variable="varNotificationReq"
                                                            part="EmailPayload"
                                                            query="/EmailPayload/ns8:To"/>
                                                    </copy>
                                                    <copy>
                                                        <from>
                                                            <Content xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">multipart/mixed</MimeType>
                                                                <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                    <MultiPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                        <BodyPart xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService">
                                                                            <MimeType xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                            <ContentBody xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                            <BodyPartName xmlns="http://xmlns.oracle.com/ias/pcbpel/NotificationService"/>
                                                                        </BodyPart>
                                                                    </MultiPart>
                                                                </ContentBody>
                                                            </Content>
                                                        </from>
                                                        <to variable="varNotificationReq"
                                                            part="EmailPayload"
                                                            query="/EmailPayload/ns8:Content"/>
                                                    </copy>
                                                    <copy>
                                                        <from expression="string('text/html; charset=UTF-8')"/>
                                                        <to variable="varNotificationReq"
                                                            part="EmailPayload"
                                                            query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:MimeType"/>
                                                    </copy>
                                                    <copy>
                                                        <from expression="string('NotificationAttachment1.html')"/>
                                                        <to variable="varNotificationReq"
                                                            part="EmailPayload"
                                                            query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:BodyPartName"/>
                                                    </copy>
                                                    <copy>
                                                        <from expression="concat('Error from Oracle is -', bpws:getVariableData('TempErrmsg'))"/>
                                                        <to variable="varNotificationReq"
                                                            part="EmailPayload"
                                                            query="/EmailPayload/ns8:Content/ns8:ContentBody/ns8:MultiPart/ns8:BodyPart[1]/ns8:ContentBody"/>
                                                    </copy>
                                                </assign>
                                                <invoke name="InvokeNotificationService"
                                                        partnerLink="NotificationService"
                                                        portType="ns8:NotificationService"
                                                        operation="sendEmailNotification"
                                                        inputVariable="varNotificationReq"
                                                        outputVariable="varNotificationResponse"/>
                                            </sequence>
                                        </scope>
                                    </case>
                                    <otherwise/>
                                </switch>
                                <assign name="assignSrexceptions">
                                    <copy>
                                        <from variable="DequeueAopsSR_InputVariable"
                                              part="Root-Element"
                                              query="/ns15:Root-Element"/>
                                        <to variable="InvokeSrexceptions_inputVariable"
                                            part="payload"
                                            query="/ns11:ExceptionData/ns11:MessageDetails/ns11:MessageData"/>
                                    </copy>
                                    <copy>
                                        <from expression="concat(ora:getProcessId(),ora:getProcessVersion())"/>
                                        <to variable="InvokeSrexceptions_inputVariable"
                                            part="payload"
                                            query="/ns11:ExceptionData/ns11:ProcessInfo/ns11:BusinessProcessName"/>
                                    </copy>
                                    <copy>
                                        <from expression="ora:getInstanceId()"/>
                                        <to variable="InvokeSrexceptions_inputVariable"
                                            part="payload"
                                            query="/ns11:ExceptionData/ns11:ProcessInfo/ns11:BusinessProcessId"/>
                                    </copy>
                                    <copy>
                                        <from expression="ora:getDomainId()"/>
                                        <to variable="InvokeSrexceptions_inputVariable"
                                            part="payload"
                                            query="/ns11:ExceptionData/ns11:ProcessInfo/ns11:BusinessProcessDomain"/>
                                    </copy>
                                    <copy>
                                        <from expression="'CREATE SR'"/>
                                        <to variable="InvokeSrexceptions_inputVariable"
                                            part="payload"
                                            query="/ns11:ExceptionData/ns11:ProcessInfo/ns11:SystemName"/>
                                    </copy>
                                    <copy>
                                        <from expression="ora:getCurrentDateTime()"/>
                                        <to variable="InvokeSrexceptions_inputVariable"
                                            part="payload"
                                            query="/ns11:ExceptionData/ns11:ExceptionDetails/ns11:ExceptionDateTime"/>
                                    </copy>
                                    <copy>
                                        <from expression="ora:doc('${server_url}/xmllib/otc/GlobalParameters.xml','/GlobalParameters/ServiceRequestCreate/FaultNotification/SendNotification')"/>
                                        <to variable="InvokeSrexceptions_inputVariable"
                                            part="payload"
                                            query="/ns11:ExceptionData/ns11:Notification/ns11:sendNotification"/>
                                    </copy>
                                    <copy>
                                        <from variable="DequeueAopsSR_InputVariable"
                                              part="Root-Element"
                                              query="/ns15:Root-Element"/>
                                        <to variable="InvokeSrexceptions_inputVariable"
                                            part="payload"
                                            query="/ns11:ExceptionData/ns11:MessageDetails/ns11:MessageType"/>
                                    </copy>
                                </assign>
                                <invoke name="InvokeSrexceptions"
                                        partnerLink="SRexceptions"
                                        portType="ns10:SRexceptions"
                                        operation="initiate"
                                        inputVariable="InvokeSrexceptions_inputVariable"/>
                            </sequence>
                        </otherwise>
                    </switch>
                </scope>
            </sequence>
        </scope>
    </sequence>
</process>